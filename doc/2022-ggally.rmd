---
title: "GGally - æ‰©å±• ggplot2 çš„å¯è§†åŒ–åˆ©å™¨"
date: "2026-01-11"
categories: [RåŒ…, å¯è§†åŒ–, æ¢ç´¢æ€§åˆ†æ]
image: "figure/ggally-cover.svg"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.width = 10,
  fig.height = 8,
  fig.retina = 2,
  out.width = "100%",
  dpi = 150
)
```

## ğŸ“¦ RåŒ…ç®€ä»‹

> **GGally** æ˜¯ ggplot2 çš„æ‰©å±•åŒ…ï¼Œæ—¨åœ¨é€šè¿‡æ·»åŠ å‡ ä¸ªå‡½æ•°æ¥é™ä½ç»„åˆå‡ ä½•å¯¹è±¡çš„å¤æ‚æ€§ã€‚å®ƒæœ€è‘—åçš„åŠŸèƒ½æ˜¯å¿«é€Ÿç”ŸæˆçŸ©é˜µæ•£ç‚¹å›¾ã€ç›¸å…³ç³»æ•°çƒ­å›¾å’Œå¹³è¡Œåæ ‡å›¾ï¼Œæ˜¯æ¢ç´¢æ€§æ•°æ®åˆ†æï¼ˆEDAï¼‰çš„å¾—åŠ›åŠ©æ‰‹ã€‚

- **æ ¸å¿ƒåŠŸèƒ½**ï¼šçŸ©é˜µæ•£ç‚¹å›¾ (`ggpairs`)ã€åŒå˜é‡åˆ†æ (`ggbivariate`)ã€æ¨¡å‹è¯Šæ–­ (`ggnostic`)ã€ç³»æ•°å›¾ (`ggcoef_model`)
- **å®˜æ–¹é“¾æ¥**ï¼š[CRAN](https://cran.r-project.org/package=GGally) | [GitHub](https://github.com/ggobi/ggally) | [æ–‡æ¡£](https://ggobi.github.io/ggally/)

### ä¸ºä»€ä¹ˆé€‰æ‹©å®ƒï¼Ÿ

- **æ•ˆç‡æé«˜**ï¼šä¸€è¡Œä»£ç å³å¯æŸ¥çœ‹æ•°æ®é›†ä¸­æ‰€æœ‰å˜é‡çš„ä¸¤ä¸¤å…³ç³»ã€‚
- **å…¼å®¹æ€§å¥½**ï¼šåŸºäº ggplot2 æ„å»ºï¼Œå›¾è¡¨å¯¹è±¡å¯ä»¥åƒ ggplot ä¸€æ ·æ·»åŠ å›¾å±‚å’Œä¿®æ”¹ä¸»é¢˜ã€‚
- **ä¿¡æ¯ä¸°å¯Œ**ï¼šä¸ä»…å±•ç¤ºå›¾å½¢ï¼Œè¿˜è‡ªåŠ¨è®¡ç®—å¹¶å±•ç¤ºç›¸å…³ç³»æ•°ç­‰ç»Ÿè®¡é‡ã€‚

## ğŸ›  å®‰è£…ä¸åŠ è½½

```{r}
# å®‰è£…
if (!requireNamespace("GGally", quietly = TRUE)) {
  install.packages("GGally", repos = "https://cloud.r-project.org")
}
if (!requireNamespace("broom.helpers", quietly = TRUE)) {
  install.packages("broom.helpers", repos = "https://cloud.r-project.org")
}

# åŠ è½½
library(GGally)
library(ggplot2)
```

## ğŸ’¡ æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 1. ggpairs()ï¼šçŸ©é˜µæ•£ç‚¹å›¾ï¼ˆå®Œå…¨æŒ‡å—ï¼‰

`ggpairs()` æ˜¯ GGally çš„æ——èˆ°å‡½æ•°ã€‚é™¤äº†é»˜è®¤å±•ç¤ºï¼Œå®ƒå…è®¸é«˜åº¦è‡ªå®šä¹‰æ¯ä¸ªåŒºåŸŸï¼ˆå¯¹è§’çº¿ã€ä¸Šä¸‰è§’ã€ä¸‹ä¸‰è§’ï¼‰çš„å±•ç¤ºå½¢å¼ã€‚

#### åŸºç¡€ç”¨æ³•ä¸åˆ†ç»„

æœ€ç®€å•çš„ç”¨æ³•æ˜¯ç›´æ¥ä¼ å…¥æ•°æ®æ¡†ï¼Œä½†é€šå¸¸æˆ‘ä»¬éœ€è¦æŒ‡å®šåˆ—å’Œåˆ†ç»„å˜é‡ã€‚

```{r fig.width=10, fig.height=8}
# ä½¿ç”¨ iris æ•°æ®é›†
data(iris)

ggpairs(iris, 
        columns = 1:5,        # åŒ…å«æ•°å€¼å’Œåˆ†ç±»å˜é‡
        aes(color = Species,  # åˆ†ç»„ç€è‰²
            alpha = 0.5)) +   # é€æ˜åº¦
  theme_bw() +
  labs(title = "åŸºç¡€ç”¨æ³•ï¼šåˆ†ç»„å±•ç¤º")
```

#### è¿›é˜¶å®šåˆ¶ï¼šæ§åˆ¶ä¸åŒåŒºåŸŸ

ä½ å¯ä»¥é€šè¿‡ `upper`, `lower`, `diag` å‚æ•°åˆ†åˆ«æ§åˆ¶ä¸‰ä¸ªåŒºåŸŸçš„ç»˜å›¾ç±»å‹ (`continuous`, `combo`, `discrete`)ã€‚

```{r fig.width=10, fig.height=8}
# è‡ªå®šä¹‰å‡½æ•°ï¼šåˆ›å»ºæ›´ç¾è§‚çš„æ•£ç‚¹å›¾
my_scatter <- function(data, mapping, ...) {
  ggplot(data = data, mapping = mapping) +
    geom_point(..., size = 0.5) +  # ç¼©å°ç‚¹çš„å¤§å°
    geom_smooth(method = "lm", se = FALSE, size = 0.5) # æ·»åŠ å›å½’çº¿
}

ggpairs(iris, 
        columns = 1:4,
        aes(color = Species),
        # ä¸Šä¸‰è§’ï¼šå±•ç¤ºç›¸å…³ç³»æ•°ï¼Œå­—ä½“å¤§å°è®¾ä¸º 3
        upper = list(continuous = wrap("cor", size = 3)),
        # ä¸‹ä¸‰è§’ï¼šä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°
        lower = list(continuous = my_scatter),
        # å¯¹è§’çº¿ï¼šä½¿ç”¨å¯†åº¦å›¾ï¼Œé€æ˜åº¦ 0.5
        diag = list(continuous = wrap("densityDiag", alpha = 0.5))
        ) +
  theme_light() +
  labs(title = "è¿›é˜¶ç”¨æ³•ï¼šè‡ªå®šä¹‰é¢æ¿å‡½æ•°")
```

### 2. ggbivariate()ï¼šåŒå˜é‡åˆ†æ

å®˜æ–¹æ–‡æ¡£å°†å…¶æ ‡è®°ä¸º"ä¸»è¦ç»˜å›¾å‡½æ•°"ä¹‹ä¸€ã€‚å®ƒç”¨äºå±•ç¤º**ä¸€ä¸ªç»“æœå˜é‡ (Outcome)** ä¸**å¤šä¸ªè§£é‡Šå˜é‡ (Explanatory)** ä¹‹é—´çš„å…³ç³»ã€‚è¿™åœ¨å»ºæ¨¡å‰çš„ EDA é˜¶æ®µéå¸¸é«˜æ•ˆã€‚

```{r fig.width=10, fig.height=6}
# ä»¥ tips æ•°æ®é›†ä¸ºä¾‹ (éœ€è¦ reshape2 æˆ–å…¶ä»–åŒ…æä¾›ï¼Œè¿™é‡Œç”¨ iris)
# æ¢ç´¢ Sepal.Length (æ•°å€¼å‹) ä¸å…¶ä»–å˜é‡çš„å…³ç³»
ggbivariate(iris, 
            outcome = "Sepal.Length", 
            explanatory = c("Sepal.Width", "Petal.Length", "Species")) +
  labs(title = "ggbivariate: æ¢ç´¢ Sepal.Length çš„å½±å“å› ç´ ")
```

### 3. ggcorr()ï¼šç›¸å…³æ€§çƒ­å›¾

ä¸“é—¨ç”¨äºå¯è§†åŒ–ç›¸å…³ç³»æ•°çŸ©é˜µï¼Œæ”¯æŒæ— éœ€è®¡ç®— `cor` ç›´æ¥ä¼ å…¥åŸå§‹æ•°æ®ã€‚

```{r fig.width=8, fig.height=6}
ggcorr(iris[, 1:4], 
       method = c("everything", "pearson"), # è®¡ç®—æ–¹æ³•
       label = TRUE,           # æ˜¾ç¤ºæ•°å€¼
       label_size = 3,         # æ•°å€¼å¤§å°
       label_round = 2,        # ä¿ç•™å°æ•°ä½
       label_alpha = TRUE,     # æ•°å€¼é€æ˜åº¦éšç›¸å…³æ€§å˜åŒ–
       nbreaks = 5,            # é¢œè‰²åˆ†æ®µæ•°
       palette = "RdBu",       # é…è‰²æ–¹æ¡ˆ (RColorBrewer)
       layout.exp = 1) +       # æ‰©å……å¸ƒå±€é˜²æ­¢æ ‡ç­¾æˆªæ–­
  labs(title = "ç²¾ç¾ç›¸å…³æ€§çƒ­å›¾")
```

### 4. ggtable()ï¼šå¯è§†åŒ–äº¤å‰è¡¨

ç”¨äºå±•ç¤ºç¦»æ•£å˜é‡ä¹‹é—´çš„åˆ†ç±»æ±‡æ€»æƒ…å†µï¼Œç±»ä¼¼äº `table()` çš„å›¾å½¢åŒ–ç‰ˆæœ¬ã€‚

```{r fig.width=8, fig.height=5}
# åˆ¶é€ ä¸€äº›ç¦»æ•£æ•°æ®
df_tips <- as.data.frame(Titanic)
# å±•å¼€æ•°æ®ï¼Œå› ä¸º ggtable é»˜è®¤æ¯è¡Œæ˜¯ä¸€ä¸ªè§‚æµ‹
df_tips_expanded <- df_tips[rep(row.names(df_tips), df_tips$Freq), 1:4]

ggtable(df_tips_expanded, "Class", c("Survived", "Sex", "Age"), cells = "observed") +
  labs(title = "ggtable: æ³°å¦å°¼å…‹å·ä¹˜å®¢åˆ†å¸ƒ")
```

### 5. ggduo()ï¼šåŒç»„å˜é‡å…³è”

å½“ä½ ä¸æƒ³çœ‹æ‰€æœ‰å˜é‡çš„ä¸¤ä¸¤å…³ç³»ï¼Œè€Œæ˜¯æƒ³çœ‹ **ä¸€ç»„å˜é‡ (X)** ä¸ **å¦ä¸€ç»„å˜é‡ (Y)** çš„å…³ç³»æ—¶ï¼ˆç±»ä¼¼å…¸å‹ç›¸å…³åˆ†æçš„è§†è§’ï¼‰ï¼Œ`ggduo()` éå¸¸æœ‰ç”¨ã€‚

```{r fig.width=10, fig.height=6}
# æ¯”å¦‚ï¼šæ¢ç´¢ è¼ç‰‡(Sepal) å°ºå¯¸ ä¸ èŠ±ç“£(Petal) å°ºå¯¸çš„å…³ç³»
ggduo(iris,
      columnsX = c("Sepal.Length", "Sepal.Width"),
      columnsY = c("Petal.Length", "Petal.Width"),
      aes(color = Species),
      types = list(continuous = "smooth_lm")) + # æ·»åŠ çº¿æ€§æ‹Ÿåˆ
  theme_bw() +
  labs(title = "ggduo: è¼ç‰‡ vs èŠ±ç“£")
```

### 6. ggnostic()ï¼šæ¨¡å‹è¯Šæ–­çŸ©é˜µ

è¿™æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œç”¨äºå±•ç¤ºæ¨¡å‹è¯Šæ–­ä¿¡æ¯ã€‚å®ƒç”Ÿæˆä¸€ä¸ªçŸ©é˜µï¼ŒåŒ…å«æ®‹å·®ã€æ æ†å€¼ã€Cookè·ç¦»ç­‰ç»Ÿè®¡é‡ä¸è§£é‡Šå˜é‡çš„å…³ç³»ã€‚

```{r fig.width=10, fig.height=8}
# æ‹Ÿåˆä¸€ä¸ªç®€å•æ¨¡å‹ (ä½¿ç”¨ iris æ•°æ®ä»¥æ”¯æŒè‡ªåŠ¨ç€è‰²)
fit_iris <- lm(Sepal.Length ~ Sepal.Width + Petal.Length + Species, data = iris)

# ç”Ÿæˆè¯Šæ–­çŸ©é˜µ
# é»˜è®¤å±•ç¤ºæ‰€æœ‰æ ‡å‡†è¯Šæ–­æŒ‡æ ‡ vs è§£é‡Šå˜é‡
ggnostic(fit_iris,
         columnsY = c(".resid", ".std.resid", ".hat", ".cooksd"), # é€‰å®šè¯Šæ–­æŒ‡æ ‡
         mapping = aes(color = Species)) +
  theme_bw() +
  labs(title = "ggnostic: çº¿æ€§æ¨¡å‹è¯Šæ–­")
```

### 7. ggcoef_model()ï¼šå›å½’ç³»æ•°å¯è§†åŒ–

æ¯”åŸºç¡€çš„ `summary(model)` æ›´ç›´è§‚ï¼Œç‰¹åˆ«é€‚åˆåœ¨è®ºæ–‡ä¸­å±•ç¤ºæ¨¡å‹ç»“æœã€‚

```{r fig.width=9, fig.height=5}
# å»ºç«‹ä¸¤ä¸ªå›å½’æ¨¡å‹
mod1 <- lm(Sepal.Length ~ Sepal.Width + Petal.Length, data = iris)
mod2 <- lm(Sepal.Length ~ Sepal.Width + Petal.Length + Petal.Width, data = iris)

# å¯¹æ¯”æ¨¡å‹
ggcoef_compare(list("Model A" = mod1, "Model B" = mod2),
               variable_labels = c(
                 Sepal.Width = "è¼ç‰‡å®½åº¦",
                 Petal.Length = "èŠ±ç“£é•¿åº¦",
                 Petal.Width = "èŠ±ç“£å®½åº¦"
               ),
               conf.level = 0.95) +
  scale_color_brewer(palette = "Dark2") + # ä½¿ç”¨æ›´å¥½çœ‹çš„é…è‰²
  theme_minimal() +
  labs(title = "å›å½’æ¨¡å‹ç³»æ•°å¯¹æ¯”", 
       caption = "æ³¨ï¼šè¯¯å·®æ£’è¡¨ç¤º 95% ç½®ä¿¡åŒºé—´")
```

## ğŸ“Š å®æˆ˜æ¡ˆä¾‹ï¼šé«˜ç»´æ•°æ®æ¢ç´¢

å¹³è¡Œåæ ‡å›¾ (`ggparcoord`) æ˜¯å±•ç¤ºå¤šç»´æ•°æ®ï¼ˆ>3ç»´ï¼‰æ¨¡å¼çš„åˆ©å™¨ï¼Œç‰¹åˆ«é€‚åˆè§‚å¯Ÿåˆ†ç±»æ•ˆæœæˆ–å¼‚å¸¸å€¼ã€‚

```{r fig.width=10, fig.height=6}
# æ¨¡æ‹Ÿä¸€ä¸ªç¨å¤æ‚çš„æ•°æ®å¤„ç†åœºæ™¯
# 1. é€‰å–æ•°å€¼åˆ—
# 2. è¿™é‡Œçš„ scale="globalminmax" ä¿ç•™äº†åŸå§‹æ•°æ®çš„ç›¸å¯¹å¤§å°ï¼Œæˆ–è€…ç”¨ "std" (é»˜è®¤) çœ‹ç›¸å¯¹è¶‹åŠ¿
ggparcoord(iris,
           columns = 1:4,          
           groupColumn = 5,        
           order = "anyClass",     # è‡ªåŠ¨æ’åºä¼˜åŒ–å±•ç¤º
           showPoints = TRUE,      
           scale = "uniminmax",    # æ ‡å‡†åŒ–åˆ° 0-1 ä¹‹é—´ï¼Œä¾¿äºæ¯”è¾ƒå½¢çŠ¶
           alphaLines = 0.3) +     
  scale_color_brewer(palette = "Set1") +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    axis.text.x = element_text(angle = 15, hjust = 1)
  ) +
  labs(title = "å¹³è¡Œåæ ‡å›¾ï¼šæ ‡å‡†åŒ–åçš„ç‰¹å¾æ¨¡å¼",
       y = "Standardized Value (0-1)",
       x = "Features")
```

## ğŸ“ å‡½æ•°é€ŸæŸ¥è¡¨

| å‡½æ•° | åŠŸèƒ½æè¿° | æ ¸å¿ƒå‚æ•°/æŠ€å·§ |
|------|----------|----------|
| `ggpairs()` | çŸ©é˜µæ•£ç‚¹å›¾ (é€šç”¨) | `upper/lower/diag` æ§åˆ¶é¢æ¿å†…å®¹ |
| `ggbivariate()` | åŒå˜é‡åˆ†æ (Outcome vs X) | `outcome`, `explanatory` æŒ‡å®šå˜é‡ |
| `ggcorr()` | ç›¸å…³æ€§çƒ­å›¾ | `label = TRUE`, `nbreaks` é¢œè‰²åˆ†æ®µ |
| `ggtable()` | å¯è§†åŒ–äº¤å‰è¡¨ | `cells = "observed"` æ˜¾ç¤ºæ•°å€¼ |
| `ggduo()` | åŒç»„å˜é‡çŸ©é˜µ | `columnsX`, `columnsY` ä¸¤ç»„å¯¹æ’ |
| `ggnostic()` | æ¨¡å‹è¯Šæ–­çŸ©é˜µ | æ”¯æŒ `lm`, `glm` ç­‰æ¨¡å‹å¯¹è±¡ |
| `ggcoef_model()` | æ¨¡å‹ç³»æ•°å›¾ | `include_intercept = FALSE` |
| `ggparcoord()` | å¹³è¡Œåæ ‡å›¾ | `scale = "uniminmax"` å½’ä¸€åŒ– |

## ğŸ”— å‚è€ƒèµ„æ–™

- **[å®˜æ–¹æ–‡æ¡£ (Pkgdown)](https://ggobi.github.io/ggally/)**ï¼šæœ¬æ–‡ç»“æ„å‚è€ƒäº†å®˜æ–¹æ–‡æ¡£çš„ Core Functionality åˆ†ç±»ã€‚
    - **[Core Functionality](https://ggobi.github.io/ggally/articles/ggally_plots.html)**: åŒ…å«æ‰€æœ‰é«˜çº§ç»˜å›¾å‡½æ•°çš„åˆ—è¡¨ã€‚
    - **[Vignette: ggpairs](https://ggobi.github.io/ggally/articles/ggpairs.html)**: å¼ºçƒˆæ¨èé˜…è¯»ï¼Œè¿™æ˜¯ GGally æœ€æ ¸å¿ƒçš„åŠŸèƒ½ã€‚
- **GitHub**: [https://github.com/ggobi/ggally](https://github.com/ggobi/ggally)

