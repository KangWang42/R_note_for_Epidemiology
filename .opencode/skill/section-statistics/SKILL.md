---
name: section-statistics
description: 生成"统计分析方法"类页面的超详细教程内容。触发条件:(1)用户要求编写回归、生存分析、因果推断、贝叶斯统计等方法教程;(2)涉及"10xx"编号的统计方法文章;(3)用户需要讲解统计模型、假设检验、效应估计;(4)用户提到PSM、Cox回归、Meta分析、RCS、多水平模型等统计术语。生成完整的方法教程,强调"方法背景→核心概念→模型假设→操作流程→结果解读→常见错误",确保理论与实践并重,从0开始详尽讲解统计原理。
---

## 核心任务

生成统计分析方法类教程(.rmd/.qmd),涵盖理论背景、模型假设、完整分析流程、结果解释。

## 必备内容结构(按顺序)

### YAML头部
```yaml
---
title: '[方法名称]完整教程'
subtitle: '副标题(可选)'
date: 'YYYY-MM-DD'
categories:
- 统计分析方法
- [具体分类:因果推断/生存分析/回归分析等]
image: figure/[cover-file].svg
description: 一句话概括方法用途
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.width = 8,
  fig.height = 5,
  fig.retina = 2,
  out.width = "100%",
  dpi = 150
)
```
```

**CRITICAL 说明**:
- `setup` chunk 必须紧跟 YAML 后，用于全局设置
- `include=FALSE` 保证 setup chunk 不出现在文档中
- 图形参数确保输出质量

### 标题层次结构（CRITICAL - 目录生成依赖）

**必须遵循的一级标题（##）层次**：

```markdown
## 方法背景与适用场景
## 核心概念与模型入门
## 模型假设与前提条件
## 数据准备
## 完整分析流程
## 结果解读与报告
## 常见错误与纠偏
## 进阶扩展
## 总结
## 参考文献
```

**层次规范**:
- 一级标题（##）：章节名称，用于生成目录
- 二级标题（###）：小节标题
- 三级标题（####）：详细步骤
- **禁止使用单个 `#`**，保留给文档总标题
- 确保每个 `##` 标题后都有实质内容

### 方法背景与适用场景

**必须包含**:
- 方法用途(解决什么研究问题)
- 适用的研究设计类型
- 数据结构要求
- 与相关方法的对比

**示例结构**:
```markdown
## 方法背景与适用场景

[方法名称]是用于[研究问题]的统计方法。

**适用场景**
- [场景1:数据类型+研究问题]
- [场景2]

**不适用场景**
- [场景1:说明原因]
- [场景2]

**与其他方法的对比**

| 方法 | 适用场景 | 优点 | 缺点 |
|------|---------|------|------|
| [本方法] | | | |
| [对比方法1] | | | |
```

### 核心概念与模型入门

**从0开始讲解,包含**:
- 基本术语定义(中英文对照)
- 方法的核心思想
- 数学模型表达(公式+文字解释)
- 工作机制的直观解释

**公式规范**:
- 使用LaTeX语法
- 每个符号都要解释含义
- 提供实际例子对应公式

**示例**:
```markdown
倾向性得分定义为:

$$e(X) = P(T=1|X)$$

其中:
- $e(X)$: 倾向性得分
- $T$: 处理变量(1=接受处理,0=未接受)
- $X$: 协变量向量
```

### 模型假设与前提条件

**必须列出**:
- 所有关键假设
- 每个假设的含义
- 违背假设的后果
- 假设检验方法

**示例格式**:
```markdown
## 模型假设

### 假设1:[假设名称]

**含义**: [通俗解释]

**检验方法**: [具体操作]

**违背后果**: [影响分析]

**应对策略**: [替代方法/稳健性分析]
```

### 数据准备

**必须包含**:
- 数据结构要求
- 变量类型说明
- 变量编码方式
- 缺失值处理
- 数据清洗步骤

**提供模拟数据示例**:
```r
# 构造符合方法要求的示例数据
set.seed(2026)
# [完整的数据生成代码]
# [变量说明注释]
```

### 完整分析流程

**分步骤详解,每步包含**:

#### 步骤结构
```
步骤说明 → 为什么需要这步 → 代码实现 → 代码逐行解释 → 输出解读
```

#### 典型流程框架
```markdown
## 分析流程

### 步骤1:探索性数据分析

[为什么需要EDA]

[代码块]

[输出结果解释]

### 步骤2:模型拟合

[模型选择依据]

[代码块]

[参数含义解释]

### 步骤3:模型诊断

[诊断什么、为什么]

[代码块]

[诊断结果判读]

### 步骤4:结果解释

[效应量含义]

[代码块]

[统计量解读]

### 步骤5:敏感性分析(如适用)

[为什么需要]

[代码块]

[结果比较]
```

### 结果解读与报告

**必须包含**:
- 统计量含义解释
- 效应量估计与置信区间
- P值的正确解读
- 临床/实际意义说明
- 论文报告格式

**示例表格**:
```markdown
| 指标 | 估计值 | 95%CI | P值 | 解释 |
|------|--------|-------|-----|------|
| [变量1] | [值] | [区间] | [p] | [含义] |
```

### 常见错误与纠偏

**列出5-10个常见错误**:
- 错误描述
- 错误原因
- 表现形式(报错信息/异常结果)
- 正确做法

**特别关注**:
- 模型不收敛
- 共线性问题
- 违背假设
- 过拟合/欠拟合
- 因果推断中的混杂

### 进阶扩展

### 封面图生成（CRITICAL）

**必须创建封面图 SVG 文件**，路径为 `doc/images/[topic]-cover.svg`：

```bash
# 创建 images 目录（如果不存在）
mkdir -p doc/images

# 生成简单的 SVG 封面（使用 R 或手动创建）
cat > doc/images/[topic]-cover.svg << 'EOF'
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 400">
  <defs>
    <linearGradient id="bg" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
    </linearGradient>
  </defs>
  <rect width="800" height="400" fill="url(#bg)"/>
  <text x="400" y="200" font-family="Arial, sans-serif" font-size="48" 
        fill="white" text-anchor="middle" font-weight="bold">
    [方法名称]
  </text>
  <text x="400" y="250" font-family="Arial, sans-serif" font-size="24" 
        fill="rgba(255,255,255,0.8)" text-anchor="middle">
    统计分析方法
  </text>
</svg>
EOF
```

**Alternative: 使用 R ggplot2 生成**:
```r
library(ggplot2)
library(svglite)

# 创建封面
p <- ggplot() +
  theme_void() +
  theme(plot.background = element_rect(fill = "#667eea")) +
  annotate("text", x = 0.5, y = 0.5, 
           label = "[方法名称]", 
           size = 20, color = "white", fontface = "bold")

# 保存为 SVG
ggsave("doc/images/[topic]-cover.svg", p, 
       width = 8, height = 4, bg = "#667eea")
```

**重要提醒**:
- 确保 YAML 中的 `image: images/[topic]-cover.svg` 路径与实际文件匹配
- 文件名使用小写字母和连字符
- 如果没有生成封面图，文章将使用默认占位图

**提供**:
- 替代模型/稳健方法
- 高级应用场景
- 软件包对比
- 相关方法链接
- 推荐阅读文献

## 写作规范

### 理论与实践平衡

- **理论部分**(30-40%):概念、假设、数学模型
- **实践部分**(60-70%):代码、流程、结果解释
- 确保读者既理解"为什么"也会"怎么做"

### 代码规范

**R包使用**:
```r
# 核心统计包用pkg::fn()
survival::coxph(...)

# 框架式多次使用才library()
library(MatchIt)
library(cobalt)
```

**代码块命名**:
```r
{r eda-baseline}        # 探索性分析
{r model-fit}           # 模型拟合
{r model-diagnostics}   # 模型诊断
{r effect-estimate}     # 效应估计
```

### 可视化要求

**必须包含的图表**:
- 数据分布图
- 模型诊断图
- 结果可视化(森林图/生存曲线等)
- 敏感性分析图(如适用)

**图表规范**:
- 使用ggsci配色方案
- 中文标题和标签
- 清晰的图例
- 每图必有文字解释

### 表格规范

- 使用gtsummary/gt/knitr::kable
- 中文表头
- 适当的数字格式
- 必要的注释

## 完整工作流程

### 步骤1:生成教程内容

按照上述结构生成完整.rmd/.qmd文件。

### 步骤2:三项渲染验证

```bash
quarto render doc/10[number]-[topic].rmd
quarto render doc/index.qmd
quarto render doc/sections/statistics.qmd
```

**安装依赖**:
```r
# 若报错缺少包,先安装
install.packages(c("survival", "MatchIt", "lme4", ...))
```

### 步骤3:更新导航

**更新`doc/_quarto.yml`**:
在statistics分类下添加新文章。

**更新`doc/0001-guide.rmd`**:
在统计分析方法表格中添加条目。

**更新`README.md`**:
在对应折叠块添加链接(.html后缀)。

### 步骤4:提交

用户确认后提交:
```bash
git add doc/10[number]-[topic].rmd doc/_quarto.yml doc/0001-guide.rmd README.md
git commit -m "新增统计教程:[方法名称]"
git push
```

## 质量检查清单

生成前确认:

- [ ] 是否明确了研究问题类型和数据结构?
- [ ] 是否讲清了方法的理论基础?
- [ ] 是否列出了所有模型假设?
- [ ] 是否提供了完整的分析流程?
- [ ] 是否包含结果解读指导?

生成后验证:

- [ ] 公式是否正确渲染?
- [ ] 代码是否可复现?
- [ ] 图表是否清晰?
- [ ] 三项render是否成功?
- [ ] 导航是否已更新?

## 参考优质模板

- `doc/1018-psm.rmd` - 完整的因果推断流程示范
- `doc/1079-kmeans.rmd` - "概念→流程→代码→解释"结构标杆
- `doc/1016-mlr3.rmd` - 详尽程度参考

## 方法分类参考

### 基础回归
- 线性回归、Logistic回归、Poisson回归、有序回归

### 生存分析
- Cox比例风险模型、竞争风险分析、RCS、时变协变量

### 因果推断
- PSM、DiD、IV、中介效应、DAG、TMLE

### 高级建模
- 多水平模型、GAM、GEE、SEM、潜类别分析

### Meta分析
- 固定效应/随机效应模型、网状Meta、伞状综述

### 贝叶斯统计
- 贝叶斯回归、MCMC、先验选择

## 常见问题

**Q: 如何平衡理论深度与可读性?**

A: 核心公式必讲,推导过程可简化。用类比和实例帮助理解,避免纯数学堆砌。

**Q: 模拟数据应该多真实?**

A: 要能展示方法特点,但保持简单可控。说明数据生成机制,让读者理解真实因果效应。

**Q: 结果解读应该多详细?**

A: 每个统计量都要解释含义、置信区间、P值,并翻译成实际意义(如HR=1.5表示风险增加50%)。

**Q: 用户需求模糊怎么办?**

A: 澄清:研究问题类型、数据结构(横断面/纵向/生存)、因变量类型、是否需要因果推断。
