[
  {
    "objectID": "test.html",
    "href": "test.html",
    "title": "bruceR - 统计分析工具",
    "section": "",
    "text": "bruceR 全称 “BRoadly Useful Convenient and Efficient R functions”，由包寒吴霜博士开发，是一个集成了众多实用功能的 R 包，专为科研数据分析设计。\n链接：CRAN | GitHub | 中文教程\n\n\nbruceR 涵盖了数据分析的完整流程：\n\n\n\n\n\n\n\n\n模块\n功能\n主要函数\n\n\n\n\n基础编程\n路径设置、数据导入导出、表格打印\nset.wd(), import(), export(), print_table()\n\n\n数据计算\n量表计算、反向计分、重编码\nMEAN(), SUM(), RECODE(), RESCALE()\n\n\n信效度分析\n信度分析、因子分析\nAlpha(), EFA(), PCA(), CFA()\n\n\n描述统计\n描述统计、频率分析、相关分析\nDescribe(), Freq(), Corr()\n\n\n方差分析\nt检验、ANOVA、简单效应、事后比较\nTTEST(), MANOVA(), EMMEANS()\n\n\n回归模型\n模型汇总、多层模型\nmodel_summary(), HLM_summary()\n\n\n中介调节\nPROCESS 宏\nPROCESS(), med_summary()\n\n\n\n\n\n\n加载 bruceR 时会自动加载常用包：\n\n数据处理：data.table, dplyr, tidyr, stringr\n可视化：ggplot2\n统计分析：psych, emmeans, lmerTest, effectsize, performance"
  },
  {
    "objectID": "test.html#r包介绍",
    "href": "test.html#r包介绍",
    "title": "bruceR - 统计分析工具",
    "section": "",
    "text": "bruceR 全称 “BRoadly Useful Convenient and Efficient R functions”，由包寒吴霜博士开发，是一个集成了众多实用功能的 R 包，专为科研数据分析设计。\n链接：CRAN | GitHub | 中文教程\n\n\nbruceR 涵盖了数据分析的完整流程：\n\n\n\n\n\n\n\n\n模块\n功能\n主要函数\n\n\n\n\n基础编程\n路径设置、数据导入导出、表格打印\nset.wd(), import(), export(), print_table()\n\n\n数据计算\n量表计算、反向计分、重编码\nMEAN(), SUM(), RECODE(), RESCALE()\n\n\n信效度分析\n信度分析、因子分析\nAlpha(), EFA(), PCA(), CFA()\n\n\n描述统计\n描述统计、频率分析、相关分析\nDescribe(), Freq(), Corr()\n\n\n方差分析\nt检验、ANOVA、简单效应、事后比较\nTTEST(), MANOVA(), EMMEANS()\n\n\n回归模型\n模型汇总、多层模型\nmodel_summary(), HLM_summary()\n\n\n中介调节\nPROCESS 宏\nPROCESS(), med_summary()\n\n\n\n\n\n\n加载 bruceR 时会自动加载常用包：\n\n数据处理：data.table, dplyr, tidyr, stringr\n可视化：ggplot2\n统计分析：psych, emmeans, lmerTest, effectsize, performance"
  },
  {
    "objectID": "test.html#r包安装",
    "href": "test.html#r包安装",
    "title": "bruceR - 统计分析工具",
    "section": "R包安装",
    "text": "R包安装\n# 方法1：从 CRAN 安装（推荐）\ninstall.packages(\"bruceR\", dep = TRUE)\n\n# 方法2：从 GitHub 安装最新版\ninstall.packages(\"devtools\")\ndevtools::install_github(\"psychbruce/bruceR\", dep = TRUE, force = TRUE)\nlibrary(bruceR)"
  },
  {
    "objectID": "test.html#基础编程功能",
    "href": "test.html#基础编程功能",
    "title": "bruceR - 统计分析工具",
    "section": "基础编程功能",
    "text": "基础编程功能\n\nset.wd()：智能设置工作目录\n自动将工作目录设置为当前脚本所在路径：\nset.wd()\n\n\nimport() / export()：万能数据导入导出\n支持几乎所有常见数据格式，自动识别文件类型：\n# 支持的格式：\n# - 文本：.txt, .csv, .tsv\n# - Excel：.xls, .xlsx\n# - SPSS：.sav\n# - Stata：.dta\n# - R对象：.rda, .rds, .RData\n\n# 导入数据\ndata &lt;- import(\"data.xlsx\")\ndata &lt;- import(\"data.sav\")\ndata &lt;- import(\"data.dta\")\n\n# 导出数据\nexport(data, file = \"output.xlsx\")\nexport(data, file = \"output.csv\")\n\n\ncc()：快速创建字符向量\n比 c() 更简洁，无需引号：\n# 传统写法\nc(\"age\", \"gender\", \"education\")\n## [1] \"age\"       \"gender\"    \"education\"\n# bruceR 写法\ncc(\"age, gender, education\")\n## [1] \"age\"       \"gender\"    \"education\"\n\n\nprint_table()：生成三线表\nsummary_data &lt;- data.frame(\n  Variable = c(\"Age\", \"Income\", \"Score\"),\n  Mean = c(35.2, 5000, 78.5),\n  SD = c(8.3, 1200, 12.1),\n  N = c(100, 100, 100)\n)\n\nprint_table(summary_data)\n## ─────────────────────────────────────\n##    Variable     Mean       SD       N\n## ─────────────────────────────────────\n## 1    Age      35.200    8.300 100.000\n## 2    Income 5000.000 1200.000 100.000\n## 3    Score    78.500   12.100 100.000\n## ─────────────────────────────────────"
  },
  {
    "objectID": "test.html#数据计算功能",
    "href": "test.html#数据计算功能",
    "title": "bruceR - 统计分析工具",
    "section": "数据计算功能",
    "text": "数据计算功能\n\nMEAN() / SUM()：横向计算（支持反向计分）\n心理学量表经常需要计算多个题目的均值或总分，并处理反向计分：\n# 创建模拟问卷数据（5点量表，共6题）\nset.seed(42)\nquestionnaire &lt;- data.frame(\n  id = 1:5,\n  q1 = sample(1:5, 5, replace = TRUE),\n  q2 = sample(1:5, 5, replace = TRUE),\n  q3 = sample(1:5, 5, replace = TRUE),\n  q4 = sample(1:5, 5, replace = TRUE),\n  q5 = sample(1:5, 5, replace = TRUE),\n  q6 = sample(1:5, 5, replace = TRUE)\n)\nquestionnaire\n##   id q1 q2 q3 q4 q5 q6\n## 1  1  1  4  1  3  5  4\n## 2  2  5  2  5  1  5  3\n## 3  3  1  2  4  1  5  2\n## 4  4  1  1  2  3  4  1\n## 5  5  2  4  2  4  2  2\n# 计算均值（q3、q6 反向计分，量表范围1-5）\nquestionnaire$score_mean &lt;- MEAN(\n  questionnaire, \n  varrange = \"q1:q6\",\n  rev = c(\"q3\", \"q6\"),\n  likert = 1:5\n)\n\n# 计算总分\nquestionnaire$score_sum &lt;- SUM(\n  questionnaire, \n  varrange = \"q1:q6\",\n  rev = c(\"q3\", \"q6\"),\n  likert = 1:5\n)\n\nquestionnaire[, c(\"id\", \"score_mean\", \"score_sum\")]\n##   id score_mean score_sum\n## 1  1   3.333333        20\n## 2  2   2.833333        17\n## 3  3   2.500000        15\n## 4  4   3.000000        18\n## 5  5   3.333333        20\n\n\nRECODE()：变量重编码\nd &lt;- data.frame(age = c(18, 25, 35, 45, 55, 65, 75))\n\nd$age_group &lt;- RECODE(d$age, \n  \"lo:29 = '青年'; \n   30:59 = '中年'; \n   60:hi = '老年'\"\n)\nd\n##   age age_group\n## 1  18      青年\n## 2  25      青年\n## 3  35      中年\n## 4  45      中年\n## 5  55      中年\n## 6  65      老年\n## 7  75      老年\n\n\nRESCALE()：变量标准化\nscores &lt;- c(2, 3, 4, 5, 6, 7, 8)\nRESCALE(scores, to = 0:100)\n## [1]   0.00000  16.66667  33.33333  50.00000  66.66667  83.33333 100.00000"
  },
  {
    "objectID": "test.html#信度与因子分析",
    "href": "test.html#信度与因子分析",
    "title": "bruceR - 统计分析工具",
    "section": "信度与因子分析",
    "text": "信度与因子分析\n\nAlpha()：信度分析\ndata(\"bfi\", package = \"psych\")\n\n# Alpha 需要指定数据和变量名\nAlpha(bfi, var = \"A\", items = 1:5)\n## \n## Reliability Analysis\n## \n## Summary:\n## Total Items: 5\n## Scale Range: 1 ~ 6\n## Total Cases: 2800\n## Valid Cases: 2709 (96.8%)\n## \n## Scale Statistics:\n## Mean = 4.208\n## S.D. = 0.735\n## Cronbach’s α = 0.431\n## McDonald’s ω = 0.592\n## \n## Warning: Scale reliability is low. You may check item codings.\n## Item A1 correlates negatively with the scale and may be reversed.\n## You can specify this argument: rev=c(\"A1\")\n## \n## Item Statistics (Cronbach’s α If Item Deleted):\n## ─────────────────────────────────────────────\n##      Mean    S.D. Item-Rest Cor. Cronbach’s α\n## ─────────────────────────────────────────────\n## A1  2.412 (1.405)         -0.311        0.718\n## A2  4.797 (1.176)          0.372        0.278\n## A3  4.599 (1.305)          0.478        0.174\n## A4  4.682 (1.486)          0.365        0.252\n## A5  4.551 (1.262)          0.448        0.207\n## ─────────────────────────────────────────────\n## Item-Rest Cor. = Corrected Item-Total Correlation\n\n\nEFA()：探索性因子分析\ndata(\"bfi\", package = \"psych\")\n\n# 探索性因子分析：使用 var + items 格式\n# 分析外向性(E)量表的5个题目\nEFA(bfi, var = \"E\", items = 1:5, nfactors = 2, plot.scree = FALSE)\n## \n## Principal Component Analysis\n## \n## Summary:\n## Total Items: 5\n## Scale Range: 1 ~ 6\n## Total Cases: 2800\n## Valid Cases: 2713 (96.9%)\n## \n## Extraction Method:\n## - Principal Component Analysis\n## Rotation Method:\n## - Varimax (with Kaiser Normalization)\n## \n## KMO and Bartlett's Test:\n## - Kaiser-Meyer-Olkin (KMO) Measure of Sampling Adequacy: MSA = 0.799\n## - Bartlett's Test of Sphericity: Approx. χ²(10) = 3011.40, p &lt; 1e-99 ***\n## \n## Total Variance Explained:\n## ──────────────────────────────────────────────────────────────────────────────────\n##              Eigenvalue Variance % Cumulative % SS Loading Variance % Cumulative %\n## ──────────────────────────────────────────────────────────────────────────────────\n## Component 1       2.565     51.298       51.298      1.884     37.680       37.680\n## Component 2       0.768     15.368       66.666      1.449     28.986       66.666\n## Component 3       0.643     12.851       79.517                                   \n## Component 4       0.561     11.211       90.728                                   \n## Component 5       0.464      9.272      100.000                                   \n## ──────────────────────────────────────────────────────────────────────────────────\n## \n## Component Loadings (Rotated) (Sorted by Size):\n## ─────────────────────────────\n##        RC1    RC2 Communality\n## ─────────────────────────────\n## E1   0.812 -0.098       0.668\n## E2   0.752 -0.304       0.658\n## E4  -0.736  0.290       0.625\n## E5  -0.145  0.860       0.761\n## E3  -0.312  0.723       0.620\n## ─────────────────────────────\n## Communality = Sum of Squared (SS) Factor Loadings\n## (Uniqueness = 1 - Communality)"
  },
  {
    "objectID": "test.html#描述统计与相关分析",
    "href": "test.html#描述统计与相关分析",
    "title": "bruceR - 统计分析工具",
    "section": "描述统计与相关分析",
    "text": "描述统计与相关分析\n\nDescribe()：描述统计\nDescribe(iris[, 1:4])\n## Descriptive Statistics:\n## ────────────────────────────────────────────────────────────────\n##                 N Mean   SD | Median  Min  Max Skewness Kurtosis\n## ────────────────────────────────────────────────────────────────\n## Sepal.Length  150 5.84 0.83 |   5.80 4.30 7.90     0.31    -0.61\n## Sepal.Width   150 3.06 0.44 |   3.00 2.00 4.40     0.31     0.14\n## Petal.Length  150 3.76 1.77 |   4.35 1.00 6.90    -0.27    -1.42\n## Petal.Width   150 1.20 0.76 |   1.30 0.10 2.50    -0.10    -1.36\n## ────────────────────────────────────────────────────────────────\n\n\nFreq()：频率分析\nFreq(iris$Species)\n## Frequency Statistics:\n## ───────────────────\n##              N    %\n## ───────────────────\n## setosa      50 33.3\n## versicolor  50 33.3\n## virginica   50 33.3\n## ───────────────────\n## Total N = 150\n\n\nCorr()：相关分析\nCorr(iris[, 1:4])\n## Pearson's r and 95% confidence intervals:\n## ─────────────────────────────────────────────────────────────\n##                                r       [95% CI]     p       N\n## ─────────────────────────────────────────────────────────────\n## Sepal.Length-Sepal.Width   -0.12 [-0.27,  0.04]  .152     150\n## Sepal.Length-Petal.Length   0.87 [ 0.83,  0.91] &lt;.001 *** 150\n## Sepal.Length-Petal.Width    0.82 [ 0.76,  0.86] &lt;.001 *** 150\n## Sepal.Width-Petal.Length   -0.43 [-0.55, -0.29] &lt;.001 *** 150\n## Sepal.Width-Petal.Width    -0.37 [-0.50, -0.22] &lt;.001 *** 150\n## Petal.Length-Petal.Width    0.96 [ 0.95,  0.97] &lt;.001 *** 150\n## ─────────────────────────────────────────────────────────────\n\n\n\nplot of chunk unnamed-chunk-14"
  },
  {
    "objectID": "test.html#统计检验",
    "href": "test.html#统计检验",
    "title": "bruceR - 统计分析工具",
    "section": "统计检验",
    "text": "统计检验\n\nTTEST()：t检验\n# 独立样本 t 检验（需要两水平因子）\niris_subset &lt;- iris[iris$Species %in% c(\"versicolor\", \"virginica\"), ]\niris_subset$Species &lt;- droplevels(iris_subset$Species)\n\nTTEST(iris_subset, y = \"Sepal.Length\", x = \"Species\")\n## \n## Independent-Samples t-test\n## \n## Hypothesis: two-sided (μ2 - μ1 ≠ 0)\n## \n## Descriptives:\n## ───────────────────────────────────────────────\n##      Variable  Factor      Level  N Mean (S.D.)\n## ───────────────────────────────────────────────\n##  Sepal.Length Species versicolor 50 5.94 (0.52)\n##  Sepal.Length Species virginica  50 6.59 (0.64)\n## ───────────────────────────────────────────────\n## \n## Levene’s test for homogeneity of variance:\n## ────────────────────────────────────────────────────────────────────────────\n##                                                 Levene’s F df1 df2     p    \n## ────────────────────────────────────────────────────────────────────────────\n## Sepal.Length: Species (virginica - versicolor)        1.42   1  98  .236    \n## ────────────────────────────────────────────────────────────────────────────\n## Note: H0 = equal variance (homoscedasticity).\n## If significant (violation of the assumption),\n## then you should better set `var.equal=FALSE`.\n## \n## Results of t-test:\n## ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n##                                                    t df     p     Difference [95% CI] Cohen’s d [95% CI]     BF10\n## ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n## Sepal.Length: Species (virginica - versicolor)  5.63 98 &lt;.001 ***   0.65 [0.42, 0.88]  1.13 [0.73, 1.52] 7.04e+04\n## ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n\n\nMANOVA()：多因素方差分析\nMANOVA(data = npk, dv = \"yield\", between = c(\"N\", \"P\", \"K\"))\n## \n## ====== ANOVA (Between-Subjects Design) ======\n## \n## Descriptives:\n## ─────────────────────────────\n##  \"N\" \"P\" \"K\"   Mean    S.D. n\n## ─────────────────────────────\n##   N0  P0  K0 51.433 (4.600) 3\n##   N0  P0  K1 52.000 (5.635) 3\n##   N0  P1  K0 54.333 (9.411) 3\n##   N0  P1  K1 50.500 (2.364) 3\n##   N1  P0  K0 63.767 (5.086) 3\n##   N1  P0  K1 54.667 (4.216) 3\n##   N1  P1  K0 57.933 (5.478) 3\n##   N1  P1  K1 54.367 (5.006) 3\n## ─────────────────────────────\n## Total sample size: N = 24\n## \n## ANOVA Table:\n## Dependent variable(s):      yield\n## Between-subjects factor(s): N, P, K\n## Within-subjects factor(s):  –\n## Covariate(s):               –\n## ──────────────────────────────────────────────────────────────────────────\n##                 MS    MSE df1 df2     F     p     η²p [90% CI of η²p]  η²G\n## ──────────────────────────────────────────────────────────────────────────\n## N          189.282 30.724   1  16 6.161  .025 *     .278 [.024, .529] .278\n## P            8.402 30.724   1  16 0.273  .608       .017 [.000, .220] .017\n## K           95.202 30.724   1  16 3.099  .097 .     .162 [.000, .427] .162\n## N * P       21.282 30.724   1  16 0.693  .418       .041 [.000, .277] .041\n## N * K       33.135 30.724   1  16 1.078  .314       .063 [.000, .312] .063\n## P * K        0.482 30.724   1  16 0.016  .902       .001 [.000, .078] .001\n## N * P * K   37.002 30.724   1  16 1.204  .289       .070 [.000, .322] .070\n## ──────────────────────────────────────────────────────────────────────────\n## MSE = mean square error (the residual variance of the linear model)\n## η²p = partial eta-squared = SS / (SS + SSE) = F * df1 / (F * df1 + df2)\n## ω²p = partial omega-squared = (F - 1) * df1 / (F * df1 + df2 + 1)\n## η²G = generalized eta-squared (see Olejnik & Algina, 2003)\n## Cohen’s f² = η²p / (1 - η²p)\n## \n## Levene’s Test for Homogeneity of Variance:\n## ───────────────────────────────────────\n##            Levene’s F df1 df2     p    \n## ───────────────────────────────────────\n## DV: yield       0.986   7  16  .475    \n## ───────────────────────────────────────\n\n\nEMMEANS()：边际均值与事后比较\nresult &lt;- MANOVA(npk, dv = \"yield\", between = c(\"N\", \"P\"))\n## \n## ====== ANOVA (Between-Subjects Design) ======\n## \n## Descriptives:\n## ─────────────────────────\n##  \"N\" \"P\"   Mean    S.D. n\n## ─────────────────────────\n##   N0  P0 51.717 (4.611) 6\n##   N0  P1 52.417 (6.486) 6\n##   N1  P0 59.217 (6.504) 6\n##   N1  P1 56.150 (5.084) 6\n## ─────────────────────────\n## Total sample size: N = 24\n## \n## ANOVA Table:\n## Dependent variable(s):      yield\n## Between-subjects factor(s): N, P\n## Within-subjects factor(s):  –\n## Covariate(s):               –\n## ──────────────────────────────────────────────────────────────────────\n##             MS    MSE df1 df2     F     p     η²p [90% CI of η²p]  η²G\n## ──────────────────────────────────────────────────────────────────────\n## N      189.282 32.870   1  20 5.758  .026 *     .224 [.017, .460] .224\n## P        8.402 32.870   1  20 0.256  .619       .013 [.000, .181] .013\n## N * P   21.282 32.870   1  20 0.647  .430       .031 [.000, .230] .031\n## ──────────────────────────────────────────────────────────────────────\n## MSE = mean square error (the residual variance of the linear model)\n## η²p = partial eta-squared = SS / (SS + SSE) = F * df1 / (F * df1 + df2)\n## ω²p = partial omega-squared = (F - 1) * df1 / (F * df1 + df2 + 1)\n## η²G = generalized eta-squared (see Olejnik & Algina, 2003)\n## Cohen’s f² = η²p / (1 - η²p)\n## \n## Levene’s Test for Homogeneity of Variance:\n## ───────────────────────────────────────\n##            Levene’s F df1 df2     p    \n## ───────────────────────────────────────\n## DV: yield       0.160   3  20  .922    \n## ───────────────────────────────────────\nEMMEANS(result, effect = \"N\")\n## ------ EMMEANS (effect = \"N\") ------\n## \n## Joint Tests of \"N\":\n## ───────────────────────────────────────────────────\n##  Effect df1 df2     F     p     η²p [90% CI of η²p]\n## ───────────────────────────────────────────────────\n##   N       1  20 5.758  .026 *     .224 [.017, .460]\n##   P       1  20 0.256  .619       .013 [.000, .181]\n##   N * P   1  20 0.647  .430       .031 [.000, .230]\n## ───────────────────────────────────────────────────\n## Note. Simple effects of repeated measures with 3 or more levels\n## are different from the results obtained with SPSS MANOVA syntax.\n## \n## Univariate Tests of \"N\":\n## ────────────────────────────────────────────────────────\n##            Sum of Squares df Mean Square     F     p    \n## ────────────────────────────────────────────────────────\n## Mean: \"N\"         189.282  1     189.282 5.758  .026 *  \n## Residuals         657.400 20      32.870                \n## ────────────────────────────────────────────────────────\n## Note. Identical to the results obtained with SPSS GLM EMMEANS syntax.\n## \n## Estimated Marginal Means of \"N\":\n## ────────────────────────────────────\n##  \"N\"   Mean [95% CI of Mean]    S.E.\n## ────────────────────────────────────\n##   N0 52.067 [48.614, 55.519] (1.655)\n##   N1 57.683 [54.231, 61.136] (1.655)\n## ────────────────────────────────────\n## \n## Pairwise Comparisons of \"N\":\n## ─────────────────────────────────────────────────────────────────────\n##  Contrast Estimate    S.E. df     t     p     Cohen’s d [95% CI of d]\n## ─────────────────────────────────────────────────────────────────────\n##   N1 - N0    5.617 (2.341) 20 2.400  .026 *      0.980 [0.128, 1.831]\n## ─────────────────────────────────────────────────────────────────────\n## Pooled SD for computing Cohen’s d: 5.733\n## Results are averaged over the levels of: P\n## No need to adjust p values.\n## \n## Disclaimer:\n## By default, pooled SD is Root Mean Square Error (RMSE).\n## There is much disagreement on how to compute Cohen’s d.\n## You are completely responsible for setting `sd.pooled`.\n## You might also use `effectsize::t_to_d()` to compute d."
  },
  {
    "objectID": "test.html#回归分析",
    "href": "test.html#回归分析",
    "title": "bruceR - 统计分析工具",
    "section": "回归分析",
    "text": "回归分析\n\nmodel_summary()：模型汇总\nlm1 &lt;- lm(Sepal.Length ~ Sepal.Width, data = iris)\nlm2 &lt;- lm(Sepal.Length ~ Sepal.Width + Petal.Length, data = iris)\nlm3 &lt;- lm(Sepal.Length ~ Sepal.Width + Petal.Length + Petal.Width, data = iris)\n\n# 多个模型对比\nmodel_summary(list(lm1, lm2, lm3))\n## \n## Model Summary\n## \n## ──────────────────────────────────────────────────────────────────\n##               (1) Sepal.Length  (2) Sepal.Length  (3) Sepal.Length\n## ──────────────────────────────────────────────────────────────────\n## (Intercept)     6.526 ***         2.249 ***         1.856 ***     \n##                (0.479)           (0.248)           (0.251)        \n## Sepal.Width    -0.223             0.596 ***         0.651 ***     \n##                (0.155)           (0.069)           (0.067)        \n## Petal.Length                      0.472 ***         0.709 ***     \n##                                  (0.017)           (0.057)        \n## Petal.Width                                        -0.556 ***     \n##                                                    (0.128)        \n## ──────────────────────────────────────────────────────────────────\n## R^2             0.014             0.840             0.859         \n## Adj. R^2        0.007             0.838             0.856         \n## Num. obs.     150               150               150             \n## ──────────────────────────────────────────────────────────────────\n## Note. * p &lt; .05, ** p &lt; .01, *** p &lt; .001.\n# 输出标准化系数\nmodel_summary(lm3, std = TRUE)\n## \n## Model Summary\n## \n## ──────────────────────────────\n##               (1) Sepal.Length\n## ──────────────────────────────\n## Sepal.Width      .343 ***     \n##                 (.035)        \n## Petal.Length    1.512 ***     \n##                 (.121)        \n## Petal.Width     -.512 ***     \n##                 (.117)        \n## ──────────────────────────────\n## R^2              .859         \n## Adj. R^2         .856         \n## Num. obs.     150             \n## ──────────────────────────────\n## Note. * p &lt; .05, ** p &lt; .01, *** p &lt; .001.\n## \n## # Check for Multicollinearity\n## \n## Low Correlation\n## \n##         Term  VIF     VIF 95% CI adj. VIF Tolerance Tolerance 95% CI\n##  Sepal.Width 1.27 [ 1.11,  1.65]     1.13      0.79     [0.61, 0.90]\n## \n## High Correlation\n## \n##          Term   VIF     VIF 95% CI adj. VIF Tolerance Tolerance 95% CI\n##  Petal.Length 15.10 [11.27, 20.36]     3.89      0.07     [0.05, 0.09]\n##   Petal.Width 14.23 [10.63, 19.19]     3.77      0.07     [0.05, 0.09]"
  },
  {
    "objectID": "test.html#中介与调节分析",
    "href": "test.html#中介与调节分析",
    "title": "bruceR - 统计分析工具",
    "section": "中介与调节分析",
    "text": "中介与调节分析\n\nPROCESS()：中介调节分析\nset.seed(123)\nn &lt;- 200\nmediation_data &lt;- data.frame(\n  X = rnorm(n),\n  M = rnorm(n),\n  Y = rnorm(n)\n)\nmediation_data$M &lt;- 0.5 * mediation_data$X + rnorm(n, sd = 0.5)\nmediation_data$Y &lt;- 0.4 * mediation_data$M + 0.3 * mediation_data$X + rnorm(n, sd = 0.5)\n\n# 简单中介模型\nPROCESS(mediation_data, y = \"Y\", x = \"X\", meds = \"M\", \n        ci = \"boot\", nsim = 100)\n## \n## ****************** PART 1. Regression Model Summary ******************\n## \n## PROCESS Model ID : 4\n## Model Type : Simple Mediation\n## -    Outcome (Y) : Y\n## -  Predictor (X) : X\n## -  Mediators (M) : M\n## - Moderators (W) : -\n## - Covariates (C) : -\n## -   HLM Clusters : -\n## \n## All numeric predictors have been grand-mean centered.\n## (For details, please see the help page of PROCESS.)\n## \n## Formula of Mediator:\n## -    M ~ X\n## Formula of Outcome:\n## -    Y ~ X + M\n## \n## CAUTION:\n##   Fixed effect (coef.) of a predictor involved in an interaction\n##   denotes its \"simple effect/slope\" at the other predictor = 0.\n##   Only when all predictors in an interaction are mean-centered\n##   can the fixed effect be interpreted as \"main effect\"!\n##   \n## Model Summary\n## \n## ──────────────────────────────────────────────────\n##              (1) Y        (2) M        (3) Y      \n## ──────────────────────────────────────────────────\n## (Intercept)    0.010       -0.015        0.010    \n##               (0.039)      (0.036)      (0.037)   \n## X              0.462 ***    0.475 ***    0.302 ***\n##               (0.041)      (0.039)      (0.052)   \n## M                                        0.336 ***\n##                                         (0.072)   \n## ──────────────────────────────────────────────────\n## R^2            0.391        0.434        0.452    \n## Adj. R^2       0.388        0.431        0.446    \n## Num. obs.    200          200          200        \n## ──────────────────────────────────────────────────\n## Note. * p &lt; .05, ** p &lt; .01, *** p &lt; .001.\n## \n## ************ PART 2. Mediation/Moderation Effect Estimate ************\n## \n## Package Use : ‘mediation’ (v4.5.0)\n## Effect Type : Simple Mediation (Model 4)\n## Sample Size : 200\n## Random Seed : set.seed()\n## Simulations : 100 (Bootstrap)\n## \n## Running 100 simulations...\n## Indirect Path: \"X\" (X) ==&gt; \"M\" (M) ==&gt; \"Y\" (Y)\n## ─────────────────────────────────────────────────────────────\n##                Effect    S.E.      z     p      [Boot 95% CI]\n## ─────────────────────────────────────────────────────────────\n## Indirect (ab)   0.160 (0.039)  4.046 &lt;.001 *** [0.098, 0.240]\n## Direct (c')     0.302 (0.053)  5.713 &lt;.001 *** [0.192, 0.387]\n## Total (c)       0.462 (0.040) 11.623 &lt;.001 *** [0.399, 0.545]\n## ─────────────────────────────────────────────────────────────\n## Percentile Bootstrap Confidence Interval\n## (SE and CI are estimated based on 100 Bootstrap samples.)\n## \n## Note. The results based on bootstrapping or other random processes\n## are unlikely identical to other statistical software (e.g., SPSS).\n## To make results reproducible, you need to set a seed (any number).\n## Please see the help page for details: help(PROCESS)\n## Ignore this note if you have already set a seed. :)"
  },
  {
    "objectID": "test.html#其他实用功能",
    "href": "test.html#其他实用功能",
    "title": "bruceR - 统计分析工具",
    "section": "其他实用功能",
    "text": "其他实用功能\n\n运算符\n# %notin%：不在其中\nc(1, 2, 3) %notin% c(2, 4, 6)\n## [1]  TRUE FALSE  TRUE\n# %allin%：全部在其中\nc(1, 2) %allin% c(1, 2, 3, 4)\n## [1] TRUE\n\n\ntheme_bruce()：ggplot2 主题\nlibrary(ggplot2)\n\nggplot(iris, aes(x = Sepal.Length, y = Sepal.Width, color = Species)) +\n  geom_point(size = 2, alpha = 0.7) +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  labs(title = \"鸢尾花数据可视化\") +\n  theme_bruce()\n\n\n\nplot of chunk unnamed-chunk-21"
  },
  {
    "objectID": "test.html#导出到-word",
    "href": "test.html#导出到-word",
    "title": "bruceR - 统计分析工具",
    "section": "导出到 Word",
    "text": "导出到 Word\nbruceR 的一大特色是可以将结果直接导出到 Word 文档：\n# 描述统计\nDescribe(iris[, 1:4], file = \"descriptives.doc\")\n\n# 相关矩阵\nCorr(iris[, 1:4], file = \"correlation.doc\")\n\n# 回归模型\nmodel_summary(list(lm1, lm2, lm3), file = \"regression.doc\")\n\n# 中介分析\nPROCESS(data, y = \"Y\", x = \"X\", meds = \"M\", file = \"mediation.doc\")"
  },
  {
    "objectID": "test.html#函数速查表",
    "href": "test.html#函数速查表",
    "title": "bruceR - 统计分析工具",
    "section": "函数速查表",
    "text": "函数速查表\n\n\n\n类别\n函数\n功能\n\n\n\n\n基础\nset.wd()\n设置工作目录到当前脚本位置\n\n\n\nimport() / export()\n万能数据导入/导出\n\n\n\ncc()\n快速创建字符向量\n\n\n\nprint_table()\n打印三线表\n\n\n计算\nMEAN() / SUM()\n横向计算（支持反向计分）\n\n\n\nRECODE()\n变量重编码\n\n\n\nRESCALE()\n变量标准化\n\n\n信效度\nAlpha()\nCronbach’s α 信度分析\n\n\n\nEFA() / PCA()\n探索性因子分析/主成分分析\n\n\n\nCFA()\n验证性因子分析\n\n\n描述\nDescribe()\n描述统计\n\n\n\nFreq()\n频率分析与交叉表\n\n\n\nCorr()\n相关分析与热力图\n\n\n检验\nTTEST()\nt检验（单样本/独立/配对）\n\n\n\nMANOVA()\n多因素方差分析\n\n\n\nEMMEANS()\n边际均值与事后比较\n\n\n回归\nmodel_summary()\n回归模型整洁输出\n\n\n\nGLM_summary()\n广义线性模型汇总\n\n\n\nHLM_summary()\n多层线性模型汇总\n\n\n中介\nPROCESS()\n中介/调节效应分析\n\n\n\nmed_summary()\n中介效应汇总"
  },
  {
    "objectID": "test.html#参考资源",
    "href": "test.html#参考资源",
    "title": "bruceR - 统计分析工具",
    "section": "参考资源",
    "text": "参考资源\n\nbruceR GitHub 主页\nCRAN 官方页面\n中文教程：概述篇\n中文教程：常见问题\n引用：Bao, H. W. S. (2021). bruceR: Broadly useful convenient and efficient R functions. https://doi.org/10.32614/CRAN.package.bruceR"
  },
  {
    "objectID": "sections/packages.html",
    "href": "sections/packages.html",
    "title": "实用 R 包",
    "section": "",
    "text": "这里收集了提高效率的各类 R 包，涵盖数据清洗、统计分析、表格生成等多个方面。每个包都附有详细的使用教程和实际案例。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nbruceR - 统计分析工具\n\n4 min\n\n\n\n\n\n\n\n\n\n\n\ncompareGroups-描述性表一快速生成\n\n2 min\n\n\n\n\n\n\n\n\n\n\n\nscitb-快速生成基线表一\n\n1 min\n\n\n\n\n\n\n\n\n\n\n\npurrr: 函数式编程,彻底摆脱for循环\n\n2 min\n\n\n\n\n\n\n\n\n\n\n\nR语言卫生经济学分析\n\n17 min\n\n\n\n\n\n\n\n\n\n\n\n时间序列分析\n\n3 min\n\n\n\n\n\n\n\n\n\n\n\n倾向性得分匹配 - 因果推断的利器\n\n9 min\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "sections/methods.html",
    "href": "sections/methods.html",
    "title": "R 语言统计方法",
    "section": "",
    "text": "这里收集了使用 R 语言实现的各类分析方法，涵盖传统统计、生存分析、因果推断和高级建模等领域。每篇教程都从原理出发，配以完整的代码实现和可视化。"
  },
  {
    "objectID": "3001-imports.html",
    "href": "3001-imports.html",
    "title": "R语言批量导入数据",
    "section": "",
    "text": "以公开数据库CHRALS为例\n在文件夹下有10个dta文件，文件名各不一致。如何将所有文件导入一个列表中？\n\n\n\n\nlibrary(bruceR)\nlibrary(purrr)\nrm(list = ls())\n# set_wd() # 自动构建时无需设置工作路径\n\n\n\n\n\nfiles &lt;- \n    fs::dir_ls(\"01-attch\\\\10\\\\CHARLS\", \n                   recurse = TRUE,\n                    glob = \"*.dta\")\n\nprint(files)\n\n01-attch/10/CHARLS/COVID_Module.dta\n01-attch/10/CHARLS/Demographic_Background.dta\n01-attch/10/CHARLS/Exit_Module.dta\n01-attch/10/CHARLS/Family_Information.dta\n01-attch/10/CHARLS/Health_Status_and_Functioning.dta\n01-attch/10/CHARLS/Household_Income.dta\n01-attch/10/CHARLS/Individual_Income.dta\n01-attch/10/CHARLS/Sample_Infor.dta\n01-attch/10/CHARLS/Weights.dta\n01-attch/10/CHARLS/Work_Retirement.dta\n\n\n\n\n\n\ndata_list &lt;- files |&gt; \n    map(\\(filename)\n    {import(file=filename)})\n\n可以看到已经导入成功 \n\n\n\n\ndata_list_neat &lt;- set_names(\n    data_list,\n    files |&gt; \n        map(\\(str)\n        {str_remove(str, \n        \"01-attch/10/CHARLS/\")})\n)\n\n可以看到列表每个元素名也规范了",
    "crumbs": [
      "主页",
      "实用操作",
      "数据导入导出"
    ]
  },
  {
    "objectID": "3001-imports.html#批量导入文件夹下的所有数据文件",
    "href": "3001-imports.html#批量导入文件夹下的所有数据文件",
    "title": "R语言批量导入数据",
    "section": "",
    "text": "以公开数据库CHRALS为例\n在文件夹下有10个dta文件，文件名各不一致。如何将所有文件导入一个列表中？\n\n\n\n\nlibrary(bruceR)\nlibrary(purrr)\nrm(list = ls())\n# set_wd() # 自动构建时无需设置工作路径\n\n\n\n\n\nfiles &lt;- \n    fs::dir_ls(\"01-attch\\\\10\\\\CHARLS\", \n                   recurse = TRUE,\n                    glob = \"*.dta\")\n\nprint(files)\n\n01-attch/10/CHARLS/COVID_Module.dta\n01-attch/10/CHARLS/Demographic_Background.dta\n01-attch/10/CHARLS/Exit_Module.dta\n01-attch/10/CHARLS/Family_Information.dta\n01-attch/10/CHARLS/Health_Status_and_Functioning.dta\n01-attch/10/CHARLS/Household_Income.dta\n01-attch/10/CHARLS/Individual_Income.dta\n01-attch/10/CHARLS/Sample_Infor.dta\n01-attch/10/CHARLS/Weights.dta\n01-attch/10/CHARLS/Work_Retirement.dta\n\n\n\n\n\n\ndata_list &lt;- files |&gt; \n    map(\\(filename)\n    {import(file=filename)})\n\n可以看到已经导入成功 \n\n\n\n\ndata_list_neat &lt;- set_names(\n    data_list,\n    files |&gt; \n        map(\\(str)\n        {str_remove(str, \n        \"01-attch/10/CHARLS/\")})\n)\n\n可以看到列表每个元素名也规范了",
    "crumbs": [
      "主页",
      "实用操作",
      "数据导入导出"
    ]
  },
  {
    "objectID": "3001-imports.html#批量导入excel下的多个sheet",
    "href": "3001-imports.html#批量导入excel下的多个sheet",
    "title": "R语言批量导入数据",
    "section": "批量导入excel下的多个sheet",
    "text": "批量导入excel下的多个sheet\n现在我们有一个excel文件，其中有多个sheet，如何一次性导入到列表里呢 \n\n第一步:提取sheet名\n\nsheet_names &lt;- readxl::excel_sheets(\n    \"01-attch/10/CHARLS/data.xlsx\"\n)\n\nsheet_names\n\n[1] \"gong\" \"bo\"   \"hong\" \"wan\"  \"he\"  \n\n\n\n\n第二步:批量导入\n\ndata_list &lt;- \n    sheet_names |&gt;\n    map(\\(var)\n        {import(\n        file='01-attch/10/CHARLS/data.xlsx',\n        sheet = var) \n    }) |&gt; \n    set_names(sheet_names)\n\nNew names:\nNew names:\nNew names:\nNew names:\nNew names:\n• `` -&gt; `...1`\n\nstr(data_list)\n\nList of 5\n $ gong:'data.frame':   12 obs. of  9 variables:\n  ..$ ...1: num [1:12] 1 2 3 4 5 6 7 8 9 10 ...\n  ..$ 来源: chr [1:12] \"白云区\" \"白云区\" \"天河区\" \"天河区\" ...\n  ..$ 重量: num [1:12] 0.501 0.502 0.498 0.497 0.499 0.496 0.5 0.503 0.5 0.501 ...\n  ..$ 编号: chr [1:12] \"1.19④\" \"1.19⑨\" \"1.20⑦\" \"1.20⑧\" ...\n  ..$ Cr  : num [1:12] 0.3465 0.1507 0.0616 0.0745 0.7903 ...\n  ..$ As  : num [1:12] 1.87 4.63 9.89 3.43 3.02 ...\n  ..$ Cd  : num [1:12] 0.0262 0.2018 0.4037 0 0.0485 ...\n  ..$ Pb  : num [1:12] 0.0761 0.2169 0.0744 0.131 0.4851 ...\n  ..$ Hg  : num [1:12] 0.1011 0.0577 0.187 0.1879 0.0538 ...\n $ bo  :'data.frame':   12 obs. of  9 variables:\n  ..$ ...1: num [1:12] 1 2 3 4 5 6 7 8 9 10 ...\n  ..$ 来源: chr [1:12] \"白云区\" \"天河区\" \"天河区\" \"天河区\" ...\n  ..$ 重量: num [1:12] 0.501 0.496 0.499 0.504 0.5 ...\n  ..$ 编号: chr [1:12] \"1.19③\" \"1.20⑨\" \"1.20⑩\" \"1.21①\" ...\n  ..$ Cr  : num [1:12] 0.0198 0.0384 0.0375 0.7255 1.784 ...\n  ..$ As  : num [1:12] 6.08 2.76 3.1 2.45 3.23 ...\n  ..$ Cd  : num [1:12] 0.0639 0.0788 0.0217 0 0.0549 ...\n  ..$ Pb  : num [1:12] 0.2474 0.0799 0.0743 0.0906 0.0836 ...\n  ..$ Hg  : num [1:12] 0.0362 0.0671 0.0383 0.0527 0.0442 ...\n $ hong:'data.frame':   12 obs. of  9 variables:\n  ..$ ...1: num [1:12] 1 2 3 4 5 6 7 8 9 10 ...\n  ..$ 来源: chr [1:12] \"白云区\" \"白云区\" \"天河区\" \"越秀区\" ...\n  ..$ 重量: num [1:12] 0.496 0.498 0.499 0.5 0.501 ...\n  ..$ 编号: chr [1:12] \"1.17②\" \"1.17④\" \"1.20⑥\" \"1.21⑩\" ...\n  ..$ Cr  : num [1:12] 1.283 0.636 0.233 1.073 0.979 ...\n  ..$ As  : num [1:12] 5.57 2.56 2.15 4.8 3.21 ...\n  ..$ Cd  : num [1:12] 0.1119 0.0241 0.0224 0 0 ...\n  ..$ Pb  : num [1:12] 0.157 0.0256 0.0745 0.1524 0.356 ...\n  ..$ Hg  : num [1:12] 0.37 0.184 1.375 1.49 0.469 ...\n $ wan :'data.frame':   12 obs. of  9 variables:\n  ..$ ...1: num [1:12] 1 2 3 4 5 6 7 8 9 10 ...\n  ..$ 来源: chr [1:12] \"白云区\" \"白云区\" \"越秀区\" \"越秀区\" ...\n  ..$ 重量: num [1:12] 0.497 0.498 0.493 0.499 0.498 ...\n  ..$ 编号: chr [1:12] \"1.23⑦\" \"1.23⑧\" \"1.21⑤\" \"1.21⑥\" ...\n  ..$ Cr  : num [1:12] 4.011 4.461 0.899 0.816 0.326 ...\n  ..$ As  : num [1:12] 0.0396 0.0934 0 0 1.4307 ...\n  ..$ Cd  : num [1:12] 0 0 0 0 0 0 0 0 0 0 ...\n  ..$ Pb  : num [1:12] 0 0.5965 0.0808 0.0878 0 ...\n  ..$ Hg  : num [1:12] 0.0066 0.017 0.062 0.0196 0.0404 0.0559 0.0074 0.0437 0.0177 0.0122 ...\n $ he  :'data.frame':   12 obs. of  9 variables:\n  ..$ ...1: num [1:12] 1 2 3 4 5 6 7 8 9 10 ...\n  ..$ 来源: chr [1:12] \"白云区\" \"白云区\" \"天河区\" \"越秀区\" ...\n  ..$ 重量: num [1:12] 0.497 0.497 0.5 0.501 0.501 0.5 0.502 0.502 0.497 0.501 ...\n  ..$ 编号: chr [1:12] \"1.19②\" \"1.23⑨\" \"1.20⑤\" \"1.21④\" ...\n  ..$ Cr  : num [1:12] 0 3.746 0.221 1.027 3.893 ...\n  ..$ As  : num [1:12] 0.908 3.099 0.935 0.896 2.939 ...\n  ..$ Cd  : num [1:12] 0.0115 0.0884 0.0395 0 0.1448 ...\n  ..$ Pb  : num [1:12] 0.065 1.545 0.845 0.125 0.226 ...\n  ..$ Hg  : num [1:12] 0.3371 0.0898 0.1123 0.1392 0.1663 ...",
    "crumbs": [
      "主页",
      "实用操作",
      "数据导入导出"
    ]
  },
  {
    "objectID": "3001-imports.html#尾语",
    "href": "3001-imports.html#尾语",
    "title": "R语言批量导入数据",
    "section": "尾语",
    "text": "尾语\n本期主要使用了bruceR包和purrr包，基本可以满足日常数据导入的所有需求。",
    "crumbs": [
      "主页",
      "实用操作",
      "数据导入导出"
    ]
  },
  {
    "objectID": "2021-cowplot.html",
    "href": "2021-cowplot.html",
    "title": "cowplot: 专业图形组合与美化",
    "section": "",
    "text": "cowplot 是 ggplot2 的扩展包，专注于：\n\n专业主题：出版级简洁主题\n图形组合：灵活的多图排列\n图形嵌入：在图中添加子图\n标签注释：自动添加 A/B/C 面板标签\n对齐控制：精确对齐多图坐标轴\n\n\nlibrary(ggplot2)\nlibrary(cowplot)\nlibrary(dplyr)",
    "crumbs": [
      "主页",
      "可视化教程",
      "cowplot - 图形组合"
    ]
  },
  {
    "objectID": "2021-cowplot.html#简介",
    "href": "2021-cowplot.html#简介",
    "title": "cowplot: 专业图形组合与美化",
    "section": "",
    "text": "cowplot 是 ggplot2 的扩展包，专注于：\n\n专业主题：出版级简洁主题\n图形组合：灵活的多图排列\n图形嵌入：在图中添加子图\n标签注释：自动添加 A/B/C 面板标签\n对齐控制：精确对齐多图坐标轴\n\n\nlibrary(ggplot2)\nlibrary(cowplot)\nlibrary(dplyr)",
    "crumbs": [
      "主页",
      "可视化教程",
      "cowplot - 图形组合"
    ]
  },
  {
    "objectID": "2021-cowplot.html#主题系统",
    "href": "2021-cowplot.html#主题系统",
    "title": "cowplot: 专业图形组合与美化",
    "section": "主题系统",
    "text": "主题系统\n\ntheme_cowplot - 经典主题\n\np &lt;- ggplot(mtcars, aes(wt, mpg)) + \n  geom_point(aes(color = factor(cyl)), size = 3)\n\n# cowplot 经典主题：无网格线，粗坐标轴\np + theme_cowplot(font_size = 12)\n\n\n\n\n\n\n\n\n\n\ntheme_minimal_grid - 极简网格\n\np + theme_minimal_grid(font_size = 12)\n\n\n\n\n\n\n\n\n\n\ntheme_minimal_hgrid / vgrid\n\np1 &lt;- p + theme_minimal_hgrid() + ggtitle(\"水平网格\")\np2 &lt;- p + theme_minimal_vgrid() + ggtitle(\"垂直网格\")\nplot_grid(p1, p2, ncol = 2)\n\n\n\n\n\n\n\n\n\n\ntheme_half_open - 半开放坐标轴\n\n# 只显示左下坐标轴，适合科研图\np + theme_half_open(font_size = 12)\n\n\n\n\n\n\n\n\n\n\n主题参数详解\n\np + theme_cowplot(\n  font_size = 14,       # 基础字号\n  font_family = \"\",     # 字体\n  line_size = 0.5,      # 线条粗细\n  rel_small = 12/14,    # 小字号比例\n  rel_tiny = 10/14,     # 更小字号比例\n  rel_large = 16/14     # 大字号比例\n)",
    "crumbs": [
      "主页",
      "可视化教程",
      "cowplot - 图形组合"
    ]
  },
  {
    "objectID": "2021-cowplot.html#图形组合plot_grid",
    "href": "2021-cowplot.html#图形组合plot_grid",
    "title": "cowplot: 专业图形组合与美化",
    "section": "图形组合：plot_grid()",
    "text": "图形组合：plot_grid()\n\n基础组合\n\np1 &lt;- ggplot(mtcars, aes(wt, mpg)) + geom_point() + theme_cowplot()\np2 &lt;- ggplot(mtcars, aes(disp, mpg)) + geom_point() + theme_cowplot()\np3 &lt;- ggplot(mtcars, aes(factor(cyl))) + geom_bar(fill = \"steelblue\") + theme_cowplot()\np4 &lt;- ggplot(mtcars, aes(hp, mpg)) + geom_point() + theme_cowplot()\n\n# 2x2 网格\nplot_grid(p1, p2, p3, p4, ncol = 2)\n\n\n\n\n\n\n\n\n\n\n添加标签\n\n# A/B/C/D 标签\nplot_grid(\n  p1, p2, p3, p4,\n  ncol = 2,\n  labels = \"AUTO\",          # 自动 A/B/C/D\n  label_size = 14,          # 标签字号\n  label_fontface = \"bold\"   # 粗体\n)\n\n\n\n\n\n\n\n\n\n# 自定义标签\nplot_grid(\n  p1, p2,\n  labels = c(\"图 1\", \"图 2\"),\n  label_size = 12,\n  label_x = 0.1,   # 标签 x 位置 (0-1)\n  label_y = 0.95   # 标签 y 位置 (0-1)\n)\n\n\n\n\n\n\n\n\n\n\n控制相对大小\n\n# rel_widths 控制列宽比例\nplot_grid(p1, p3, ncol = 2, rel_widths = c(2, 1))  # 左:右 = 2:1\n\n\n\n\n\n\n\n\n\n# rel_heights 控制行高比例\nplot_grid(p1, p3, nrow = 2, rel_heights = c(2, 1))  # 上:下 = 2:1\n\n\n\n\n\n\n\n\n\n\n对齐坐标轴\n\n# 不同 y 轴范围的图\npa &lt;- ggplot(mtcars, aes(wt, mpg)) + geom_point() + theme_cowplot()\npb &lt;- ggplot(mtcars, aes(wt, disp)) + geom_point() + theme_cowplot()\n\n# align 参数对齐坐标轴\nplot_grid(\n  pa, pb,\n  ncol = 2,\n  align = \"h\",   # 水平对齐 (h/v/hv/none)\n  axis = \"bt\"    # 对齐哪些轴 (t/b/l/r/tb/lr/tblr)\n)\n\n\n\n\n\n\n\n\n\n\n嵌套组合\n\n# 复杂布局：左边一个大图，右边两个小图\nright_col &lt;- plot_grid(p2, p3, ncol = 1, labels = c(\"B\", \"C\"))\nplot_grid(p1, right_col, ncol = 2, labels = c(\"A\", \"\"), rel_widths = c(1.5, 1))",
    "crumbs": [
      "主页",
      "可视化教程",
      "cowplot - 图形组合"
    ]
  },
  {
    "objectID": "2021-cowplot.html#图形嵌入draw_plot",
    "href": "2021-cowplot.html#图形嵌入draw_plot",
    "title": "cowplot: 专业图形组合与美化",
    "section": "图形嵌入：draw_plot()",
    "text": "图形嵌入：draw_plot()\n\n在图中嵌入子图\n\n# 主图\nmain_plot &lt;- ggplot(mtcars, aes(wt, mpg)) +\n  geom_point(size = 3) +\n  theme_cowplot()\n\n# 子图（缩略图）\ninset_plot &lt;- ggplot(mtcars, aes(factor(cyl))) +\n  geom_bar(fill = \"steelblue\") +\n  theme_cowplot(font_size = 10) +\n  theme(plot.background = element_rect(fill = \"white\", color = \"grey50\"))\n\n# 将子图嵌入主图\nggdraw(main_plot) +\n  draw_plot(\n    inset_plot,\n    x = 0.6, y = 0.6,           # 子图左下角位置\n    width = 0.35, height = 0.35  # 子图尺寸\n  )\n\n\n\n\n\n\n\n\n\n\n多个嵌入图\n\n# 可嵌入多个子图\ninset2 &lt;- ggplot(mtcars, aes(hp)) +\n  geom_histogram(fill = \"coral\", bins = 15) +\n  theme_cowplot(font_size = 9) +\n  labs(title = \"HP分布\")\n\nggdraw(main_plot) +\n  draw_plot(inset_plot, x = 0.05, y = 0.6, width = 0.3, height = 0.35) +\n  draw_plot(inset2, x = 0.65, y = 0.1, width = 0.3, height = 0.3)",
    "crumbs": [
      "主页",
      "可视化教程",
      "cowplot - 图形组合"
    ]
  },
  {
    "objectID": "2021-cowplot.html#添加注释",
    "href": "2021-cowplot.html#添加注释",
    "title": "cowplot: 专业图形组合与美化",
    "section": "添加注释",
    "text": "添加注释\n\ndraw_label()\n\n# 添加文字标签\nggdraw(main_plot) +\n  draw_label(\n    \"R2 = 0.75\",\n    x = 0.8, y = 0.9,\n    size = 14,\n    fontface = \"bold\",\n    color = \"red\"\n  )\n\n\n\n\n\n\n\n\n\n\ndraw_image() - 嵌入图片\n\n# 嵌入外部图片（如 logo）\nggdraw() +\n  draw_image(\"path/to/logo.png\", x = 0.4, y = 0.4, width = 0.2) +\n  draw_plot(p1)\n\n\n\ndraw_line() - 添加线条\n\n# 添加参考线或箭头\nggdraw(main_plot) +\n  draw_line(x = c(0.2, 0.5), y = c(0.2, 0.8), color = \"red\", size = 1)",
    "crumbs": [
      "主页",
      "可视化教程",
      "cowplot - 图形组合"
    ]
  },
  {
    "objectID": "2021-cowplot.html#坐标轴对齐align_plots",
    "href": "2021-cowplot.html#坐标轴对齐align_plots",
    "title": "cowplot: 专业图形组合与美化",
    "section": "坐标轴对齐：align_plots()",
    "text": "坐标轴对齐：align_plots()\n当图形有不同的坐标轴范围时，plot_grid() 的 align 参数可能不够用，此时使用 align_plots() 更精确。\n\n# 两个 y 轴范围差异大的图\nplot_a &lt;- ggplot(mtcars, aes(wt, mpg)) + geom_point() + theme_cowplot()\nplot_b &lt;- ggplot(mtcars, aes(wt, hp)) + geom_point() + theme_cowplot()\n\n# 精确对齐\naligned &lt;- align_plots(plot_a, plot_b, align = \"hv\", axis = \"tblr\")\nplot_grid(aligned[[1]], aligned[[2]], ncol = 2)",
    "crumbs": [
      "主页",
      "可视化教程",
      "cowplot - 图形组合"
    ]
  },
  {
    "objectID": "2021-cowplot.html#保存组合图",
    "href": "2021-cowplot.html#保存组合图",
    "title": "cowplot: 专业图形组合与美化",
    "section": "保存组合图",
    "text": "保存组合图\n\nsave_plot()\n\n# cowplot 提供的保存函数\ncombined &lt;- plot_grid(p1, p2, p3, p4, ncol = 2, labels = \"AUTO\")\n\n# 保存为 PNG\nsave_plot(\n  \"combined_plot.png\",\n  combined,\n  ncol = 2,          # 列数（用于计算尺寸）\n  nrow = 2,          # 行数\n  base_width = 4,    # 每个子图宽度（英寸）\n  base_height = 3    # 每个子图高度\n)\n\n# 保存为 PDF（矢量图）\nsave_plot(\"combined_plot.pdf\", combined, ncol = 2, nrow = 2)\n\n\n\nggsave2() - 增强版 ggsave\n\n# ggsave2 自动处理组合图尺寸\nggsave2(\"output.png\", combined, width = 10, height = 8, dpi = 300)",
    "crumbs": [
      "主页",
      "可视化教程",
      "cowplot - 图形组合"
    ]
  },
  {
    "objectID": "2021-cowplot.html#与-ggplot2-facet-对比",
    "href": "2021-cowplot.html#与-ggplot2-facet-对比",
    "title": "cowplot: 专业图形组合与美化",
    "section": "与 ggplot2 facet 对比",
    "text": "与 ggplot2 facet 对比\n\n\n\n场景\n推荐方法\n\n\n\n\n同一数据的分面\nggplot + facet_wrap()\n\n\n不同数据/不同图\ncowplot::plot_grid()\n\n\n需要不同坐标轴\ncowplot::plot_grid(align = “h”)\n\n\n需要嵌入子图\nggdraw() + draw_plot()\n\n\n复杂嵌套布局\ncowplot 嵌套 plot_grid()",
    "crumbs": [
      "主页",
      "可视化教程",
      "cowplot - 图形组合"
    ]
  },
  {
    "objectID": "2021-cowplot.html#实战完整科研图",
    "href": "2021-cowplot.html#实战完整科研图",
    "title": "cowplot: 专业图形组合与美化",
    "section": "实战：完整科研图",
    "text": "实战：完整科研图\n\nset.seed(42)\ndf &lt;- mtcars |&gt; mutate(group = ifelse(mpg &gt; 20, \"High\", \"Low\"))\n\n# 图 A: 散点图 + 回归\nfig_a &lt;- ggplot(df, aes(wt, mpg)) +\n  geom_point(aes(color = group), size = 3) +\n  geom_smooth(method = \"lm\", se = TRUE, color = \"grey40\") +\n  scale_color_manual(values = c(\"High\" = \"#E64B35\", \"Low\" = \"#4DAF4A\")) +\n  labs(x = \"Weight (1000 lbs)\", y = \"Miles per Gallon\", color = \"MPG Group\") +\n  theme_half_open() +\n  theme(legend.position = c(0.8, 0.8))\n\n# 图 B: 箱线图\nfig_b &lt;- ggplot(df, aes(factor(cyl), mpg, fill = group)) +\n  geom_boxplot() +\n  scale_fill_manual(values = c(\"High\" = \"#E64B35\", \"Low\" = \"#4DAF4A\")) +\n  labs(x = \"Cylinders\", y = \"MPG\", fill = \"Group\") +\n  theme_half_open() +\n  theme(legend.position = \"none\")\n\n# 图 C: 密度图\nfig_c &lt;- ggplot(df, aes(mpg, fill = group)) +\n  geom_density(alpha = 0.6) +\n  scale_fill_manual(values = c(\"High\" = \"#E64B35\", \"Low\" = \"#4DAF4A\")) +\n  labs(x = \"MPG\", y = \"Density\") +\n  theme_minimal_hgrid() +\n  theme(legend.position = \"none\")\n\n# 图 D: 柱状图\nfig_d &lt;- df |&gt;\n  count(cyl, group) |&gt;\n  ggplot(aes(factor(cyl), n, fill = group)) +\n  geom_col(position = \"dodge\") +\n  scale_fill_manual(values = c(\"High\" = \"#E64B35\", \"Low\" = \"#4DAF4A\")) +\n  labs(x = \"Cylinders\", y = \"Count\") +\n  theme_half_open() +\n  theme(legend.position = \"none\")\n\n# 组合：上方大图，下方三个小图\ntop_row &lt;- fig_a\nbottom_row &lt;- plot_grid(fig_b, fig_c, fig_d, ncol = 3, labels = c(\"B\", \"C\", \"D\"), label_size = 14)\n\n# 最终组合\nfinal_plot &lt;- plot_grid(\n  top_row, bottom_row,\n  nrow = 2,\n  labels = c(\"A\", \"\"),\n  label_size = 14,\n  rel_heights = c(1.2, 1)\n)\n\nfinal_plot",
    "crumbs": [
      "主页",
      "可视化教程",
      "cowplot - 图形组合"
    ]
  },
  {
    "objectID": "2021-cowplot.html#与-patchwork-对比",
    "href": "2021-cowplot.html#与-patchwork-对比",
    "title": "cowplot: 专业图形组合与美化",
    "section": "与 patchwork 对比",
    "text": "与 patchwork 对比\n\n\n\n特性\ncowplot\npatchwork\n\n\n\n\n语法\nplot_grid(p1, p2)\np1 + p2 / p1 | p2\n\n\n图形嵌入\ndraw_plot()\ninset_element()\n\n\n坐标轴对齐\n需手动 align\n自动对齐\n\n\n标签添加\nlabels = “AUTO”\nplot_annotation(tag_levels)\n\n\n主题系统\n丰富的专业主题\n无\n\n\n学习曲线\n中等\n简单\n\n\n\n选择建议：\n\n需要专业主题 → cowplot\n快速组合 → patchwork\n图形嵌入 → 两者均可\n复杂布局控制 → cowplot",
    "crumbs": [
      "主页",
      "可视化教程",
      "cowplot - 图形组合"
    ]
  },
  {
    "objectID": "2021-cowplot.html#提取与共享图例",
    "href": "2021-cowplot.html#提取与共享图例",
    "title": "cowplot: 专业图形组合与美化",
    "section": "提取与共享图例",
    "text": "提取与共享图例\n\n# 创建带图例的图\np_legend &lt;- ggplot(mtcars, aes(wt, mpg, color = factor(cyl))) +\n  geom_point(size = 3) +\n  scale_color_brewer(palette = \"Set1\", name = \"Cylinders\") +\n  theme_cowplot()\n\n# 提取图例\nlegend &lt;- get_legend(p_legend)\n\n# 创建无图例的图\np_no_leg1 &lt;- p_legend + theme(legend.position = \"none\")\np_no_leg2 &lt;- ggplot(mtcars, aes(disp, mpg, color = factor(cyl))) +\n  geom_point(size = 3) +\n  scale_color_brewer(palette = \"Set1\") +\n  theme_cowplot() +\n  theme(legend.position = \"none\")\n\n# 组合：两图共享一个图例\nplot_grid(\n  plot_grid(p_no_leg1, p_no_leg2, ncol = 2),\n  legend,\n  ncol = 2,\n  rel_widths = c(1, 0.15)\n)",
    "crumbs": [
      "主页",
      "可视化教程",
      "cowplot - 图形组合"
    ]
  },
  {
    "objectID": "2021-cowplot.html#常用函数速查",
    "href": "2021-cowplot.html#常用函数速查",
    "title": "cowplot: 专业图形组合与美化",
    "section": "常用函数速查",
    "text": "常用函数速查\n\n\n\n函数\n用途\n\n\n\n\ntheme_cowplot()\n经典无网格主题\n\n\ntheme_half_open()\n半开放坐标轴\n\n\ntheme_minimal_grid()\n极简网格\n\n\nplot_grid()\n组合多图\n\n\nalign_plots()\n精确对齐坐标轴\n\n\nggdraw()\n创建绑图画布\n\n\ndraw_plot()\n嵌入子图\n\n\ndraw_label()\n添加文字\n\n\ndraw_image()\n嵌入图片\n\n\nsave_plot()\n保存组合图\n\n\nget_legend()\n提取图例\n\n\nget_title()\n提取标题",
    "crumbs": [
      "主页",
      "可视化教程",
      "cowplot - 图形组合"
    ]
  },
  {
    "objectID": "2021-cowplot.html#总结",
    "href": "2021-cowplot.html#总结",
    "title": "cowplot: 专业图形组合与美化",
    "section": "总结",
    "text": "总结\ncowplot 核心优势：\n\n专业主题 - theme_cowplot(), theme_half_open() 直接用于科研图\n灵活组合 - plot_grid() 支持复杂嵌套布局\n精确控制 - rel_widths, rel_heights, align 参数\n图形嵌入 - draw_plot() 轻松添加子图\n自动标签 - labels = “AUTO” 一键添加面板标签\n\n推荐工作流：\n\n# 1. 创建单图，应用 cowplot 主题\np1 &lt;- ggplot(...) + theme_half_open()\np2 &lt;- ggplot(...) + theme_half_open()\n\n# 2. 组合并添加标签\ncombined &lt;- plot_grid(p1, p2, labels = \"AUTO\", align = \"hv\")\n\n# 3. 保存\nsave_plot(\"output.pdf\", combined, ncol = 2)",
    "crumbs": [
      "主页",
      "可视化教程",
      "cowplot - 图形组合"
    ]
  },
  {
    "objectID": "2019-dualaxis.html",
    "href": "2019-dualaxis.html",
    "title": "双坐标轴：左右两个 Y 轴的绑图技巧",
    "section": "",
    "text": "双坐标轴（Dual Y-Axis）图表可以在同一张图中展示两个量纲不同的变量，常用于展示趋势对比、柱线混合图等场景。本教程介绍如何在 ggplot2 中实现双坐标轴绑图。",
    "crumbs": [
      "主页",
      "可视化教程",
      "双坐标轴"
    ]
  },
  {
    "objectID": "2019-dualaxis.html#什么是双坐标轴",
    "href": "2019-dualaxis.html#什么是双坐标轴",
    "title": "双坐标轴：左右两个 Y 轴的绑图技巧",
    "section": "什么是双坐标轴？",
    "text": "什么是双坐标轴？\n双坐标轴图表是指在同一张图中使用两个 Y 轴：\n\n左 Y 轴（主轴）：通常展示主要变量\n右 Y 轴（次轴）：展示次要变量，量纲可能不同\n\n\n适用场景\n\n\n\n场景\n示例\n\n\n\n\n柱线混合图\n柱状图显示销量，折线图显示增长率\n\n\n趋势对比\n温度与降雨量的时间变化\n\n\n因果关系\n广告投入与销售额的关系\n\n\n\n\n\n争议与注意事项\n双坐标轴图表存在一些争议：\n\n误导性：两个 Y 轴的刻度比例会影响读者对数据关系的理解\n可读性：增加了图表的复杂度\n替代方案：分面图（facet）通常是更好的选择\n\n使用建议：\n\n✅ 两个变量确实有关联时使用\n✅ 明确标注两个轴的单位\n❌ 避免刻意调整刻度来制造相关性假象",
    "crumbs": [
      "主页",
      "可视化教程",
      "双坐标轴"
    ]
  },
  {
    "objectID": "2019-dualaxis.html#基础用法",
    "href": "2019-dualaxis.html#基础用法",
    "title": "双坐标轴：左右两个 Y 轴的绑图技巧",
    "section": "基础用法",
    "text": "基础用法\n\nggplot2 中的 sec_axis()\nggplot2 通过 sec_axis() 函数实现双坐标轴。核心原理是 次轴必须是主轴的线性变换。\n\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(tidyr)\n\n\n\n最简示例\n\n# 创建示例数据\ndf &lt;- data.frame(\n  month = 1:12,\n  sales = c(120, 135, 150, 180, 200, 220, 250, 240, 210, 180, 150, 160),\n  growth_rate = c(5, 8, 12, 15, 18, 20, 22, 18, 12, 8, 5, 6)\n)\n\n# 定义转换系数（让两个变量在图上有相似的范围）\ncoef &lt;- max(df$sales) / max(df$growth_rate)\n\nggplot(df, aes(x = month)) +\n  geom_col(aes(y = sales), fill = \"#4f46e5\", alpha = 0.7) +\n  geom_line(aes(y = growth_rate * coef), color = \"#ef4444\", linewidth = 1.2) +\n  geom_point(aes(y = growth_rate * coef), color = \"#ef4444\", size = 3) +\n  scale_y_continuous(\n    name = \"销售额\",\n    sec.axis = sec_axis(~ . / coef, name = \"增长率 (%)\")\n  ) +\n  scale_x_continuous(breaks = 1:12, labels = paste0(1:12, \"月\")) +\n  labs(title = \"月度销售额与增长率\", x = NULL) +\n  theme_bw(base_size = 12)\n\n\n\n\n\n\n\n\n\n\n关键步骤解析\n\n计算转换系数：coef &lt;- max(主轴变量) / max(次轴变量)\n绑制次轴数据时乘以系数：aes(y = growth_rate * coef)\n设置 sec_axis 时除以系数：sec_axis(~ . / coef, name = \"次轴标签\")",
    "crumbs": [
      "主页",
      "可视化教程",
      "双坐标轴"
    ]
  },
  {
    "objectID": "2019-dualaxis.html#柱线混合图",
    "href": "2019-dualaxis.html#柱线混合图",
    "title": "双坐标轴：左右两个 Y 轴的绑图技巧",
    "section": "柱线混合图",
    "text": "柱线混合图\n柱线混合图是双坐标轴最常见的应用场景。\n\n基础版本\n\n# 模拟季度数据\nquarterly &lt;- data.frame(\n  quarter = c(\"Q1\", \"Q2\", \"Q3\", \"Q4\"),\n  revenue = c(450, 520, 680, 720),\n  profit_margin = c(12, 15, 18, 20)\n)\n\ncoef &lt;- max(quarterly$revenue) / max(quarterly$profit_margin)\n\nggplot(quarterly, aes(x = quarter)) +\n  geom_col(aes(y = revenue), fill = \"#0ea5e9\", width = 0.6) +\n  geom_line(aes(y = profit_margin * coef, group = 1), \n            color = \"#f97316\", linewidth = 1.5) +\n  geom_point(aes(y = profit_margin * coef), \n             color = \"#f97316\", size = 4) +\n  scale_y_continuous(\n    name = \"营收 (万元)\",\n    sec.axis = sec_axis(~ . / coef, name = \"利润率 (%)\")\n  ) +\n  labs(title = \"季度营收与利润率\", x = NULL) +\n  theme_minimal(base_size = 12)\n\n\n\n\n\n\n\n\n\n\n添加数据标签\n\nggplot(quarterly, aes(x = quarter)) +\n  geom_col(aes(y = revenue), fill = \"#0ea5e9\", width = 0.6) +\n  geom_text(aes(y = revenue, label = revenue), vjust = -0.5, size = 4) +\n  geom_line(aes(y = profit_margin * coef, group = 1), \n            color = \"#f97316\", linewidth = 1.5) +\n  geom_point(aes(y = profit_margin * coef), \n             color = \"#f97316\", size = 4) +\n  geom_text(aes(y = profit_margin * coef, label = paste0(profit_margin, \"%\")), \n            vjust = -1, color = \"#f97316\", size = 4) +\n  scale_y_continuous(\n    name = \"营收 (万元)\",\n    limits = c(0, max(quarterly$revenue) * 1.15),\n    sec.axis = sec_axis(~ . / coef, name = \"利润率 (%)\")\n  ) +\n  labs(title = \"季度营收与利润率\", x = NULL) +\n  theme_minimal(base_size = 12)",
    "crumbs": [
      "主页",
      "可视化教程",
      "双坐标轴"
    ]
  },
  {
    "objectID": "2019-dualaxis.html#双折线图",
    "href": "2019-dualaxis.html#双折线图",
    "title": "双坐标轴：左右两个 Y 轴的绑图技巧",
    "section": "双折线图",
    "text": "双折线图\n当两个变量都是连续时间序列时，可以用双折线图。\n\n# 模拟气象数据\nweather &lt;- data.frame(\n  date = seq(as.Date(\"2025-01-01\"), as.Date(\"2025-12-01\"), by = \"month\"),\n  temperature = c(8, 10, 15, 20, 25, 30, 33, 32, 28, 22, 15, 10),\n  rainfall = c(45, 60, 80, 120, 180, 220, 150, 100, 70, 50, 40, 35)\n)\n\ncoef &lt;- max(weather$rainfall) / max(weather$temperature)\n\nggplot(weather, aes(x = date)) +\n  geom_line(aes(y = temperature), color = \"#ef4444\", linewidth = 1.2) +\n  geom_point(aes(y = temperature), color = \"#ef4444\", size = 2.5) +\n  geom_area(aes(y = rainfall / coef), fill = \"#3b82f6\", alpha = 0.3) +\n  geom_line(aes(y = rainfall / coef), color = \"#3b82f6\", linewidth = 1.2) +\n  scale_y_continuous(\n    name = \"温度 (°C)\",\n    sec.axis = sec_axis(~ . * coef, name = \"降雨量 (mm)\")\n  ) +\n  scale_x_date(date_labels = \"%m月\", date_breaks = \"1 month\") +\n  labs(title = \"2025 年月度温度与降雨量\", x = NULL) +\n  theme_bw(base_size = 12) +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))",
    "crumbs": [
      "主页",
      "可视化教程",
      "双坐标轴"
    ]
  },
  {
    "objectID": "2019-dualaxis.html#自定义坐标轴样式",
    "href": "2019-dualaxis.html#自定义坐标轴样式",
    "title": "双坐标轴：左右两个 Y 轴的绑图技巧",
    "section": "自定义坐标轴样式",
    "text": "自定义坐标轴样式\n\n匹配颜色\n让坐标轴颜色与对应的数据系列颜色一致，提高可读性：\n\nggplot(df, aes(x = month)) +\n  geom_col(aes(y = sales), fill = \"#4f46e5\", alpha = 0.8) +\n  geom_line(aes(y = growth_rate * coef), color = \"#ef4444\", linewidth = 1.2) +\n  geom_point(aes(y = growth_rate * coef), color = \"#ef4444\", size = 3) +\n  scale_y_continuous(\n    name = \"销售额\",\n    sec.axis = sec_axis(~ . / coef, name = \"增长率 (%)\")\n  ) +\n  scale_x_continuous(breaks = 1:12, labels = paste0(1:12, \"月\")) +\n  labs(title = \"月度销售额与增长率\", x = NULL) +\n  theme_bw(base_size = 12) +\n  theme(\n    axis.title.y.left = element_text(color = \"#4f46e5\", face = \"bold\"),\n    axis.text.y.left = element_text(color = \"#4f46e5\"),\n    axis.title.y.right = element_text(color = \"#ef4444\", face = \"bold\"),\n    axis.text.y.right = element_text(color = \"#ef4444\")\n  )\n\n\n\n\n\n\n\n\n\n\n添加图例\n双坐标轴图表默认没有图例，需要手动创建：\n\nggplot(df, aes(x = month)) +\n  geom_col(aes(y = sales, fill = \"销售额\"), alpha = 0.8) +\n  geom_line(aes(y = growth_rate * coef, color = \"增长率\"), linewidth = 1.2) +\n  geom_point(aes(y = growth_rate * coef, color = \"增长率\"), size = 3) +\n  scale_fill_manual(values = c(\"销售额\" = \"#4f46e5\")) +\n  scale_color_manual(values = c(\"增长率\" = \"#ef4444\")) +\n  scale_y_continuous(\n    name = \"销售额\",\n    sec.axis = sec_axis(~ . / coef, name = \"增长率 (%)\")\n  ) +\n  scale_x_continuous(breaks = 1:12, labels = paste0(1:12, \"月\")) +\n  labs(\n    title = \"月度销售额与增长率\",\n    x = NULL,\n    fill = NULL,\n    color = NULL\n  ) +\n  theme_bw(base_size = 12) +\n  theme(\n    legend.position = \"top\",\n    legend.box = \"horizontal\"\n  ) +\n  guides(\n    fill = guide_legend(order = 1),\n    color = guide_legend(order = 2)\n  )",
    "crumbs": [
      "主页",
      "可视化教程",
      "双坐标轴"
    ]
  },
  {
    "objectID": "2019-dualaxis.html#分组双坐标轴",
    "href": "2019-dualaxis.html#分组双坐标轴",
    "title": "双坐标轴：左右两个 Y 轴的绑图技巧",
    "section": "分组双坐标轴",
    "text": "分组双坐标轴\n当有分组变量时，可以使用堆叠或分组柱状图。\n\n# 分组数据\ngrouped_data &lt;- data.frame(\n  quarter = rep(c(\"Q1\", \"Q2\", \"Q3\", \"Q4\"), each = 2),\n  category = rep(c(\"产品A\", \"产品B\"), 4),\n  sales = c(200, 150, 250, 180, 300, 220, 280, 250),\n  total_growth = rep(c(8, 12, 15, 10), each = 2)\n)\n\n# 计算每季度总销售额用于绑图\ngrouped_summary &lt;- grouped_data |&gt;\n  group_by(quarter) |&gt;\n  summarise(total_sales = sum(sales), growth = first(total_growth))\n\ncoef &lt;- max(grouped_summary$total_sales) / max(grouped_summary$growth)\n\nggplot() +\n  geom_col(data = grouped_data, \n           aes(x = quarter, y = sales, fill = category),\n           position = \"dodge\", width = 0.7) +\n  geom_line(data = grouped_summary,\n            aes(x = quarter, y = growth * coef, group = 1),\n            color = \"#f97316\", linewidth = 1.5) +\n  geom_point(data = grouped_summary,\n             aes(x = quarter, y = growth * coef),\n             color = \"#f97316\", size = 4) +\n  scale_fill_manual(values = c(\"产品A\" = \"#4f46e5\", \"产品B\" = \"#06b6d4\")) +\n  scale_y_continuous(\n    name = \"销售额 (万元)\",\n    sec.axis = sec_axis(~ . / coef, name = \"增长率 (%)\")\n  ) +\n  labs(title = \"分产品销售额与总体增长率\", x = NULL, fill = NULL) +\n  theme_minimal(base_size = 12) +\n  theme(legend.position = \"top\")",
    "crumbs": [
      "主页",
      "可视化教程",
      "双坐标轴"
    ]
  },
  {
    "objectID": "2019-dualaxis.html#使用-ggnewscale-实现双图例",
    "href": "2019-dualaxis.html#使用-ggnewscale-实现双图例",
    "title": "双坐标轴：左右两个 Y 轴的绑图技巧",
    "section": "使用 ggnewscale 实现双图例",
    "text": "使用 ggnewscale 实现双图例\n当需要为两个轴分别设置完整的图例时，可以使用 ggnewscale 包：\n\nlibrary(ggnewscale)\n\nggplot(df, aes(x = month)) +\n  # 第一个图层：柱状图\n  geom_col(aes(y = sales, fill = sales), alpha = 0.8) +\n  scale_fill_gradient(low = \"#c7d2fe\", high = \"#4f46e5\", name = \"销售额\") +\n  # 开启新的填充/颜色标度\n\n  new_scale_color() +\n  # 第二个图层：折线图\n  geom_line(aes(y = growth_rate * coef, color = growth_rate), linewidth = 1.5) +\n  geom_point(aes(y = growth_rate * coef, color = growth_rate), size = 3) +\n  scale_color_gradient(low = \"#fca5a5\", high = \"#dc2626\", name = \"增长率 (%)\") +\n  scale_y_continuous(\n    name = \"销售额\",\n    sec.axis = sec_axis(~ . / coef, name = \"增长率 (%)\")\n  ) +\n  scale_x_continuous(breaks = 1:12, labels = paste0(1:12, \"月\")) +\n  labs(title = \"月度销售额与增长率\", x = NULL) +\n  theme_bw(base_size = 12)",
    "crumbs": [
      "主页",
      "可视化教程",
      "双坐标轴"
    ]
  },
  {
    "objectID": "2019-dualaxis.html#实战案例",
    "href": "2019-dualaxis.html#实战案例",
    "title": "双坐标轴：左右两个 Y 轴的绑图技巧",
    "section": "实战案例",
    "text": "实战案例\n\n案例1：经济指标对比\n\n# 模拟经济数据\neconomy &lt;- data.frame(\n  year = 2015:2024,\n  gdp = c(68.9, 74.6, 83.2, 91.9, 99.1, 101.4, 114.4, 121.0, 126.1, 134.8),\n  gdp_growth = c(6.9, 6.7, 6.8, 6.6, 6.0, 2.3, 8.1, 3.0, 5.2, 5.0)\n)\n\ncoef &lt;- max(economy$gdp) / max(economy$gdp_growth)\n\nggplot(economy, aes(x = year)) +\n  geom_area(aes(y = gdp), fill = \"#4f46e5\", alpha = 0.3) +\n  geom_line(aes(y = gdp), color = \"#4f46e5\", linewidth = 1.2) +\n  geom_point(aes(y = gdp), color = \"#4f46e5\", size = 2.5) +\n  geom_line(aes(y = gdp_growth * coef), color = \"#ef4444\", linewidth = 1.2) +\n  geom_point(aes(y = gdp_growth * coef), color = \"#ef4444\", size = 2.5) +\n  scale_y_continuous(\n    name = \"GDP (万亿元)\",\n    sec.axis = sec_axis(~ . / coef, name = \"GDP增速 (%)\")\n  ) +\n  scale_x_continuous(breaks = 2015:2024) +\n  labs(title = \"中国 GDP 总量与增速 (2015-2024)\", x = NULL) +\n  theme_bw(base_size = 12) +\n  theme(\n    axis.title.y.left = element_text(color = \"#4f46e5\"),\n    axis.text.y.left = element_text(color = \"#4f46e5\"),\n    axis.title.y.right = element_text(color = \"#ef4444\"),\n    axis.text.y.right = element_text(color = \"#ef4444\"),\n    axis.text.x = element_text(angle = 45, hjust = 1)\n  )\n\n\n\n\n\n\n\n\n\n\n案例2：营销效果分析\n\n# 模拟营销数据\nmarketing &lt;- data.frame(\n  week = 1:12,\n  ad_spend = c(5, 8, 12, 15, 20, 25, 22, 18, 15, 12, 10, 8),\n  conversions = c(120, 180, 280, 350, 480, 600, 550, 420, 350, 280, 220, 180)\n)\n\ncoef &lt;- max(marketing$conversions) / max(marketing$ad_spend)\n\nggplot(marketing, aes(x = week)) +\n  geom_col(aes(y = conversions, fill = \"转化数\"), alpha = 0.7, width = 0.7) +\n  geom_line(aes(y = ad_spend * coef, color = \"广告支出\"), linewidth = 1.5) +\n  geom_point(aes(y = ad_spend * coef, color = \"广告支出\"), size = 3) +\n  scale_fill_manual(values = c(\"转化数\" = \"#10b981\")) +\n  scale_color_manual(values = c(\"广告支出\" = \"#f59e0b\")) +\n  scale_y_continuous(\n    name = \"转化数\",\n    sec.axis = sec_axis(~ . / coef, name = \"广告支出 (万元)\")\n  ) +\n  scale_x_continuous(breaks = 1:12, labels = paste0(\"第\", 1:12, \"周\")) +\n  labs(\n    title = \"广告投入与转化效果\",\n    subtitle = \"12 周营销活动追踪\",\n    x = NULL, fill = NULL, color = NULL\n  ) +\n  theme_minimal(base_size = 12) +\n  theme(\n    legend.position = \"top\",\n    axis.text.x = element_text(angle = 45, hjust = 1)\n  )\n\n\n\n\n\n\n\n\n\n\n案例3：库存管理\n\n# 模拟库存数据\ninventory &lt;- data.frame(\n  month = factor(month.abb, levels = month.abb),\n  stock = c(1000, 850, 920, 780, 650, 500, 600, 750, 900, 1100, 1200, 1050),\n  turnover = c(2.5, 2.8, 2.6, 3.0, 3.5, 4.0, 3.8, 3.2, 2.8, 2.4, 2.2, 2.5)\n)\n\ncoef &lt;- max(inventory$stock) / max(inventory$turnover)\n\nggplot(inventory, aes(x = month)) +\n  geom_col(aes(y = stock), fill = \"#6366f1\", alpha = 0.7, width = 0.6) +\n  geom_line(aes(y = turnover * coef, group = 1), \n            color = \"#ec4899\", linewidth = 1.5) +\n  geom_point(aes(y = turnover * coef), color = \"#ec4899\", size = 3.5) +\n  geom_hline(yintercept = 800, linetype = \"dashed\", color = \"#6366f1\", alpha = 0.5) +\n  annotate(\"text\", x = 11.5, y = 850, label = \"安全库存线\", \n           color = \"#6366f1\", size = 3.5) +\n  scale_y_continuous(\n    name = \"库存量 (件)\",\n    sec.axis = sec_axis(~ . / coef, name = \"周转率\")\n  ) +\n  labs(\n    title = \"库存量与周转率月度变化\",\n    x = NULL\n  ) +\n  theme_bw(base_size = 12) +\n  theme(\n    axis.title.y.left = element_text(color = \"#6366f1\", face = \"bold\"),\n    axis.text.y.left = element_text(color = \"#6366f1\"),\n    axis.title.y.right = element_text(color = \"#ec4899\", face = \"bold\"),\n    axis.text.y.right = element_text(color = \"#ec4899\")\n  )",
    "crumbs": [
      "主页",
      "可视化教程",
      "双坐标轴"
    ]
  },
  {
    "objectID": "2019-dualaxis.html#封装函数",
    "href": "2019-dualaxis.html#封装函数",
    "title": "双坐标轴：左右两个 Y 轴的绑图技巧",
    "section": "封装函数",
    "text": "封装函数\n为了方便复用，可以将双坐标轴绑图封装成函数：\n\n#' 创建柱线混合双坐标轴图\n#' \n#' @param data 数据框\n#' @param x x轴变量名（字符串）\n#' @param y1 主轴变量名（柱状图）\n#' @param y2 次轴变量名（折线图）\n#' @param y1_name 主轴标签\n#' @param y2_name 次轴标签\n#' @param title 图表标题\n#' @param bar_color 柱状图颜色\n#' @param line_color 折线图颜色\ncreate_dual_axis_plot &lt;- function(\n    data, x, y1, y2,\n    y1_name = y1, y2_name = y2,\n    title = NULL,\n    bar_color = \"#4f46e5\",\n    line_color = \"#ef4444\"\n) {\n  \n  # 提取数据\n  x_val &lt;- data[[x]]\n  y1_val &lt;- data[[y1]]\n  y2_val &lt;- data[[y2]]\n  \n  # 计算转换系数\n  coef &lt;- max(y1_val, na.rm = TRUE) / max(y2_val, na.rm = TRUE)\n  \n  # 创建绑图数据\n  plot_data &lt;- data.frame(\n    x = x_val,\n    y1 = y1_val,\n    y2 = y2_val,\n    y2_scaled = y2_val * coef\n  )\n  \n  # 绘图\n  ggplot(plot_data, aes(x = x)) +\n    geom_col(aes(y = y1), fill = bar_color, alpha = 0.7, width = 0.6) +\n    geom_line(aes(y = y2_scaled, group = 1), color = line_color, linewidth = 1.2) +\n    geom_point(aes(y = y2_scaled), color = line_color, size = 3) +\n    scale_y_continuous(\n      name = y1_name,\n      sec.axis = sec_axis(~ . / coef, name = y2_name)\n    ) +\n    labs(title = title, x = NULL) +\n    theme_bw(base_size = 12) +\n    theme(\n      axis.title.y.left = element_text(color = bar_color, face = \"bold\"),\n      axis.text.y.left = element_text(color = bar_color),\n      axis.title.y.right = element_text(color = line_color, face = \"bold\"),\n      axis.text.y.right = element_text(color = line_color)\n    )\n}\n\n# 使用示例\ncreate_dual_axis_plot(\n  data = df,\n  x = \"month\",\n  y1 = \"sales\",\n  y2 = \"growth_rate\",\n  y1_name = \"销售额\",\n  y2_name = \"增长率 (%)\",\n  title = \"月度销售数据\"\n)",
    "crumbs": [
      "主页",
      "可视化教程",
      "双坐标轴"
    ]
  },
  {
    "objectID": "2019-dualaxis.html#常见问题",
    "href": "2019-dualaxis.html#常见问题",
    "title": "双坐标轴：左右两个 Y 轴的绑图技巧",
    "section": "常见问题",
    "text": "常见问题\n\n1. 如何确定合适的转换系数？\n最常用的方法是让两个变量的最大值对齐：\ncoef &lt;- max(主轴变量) / max(次轴变量)\n也可以根据数据范围调整：\n# 让两个变量的范围对齐\ncoef &lt;- diff(range(主轴变量)) / diff(range(次轴变量))\n\n\n2. 次轴数据显示不完整怎么办？\n调整主轴的 limits：\nscale_y_continuous(\n  limits = c(0, max(主轴变量) * 1.1),  # 留出10%空间\n  sec.axis = sec_axis(...)\n)\n\n\n3. 如何让次轴从 0 开始？\n需要对数据进行偏移变换：\n\n# 示例：次轴数据范围是 10-30，想让它从 0 开始显示\ndf_offset &lt;- data.frame(\n  x = 1:5,\n  y1 = c(100, 150, 200, 180, 220),\n  y2 = c(10, 15, 20, 25, 30)\n)\n\n# 计算偏移和缩放\ny2_min &lt;- min(df_offset$y2)\ny2_max &lt;- max(df_offset$y2)\ny1_max &lt;- max(df_offset$y1)\n\n# 变换公式: y2_transformed = (y2 - y2_min) * y1_max / (y2_max - y2_min)\ncoef &lt;- y1_max / (y2_max - y2_min)\noffset &lt;- y2_min\n\nggplot(df_offset, aes(x = x)) +\n  geom_col(aes(y = y1), fill = \"#4f46e5\", alpha = 0.7) +\n  geom_line(aes(y = (y2 - offset) * coef), color = \"#ef4444\", linewidth = 1.2) +\n  scale_y_continuous(\n    name = \"主轴\",\n    sec.axis = sec_axis(~ . / coef + offset, name = \"次轴\")\n  ) +\n  theme_bw()\n\n\n\n\n\n\n\n\n\n\n4. 双坐标轴 vs 分面图\n当不确定是否使用双坐标轴时，考虑用分面图替代：\n\n# 数据转换为长格式\ndf_long &lt;- df |&gt;\n  pivot_longer(cols = c(sales, growth_rate), \n               names_to = \"metric\", \n               values_to = \"value\") |&gt;\n  mutate(metric = ifelse(metric == \"sales\", \"销售额\", \"增长率 (%)\"))\n\n# 分面图\nggplot(df_long, aes(x = month, y = value, color = metric)) +\n  geom_line(linewidth = 1.2) +\n  geom_point(size = 2.5) +\n  facet_wrap(~ metric, ncol = 1, scales = \"free_y\") +\n  scale_x_continuous(breaks = 1:12, labels = paste0(1:12, \"月\")) +\n  labs(title = \"月度销售数据\", x = NULL, y = NULL, color = NULL) +\n  theme_bw(base_size = 12) +\n  theme(legend.position = \"none\")",
    "crumbs": [
      "主页",
      "可视化教程",
      "双坐标轴"
    ]
  },
  {
    "objectID": "2019-dualaxis.html#总结",
    "href": "2019-dualaxis.html#总结",
    "title": "双坐标轴：左右两个 Y 轴的绑图技巧",
    "section": "总结",
    "text": "总结\n双坐标轴的核心要点：\n\n原理：次轴是主轴的线性变换，通过 sec_axis() 实现\n转换系数：coef = max(主轴) / max(次轴)\n绘制次轴数据：乘以系数 y2 * coef\n设置次轴刻度：除以系数 ~ . / coef\n美化：匹配坐标轴颜色，添加图例\n\n使用建议：\n\n✅ 两个变量有明确关联时使用\n✅ 用颜色区分两个轴\n✅ 清晰标注单位\n❌ 避免刻意调整比例误导读者\n❌ 当数据复杂时，考虑分面图替代",
    "crumbs": [
      "主页",
      "可视化教程",
      "双坐标轴"
    ]
  },
  {
    "objectID": "2019-dualaxis.html#参考资源",
    "href": "2019-dualaxis.html#参考资源",
    "title": "双坐标轴：左右两个 Y 轴的绑图技巧",
    "section": "参考资源",
    "text": "参考资源\n\nggplot2 官方文档 - sec_axis\nggnewscale 包\nWhy not to use two Y axes - 关于双坐标轴争议的讨论",
    "crumbs": [
      "主页",
      "可视化教程",
      "双坐标轴"
    ]
  },
  {
    "objectID": "2017-ggtext.html",
    "href": "2017-ggtext.html",
    "title": "ggtext：中英文混合字体的完美解决方案",
    "section": "",
    "text": "ggtext 包扩展了 ggplot2 的文本渲染能力，支持 Markdown 和 HTML 语法，是解决中英文字体混合显示的终极方案。",
    "crumbs": [
      "主页",
      "可视化教程",
      "ggtext - 中英文字体混合"
    ]
  },
  {
    "objectID": "2017-ggtext.html#r包介绍",
    "href": "2017-ggtext.html#r包介绍",
    "title": "ggtext：中英文混合字体的完美解决方案",
    "section": "R包介绍",
    "text": "R包介绍\n\n为什么需要 ggtext？\n在科研绑图中，我们经常遇到以下问题：\n\n中英文混合：标题需要同时显示中文和英文，但字体不统一\n富文本格式：需要在标签中使用粗体、斜体、颜色等格式\n上下标：化学式 H₂O、数学公式 R² 等需要特殊格式\n图例美化：希望图例文字带颜色、格式\n\nggtext 完美解决了这些问题！\n\n\n安装与加载\n\ninstall.packages(\"ggtext\")\n\n\nlibrary(ggplot2)\nlibrary(ggtext)\nlibrary(dplyr)",
    "crumbs": [
      "主页",
      "可视化教程",
      "ggtext - 中英文字体混合"
    ]
  },
  {
    "objectID": "2017-ggtext.html#基础用法markdown-文本",
    "href": "2017-ggtext.html#基础用法markdown-文本",
    "title": "ggtext：中英文混合字体的完美解决方案",
    "section": "基础用法：Markdown 文本",
    "text": "基础用法：Markdown 文本\n\nelement_markdown() 基础\nggtext 的核心函数是 element_markdown()，它替代 element_text() 来渲染富文本。\n\n# 创建示例数据\ndata &lt;- data.frame(\n  category = c(\"Control\", \"Treatment A\", \"Treatment B\"),\n  value = c(25, 45, 35)\n)\n\n# 使用 Markdown 语法的标题\nggplot(data, aes(x = category, y = value, fill = category)) +\n  geom_col() +\n  labs(\n    title = \"**实验结果** (*Experimental Results*)\",\n    x = \"分组\",\n    y = \"数值\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_markdown(size = 16, hjust = 0.5)\n  ) +\n  scale_fill_brewer(palette = \"Set2\")\n\n\n\n\n\n\n\n\n\n\n支持的 Markdown 语法\n\n\n\n语法\n效果\n示例\n\n\n\n\n**text**\n粗体\n粗体文字\n\n\n*text*\n斜体\n斜体文字\n\n\n&lt;sup&gt;text&lt;/sup&gt;\n上标\nR2\n\n\n&lt;sub&gt;text&lt;/sub&gt;\n下标\nH2O\n\n\n&lt;span style='color:red'&gt;\n颜色\n红色文字\n\n\n&lt;br&gt;\n换行\n多行文本\n\n\n\n\nggplot(data, aes(x = category, y = value, fill = category)) +\n  geom_col() +\n  labs(\n    title = \"H&lt;sub&gt;2&lt;/sub&gt;O 含量与 CO&lt;sub&gt;2&lt;/sub&gt; 浓度\",\n    subtitle = \"相关系数 R&lt;sup&gt;2&lt;/sup&gt; = 0.95\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_markdown(size = 14, hjust = 0.5),\n    plot.subtitle = element_markdown(size = 11, hjust = 0.5, color = \"gray50\")\n  ) +\n  scale_fill_brewer(palette = \"Pastel1\")",
    "crumbs": [
      "主页",
      "可视化教程",
      "ggtext - 中英文字体混合"
    ]
  },
  {
    "objectID": "2017-ggtext.html#中英文混合字体设置",
    "href": "2017-ggtext.html#中英文混合字体设置",
    "title": "ggtext：中英文混合字体的完美解决方案",
    "section": "中英文混合字体设置",
    "text": "中英文混合字体设置\n\n核心原理\nggtext 使用 CSS 语法来指定字体，通过 &lt;span style='font-family:...'&gt; 可以为不同文字指定不同字体。\n\n\n基础示例：中英文分别设置字体\n\n# 创建带中英文标签的数据\ndf &lt;- data.frame(\n  group = c(\"对照组\\nControl\", \"治疗组A\\nTreatment A\", \"治疗组B\\nTreatment B\"),\n  mean_value = c(23.5, 45.2, 38.7)\n)\n\nggplot(df, aes(x = group, y = mean_value, fill = group)) +\n  geom_col(width = 0.7) +\n  labs(\n    title = \"&lt;span style='font-family:SimHei'&gt;临床试验结果&lt;/span&gt; &lt;span style='font-family:Arial'&gt;Clinical Trial Results&lt;/span&gt;\",\n    x = NULL,\n    y = \"&lt;span style='font-family:SimSun'&gt;数值&lt;/span&gt; (Value)\"\n  ) +\n  theme_bw(base_size = 12) +\n  theme(\n    plot.title = element_markdown(size = 16, hjust = 0.5),\n    axis.title.y = element_markdown(),\n    legend.position = \"none\"\n  ) +\n  scale_fill_brewer(palette = \"Blues\")\n\n\n\n\n\n\n\n\n\n\n推荐的中英文字体搭配\n\n\n\n用途\n中文字体\n英文字体\n效果\n\n\n\n\n正文\nSimSun (宋体)\nTimes New Roman\n学术规范\n\n\n标题\nSimHei (黑体)\nArial\n醒目清晰\n\n\n强调\nMicrosoft YaHei (微软雅黑)\nHelvetica\n现代简洁\n\n\n代码\nSimSun\nConsolas\n等宽整齐\n\n\n\n\n\n创建便捷函数\n为了简化中英文混合字体的设置，我们可以创建辅助函数：\n\n# 中英文混合文本格式化函数\nformat_cn_en &lt;- function(cn_text, en_text, \n                         cn_font = \"SimHei\", \n                         en_font = \"Arial\",\n                         cn_color = \"black\",\n                         en_color = \"gray30\") {\n  glue::glue(\n    \"&lt;span style='font-family:{cn_font}; color:{cn_color}'&gt;{cn_text}&lt;/span&gt; \",\n    \"&lt;span style='font-family:{en_font}; color:{en_color}; font-style:italic'&gt;{en_text}&lt;/span&gt;\"\n  )\n}\n\n# 使用示例\ntitle_text &lt;- format_cn_en(\"生存分析结果\", \"Survival Analysis\")\n\nggplot(mtcars, aes(x = factor(cyl), y = mpg, fill = factor(cyl))) +\n  geom_boxplot() +\n  labs(title = title_text) +\n  theme_bw() +\n  theme(\n    plot.title = element_markdown(size = 14, hjust = 0.5),\n    legend.position = \"none\"\n  ) +\n  scale_fill_brewer(palette = \"Set2\")",
    "crumbs": [
      "主页",
      "可视化教程",
      "ggtext - 中英文字体混合"
    ]
  },
  {
    "objectID": "2017-ggtext.html#高级应用彩色坐标轴标签",
    "href": "2017-ggtext.html#高级应用彩色坐标轴标签",
    "title": "ggtext：中英文混合字体的完美解决方案",
    "section": "高级应用：彩色坐标轴标签",
    "text": "高级应用：彩色坐标轴标签\n\n按分组着色的 X 轴标签\n\n# 创建数据，标签包含颜色信息\niris_summary &lt;- iris |&gt;\n  group_by(Species) |&gt;\n  summarise(mean_length = mean(Sepal.Length), .groups = \"drop\") |&gt;\n  mutate(\n    # 为每个物种创建带颜色的标签\n    colored_label = case_when(\n      Species == \"setosa\" ~ \"&lt;span style='color:#E41A1C'&gt;**Setosa** 山鸢尾&lt;/span&gt;\",\n      Species == \"versicolor\" ~ \"&lt;span style='color:#377EB8'&gt;**Versicolor** 变色鸢尾&lt;/span&gt;\",\n      Species == \"virginica\" ~ \"&lt;span style='color:#4DAF4A'&gt;**Virginica** 维吉尼亚鸢尾&lt;/span&gt;\"\n    )\n  )\n\nggplot(iris_summary, aes(x = colored_label, y = mean_length, fill = Species)) +\n  geom_col(width = 0.6) +\n  labs(\n    title = \"鸢尾花萼片长度比较\",\n    x = NULL,\n    y = \"平均萼片长度 (cm)\"\n  ) +\n  theme_bw(base_size = 12) +\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\"),\n    axis.text.x = element_markdown(size = 11),\n    legend.position = \"none\"\n  ) +\n  scale_fill_manual(values = c(\"#E41A1C\", \"#377EB8\", \"#4DAF4A\"))\n\n\n\n\n\n\n\n\n\n\n彩色图例文字\n\n# 使用 ggtext 美化图例\nggplot(iris, aes(x = Sepal.Length, y = Sepal.Width, color = Species)) +\n  geom_point(size = 2, alpha = 0.7) +\n  scale_color_manual(\n    values = c(\"setosa\" = \"#E41A1C\", \"versicolor\" = \"#377EB8\", \"virginica\" = \"#4DAF4A\"),\n    labels = c(\n      \"setosa\" = \"&lt;span style='color:#E41A1C'&gt;**Setosa** 山鸢尾&lt;/span&gt;\",\n      \"versicolor\" = \"&lt;span style='color:#377EB8'&gt;**Versicolor** 变色鸢尾&lt;/span&gt;\",\n      \"virginica\" = \"&lt;span style='color:#4DAF4A'&gt;**Virginica** 维吉尼亚鸢尾&lt;/span&gt;\"\n    )\n  ) +\n  labs(\n    title = \"鸢尾花形态特征散点图\",\n    x = \"萼片长度 Sepal Length (cm)\",\n    y = \"萼片宽度 Sepal Width (cm)\",\n    color = \"物种 Species\"\n  ) +\n  theme_bw() +\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\"),\n    legend.text = element_markdown(size = 10)\n  )",
    "crumbs": [
      "主页",
      "可视化教程",
      "ggtext - 中英文字体混合"
    ]
  },
  {
    "objectID": "2017-ggtext.html#文本框geom_richtext-和-geom_textbox",
    "href": "2017-ggtext.html#文本框geom_richtext-和-geom_textbox",
    "title": "ggtext：中英文混合字体的完美解决方案",
    "section": "文本框：geom_richtext() 和 geom_textbox()",
    "text": "文本框：geom_richtext() 和 geom_textbox()\n\ngeom_richtext()：富文本标注\n\n# 在图中添加富文本标注\ndf_annotation &lt;- data.frame(\n  x = 6.5,\n  y = 4.2,\n  label = \"**最大值点**&lt;br&gt;&lt;span style='color:red; font-size:10pt'&gt;*Sepal.Length* = 7.9&lt;/span&gt;\"\n)\n\nggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) +\n  geom_point(aes(color = Species), alpha = 0.6) +\n  geom_richtext(\n    data = df_annotation,\n    aes(x = x, y = y, label = label),\n    fill = \"white\",\n    label.color = \"gray50\",\n    hjust = 0\n  ) +\n  labs(title = \"使用 geom_richtext 添加标注\") +\n  theme_bw() +\n  theme(plot.title = element_text(hjust = 0.5)) +\n  scale_color_brewer(palette = \"Set1\")\n\n\n\n\n\n\n\n\n\n\ngeom_textbox()：文本框\n\n# 添加可换行的文本框\nlong_text &lt;- \"这是一段较长的说明文字，使用 **geom_textbox** 可以实现自动换行。支持 *Markdown* 语法和 &lt;span style='color:blue'&gt;HTML 样式&lt;/span&gt;。\"\n\nggplot(mtcars, aes(x = wt, y = mpg)) +\n  geom_point(aes(color = factor(cyl))) +\n  geom_textbox(\n    aes(x = 4.5, y = 30, label = long_text),\n    width = unit(5, \"cm\"),\n    fill = \"lightyellow\",\n    box.color = \"orange\",\n    hjust = 0.5\n  ) +\n  labs(title = \"使用 geom_textbox 添加说明\") +\n  theme_bw() +\n  theme(plot.title = element_text(hjust = 0.5)) +\n  scale_color_brewer(palette = \"Dark2\", name = \"气缸数\")",
    "crumbs": [
      "主页",
      "可视化教程",
      "ggtext - 中英文字体混合"
    ]
  },
  {
    "objectID": "2017-ggtext.html#实战案例完整的中英文混合图表",
    "href": "2017-ggtext.html#实战案例完整的中英文混合图表",
    "title": "ggtext：中英文混合字体的完美解决方案",
    "section": "实战案例：完整的中英文混合图表",
    "text": "实战案例：完整的中英文混合图表\n\n案例1：临床试验结果图\n\n# 模拟临床数据\nset.seed(42)\nclinical_data &lt;- data.frame(\n  group = rep(c(\"安慰剂组\\nPlacebo\", \"低剂量组\\nLow Dose\", \"高剂量组\\nHigh Dose\"), each = 30),\n  response = c(\n    rnorm(30, 50, 10),\n    rnorm(30, 60, 12),\n    rnorm(30, 75, 8)\n  )\n)\n\n# 计算汇总统计\nsummary_data &lt;- clinical_data |&gt;\n  group_by(group) |&gt;\n  summarise(\n    mean_val = mean(response),\n    se = sd(response) / sqrt(n()),\n    .groups = \"drop\"\n  )\n\n# 创建图表\np_clinical &lt;- ggplot(summary_data, aes(x = group, y = mean_val, fill = group)) +\n  geom_col(width = 0.6, color = \"black\", linewidth = 0.3) +\n  geom_errorbar(\n    aes(ymin = mean_val - se, ymax = mean_val + se),\n    width = 0.2\n  ) +\n  labs(\n    title = \"&lt;span style='font-family:SimHei; font-size:16pt'&gt;**药物疗效评估**&lt;/span&gt;&lt;br&gt;&lt;span style='font-family:Arial; color:gray40; font-size:12pt'&gt;*Drug Efficacy Assessment*&lt;/span&gt;\",\n    x = NULL,\n    y = \"&lt;span style='font-family:SimSun'&gt;应答率 (%)&lt;/span&gt; &lt;span style='font-family:Arial; color:gray50'&gt;Response Rate&lt;/span&gt;\"\n  ) +\n  theme_bw(base_size = 11) +\n  theme(\n    plot.title = element_markdown(hjust = 0.5, lineheight = 1.2),\n    axis.title.y = element_markdown(),\n    axis.text.x = element_text(size = 10),\n    legend.position = \"none\"\n  ) +\n  scale_fill_brewer(palette = \"Blues\") +\n  scale_y_continuous(expand = expansion(mult = c(0, 0.1)))\n\np_clinical\n\n\n\n\n\n\n\n\n\n\n案例2：带图片的图例\n\n# 创建自定义图例标签（模拟带图标效果）\nlegend_labels &lt;- c(\n  \"setosa\" = \"&lt;span style='color:#E41A1C'&gt;●&lt;/span&gt; **Setosa** &lt;span style='color:gray50'&gt;山鸢尾&lt;/span&gt;\",\n  \"versicolor\" = \"&lt;span style='color:#377EB8'&gt;●&lt;/span&gt; **Versicolor** &lt;span style='color:gray50'&gt;变色鸢尾&lt;/span&gt;\",\n  \"virginica\" = \"&lt;span style='color:#4DAF4A'&gt;●&lt;/span&gt; **Virginica** &lt;span style='color:gray50'&gt;维吉尼亚鸢尾&lt;/span&gt;\"\n)\n\nggplot(iris, aes(x = Sepal.Length, y = Petal.Length, color = Species)) +\n  geom_point(size = 2.5, alpha = 0.7) +\n  scale_color_manual(\n    values = c(\"setosa\" = \"#E41A1C\", \"versicolor\" = \"#377EB8\", \"virginica\" = \"#4DAF4A\"),\n    labels = legend_labels\n  ) +\n  labs(\n    title = \"鸢尾花 **萼片** 与 **花瓣** 长度关系\",\n    subtitle = \"*Relationship between Sepal and Petal Length*\",\n    x = \"萼片长度 (cm)\",\n    y = \"花瓣长度 (cm)\",\n    color = \"物种 Species\"\n  ) +\n  theme_bw() +\n  theme(\n    plot.title = element_markdown(size = 14, hjust = 0.5),\n    plot.subtitle = element_markdown(size = 11, hjust = 0.5, color = \"gray50\"),\n    legend.text = element_markdown(size = 10),\n    legend.title = element_text(face = \"bold\")\n  )",
    "crumbs": [
      "主页",
      "可视化教程",
      "ggtext - 中英文字体混合"
    ]
  },
  {
    "objectID": "2017-ggtext.html#常见问题与解决方案",
    "href": "2017-ggtext.html#常见问题与解决方案",
    "title": "ggtext：中英文混合字体的完美解决方案",
    "section": "常见问题与解决方案",
    "text": "常见问题与解决方案\n\n1. 字体不显示\n\n# 检查系统可用字体\nwindowsFonts()\n\n# 查看特定字体是否可用\nlibrary(systemfonts)\nsystem_fonts() |&gt; \n  filter(grepl(\"Sim|Microsoft\", family, ignore.case = TRUE))\n\n\n\n2. PDF 导出中文乱码\n\n# 使用 ragg 包导出 PNG（推荐）\nggsave(\"figure.png\", plot = p, device = ragg::agg_png, dpi = 300)\n\n# PDF 使用 cairo_pdf\nggsave(\"figure.pdf\", plot = p, device = cairo_pdf)\n\n\n\n3. element_markdown 与 element_text 的区别\n\n\n\n特性\nelement_text()\nelement_markdown()\n\n\n\n\n纯文本\n✓\n✓\n\n\n粗体/斜体\nface 参数\nMarkdown 语法\n\n\n颜色\ncolor 参数\nHTML span 标签\n\n\n多字体\n✗\n✓\n\n\n上下标\n✗\n✓",
    "crumbs": [
      "主页",
      "可视化教程",
      "ggtext - 中英文字体混合"
    ]
  },
  {
    "objectID": "2017-ggtext.html#总结",
    "href": "2017-ggtext.html#总结",
    "title": "ggtext：中英文混合字体的完美解决方案",
    "section": "总结",
    "text": "总结\nggtext 包的核心功能：\n\nelement_markdown()：在主题元素中使用 Markdown/HTML\ngeom_richtext()：在图中添加富文本标注\ngeom_textbox()：添加可换行的文本框\n中英文混合：通过 CSS font-family 属性实现\n\n推荐的工作流程：\n\n使用 glue 包构建复杂的 HTML 字符串\n创建辅助函数简化重复操作\n使用 ragg 包导出确保中文正常显示\n\n参考资源：\n\nggtext 官方文档\nCRAN 页面\nggtext GitHub",
    "crumbs": [
      "主页",
      "可视化教程",
      "ggtext - 中英文字体混合"
    ]
  },
  {
    "objectID": "2015-map.html",
    "href": "2015-map.html",
    "title": "R语言采样地图绘制详细教程",
    "section": "",
    "text": "本期主要介绍如何绘制采样地图和国内区域地图，并自定义相关内容",
    "crumbs": [
      "主页",
      "可视化教程",
      "地图绑制"
    ]
  },
  {
    "objectID": "2015-map.html#r包介绍",
    "href": "2015-map.html#r包介绍",
    "title": "R语言采样地图绘制详细教程",
    "section": "R包介绍",
    "text": "R包介绍\nggspatial教程",
    "crumbs": [
      "主页",
      "可视化教程",
      "地图绑制"
    ]
  },
  {
    "objectID": "2015-map.html#r包安装",
    "href": "2015-map.html#r包安装",
    "title": "R语言采样地图绘制详细教程",
    "section": "R包安装",
    "text": "R包安装\n\ninstall.packages(\"ggspatial\")\ninstall.packages(\"sf\")",
    "crumbs": [
      "主页",
      "可视化教程",
      "地图绑制"
    ]
  },
  {
    "objectID": "2015-map.html#基础绘图代码",
    "href": "2015-map.html#基础绘图代码",
    "title": "R语言采样地图绘制详细教程",
    "section": "基础绘图代码",
    "text": "基础绘图代码\n\n导入地图json数据\n进入从阿里云DataV可视化网站（可选择其他平台）下载格式为.json的地图数据：\n\n\n\n数据导入\n\nlibrary(ggspatial)\nlibrary(sf)\n\nLinking to GEOS 3.13.1, GDAL 3.11.4, PROJ 9.7.0; sf_use_s2() is TRUE\n\nlibrary(ggplot2)\n\n# 导入地图json数据\nmap &lt;- st_read(\"01-attch\\\\10\\\\广州市.json\")\n\nReading layer `广州市' from data source \n  `E:\\99 其它\\05 R语言\\doc\\01-attch\\10\\广州市.json' using driver `GeoJSON'\nSimple feature collection with 11 features and 9 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 112.9585 ymin: 22.51436 xmax: 114.06 ymax: 23.93292\nGeodetic CRS:  WGS 84\n\n\n\n\n开始绘制\n\n添加省份区边框\n\nggplot() +\n  labs(title = \"Guangzhou\", x = NULL, y = NULL) +\n  geom_sf(data = map, fill = c(\"#f0eedf\"), size = 0.8, color = \"black\")\n\n\n\n\n\n\n\n\n\n\n添加指南针annotation\n\np &lt;- ggplot() +\n  labs(title = \"Guangzhou\", x = NULL, y = NULL) +\n  geom_sf(data = map, fill = c(\"#f0eedf\"), size = 0.8, color = \"black\") + # 设置比例尺\n  annotation_north_arrow(\n    location = \"tl\",\n    style = north_arrow_nautical(\n      fill = c(\"black\", \"white\"),\n      line_col = \"black\"\n    )\n  )\np",
    "crumbs": [
      "主页",
      "可视化教程",
      "地图绑制"
    ]
  },
  {
    "objectID": "2015-map.html#我们来自定义绘图内容",
    "href": "2015-map.html#我们来自定义绘图内容",
    "title": "R语言采样地图绘制详细教程",
    "section": "我们来自定义绘图内容",
    "text": "我们来自定义绘图内容\n\n设置白云区天河区突出显示\n我们新加一个图层就可以，然后fill填充亮色\n\np + geom_sf(\n  data = map |&gt; dplyr::filter(name %in% c(\"天河区\", \"白云区\", \"番禺区\")),\n  fill = c(\"#c98c50\"),\n  size = 0.8,\n  color = \"black\"\n)\n\n\n\n\n\n\n\n\n\n\n设置text\n接下来我们要在图里标注部分区名\n\nlibrary(showtext)\nshowtext::showtext_auto()\n\n\np + geom_sf(\n  data = map |&gt; dplyr::filter(name %in% c(\"天河区\", \"白云区\", \"番禺区\")),\n  fill = c(\"#c98c50\"),\n  size = 0.8,\n  color = \"black\"\n) +\n  geom_sf_text(\n    data = map |&gt; dplyr::filter(name %in% c(\"天河区\", \"白云区\", \"番禺区\")),\n    aes(label = name),\n    size = 3,\n    color = \"black\",\n    fontface = \"bold\"\n  )\n\n\n\n\n\n\n\n\n\n\n设置一个合适的主题\n\np2 &lt;-\n  p + geom_sf(\n    data = map |&gt; dplyr::filter(name %in% c(\"天河区\", \"白云区\", \"番禺区\")),\n    fill = c(\"#c98c50\"),\n    size = 0.8,\n    color = \"black\"\n  ) +\n  geom_sf_text(\n    data = map |&gt; dplyr::filter(name %in% c(\"天河区\", \"白云区\", \"番禺区\")),\n    aes(label = name),\n    size = 3,\n    color = \"black\",\n    fontface = \"bold\"\n  ) +\n  theme_minimal()\n\np2\n\n\n\n\n\n\n\n\n\n\n设置根据数值变量对各区的fill进行映射\n\n# 先生成一个随机变量\nmap_neat_1 &lt;-\n  map |&gt;\n  dplyr::mutate(\n    value = sample(1:100, nrow(map), replace = TRUE)\n  )\n\n\nggplot() +\n  labs(title = \"map_neat_1\", x = NULL, y = NULL) +\n  geom_sf(data = map_neat_1, aes(fill = value), size = 0.8, color = \"black\") + # 设置比例尺\n  annotation_north_arrow(\n    location = \"tl\",\n    style = north_arrow_nautical(\n      fill = c(\"black\", \"white\"),\n      line_col = \"black\"\n    )\n  ) +\n  geom_sf_text(\n    data = map,\n    aes(label = name),\n    size = 3,\n    color = \"black\",\n    fontface = \"bold\"\n  ) +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\n\n根据分类变量对区进行fill映射\n\nlibrary(MetBrewer)\n\nmap_neat_2 &lt;-\n  map |&gt;\n  dplyr::mutate(\n    group = sample(c(\"A\", \"B\", \"C\"), nrow(map), replace = TRUE)\n  )\n\nggplot() +\n  labs(title = \"map_neat_2\", x = NULL, y = NULL) +\n  geom_sf(data = map_neat_2, aes(fill = group), size = 0.8, color = \"black\") + # 设置比例尺\n  annotation_north_arrow(\n    location = \"tl\",\n    style = north_arrow_nautical(\n      fill = c(\"black\", \"white\"),\n      line_col = \"black\"\n    )\n  ) +\n  geom_sf_text(\n    data = map,\n    aes(label = name),\n    size = 3,\n    color = \"black\",\n    fontface = \"bold\"\n  ) +\n  theme_minimal() +\n  scale_fill_met_d(\"Cassatt1\")\n\n\n\n\n\n\n\n\n\n\n添加采样点\n\ndata_sample &lt;-\n  tibble::tibble(\n    lon = c(113.292333, 113.412333, 113.532333),\n    lat = c(23.191944, 23.331944, 22.931944),\n    point = c(\"A\", \"B\", \"C\"),\n  )\n\np2 +\n  geom_point(\n    data = data_sample,\n    aes(x = lon, y = lat),\n    size = 2,\n    color = \"#1647a3\"\n  ) +\n  geom_text(\n    data = data_sample,\n    aes(x = lon, y = lat, label = point),\n    size = 4,\n    color = \"#000000\",\n    fontface = \"bold\",\n    nudge_y = 0.05\n  )+\n  labs(title = \"广州市\")+\n  theme(plot.title = element_text(hjust = 0.5))",
    "crumbs": [
      "主页",
      "可视化教程",
      "地图绑制"
    ]
  },
  {
    "objectID": "2013-legend.html",
    "href": "2013-legend.html",
    "title": "R语言图例修改自定义教程",
    "section": "",
    "text": "ggplot2中的图例样式修改（图例间距，位置修改等）一直是大部分用户的心头痛，因为它的修改方法实在太多了，而且很难记住。多种参数方法看起来杂乱无章，但是在24年2月更新的ggplot2 2.3.5之后，ggplot2的图例修改方法终于有了一个统一的标准。接下来我们一起学习一下吧\n在ggplot2更新后有且仅有一种方式修改图例样式，那就是使用theme()参数 。theme()函数有新的参数来控制图例的外观，这使得全局控制图例的外观变得更容易。例如： theme(legend.frame)替换 guide_colourbar(frame.colour, frame.linewidth, frame.linetype) 和 theme(legend.axis.line)替换 guide_bins(axis, axis.colour, axis.linewidth, axis.arrow) 。（如果有其它方法就是还没弃置，建议不要用了）",
    "crumbs": [
      "主页",
      "可视化教程",
      "图例自定义"
    ]
  },
  {
    "objectID": "2013-legend.html#图例样式修改介绍",
    "href": "2013-legend.html#图例样式修改介绍",
    "title": "R语言图例修改自定义教程",
    "section": "",
    "text": "ggplot2中的图例样式修改（图例间距，位置修改等）一直是大部分用户的心头痛，因为它的修改方法实在太多了，而且很难记住。多种参数方法看起来杂乱无章，但是在24年2月更新的ggplot2 2.3.5之后，ggplot2的图例修改方法终于有了一个统一的标准。接下来我们一起学习一下吧\n在ggplot2更新后有且仅有一种方式修改图例样式，那就是使用theme()参数 。theme()函数有新的参数来控制图例的外观，这使得全局控制图例的外观变得更容易。例如： theme(legend.frame)替换 guide_colourbar(frame.colour, frame.linewidth, frame.linetype) 和 theme(legend.axis.line)替换 guide_bins(axis, axis.colour, axis.linewidth, axis.arrow) 。（如果有其它方法就是还没弃置，建议不要用了）",
    "crumbs": [
      "主页",
      "可视化教程",
      "图例自定义"
    ]
  },
  {
    "objectID": "2013-legend.html#本期主要内容来源",
    "href": "2013-legend.html#本期主要内容来源",
    "title": "R语言图例修改自定义教程",
    "section": "本期主要内容来源",
    "text": "本期主要内容来源\n更新说明\nguide_legend教程",
    "crumbs": [
      "主页",
      "可视化教程",
      "图例自定义"
    ]
  },
  {
    "objectID": "2013-legend.html#加载包",
    "href": "2013-legend.html#加载包",
    "title": "R语言图例修改自定义教程",
    "section": "加载包",
    "text": "加载包\n\nlibrary(ggplot2)",
    "crumbs": [
      "主页",
      "可视化教程",
      "图例自定义"
    ]
  },
  {
    "objectID": "2013-legend.html#图例行为",
    "href": "2013-legend.html#图例行为",
    "title": "R语言图例修改自定义教程",
    "section": "图例行为",
    "text": "图例行为\n\nguide_legend系列\nggplot2 中的图例包含名为guide_legend()，还包括guide_colourbar() 、 guide_coloursteps()和guide_bins()基本参数都一致，设置图例的类型 。\n\nguide_legend(\n  title = waiver(),\n  theme = NULL,\n  position = NULL,\n  direction = NULL,\n  override.aes = list(),\n  nrow = NULL,\n  ncol = NULL,\n  reverse = FALSE,\n  order = 0,\n  ...\n)\n\n\n\n更新后加了什么\n下方代码展示了如何设置某单独映射的图例样式和全局样式的区别。如果要单独设置某映射的图例样式，只需将其添加到guides() 。如果要设置全局样式，只需将其添加到theme() 。最终的参数形式就是theme(legend.XXX = element_XXX()) 。\n\nggplot(mpg, aes(displ, hwy, shape = factor(cyl), colour = cty)) +\n  geom_point() +\n  # 设置单独映射的图例\n  guides(\n    shape  = guide_legend(theme = theme(legend.text = element_text(colour = \"red\"))),\n    colour = guide_colorbar(theme = theme(legend.frame = element_rect(colour = \"red\")))\n  ) +\n  # 设置全局图例的样式\n  theme(\n    legend.title.position = \"left\",\n    # Title justification is controlled by hjust/vjust in the element\n    legend.title = element_text(angle = 90, hjust = 0.5)\n  )\n\n\n\n\n\n\n\n\n\n\n图例是否显示\n唯一不放在theme里的参数就是legend.show 。您可以在图层中设置show.legend = TRUE选项。和以前一样， show.legend参数仍然可以以特定于美学的方式设置。将其设置为TRUE表示“始终显示”， FALSE表示“从不显示”， NA表示“如果找到则显示”。查看下方示例，在设置了plot的showlegend里在图例中强制显示了点和线。\n::: {.cell}\np &lt;- ggplot(mpg, aes(displ, hwy)) +\n scale_alpha_manual(values = c(0.5, 1))\n\np +\n geom_point(aes(colour = \"points\", alpha = \"points\")) +\n geom_line(\n   aes(colour = \"line\", alpha = \"line\"),\n   stat = \"smooth\", formula = y ~ x, method = \"lm\"\n )\n::: {.cell-output-display}  :::\np +\n geom_point(\n   aes(colour = \"points\", alpha = \"points\"),\n   show.legend = TRUE # always show\n ) +\n geom_line(\n   aes(colour = \"line\", alpha = \"line\"),\n   stat = \"smooth\", formula = y ~ x, method = \"lm\",\n   show.legend = c(colour = NA, alpha = TRUE) # always show in alpha\n )\n::: {.cell-output-display}  ::: :::\n\n\n图例位置\n图例位置不再仅限于图的一侧。通过设置guides的position参数，你可以定制哪些参考线出现在绘图中的位置。没有设置位置的参考线（例如下面的“drv”形状图例）遵循全局主题的legend.position设置。\n\np &lt;- ggplot(mpg, \n    aes(displ, hwy, shape = drv, colour = cty, size = year)) +\n  geom_point(aes(alpha = cyl))+\n  theme(legend.position = \"left\") +\n  guides(\n    colour = guide_colourbar(position = \"right\"),\n    size   = guide_legend(position = \"top\"),\n    alpha  = guide_legend(position = \"inside\")\n  ) \np\n\n\n\n\n\n\n\n\n\n图例的对齐\n图例的对齐可以通过使用theme的legend.justification.{position}参数来控制。此外，通过设置legend.location参数，可以将顶部和底部参考线与绘图而不是面板对齐。默认情况下，当plot.title.position = \"plot\"时，左侧图例已经对齐。因此，对于legend.location设置，顶部和底部参考线优先。\n\np + \n  labs(title = \"Plot-aligned title\") +\n  theme(\n    legend.margin = margin(0, 0, 0, 0), # turned off for alignment\n    legend.justification.top = \"left\",\n    legend.justification.left = \"top\",\n    legend.justification.bottom = \"right\",\n    legend.justification.inside = c(1, 1),\n    legend.location = \"plot\",\n    plot.title.position = \"plot\"\n  )\n\n\n\n\n\n\n\n\n\n\n\n图例的间距\n我们先观看一下下方的图，表示图例的组成和间距的含义\n\n\n\n图例图示\n\n\n当标题和键没有明确的边距时，会根据文本或标题位置自动添加适当的边距。但是，如果您覆盖边距，它们将按你的设置来走。\n\nggplot(mpg, aes(displ, hwy, colour = class)) +\n  geom_point() +\n  guides(colour = guide_legend(ncol = 2)) +\n  theme(\n    legend.key.spacing.x = unit(10, \"pt\"),\n    legend.key.spacing.y = unit(20, \"pt\"),\n    legend.text = element_text(margin = margin(l = 0)),\n    legend.title = element_text(margin = margin(b = 20))\n  )\n\n\n\n\n\n\n\n\n\n\n添加特殊图例\nguide_custom() 。它可用于将任何图形对象（grob）添加到绘图中，例如annotation_custom() 。但有一些区别：它的位置就像图例一样，并添加了标题和页边距。从某种意义上说，本图例是“特殊的”，因为它是唯一不直接反映比例的指南。缺点是它无法从图中读取属性，但优点是它非常灵活。\n\nx &lt;- c(0.5, 1, 1.5, 1.2, 1.5, 1, 0.5, 0.8, 1, 1.15, 2, 1.15, 1, 0.85, 0, 0.85)\ny &lt;- c(1.5, 1.2, 1.5, 1, 0.5, 0.8, 0.5, 1, 2, 1.15, 1, 0.85, 0, 0.85, 1, 1.15)\n\ncompass_rose &lt;- grid::polygonGrob(\n  x = unit(x, \"cm\"), y = unit(y, \"cm\"), id.lengths = c(8, 8),\n  gp = grid::gpar(fill = c(\"grey50\", \"grey25\"), col = NA)\n)\n\nnc &lt;- sf::st_read(system.file(\"shape/nc.shp\", package = \"sf\"), quiet = TRUE)\nggplot(nc) +\n  geom_sf(aes(fill = AREA)) +\n  guides(custom = guide_custom(compass_rose, title = \"compass\"))",
    "crumbs": [
      "主页",
      "可视化教程",
      "图例自定义"
    ]
  },
  {
    "objectID": "2011-viscolor.html",
    "href": "2011-viscolor.html",
    "title": "R语言配色教程",
    "section": "",
    "text": "第98期 R语言教程 科研绘图配色常用R包\n在r语言，ggplot2绘图过程中最重要的一部分就是配色的选择。优秀的配色要充分考虑到颜色的区分度，期刊要求，冷暖特点等\n本期介绍如何调整r语言中的配色，使整个图片美观优雅",
    "crumbs": [
      "主页",
      "可视化教程",
      "配色方案"
    ]
  },
  {
    "objectID": "2011-viscolor.html#基础工作",
    "href": "2011-viscolor.html#基础工作",
    "title": "R语言配色教程",
    "section": "基础工作",
    "text": "基础工作\n\n加载数据\n\nlibrary(bruceR)\nlibrary(ggplot2)\ndata(iris)\nhead(iris, 10)\n\n   Sepal.Length Sepal.Width Petal.Length Petal.Width Species\n1           5.1         3.5          1.4         0.2  setosa\n2           4.9         3.0          1.4         0.2  setosa\n3           4.7         3.2          1.3         0.2  setosa\n4           4.6         3.1          1.5         0.2  setosa\n5           5.0         3.6          1.4         0.2  setosa\n6           5.4         3.9          1.7         0.4  setosa\n7           4.6         3.4          1.4         0.3  setosa\n8           5.0         3.4          1.5         0.2  setosa\n9           4.4         2.9          1.4         0.2  setosa\n10          4.9         3.1          1.5         0.1  setosa\n\n\n\n\n使用r默认配色方案\n\nggplot(iris, aes(x = Species, y = Sepal.Length, fill = Species)) +\n  geom_bar(stat = \"identity\") +\n  labs(title = \"Sepal Length by Species\", x = \"Species\", y = \"Sepal Length\") +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\n\nggplot2手动调色\n\nggplot(iris, aes(x = Species, y = Sepal.Length, fill = Species)) +\n  geom_bar(stat = \"identity\") +\n  labs(title = \"Sepal Length by Species\", x = \"Species\", y = \"Sepal Length\") +\n  theme_minimal()+\n  scale_fill_manual(values = c(\"black\", \"grey\", \"brown\"))",
    "crumbs": [
      "主页",
      "可视化教程",
      "配色方案"
    ]
  },
  {
    "objectID": "2011-viscolor.html#使用rcolorbrewer包设置颜色",
    "href": "2011-viscolor.html#使用rcolorbrewer包设置颜色",
    "title": "R语言配色教程",
    "section": "使用RColorBrewer包设置颜色",
    "text": "使用RColorBrewer包设置颜色\n\nRcolorbrew介绍\nCRAN库:CRAN: Package RColorBrewer (r-project.org)\n调用网站https://colorbrewer2.org/上的配色方案,使用人数众多,整体比较中规中矩\n\nlibrary(RColorBrewer)\n\n\n\n查看配色盘，选择3颜色，区分色\n\n先display配色,查看目标色数和色型\n选择合适的调色盘,在ggplot中使用 scale_*_brewer调用\n\n\ndisplay.brewer.all(3, type = 'div')\n\n\n\n\n\n\n\n\n\n\nggplot2建立柱状图可视化\n\nggplot(iris, aes(x = Species, y = Sepal.Length, fill = Species)) +\n  geom_bar(stat = \"identity\") +\n  labs(title = \"Sepal Length by Species\", x = \"Species\", y = \"Sepal Length\") +\n  theme_minimal()+\n  scale_fill_brewer(palette = \"Spectral\")",
    "crumbs": [
      "主页",
      "可视化教程",
      "配色方案"
    ]
  },
  {
    "objectID": "2011-viscolor.html#使用ggsci包设置颜色",
    "href": "2011-viscolor.html#使用ggsci包设置颜色",
    "title": "R语言配色教程",
    "section": "使用ggsci包设置颜色",
    "text": "使用ggsci包设置颜色\n\nR包介绍\nggsci包含期刊或软件的经典配色,投稿时调用快,效果好,顺手就用上了我用该包配色最多\nCRAN库:CRAN: Package ggsci (r-project.org)\n教程:Scientific Journal and Sci-Fi Themed Color Palettes for ggplot2 (r-project.org)\n\nlibrary(ggsci)\n\n\n\n配色方案\n\n\n\n\n\n\n\n\n\nName\nScales\nPalette Types\nPalette Generator\n\n\n\n\nNPG\nscale_color_npg() scale_fill_npg()\n\"nrc\"\npal_npg()\n\n\nAAAS\nscale_color_aaas() scale_fill_aaas()\n\"default\"\npal_aaas()\n\n\nNEJM\nscale_color_nejm() scale_fill_nejm()\n\"default\"\npal_nejm()\n\n\nLancet\nscale_color_lancet() scale_fill_lancet()\n\"lanonc\"\npal_lancet()\n\n\nJAMA\nscale_color_jama() scale_fill_jama()\n\"default\"\npal_jama()\n\n\nBMJ\nscale_color_bmj() scale_fill_bmj()\n\"default\"\npal_bmj()\n\n\nJCO\nscale_color_jco() scale_fill_jco()\n\"default\"\npal_jco()\n\n\nUCSCGB\nscale_color_ucscgb() scale_fill_ucscgb()\n\"default\"\npal_ucscgb()\n\n\nD3\nscale_color_d3()``scale_fill_d3()\n\"category10\" \"category20\" \"category20b\" \"category20c\"\npal_d3()\n\n\nObservable\nscale_color_observable() scale_fill_observable()\n\"observable10\"\npal_observable()\n\n\nLocusZoom\nscale_color_locuszoom() scale_fill_locuszoom()\n\"default\"\npal_locuszoom()\n\n\nIGV\nscale_color_igv() scale_fill_igv()\n\"default\"``\"alternating\"\npal_igv()\n\n\nCOSMIC\nscale_color_cosmic() scale_fill_cosmic()\n\"hallmarks_light\"``\"hallmarks_dark\"``\"signature_substitutions\"\npal_cosmic()\n\n\nUChicago\nscale_color_uchicago() scale_fill_uchicago()\n\"default\"``\"light\"``\"dark\"\npal_uchicago()\n\n\nStar Trek\nscale_color_startrek() scale_fill_startrek()\n\"uniform\"\npal_startrek()\n\n\nTron Legacy\nscale_color_tron() scale_fill_tron()\n\"legacy\"\npal_tron()\n\n\nFuturama\nscale_color_futurama() scale_fill_futurama()\n\"planetexpress\"\npal_futurama()\n\n\nRick and Morty\nscale_color_rickandmorty() scale_fill_rickandmorty()\n\"schwifty\"\npal_rickandmorty()\n\n\nThe Simpsons\nscale_color_simpsons() scale_fill_simpsons()\n\"springfield\"\npal_simpsons()\n\n\nFlat UI\nscale_color_flatui() scale_fill_flatui()\n\"default\" \"flattastic\" \"aussie\"\npal_flatui()\n\n\nFrontiers\nscale_color_frontiers() scale_fill_frontiers()\n\"default\"\npal_frontiers()\n\n\nGSEA\nscale_color_gsea() scale_fill_gsea()\n\"default\"\npal_gsea()\n\n\nBootstrap 5\nscale_color_bs5() scale_fill_bs5()\n\"blue\" \"indigo\"``\"purple\" \"pink\"``\"red\" \"orange\"``\"yellow\" \"green\"``\"teal\" \"cyan\"``\"gray\"\npal_bs5()\n\n\nMaterial Design\nscale_color_material() scale_fill_material()\n\"red\" \"pink\"``\"purple\" \"deep-purple\"``\"indigo\" \"blue\"``\"light-blue\" \"cyan\"``\"teal\" \"green\"``\"light-green\" \"lime\"``\"yellow\" \"amber\"``\"orange\" \"deep-orange\"``\"brown\" \"grey\"``\"blue-grey\"\npal_material()\n\n\nTailwind CSS\nscale_color_tw3() scale_fill_tw3()\n\"slate\" \"gray\"``\"zinc\" \"neutral\"``\"stone\" \"red\"``\"orange\" \"amber\"``\"yellow\" \"lime\"``\"green\" \"emerald\"``\"teal\" \"cyan\"``\"sky\" \"blue\"``\"indigo\" \"violet\"``\"purple\" \"fuchsia\"``\"pink\" \"rose\"\npal_tw3()\n\n\n\n\n\n\n柳叶刀配色\n\nggplot(iris, aes(x = Species, y = Sepal.Length, fill = Species)) +\n  geom_bar(stat = \"identity\") +\n  labs(title = \"Sepal Length by Species\", x = \"Species\", y = \"Sepal Length\") +\n  theme_minimal()+\n  scale_fill_lancet()",
    "crumbs": [
      "主页",
      "可视化教程",
      "配色方案"
    ]
  },
  {
    "objectID": "2011-viscolor.html#其它实用r包",
    "href": "2011-viscolor.html#其它实用r包",
    "title": "R语言配色教程",
    "section": "其它实用r包",
    "text": "其它实用r包\n\nviridis: Colorblind-Friendly Color Maps for R\n\n介绍\n官方仓库:CRAN: Package viridis (r-project.org)\n教程:Introduction to the viridis color maps (r-project.org)\n多用于连续渐变色\n\n\n使用效果\n色盘\n\n使用方案参考\n\n\n\n\n使用MetBrewer包设置颜色\n\nr包介绍\n官方CRAN库:CRAN: Package MetBrewer (r-project.org)\n配色方案参考纽约大都会艺术博物馆,艺术感爆表一起来看看\n\nlibrary(MetBrewer)\n\n\n\n查看配色盘，选择3颜色，区分色\n\nggplot(iris, aes(x = Species, y = Sepal.Length, fill = Species)) +\n  geom_bar(stat = \"identity\") +\n  labs(title = \"Sepal Length by Species\", x = \"Species\", y = \"Sepal Length\") +\n  theme_minimal()+\n  scale_fill_manual(values = met.brewer(\"Austria\"))\n\n\n\n\n\n\n\n\n\nggplot(iris, aes(x = Species, y = Sepal.Length, fill = Species)) +\n  geom_bar(stat = \"identity\") +\n  labs(title = \"Sepal Length by Species\", x = \"Species\", y = \"Sepal Length\") +\n  theme_minimal()+\n  scale_fill_manual(values = met.brewer(\"Degas\"))\n\n\n\n\n\n\n\n\n最后看看好看",
    "crumbs": [
      "主页",
      "可视化教程",
      "配色方案"
    ]
  },
  {
    "objectID": "1017-timeseries.html",
    "href": "1017-timeseries.html",
    "title": "时间序列分析",
    "section": "",
    "text": "时间序列分析是研究按时间顺序排列的数据规律的方法，广泛应用于经济预测、气象分析、销售预估等领域。",
    "crumbs": [
      "主页",
      "R 语言方法",
      "时间序列分析"
    ]
  },
  {
    "objectID": "1017-timeseries.html#基础概念",
    "href": "1017-timeseries.html#基础概念",
    "title": "时间序列分析",
    "section": "基础概念",
    "text": "基础概念\n\nlibrary(forecast)   # 时间序列预测核心包\nlibrary(ggplot2)\nlibrary(patchwork)\n\n# 使用经典航空乘客数据\ndata &lt;- AirPassengers  # 1949-1960年月度乘客数（千人）\ndata\n\n     Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec\n1949 112 118 132 129 121 135 148 148 136 119 104 118\n1950 115 126 141 135 125 149 170 170 158 133 114 140\n1951 145 150 178 163 172 178 199 199 184 162 146 166\n1952 171 180 193 181 183 218 230 242 209 191 172 194\n1953 196 196 236 235 229 243 264 272 237 211 180 201\n1954 204 188 235 227 234 264 302 293 259 229 203 229\n1955 242 233 267 269 270 315 364 347 312 274 237 278\n1956 284 277 317 313 318 374 413 405 355 306 271 306\n1957 315 301 356 348 355 422 465 467 404 347 305 336\n1958 340 318 362 348 363 435 491 505 404 359 310 337\n1959 360 342 406 396 420 472 548 559 463 407 362 405\n1960 417 391 419 461 472 535 622 606 508 461 390 432\n\n\n时间序列的三个核心成分：\n\n趋势 (Trend)：长期上升或下降的模式\n季节性 (Seasonality)：固定周期的重复波动\n残差 (Residual)：去除趋势和季节性后的随机成分",
    "crumbs": [
      "主页",
      "R 语言方法",
      "时间序列分析"
    ]
  },
  {
    "objectID": "1017-timeseries.html#时序分解",
    "href": "1017-timeseries.html#时序分解",
    "title": "时间序列分析",
    "section": "时序分解",
    "text": "时序分解\n将时间序列分解为趋势、季节和残差三部分：\n\n# STL分解：更灵活的现代方法\nstl(data, s.window = \"periodic\") |&gt; \n  autoplot() + \n  theme_minimal() +\n  labs(title = \"航空乘客数据的STL分解\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nTip\n\n\n\n分解类型选择：\n\n加法模型：\\(Y = T + S + R\\)（波动幅度稳定）\n乘法模型：\\(Y = T \\times S \\times R\\)（波动随趋势增大，如本例）",
    "crumbs": [
      "主页",
      "R 语言方法",
      "时间序列分析"
    ]
  },
  {
    "objectID": "1017-timeseries.html#平稳性检验",
    "href": "1017-timeseries.html#平稳性检验",
    "title": "时间序列分析",
    "section": "平稳性检验",
    "text": "平稳性检验\nARIMA模型要求序列平稳。使用ADF检验判断：\n\nlibrary(tseries)\n\n# 原始序列：非平稳\nadf.test(data)  # p &gt; 0.05 → 非平稳\n\n\n    Augmented Dickey-Fuller Test\n\ndata:  data\nDickey-Fuller = -7.3186, Lag order = 5, p-value = 0.01\nalternative hypothesis: stationary\n\n# 一阶差分后：平稳\nadf.test(diff(data))  # p &lt; 0.05 → 平稳\n\n\n    Augmented Dickey-Fuller Test\n\ndata:  diff(data)\nDickey-Fuller = -7.0177, Lag order = 5, p-value = 0.01\nalternative hypothesis: stationary\n\n\n差分可消除趋势，使序列平稳：\n\n# 对比原始与差分后的序列\np1 &lt;- autoplot(data) + labs(title = \"原始序列\", y = \"乘客数\")\np2 &lt;- autoplot(diff(data)) + labs(title = \"一阶差分后\", y = \"差分值\")\np1 / p2 & theme_minimal()",
    "crumbs": [
      "主页",
      "R 语言方法",
      "时间序列分析"
    ]
  },
  {
    "objectID": "1017-timeseries.html#arima模型",
    "href": "1017-timeseries.html#arima模型",
    "title": "时间序列分析",
    "section": "ARIMA模型",
    "text": "ARIMA模型\nARIMA(p,d,q) 是最常用的时间序列模型：\n\np：自回归阶数（AR）\nd：差分次数\nq：移动平均阶数（MA）\n\n\n# 自动选择最优参数（基于AIC准则）\nfit &lt;- auto.arima(data)\nfit\n\nSeries: data \nARIMA(2,1,1)(0,1,0)[12] \n\nCoefficients:\n         ar1     ar2      ma1\n      0.5960  0.2143  -0.9819\ns.e.  0.0888  0.0880   0.0292\n\nsigma^2 = 132.3:  log likelihood = -504.92\nAIC=1017.85   AICc=1018.17   BIC=1029.35\n\n\n\n模型诊断\n检查残差是否为白噪声：\n\ncheckresiduals(fit)  # 残差应无自相关、近似正态\n\n\n\n\n\n\n\n\n\n    Ljung-Box test\n\ndata:  Residuals from ARIMA(2,1,1)(0,1,0)[12]\nQ* = 37.784, df = 21, p-value = 0.01366\n\nModel df: 3.   Total lags used: 24",
    "crumbs": [
      "主页",
      "R 语言方法",
      "时间序列分析"
    ]
  },
  {
    "objectID": "1017-timeseries.html#预测",
    "href": "1017-timeseries.html#预测",
    "title": "时间序列分析",
    "section": "预测",
    "text": "预测\n使用拟合模型进行未来预测：\n\n# 预测未来2年（24个月）\nfc &lt;- forecast(fit, h = 24)\n\n# 可视化：蓝色区域为置信区间\nautoplot(fc) +\n  theme_minimal() +\n  labs(title = \"航空乘客数预测\", \n       subtitle = \"ARIMA模型 + 80%/95%置信区间\",\n       x = \"年份\", y = \"乘客数（千人）\")",
    "crumbs": [
      "主页",
      "R 语言方法",
      "时间序列分析"
    ]
  },
  {
    "objectID": "1017-timeseries.html#季节性arima",
    "href": "1017-timeseries.html#季节性arima",
    "title": "时间序列分析",
    "section": "季节性ARIMA",
    "text": "季节性ARIMA\n对于有明显季节模式的数据，使用SARIMA：\n\n# 强制使用季节性模型\nfit_seasonal &lt;- auto.arima(data, seasonal = TRUE, D = 1)\nfit_seasonal\n\nSeries: data \nARIMA(2,1,1)(0,1,0)[12] \n\nCoefficients:\n         ar1     ar2      ma1\n      0.5960  0.2143  -0.9819\ns.e.  0.0888  0.0880   0.0292\n\nsigma^2 = 132.3:  log likelihood = -504.92\nAIC=1017.85   AICc=1018.17   BIC=1029.35\n\n# 预测并对比\nforecast(fit_seasonal, h = 24) |&gt; \n  autoplot() +\n  theme_minimal() +\n  labs(title = \"季节性ARIMA预测\")",
    "crumbs": [
      "主页",
      "R 语言方法",
      "时间序列分析"
    ]
  },
  {
    "objectID": "1017-timeseries.html#指数平滑法",
    "href": "1017-timeseries.html#指数平滑法",
    "title": "时间序列分析",
    "section": "指数平滑法",
    "text": "指数平滑法\n另一类常用方法，适合短期预测：\n\n# ETS自动选择最优平滑参数\nets_fit &lt;- ets(data)\nets_fit  # M,A,M = 乘法误差、加法趋势、乘法季节\n\nETS(M,Ad,M) \n\nCall:\nets(y = data)\n\n  Smoothing parameters:\n    alpha = 0.7096 \n    beta  = 0.0204 \n    gamma = 1e-04 \n    phi   = 0.98 \n\n  Initial states:\n    l = 120.9939 \n    b = 1.7705 \n    s = 0.8944 0.7993 0.9217 1.0592 1.2203 1.2318\n           1.1105 0.9786 0.9804 1.011 0.8869 0.9059\n\n  sigma:  0.0392\n\n     AIC     AICc      BIC \n1395.166 1400.638 1448.623 \n\n# 预测\nforecast(ets_fit, h = 24) |&gt; \n  autoplot() +\n  theme_minimal() +\n  labs(title = \"指数平滑预测 (ETS)\")",
    "crumbs": [
      "主页",
      "R 语言方法",
      "时间序列分析"
    ]
  },
  {
    "objectID": "1017-timeseries.html#模型对比",
    "href": "1017-timeseries.html#模型对比",
    "title": "时间序列分析",
    "section": "模型对比",
    "text": "模型对比\n使用交叉验证比较预测准确性：\n\n# 取最后2年作为测试集\ntrain &lt;- window(data, end = c(1958, 12))\ntest &lt;- window(data, start = c(1959, 1))\n\n# 训练两个模型\nm1 &lt;- auto.arima(train)\nm2 &lt;- ets(train)\n\n# 预测并计算误差\nfc1 &lt;- forecast(m1, h = 24)\nfc2 &lt;- forecast(m2, h = 24)\n\n# 准确率指标\naccuracy(fc1, test)[2, c(\"RMSE\", \"MAE\", \"MAPE\")]\n\n    RMSE      MAE     MAPE \n74.25224 68.57729 14.92756 \n\naccuracy(fc2, test)[2, c(\"RMSE\", \"MAE\", \"MAPE\")]\n\n    RMSE      MAE     MAPE \n72.54791 63.21297 13.30345 \n\n\n\n\n\n\n\n\nNote\n\n\n\n常用评估指标：\n\nRMSE：均方根误差（对大误差敏感）\nMAE：平均绝对误差\nMAPE：平均绝对百分比误差（可解释性好）",
    "crumbs": [
      "主页",
      "R 语言方法",
      "时间序列分析"
    ]
  },
  {
    "objectID": "1017-timeseries.html#实战预测月度销售",
    "href": "1017-timeseries.html#实战预测月度销售",
    "title": "时间序列分析",
    "section": "实战：预测月度销售",
    "text": "实战：预测月度销售\n\n# 模拟零售数据\nset.seed(42)\nsales &lt;- ts(\n  100 + 1:60 * 2 +                    # 上升趋势\n  30 * sin(2 * pi * 1:60 / 12) +      # 季节性\n  rnorm(60, sd = 10),                 # 噪声\n  start = c(2020, 1), frequency = 12\n)\n\n# 一行完成：建模 + 预测 + 可视化\nsales |&gt; \n  auto.arima() |&gt; \n  forecast(h = 12) |&gt; \n  autoplot() +\n  theme_minimal() +\n  labs(title = \"月度销售额预测\", x = \"年份\", y = \"销售额\")",
    "crumbs": [
      "主页",
      "R 语言方法",
      "时间序列分析"
    ]
  },
  {
    "objectID": "1017-timeseries.html#总结",
    "href": "1017-timeseries.html#总结",
    "title": "时间序列分析",
    "section": "总结",
    "text": "总结\n\n\n\n方法\n适用场景\n函数\n\n\n\n\nSTL分解\n理解数据结构\nstl()\n\n\nARIMA\n通用预测\nauto.arima()\n\n\nSARIMA\n强季节性数据\nauto.arima(seasonal=TRUE)\n\n\nETS\n短期预测、平滑\nets()\n\n\n\n\n\n\n\n\n\nTip\n\n\n\n实践建议：\n\n先可视化，理解数据特征\n检验平稳性，必要时差分\n对比多个模型，选择最优\n关注置信区间，预测有不确定性",
    "crumbs": [
      "主页",
      "R 语言方法",
      "时间序列分析"
    ]
  },
  {
    "objectID": "1015-health-economics.html",
    "href": "1015-health-economics.html",
    "title": "R语言卫生经济学分析",
    "section": "",
    "text": "卫生经济学评价（Health Economic Evaluation）是一种系统性比较不同医疗干预措施的成本和健康结果的分析方法，帮助决策者在有限资源下做出最优选择。\n\n\n\n\n\n方法\n英文缩写\n结果指标\n适用场景\n\n\n\n\n成本效果分析\nCEA\n自然单位（如生命年）\n单一疾病比较\n\n\n成本效用分析\nCUA\n质量调整生命年（QALY）\n跨疾病比较\n\n\n成本效益分析\nCBA\n货币单位\n健康与非健康项目比较\n\n\n成本最小化分析\nCMA\n无（假设效果相同）\n效果相同的干预比较\n\n\n\n\n\n\n\nICER（增量成本效果比）：每多获得一个健康单位所需的额外成本\nQALY（质量调整生命年）：综合考虑生存时间和生活质量\nWTP（支付意愿）：社会愿意为一个 QALY 支付的最高金额\n贴现率：将未来成本/效果折算为现值的比率（通常 3-5%）",
    "crumbs": [
      "主页",
      "R 语言方法",
      "卫生经济学分析"
    ]
  },
  {
    "objectID": "1015-health-economics.html#什么是卫生经济学评价",
    "href": "1015-health-economics.html#什么是卫生经济学评价",
    "title": "R语言卫生经济学分析",
    "section": "",
    "text": "卫生经济学评价（Health Economic Evaluation）是一种系统性比较不同医疗干预措施的成本和健康结果的分析方法，帮助决策者在有限资源下做出最优选择。\n\n\n\n\n\n方法\n英文缩写\n结果指标\n适用场景\n\n\n\n\n成本效果分析\nCEA\n自然单位（如生命年）\n单一疾病比较\n\n\n成本效用分析\nCUA\n质量调整生命年（QALY）\n跨疾病比较\n\n\n成本效益分析\nCBA\n货币单位\n健康与非健康项目比较\n\n\n成本最小化分析\nCMA\n无（假设效果相同）\n效果相同的干预比较\n\n\n\n\n\n\n\nICER（增量成本效果比）：每多获得一个健康单位所需的额外成本\nQALY（质量调整生命年）：综合考虑生存时间和生活质量\nWTP（支付意愿）：社会愿意为一个 QALY 支付的最高金额\n贴现率：将未来成本/效果折算为现值的比率（通常 3-5%）",
    "crumbs": [
      "主页",
      "R 语言方法",
      "卫生经济学分析"
    ]
  },
  {
    "objectID": "1015-health-economics.html#r包介绍",
    "href": "1015-health-economics.html#r包介绍",
    "title": "R语言卫生经济学分析",
    "section": "R包介绍",
    "text": "R包介绍\n卫生经济学分析常用的 R 包：\n\n\n\nR包\n功能\n链接\n\n\n\n\nhesim\n健康状态转换模型、决策分析\nCRAN\n\n\nheemod\n马尔可夫模型构建\nCRAN\n\n\nBCEA\n贝叶斯成本效果分析\nCRAN\n\n\ndampack\n决策分析模型参数化\nCRAN\n\n\nsurvHE\n生存分析外推\nCRAN\n\n\n\n本教程使用基础 R 和 ggplot2 从零实现卫生经济学核心分析，无需安装专业包。",
    "crumbs": [
      "主页",
      "R 语言方法",
      "卫生经济学分析"
    ]
  },
  {
    "objectID": "1015-health-economics.html#r包安装",
    "href": "1015-health-economics.html#r包安装",
    "title": "R语言卫生经济学分析",
    "section": "R包安装",
    "text": "R包安装\n\n# 安装核心包\ninstall.packages(\"ggplot2\")\ninstall.packages(\"dplyr\")\ninstall.packages(\"scales\")\n\n\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(scales)",
    "crumbs": [
      "主页",
      "R 语言方法",
      "卫生经济学分析"
    ]
  },
  {
    "objectID": "1015-health-economics.html#成本效果分析基础",
    "href": "1015-health-economics.html#成本效果分析基础",
    "title": "R语言卫生经济学分析",
    "section": "成本效果分析基础",
    "text": "成本效果分析基础\n\n模拟数据准备\n假设我们比较三种治疗方案：标准治疗、新药 A、新药 B。\n\n# 创建策略数据\nstrategies &lt;- c(\"标准治疗\", \"新药A\", \"新药B\")\n\n# 成本数据（单位：元）\ncosts &lt;- c(50000, 80000, 120000)\n\n# 效果数据（QALY）\nqalys &lt;- c(5.2, 6.8, 7.5)\n\n# 创建数据框\ncea_data &lt;- data.frame(\n  Strategy = strategies,\n  Cost = costs,\n  QALY = qalys\n)\n\ncea_data\n\n  Strategy   Cost QALY\n1 标准治疗  50000  5.2\n2    新药A  80000  6.8\n3    新药B 120000  7.5\n\n\n\n\n成本效果平面图\n成本效果平面图是卫生经济学最基础的可视化，横轴为效果（QALY），纵轴为成本。\n\n# 基础成本效果平面图\nggplot(cea_data, aes(x = QALY, y = Cost, color = Strategy)) +\n  geom_point(size = 5) +\n  geom_text(aes(label = Strategy), vjust = -1, size = 4) +\n  scale_y_continuous(labels = comma_format()) +\n  scale_color_manual(values = c(\"#4f46e5\", \"#10b981\", \"#f59e0b\")) +\n  labs(\n    title = \"成本效果平面图\",\n    x = \"质量调整生命年 (QALY)\",\n    y = \"成本 (元)\",\n    color = \"治疗方案\"\n  ) +\n  theme_bw(base_size = 12) +\n  theme(\n    legend.position = \"bottom\",\n    plot.title = element_text(hjust = 0.5, face = \"bold\")\n  ) +\n  expand_limits(y = c(0, 150000))\n\n\n\n\n\n\n\n\n\n\n计算增量成本效果比 (ICER)\nICER 公式：\\[ICER = \\frac{\\Delta Cost}{\\Delta QALY} = \\frac{Cost_B - Cost_A}{QALY_B - QALY_A}\\]\n\n# 以标准治疗为参照计算 ICER\nreference &lt;- cea_data[1, ]\n\nicer_results &lt;- cea_data |&gt;\n  mutate(\n    Delta_Cost = Cost - reference$Cost,\n    Delta_QALY = QALY - reference$QALY,\n    ICER = ifelse(Delta_QALY &gt; 0, Delta_Cost / Delta_QALY, NA)\n  )\n\nicer_results\n\n  Strategy   Cost QALY Delta_Cost Delta_QALY     ICER\n1 标准治疗  50000  5.2          0        0.0       NA\n2    新药A  80000  6.8      30000        1.6 18750.00\n3    新药B 120000  7.5      70000        2.3 30434.78",
    "crumbs": [
      "主页",
      "R 语言方法",
      "卫生经济学分析"
    ]
  },
  {
    "objectID": "1015-health-economics.html#成本效果可接受曲线-ceac",
    "href": "1015-health-economics.html#成本效果可接受曲线-ceac",
    "title": "R语言卫生经济学分析",
    "section": "成本效果可接受曲线 (CEAC)",
    "text": "成本效果可接受曲线 (CEAC)\n\n概率敏感性分析数据\n模拟 1000 次蒙特卡洛模拟的结果：\n\nset.seed(42)\nn_sim &lt;- 1000\n\n# 模拟成本和效果的不确定性\nsim_data &lt;- data.frame(\n  simulation = rep(1:n_sim, 3),\n  Strategy = rep(c(\"标准治疗\", \"新药A\", \"新药B\"), each = n_sim),\n  Cost = c(\n    rnorm(n_sim, 50000, 5000),\n    rnorm(n_sim, 80000, 10000),\n    rnorm(n_sim, 120000, 15000)\n  ),\n  QALY = c(\n    rnorm(n_sim, 5.2, 0.5),\n    rnorm(n_sim, 6.8, 0.6),\n    rnorm(n_sim, 7.5, 0.7)\n  )\n)\n\nhead(sim_data)\n\n  simulation Strategy     Cost     QALY\n1          1 标准治疗 56854.79 4.857169\n2          2 标准治疗 47176.51 4.803643\n3          3 标准治疗 51815.64 4.996498\n4          4 标准治疗 53164.31 4.625665\n5          5 标准治疗 52021.34 5.757880\n6          6 标准治疗 49469.38 4.760272\n\n\n\n\n增量成本效果散点图\n\n# 计算相对于标准治疗的增量\nref_data &lt;- sim_data |&gt;\n  filter(Strategy == \"标准治疗\") |&gt;\n  select(simulation, ref_Cost = Cost, ref_QALY = QALY)\n\nincremental_data &lt;- sim_data |&gt;\n  filter(Strategy != \"标准治疗\") |&gt;\n  left_join(ref_data, by = \"simulation\") |&gt;\n  mutate(\n    Delta_Cost = Cost - ref_Cost,\n    Delta_QALY = QALY - ref_QALY\n  )\n\n# 绘制增量成本效果散点图\nggplot(incremental_data, aes(x = Delta_QALY, y = Delta_Cost, color = Strategy)) +\n  geom_point(alpha = 0.3, size = 1.5) +\n  geom_hline(yintercept = 0, linetype = \"dashed\", color = \"gray50\") +\n  geom_vline(xintercept = 0, linetype = \"dashed\", color = \"gray50\") +\n  # 添加 WTP 阈值线（假设 50000 元/QALY）\n  geom_abline(intercept = 0, slope = 50000, linetype = \"solid\", color = \"red\", linewidth = 1) +\n  scale_y_continuous(labels = comma_format()) +\n  scale_color_manual(values = c(\"#10b981\", \"#f59e0b\")) +\n  labs(\n    title = \"增量成本效果散点图\",\n    subtitle = \"红线: WTP 阈值 = 50,000 元/QALY\",\n    x = \"增量 QALY (ΔQALYs)\",\n    y = \"增量成本 (Δ成本)\",\n    color = \"治疗方案\"\n  ) +\n  theme_bw(base_size = 12) +\n  theme(\n    legend.position = \"bottom\",\n    plot.title = element_text(hjust = 0.5, face = \"bold\")\n  ) +\n  annotate(\"text\", x = 2.5, y = -20000, label = \"优势象限\\n(更有效且更便宜)\", \n           color = \"darkgreen\", size = 3) +\n  annotate(\"text\", x = -0.5, y = 80000, label = \"劣势象限\\n(更无效且更贵)\", \n           color = \"darkred\", size = 3)\n\n\n\n\n\n\n\n\n\n\n成本效果可接受曲线\nCEAC 展示在不同 WTP 阈值下，每种策略具有成本效果的概率。\n\n# 定义 WTP 范围\nwtp_range &lt;- seq(0, 150000, by = 5000)\n\n# 计算每个 WTP 下各策略的可接受概率\ncalculate_ceac &lt;- function(sim_data, wtp_range) {\n  strategies &lt;- unique(sim_data$Strategy)\n  results &lt;- data.frame()\n  \n  for (wtp in wtp_range) {\n    # 计算每次模拟的净货币收益 (NMB)\n    nmb_data &lt;- sim_data |&gt;\n      mutate(NMB = wtp * QALY - Cost)\n    \n    # 找出每次模拟中 NMB 最高的策略\n    best_strategy &lt;- nmb_data |&gt;\n      group_by(simulation) |&gt;\n      slice_max(NMB, n = 1) |&gt;\n      ungroup()\n    \n    # 计算每种策略的最优概率\n    prob_best &lt;- best_strategy |&gt;\n      count(Strategy) |&gt;\n      mutate(Probability = n / n_sim)\n    \n    # 补充没有出现的策略\n    for (s in strategies) {\n      if (!s %in% prob_best$Strategy) {\n        prob_best &lt;- bind_rows(prob_best, \n                               data.frame(Strategy = s, n = 0, Probability = 0))\n      }\n    }\n    \n    prob_best$WTP &lt;- wtp\n    results &lt;- bind_rows(results, prob_best)\n  }\n  \n  results\n}\n\nceac_data &lt;- calculate_ceac(sim_data, wtp_range)\n\n# 绘制 CEAC\nggplot(ceac_data, aes(x = WTP, y = Probability, color = Strategy)) +\n  geom_line(linewidth = 1.2) +\n  geom_vline(xintercept = 50000, linetype = \"dashed\", color = \"gray50\") +\n  scale_x_continuous(labels = comma_format()) +\n  scale_y_continuous(limits = c(0, 1), labels = percent_format()) +\n  scale_color_manual(values = c(\"#4f46e5\", \"#10b981\", \"#f59e0b\")) +\n  labs(\n    title = \"成本效果可接受曲线 (CEAC)\",\n    x = \"支付意愿 (WTP, 元/QALY)\",\n    y = \"成本效果的概率\",\n    color = \"治疗方案\"\n  ) +\n  theme_bw(base_size = 12) +\n  theme(\n    legend.position = \"bottom\",\n    plot.title = element_text(hjust = 0.5, face = \"bold\")\n  ) +\n  annotate(\"text\", x = 55000, y = 0.95, label = \"WTP = 50,000\", \n           hjust = 0, color = \"gray30\", size = 3.5)",
    "crumbs": [
      "主页",
      "R 语言方法",
      "卫生经济学分析"
    ]
  },
  {
    "objectID": "1015-health-economics.html#决策树模型",
    "href": "1015-health-economics.html#决策树模型",
    "title": "R语言卫生经济学分析",
    "section": "决策树模型",
    "text": "决策树模型\n\n简单决策树示例\n模拟一个简单的治疗决策场景：\n\n# 决策树参数\nparams &lt;- list(\n  # 治疗成功率\n  p_success_standard = 0.60,\n  p_success_new = 0.80,\n  \n  # 成本\n  c_standard = 10000,\n  c_new = 25000,\n  c_success = 5000,  # 成功后维护成本\n  c_failure = 50000, # 失败后补救成本\n  \n  # 效用\n  u_success = 0.9,\n  u_failure = 0.5,\n  \n  # 时间范围（年）\n  time_horizon = 5\n)\n\n# 计算期望成本和效果\ncalculate_expected &lt;- function(p_success, c_treatment, params) {\n  # 期望成本\n  expected_cost &lt;- c_treatment + \n    p_success * params$c_success + \n    (1 - p_success) * params$c_failure\n  \n  # 期望 QALY\n  expected_qaly &lt;- params$time_horizon * (\n    p_success * params$u_success + \n    (1 - p_success) * params$u_failure\n  )\n  \n  list(cost = expected_cost, qaly = expected_qaly)\n}\n\n# 标准治疗\nstandard &lt;- calculate_expected(params$p_success_standard, params$c_standard, params)\n\n# 新治疗\nnew_treatment &lt;- calculate_expected(params$p_success_new, params$c_new, params)\n\n# 结果汇总\ndecision_tree_results &lt;- data.frame(\n  Strategy = c(\"标准治疗\", \"新治疗\"),\n  Expected_Cost = c(standard$cost, new_treatment$cost),\n  Expected_QALY = c(standard$qaly, new_treatment$qaly)\n) |&gt;\n  mutate(\n    ICER = c(NA, (Expected_Cost[2] - Expected_Cost[1]) / \n               (Expected_QALY[2] - Expected_QALY[1]))\n  )\n\ndecision_tree_results\n\n  Strategy Expected_Cost Expected_QALY  ICER\n1 标准治疗         33000           3.7    NA\n2   新治疗         39000           4.1 15000\n\n\n\n\n决策树可视化\n\n# 创建决策树数据\ntree_data &lt;- data.frame(\n  x = c(0, 1, 1, 2, 2, 2, 2),\n  y = c(3, 4.5, 1.5, 5.5, 3.5, 2.5, 0.5),\n  label = c(\n    \"决策节点\",\n    \"标准治疗\",\n    \"新治疗\",\n    paste0(\"成功 (\", params$p_success_standard * 100, \"%)\"),\n    paste0(\"失败 (\", (1 - params$p_success_standard) * 100, \"%)\"),\n    paste0(\"成功 (\", params$p_success_new * 100, \"%)\"),\n    paste0(\"失败 (\", (1 - params$p_success_new) * 100, \"%)\")\n  ),\n  node_type = c(\"decision\", \"chance\", \"chance\", \"outcome\", \"outcome\", \"outcome\", \"outcome\")\n)\n\n# 连接线数据\nedges &lt;- data.frame(\n  x = c(0, 0, 1, 1, 1, 1),\n  xend = c(1, 1, 2, 2, 2, 2),\n  y = c(3, 3, 4.5, 4.5, 1.5, 1.5),\n  yend = c(4.5, 1.5, 5.5, 3.5, 2.5, 0.5)\n)\n\nggplot() +\n  # 绘制连接线\n  geom_segment(data = edges, \n               aes(x = x, y = y, xend = xend, yend = yend),\n               color = \"gray50\", linewidth = 0.8) +\n  # 决策节点（方形）\n  geom_point(data = tree_data |&gt; filter(node_type == \"decision\"),\n             aes(x = x, y = y), shape = 15, size = 8, color = \"#4f46e5\") +\n  # 机会节点（圆形）\n  geom_point(data = tree_data |&gt; filter(node_type == \"chance\"),\n             aes(x = x, y = y), shape = 16, size = 6, color = \"#10b981\") +\n  # 结果节点（三角形）\n  geom_point(data = tree_data |&gt; filter(node_type == \"outcome\"),\n             aes(x = x, y = y), shape = 17, size = 5, color = \"#f59e0b\") +\n  # 标签\n  geom_text(data = tree_data,\n            aes(x = x, y = y, label = label),\n            hjust = -0.1, vjust = 0.5, size = 3.5) +\n  # 添加结果数值\n  annotate(\"text\", x = 2.8, y = 5.5, \n           label = paste0(\"成本: \", comma(params$c_standard + params$c_success), \n                          \"\\nQALY: \", params$time_horizon * params$u_success),\n           hjust = 0, size = 3, color = \"gray30\") +\n  annotate(\"text\", x = 2.8, y = 3.5,\n           label = paste0(\"成本: \", comma(params$c_standard + params$c_failure),\n                          \"\\nQALY: \", params$time_horizon * params$u_failure),\n           hjust = 0, size = 3, color = \"gray30\") +\n  annotate(\"text\", x = 2.8, y = 2.5,\n           label = paste0(\"成本: \", comma(params$c_new + params$c_success),\n                          \"\\nQALY: \", params$time_horizon * params$u_success),\n           hjust = 0, size = 3, color = \"gray30\") +\n  annotate(\"text\", x = 2.8, y = 0.5,\n           label = paste0(\"成本: \", comma(params$c_new + params$c_failure),\n                          \"\\nQALY: \", params$time_horizon * params$u_failure),\n           hjust = 0, size = 3, color = \"gray30\") +\n  labs(title = \"治疗决策树模型\") +\n  theme_void() +\n  theme(plot.title = element_text(hjust = 0.5, face = \"bold\", size = 14)) +\n  xlim(-0.5, 4) +\n  ylim(-0.5, 6.5)",
    "crumbs": [
      "主页",
      "R 语言方法",
      "卫生经济学分析"
    ]
  },
  {
    "objectID": "1015-health-economics.html#马尔可夫模型",
    "href": "1015-health-economics.html#马尔可夫模型",
    "title": "R语言卫生经济学分析",
    "section": "马尔可夫模型",
    "text": "马尔可夫模型\n\n模型概述\n马尔可夫模型是卫生经济学中最常用的建模方法，用于模拟疾病进展和干预效果。\n\n# 定义模型参数\nmarkov_params &lt;- list(\n  # 状态名称\n  states = c(\"健康\", \"疾病\", \"死亡\"),\n  n_states = 3,\n  \n  # 周期数（年）\n  n_cycles = 20,\n  \n  # 转移概率（标准治疗）\n  p_healthy_disease_std = 0.10,\n  p_disease_death_std = 0.15,\n  \n  # 转移概率（新治疗）\n  p_healthy_disease_new = 0.05,\n  p_disease_death_new = 0.10,\n  \n  # 成本（每周期）\n  c_healthy = 1000,\n  c_disease = 8000,\n  c_death = 0,\n  c_new_treatment = 5000,  # 新治疗额外成本\n  \n  # 效用\n  u_healthy = 1.0,\n  u_disease = 0.6,\n  u_death = 0,\n  \n  # 贴现率\n  discount_rate = 0.03\n)\n\n\n\n构建转移概率矩阵\n\n# 标准治疗转移矩阵\ntrans_matrix_std &lt;- matrix(c(\n  0.89, 0.10, 0.01,  # 从健康状态\n  0.00, 0.84, 0.16,  # 从疾病状态（含背景死亡）\n  0.00, 0.00, 1.00   # 从死亡状态\n), nrow = 3, byrow = TRUE)\n\nrownames(trans_matrix_std) &lt;- colnames(trans_matrix_std) &lt;- markov_params$states\n\n# 新治疗转移矩阵\ntrans_matrix_new &lt;- matrix(c(\n  0.94, 0.05, 0.01,  # 从健康状态\n  0.00, 0.89, 0.11,  # 从疾病状态\n  0.00, 0.00, 1.00   # 从死亡状态\n), nrow = 3, byrow = TRUE)\n\nrownames(trans_matrix_new) &lt;- colnames(trans_matrix_new) &lt;- markov_params$states\n\ntrans_matrix_std\n\n     健康 疾病 死亡\n健康 0.89 0.10 0.01\n疾病 0.00 0.84 0.16\n死亡 0.00 0.00 1.00\n\n\n\n\n运行马尔可夫模拟\n\n# 马尔可夫模拟函数\nrun_markov &lt;- function(trans_matrix, params, treatment_cost = 0) {\n  n_cycles &lt;- params$n_cycles\n  states &lt;- params$states\n  \n  # 初始状态分布（100% 健康）\n  state_dist &lt;- matrix(0, nrow = n_cycles + 1, ncol = 3)\n  colnames(state_dist) &lt;- states\n  state_dist[1, ] &lt;- c(1, 0, 0)\n  \n  # 成本和效用向量\n  costs &lt;- c(params$c_healthy, params$c_disease, params$c_death)\n  utilities &lt;- c(params$u_healthy, params$u_disease, params$u_death)\n  \n  # 贴现因子\n  discount_factors &lt;- (1 / (1 + params$discount_rate)) ^ (0:n_cycles)\n  \n  # 模拟各周期\n  for (i in 1:n_cycles) {\n    state_dist[i + 1, ] &lt;- state_dist[i, ] %*% trans_matrix\n  }\n  \n  # 计算成本和 QALY\n  cycle_costs &lt;- state_dist %*% costs + treatment_cost\n  cycle_qalys &lt;- state_dist %*% utilities\n  \n  # 贴现后总计\n  total_cost &lt;- sum(cycle_costs * discount_factors)\n  total_qaly &lt;- sum(cycle_qalys * discount_factors)\n  \n  list(\n    state_dist = state_dist,\n    total_cost = total_cost,\n    total_qaly = total_qaly,\n    cycle_costs = cycle_costs,\n    cycle_qalys = cycle_qalys\n  )\n}\n\n# 运行两种治疗方案\nresults_std &lt;- run_markov(trans_matrix_std, markov_params, treatment_cost = 0)\nresults_new &lt;- run_markov(trans_matrix_new, markov_params, treatment_cost = markov_params$c_new_treatment)\n\n\n\n状态分布可视化\n\n# 整理状态分布数据\nprepare_state_data &lt;- function(results, treatment_name) {\n  data.frame(\n    Cycle = rep(0:markov_params$n_cycles, 3),\n    State = rep(markov_params$states, each = markov_params$n_cycles + 1),\n    Proportion = as.vector(results$state_dist),\n    Treatment = treatment_name\n  )\n}\n\nstate_data &lt;- bind_rows(\n  prepare_state_data(results_std, \"标准治疗\"),\n  prepare_state_data(results_new, \"新治疗\")\n)\n\n# 绘制状态转移图\nggplot(state_data, aes(x = Cycle, y = Proportion, fill = State)) +\n  geom_area(alpha = 0.8) +\n  facet_wrap(~Treatment) +\n  scale_fill_manual(values = c(\"#10b981\", \"#f59e0b\", \"#6b7280\")) +\n  scale_y_continuous(labels = percent_format()) +\n  labs(\n    title = \"马尔可夫模型状态分布\",\n    x = \"周期（年）\",\n    y = \"人群比例\",\n    fill = \"健康状态\"\n  ) +\n  theme_bw(base_size = 12) +\n  theme(\n    legend.position = \"bottom\",\n    plot.title = element_text(hjust = 0.5, face = \"bold\"),\n    strip.background = element_rect(fill = \"#4f46e5\"),\n    strip.text = element_text(color = \"white\", face = \"bold\")\n  )\n\n\n\n\n\n\n\n\n\n\n马尔可夫模型结果汇总\n\n# 汇总结果\nmarkov_summary &lt;- data.frame(\n  Strategy = c(\"标准治疗\", \"新治疗\"),\n  Total_Cost = c(results_std$total_cost, results_new$total_cost),\n  Total_QALY = c(results_std$total_qaly, results_new$total_qaly)\n) |&gt;\n  mutate(\n    Delta_Cost = Total_Cost - Total_Cost[1],\n    Delta_QALY = Total_QALY - Total_QALY[1],\n    ICER = ifelse(Delta_QALY &gt; 0, Delta_Cost / Delta_QALY, NA)\n  )\n\nmarkov_summary\n\n  Strategy Total_Cost Total_QALY Delta_Cost Delta_QALY     ICER\n1 标准治疗   33714.77   9.017402       0.00   0.000000       NA\n2   新治疗  111169.34  11.417944   77454.57   2.400542 32265.45",
    "crumbs": [
      "主页",
      "R 语言方法",
      "卫生经济学分析"
    ]
  },
  {
    "objectID": "1015-health-economics.html#单因素敏感性分析",
    "href": "1015-health-economics.html#单因素敏感性分析",
    "title": "R语言卫生经济学分析",
    "section": "单因素敏感性分析",
    "text": "单因素敏感性分析\n\n龙卷风图\n龙卷风图展示各参数对结果的影响程度。\n\n# 定义参数范围\nsensitivity_params &lt;- data.frame(\n  Parameter = c(\n    \"疾病转移概率 (标准)\",\n    \"死亡转移概率 (标准)\",\n    \"疾病转移概率 (新)\",\n    \"死亡转移概率 (新)\",\n    \"疾病状态成本\",\n    \"新治疗成本\",\n    \"贴现率\"\n  ),\n  Base = c(0.10, 0.15, 0.05, 0.10, 8000, 5000, 0.03),\n  Low = c(0.05, 0.10, 0.03, 0.05, 5000, 3000, 0.00),\n  High = c(0.15, 0.20, 0.08, 0.15, 12000, 8000, 0.05)\n)\n\n# 模拟敏感性分析结果（简化演示）\nset.seed(123)\ntornado_data &lt;- sensitivity_params |&gt;\n  mutate(\n    ICER_low = runif(n(), 15000, 35000),\n    ICER_high = runif(n(), 35000, 55000),\n    ICER_base = 32000\n  ) |&gt;\n  arrange(desc(abs(ICER_high - ICER_low)))\n\n# 绘制龙卷风图\nggplot(tornado_data) +\n  geom_segment(aes(y = reorder(Parameter, abs(ICER_high - ICER_low)),\n                   yend = reorder(Parameter, abs(ICER_high - ICER_low)),\n                   x = ICER_low, xend = ICER_high),\n               linewidth = 8, color = \"#4f46e5\", alpha = 0.7) +\n  geom_vline(xintercept = tornado_data$ICER_base[1], \n             linetype = \"dashed\", color = \"red\", linewidth = 1) +\n  scale_x_continuous(labels = comma_format()) +\n  labs(\n    title = \"龙卷风图 - 单因素敏感性分析\",\n    subtitle = \"红色虚线: 基准 ICER\",\n    x = \"ICER (元/QALY)\",\n    y = \"参数\"\n  ) +\n  theme_bw(base_size = 12) +\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\"),\n    panel.grid.major.y = element_blank()\n  )",
    "crumbs": [
      "主页",
      "R 语言方法",
      "卫生经济学分析"
    ]
  },
  {
    "objectID": "1015-health-economics.html#成本效果前沿",
    "href": "1015-health-economics.html#成本效果前沿",
    "title": "R语言卫生经济学分析",
    "section": "成本效果前沿",
    "text": "成本效果前沿\n\n效率前沿线\n效率前沿展示在给定成本下可达到的最大效果。\n\n# 创建多策略数据\nfrontier_data &lt;- data.frame(\n  Strategy = c(\"无干预\", \"方案A\", \"方案B\", \"方案C\", \"方案D\", \"方案E\"),\n  Cost = c(10000, 30000, 45000, 60000, 90000, 100000),\n  QALY = c(4.0, 5.5, 6.2, 6.8, 7.8, 7.9)\n)\n\n# 识别效率前沿上的策略（简化算法）\nfrontier_data &lt;- frontier_data |&gt;\n  arrange(Cost) |&gt;\n  mutate(\n    on_frontier = c(TRUE, TRUE, TRUE, FALSE, TRUE, FALSE)  # 手动标记\n  )\n\nggplot(frontier_data, aes(x = QALY, y = Cost)) +\n  # 绘制效率前沿线\n  geom_line(data = frontier_data |&gt; filter(on_frontier),\n            color = \"#4f46e5\", linewidth = 1.2) +\n  # 所有点\n  geom_point(aes(color = on_frontier), size = 5) +\n  # 标签\n  geom_text(aes(label = Strategy), vjust = -1, size = 3.5) +\n  scale_color_manual(values = c(\"TRUE\" = \"#10b981\", \"FALSE\" = \"#ef4444\"),\n                     labels = c(\"TRUE\" = \"效率前沿\", \"FALSE\" = \"被支配\")) +\n  scale_y_continuous(labels = comma_format()) +\n  labs(\n    title = \"成本效果效率前沿\",\n    x = \"质量调整生命年 (QALY)\",\n    y = \"成本 (元)\",\n    color = \"策略状态\"\n  ) +\n  theme_bw(base_size = 12) +\n  theme(\n    legend.position = \"bottom\",\n    plot.title = element_text(hjust = 0.5, face = \"bold\")\n  )",
    "crumbs": [
      "主页",
      "R 语言方法",
      "卫生经济学分析"
    ]
  },
  {
    "objectID": "1015-health-economics.html#净货币收益分析",
    "href": "1015-health-economics.html#净货币收益分析",
    "title": "R语言卫生经济学分析",
    "section": "净货币收益分析",
    "text": "净货币收益分析\n\nNMB 计算与可视化\n净货币收益（Net Monetary Benefit）：\\[NMB = WTP \\times \\Delta QALY - \\Delta Cost\\]\n\n# 计算不同 WTP 下的 NMB\nwtp_values &lt;- seq(0, 100000, by = 10000)\n\nnmb_data &lt;- expand.grid(\n  WTP = wtp_values,\n  Strategy = c(\"标准治疗\", \"新药A\", \"新药B\")\n) |&gt;\n  left_join(cea_data, by = \"Strategy\") |&gt;\n  mutate(\n    NMB = WTP * QALY - Cost\n  )\n\nggplot(nmb_data, aes(x = WTP, y = NMB, color = Strategy)) +\n  geom_line(linewidth = 1.2) +\n  geom_hline(yintercept = 0, linetype = \"dashed\", color = \"gray50\") +\n  scale_x_continuous(labels = comma_format()) +\n  scale_y_continuous(labels = comma_format()) +\n  scale_color_manual(values = c(\"#4f46e5\", \"#10b981\", \"#f59e0b\")) +\n  labs(\n    title = \"净货币收益 (NMB) 分析\",\n    x = \"支付意愿 (WTP, 元/QALY)\",\n    y = \"净货币收益 (元)\",\n    color = \"治疗方案\"\n  ) +\n  theme_bw(base_size = 12) +\n  theme(\n    legend.position = \"bottom\",\n    plot.title = element_text(hjust = 0.5, face = \"bold\")\n  )",
    "crumbs": [
      "主页",
      "R 语言方法",
      "卫生经济学分析"
    ]
  },
  {
    "objectID": "1015-health-economics.html#实用函数封装",
    "href": "1015-health-economics.html#实用函数封装",
    "title": "R语言卫生经济学分析",
    "section": "实用函数封装",
    "text": "实用函数封装\n\nICER 计算函数\n\n#' 计算 ICER\n#' @param cost_new 新治疗成本\n#' @param cost_ref 参照治疗成本\n#' @param effect_new 新治疗效果\n#' @param effect_ref 参照治疗效果\n#' @return ICER 值\ncalculate_icer &lt;- function(cost_new, cost_ref, effect_new, effect_ref) {\n  delta_cost &lt;- cost_new - cost_ref\n  delta_effect &lt;- effect_new - effect_ref\n  \n  if (delta_effect &lt;= 0) {\n    warning(\"增量效果 &lt;= 0，新治疗可能被支配\")\n    return(NA)\n  }\n  \n  icer &lt;- delta_cost / delta_effect\n  \n  cat(\"增量成本:\", comma(delta_cost), \"元\\n\")\n  cat(\"增量效果:\", round(delta_effect, 3), \"QALY\\n\")\n  cat(\"ICER:\", comma(round(icer, 0)), \"元/QALY\\n\")\n  \n  invisible(icer)\n}\n\n# 示例\ncalculate_icer(\n  cost_new = 80000, cost_ref = 50000,\n  effect_new = 6.8, effect_ref = 5.2\n)\n\n增量成本: 30,000 元\n增量效果: 1.6 QALY\nICER: 18,750 元/QALY",
    "crumbs": [
      "主页",
      "R 语言方法",
      "卫生经济学分析"
    ]
  },
  {
    "objectID": "1015-health-economics.html#总结",
    "href": "1015-health-economics.html#总结",
    "title": "R语言卫生经济学分析",
    "section": "总结",
    "text": "总结\n卫生经济学评价是医疗决策的重要工具，R 语言提供了强大的分析能力：\n\n\n\n分析类型\n关键指标\n推荐方法\n\n\n\n\n成本效果分析\nICER\n增量分析、效率前沿\n\n\n不确定性分析\nCEAC、龙卷风图\n概率敏感性分析\n\n\n疾病建模\n状态分布、生存曲线\n马尔可夫模型、决策树\n\n\n决策支持\nNMB\n净货币收益分析\n\n\n\n\n推荐学习资源\n\nDARTH 工作组 - 决策分析建模教程\nISPOR 指南 - 卫生经济学方法学标准\nR for Health Technology Assessment - R 语言 HTA 资源\n\n\n\n常用 WTP 阈值参考\n\n\n\n国家/地区\nWTP 阈值（每 QALY）\n\n\n\n\n中国\n1-3 倍人均 GDP（约 7-21 万元）\n\n\n英国 (NICE)\n£20,000-30,000\n\n\n美国\n$50,000-150,000\n\n\nWHO 推荐\n1-3 倍人均 GDP",
    "crumbs": [
      "主页",
      "R 语言方法",
      "卫生经济学分析"
    ]
  },
  {
    "objectID": "1013-scitb.html",
    "href": "1013-scitb.html",
    "title": "scitb-快速生成基线表一",
    "section": "",
    "text": "scitb是一个专门用于基线表开发的包，相较于tableone scitb具有更好使用，导出方便，快速设置的优点\nCRAN库\n作者教程",
    "crumbs": [
      "主页",
      "实用 R 包",
      "scitb - 快速基线表"
    ]
  },
  {
    "objectID": "1013-scitb.html#r包介绍",
    "href": "1013-scitb.html#r包介绍",
    "title": "scitb-快速生成基线表一",
    "section": "",
    "text": "scitb是一个专门用于基线表开发的包，相较于tableone scitb具有更好使用，导出方便，快速设置的优点\nCRAN库\n作者教程",
    "crumbs": [
      "主页",
      "实用 R 包",
      "scitb - 快速基线表"
    ]
  },
  {
    "objectID": "1013-scitb.html#r包安装",
    "href": "1013-scitb.html#r包安装",
    "title": "scitb-快速生成基线表一",
    "section": "R包安装",
    "text": "R包安装\n\ninstall.packages(\"scitb\")",
    "crumbs": [
      "主页",
      "实用 R 包",
      "scitb - 快速基线表"
    ]
  },
  {
    "objectID": "1013-scitb.html#r包使用",
    "href": "1013-scitb.html#r包使用",
    "title": "scitb-快速生成基线表一",
    "section": "R包使用",
    "text": "R包使用\n\n导入示例数据\n导入数据prematurity，：low 是否是小于2500g早产低体重儿，age 母亲的年龄，lwt 末次月经体重，race 种族，smoke孕期抽烟，ptl 早产史（计数），ht 有高血压病史，ui 子宫过敏，ftv 早孕时看医生的次数bwt 新生儿体重数值\n\nlibrary(scitb)\nlibrary(bruceR)\n\n\nbruceR (v2025.11)\nBroadly Useful Convenient and Efficient R functions\n\nPackages also loaded:\n✔ dplyr         ✔ data.table\n✔ tidyr         ✔ emmeans\n✔ stringr       ✔ lmerTest\n✔ forcats       ✔ effectsize\n✔ ggplot2       ✔ performance\n✔ cowplot       ✔ interactions\n\nMain functions of `bruceR`:\ncc()            Describe()  TTEST()\nadd()           Freq()      MANOVA()\n.mean()         Corr()      EMMEANS()\nset.wd()        Alpha()     PROCESS()\nimport()        EFA()       model_summary()\nprint_table()   CFA()       lavaan_summary()\n\nFor full functionality, please install all dependencies:\ninstall.packages(\"bruceR\", dep=TRUE)\n\nOnline documentation:\nhttps://psychbruce.github.io/bruceR\n\nTo use this package in publications, please cite:\nBao, H. W. S. (2021). bruceR: Broadly useful convenient and efficient R functions (Version 2025.11) [Computer software]. https://doi.org/10.32614/CRAN.package.bruceR\n\ndata &lt;- prematurity\nhead(data,5)\n\n  id low age lwt  race     smoke ptl ht ui ftv  bwt\n1 85   0  19 182 black nonsmoker   0  0  1   0 2523\n2 86   0  33 155 other nonsmoker   0  0  0   3 2551\n3 87   0  20 105 white    smoker   0  0  0   1 2557\n4 88   0  21 108 white    smoker   0  0  1   2 2594\n5 89   0  18 107 white    smoker   0  0  1   0 2600\n\n\n\n\n生成描述性表1\n\n首先定义变量\n为什么这里要定义变量，而不在基线表函数里直接引入字符向量，这是为了有良好的编程习惯。先从构建函数框架开始，最后函数调用，后续无论是修改变量还是增删变量都会很清晰\n\nallVars&lt;-c(\"low\",\"age\",\"lwt\",\"race\",\"smoke\",\"ptl\",\"ht\",\"ui\",\"ftv\",\"bwt\")\nfvars&lt;-c(\"low\",\"race\",\"smoke\",\"ptl\",\"ht\",\"ui\",\"ftv\")\nstrata&lt;-c(\"bwt\")\n\n\n\n生成基线表\n\ndata_neat &lt;- data |&gt; \n  mutate(\n    race = as.factor(race),\n    smoke = as.factor(smoke)\n  )\n\ntab0&lt;-scitb1(vars=allVars,fvars=fvars,strata=strata,data=data_neat)\n\n      Min 33.33333% 66.66667%       Max \n  709.000  2598.000  3283.667  4990.000 \n\n\nStrata is treated as a continuous variable.\n\ntab0\n\n   Characteristic G.0                      G.1                     \n   \"N\"            \"63\"                     \"63\"                    \nd1 \"age\"          \"22.00 (19.50-25.00)\"    \"23.00 (19.00-28.00)\"   \nd1 \"lwt\"          \"120.00 (105.00-131.00)\" \"120.00 (109.50-132.50)\"\nd1 \"bwt\"          \"2126.24±394.60\"         \"2969.94±190.20\"        \nd2 \"low\"          \" \"                      \" \"                     \n   \"0\"            \" 4 (6.35%)\"             \"63 (100.00%)\"          \n   \"1\"            \"59 (93.65%)\"            \" 0 (0.00%)\"            \nd2 \"race\"         \" \"                      \" \"                     \n   \"black\"        \"12 (19.05%)\"            \" 8 (12.70%)\"           \n   \"other\"        \"26 (41.27%)\"            \"25 (39.68%)\"           \n   \"white\"        \"25 (39.68%)\"            \"30 (47.62%)\"           \nd2 \"smoke\"        \" \"                      \" \"                     \n   \"nonsmoker\"    \"31 (49.21%)\"            \"39 (61.90%)\"           \n   \"smoker\"       \"32 (50.79%)\"            \"24 (38.10%)\"           \nd2 \"ptl\"          \" \"                      \" \"                     \n   \"0\"            \"45 (71.43%)\"            \"58 (92.06%)\"           \n   \"1\"            \"16 (25.40%)\"            \" 4 (6.35%)\"            \n   \"2\"            \" 2 (3.17%)\"             \" 1 (1.59%)\"            \n   \"3\"            \" 0 (0.00%)\"             \" 0 (0.00%)\"            \nd2 \"ht\"           \" \"                      \" \"                     \n   \"0\"            \"56 (88.89%)\"            \"61 (96.83%)\"           \n   \"1\"            \" 7 (11.11%)\"            \" 2 (3.17%)\"            \nd2 \"ui\"           \" \"                      \" \"                     \n   \"0\"            \"47 (74.60%)\"            \"54 (85.71%)\"           \n   \"1\"            \"16 (25.40%)\"            \" 9 (14.29%)\"           \nd2 \"ftv\"          \" \"                      \" \"                     \n   \"0\"            \"37 (58.73%)\"            \"32 (50.79%)\"           \n   \"1\"            \"12 (19.05%)\"            \"15 (23.81%)\"           \n   \"2\"            \" 8 (12.70%)\"            \"13 (20.63%)\"           \n   \"3\"            \" 5 (7.94%)\"             \" 2 (3.17%)\"            \n   \"4\"            \" 1 (1.59%)\"             \" 1 (1.59%)\"            \n   \"6\"            \" 0 (0.00%)\"             \" 0 (0.00%)\"            \n   G.2                      p value \n   \"63\"                     \"\"      \nd1 \"23.00 (19.50-28.00)\"    \"0.483\" \nd1 \"131.00 (120.00-156.00)\" \"&lt;0.001\"\nd1 \"3736.68±317.76\"         \"&lt;0.001\"\nd2 \" \"                      \"&lt;0.001\"\n   \"63 (100.00%)\"           \" \"     \n   \" 0 (0.00%)\"             \" \"     \nd2 \" \"                      \"0.060\" \n   \" 6 (9.52%)\"             \" \"     \n   \"16 (25.40%)\"            \" \"     \n   \"41 (65.08%)\"            \" \"     \nd2 \" \"                      \"0.037\" \n   \"45 (71.43%)\"            \" \"     \n   \"18 (28.57%)\"            \" \"     \nd2 \" \"                      \"0.012\" \n   \"56 (88.89%)\"            \" \"     \n   \" 4 (6.35%)\"             \" \"     \n   \" 2 (3.17%)\"             \" \"     \n   \" 1 (1.59%)\"             \" \"     \nd2 \" \"                      \"0.154\" \n   \"60 (95.24%)\"            \" \"     \n   \" 3 (4.76%)\"             \" \"     \nd2 \" \"                      \"0.005\" \n   \"60 (95.24%)\"            \" \"     \n   \" 3 (4.76%)\"             \" \"     \nd2 \" \"                      \"0.283\" \n   \"31 (49.21%)\"            \" \"     \n   \"20 (31.75%)\"            \" \"     \n   \" 9 (14.29%)\"            \" \"     \n   \" 0 (0.00%)\"             \" \"     \n   \" 2 (3.17%)\"             \" \"     \n   \" 1 (1.59%)\"             \" \"     \n\n\n\n\n设置有非正态资料\n设置非正态后可以看到lwt变量是用百分位数进行描述，后边的pvalue也调用非参检验\n\ntab2 &lt;-scitb1(vars=allVars,fvars=fvars,strata=strata,data=data_neat, nonnormal=c(\"lwt\"))\n\n      Min 33.33333% 66.66667%       Max \n  709.000  2598.000  3283.667  4990.000 \n\n\nStrata is treated as a continuous variable.\n\ntab2\n\n   Characteristic G.0                      G.1                     \n   \"N\"            \"63\"                     \"63\"                    \nd1 \"age\"          \"22.00 (19.50-25.00)\"    \"23.00 (19.00-28.00)\"   \nd1 \"lwt\"          \"120.00 (105.00-131.00)\" \"120.00 (109.50-132.50)\"\nd1 \"bwt\"          \"2126.24±394.60\"         \"2969.94±190.20\"        \nd2 \"low\"          \" \"                      \" \"                     \n   \"0\"            \" 4 (6.35%)\"             \"63 (100.00%)\"          \n   \"1\"            \"59 (93.65%)\"            \" 0 (0.00%)\"            \nd2 \"race\"         \" \"                      \" \"                     \n   \"black\"        \"12 (19.05%)\"            \" 8 (12.70%)\"           \n   \"other\"        \"26 (41.27%)\"            \"25 (39.68%)\"           \n   \"white\"        \"25 (39.68%)\"            \"30 (47.62%)\"           \nd2 \"smoke\"        \" \"                      \" \"                     \n   \"nonsmoker\"    \"31 (49.21%)\"            \"39 (61.90%)\"           \n   \"smoker\"       \"32 (50.79%)\"            \"24 (38.10%)\"           \nd2 \"ptl\"          \" \"                      \" \"                     \n   \"0\"            \"45 (71.43%)\"            \"58 (92.06%)\"           \n   \"1\"            \"16 (25.40%)\"            \" 4 (6.35%)\"            \n   \"2\"            \" 2 (3.17%)\"             \" 1 (1.59%)\"            \n   \"3\"            \" 0 (0.00%)\"             \" 0 (0.00%)\"            \nd2 \"ht\"           \" \"                      \" \"                     \n   \"0\"            \"56 (88.89%)\"            \"61 (96.83%)\"           \n   \"1\"            \" 7 (11.11%)\"            \" 2 (3.17%)\"            \nd2 \"ui\"           \" \"                      \" \"                     \n   \"0\"            \"47 (74.60%)\"            \"54 (85.71%)\"           \n   \"1\"            \"16 (25.40%)\"            \" 9 (14.29%)\"           \nd2 \"ftv\"          \" \"                      \" \"                     \n   \"0\"            \"37 (58.73%)\"            \"32 (50.79%)\"           \n   \"1\"            \"12 (19.05%)\"            \"15 (23.81%)\"           \n   \"2\"            \" 8 (12.70%)\"            \"13 (20.63%)\"           \n   \"3\"            \" 5 (7.94%)\"             \" 2 (3.17%)\"            \n   \"4\"            \" 1 (1.59%)\"             \" 1 (1.59%)\"            \n   \"6\"            \" 0 (0.00%)\"             \" 0 (0.00%)\"            \n   G.2                      p value \n   \"63\"                     \"\"      \nd1 \"23.00 (19.50-28.00)\"    \"0.483\" \nd1 \"131.00 (120.00-156.00)\" \"&lt;0.001\"\nd1 \"3736.68±317.76\"         \"&lt;0.001\"\nd2 \" \"                      \"&lt;0.001\"\n   \"63 (100.00%)\"           \" \"     \n   \" 0 (0.00%)\"             \" \"     \nd2 \" \"                      \"0.060\" \n   \" 6 (9.52%)\"             \" \"     \n   \"16 (25.40%)\"            \" \"     \n   \"41 (65.08%)\"            \" \"     \nd2 \" \"                      \"0.037\" \n   \"45 (71.43%)\"            \" \"     \n   \"18 (28.57%)\"            \" \"     \nd2 \" \"                      \"0.012\" \n   \"56 (88.89%)\"            \" \"     \n   \" 4 (6.35%)\"             \" \"     \n   \" 2 (3.17%)\"             \" \"     \n   \" 1 (1.59%)\"             \" \"     \nd2 \" \"                      \"0.154\" \n   \"60 (95.24%)\"            \" \"     \n   \" 3 (4.76%)\"             \" \"     \nd2 \" \"                      \"0.005\" \n   \"60 (95.24%)\"            \" \"     \n   \" 3 (4.76%)\"             \" \"     \nd2 \" \"                      \"0.283\" \n   \"31 (49.21%)\"            \" \"     \n   \"20 (31.75%)\"            \" \"     \n   \" 9 (14.29%)\"            \" \"     \n   \" 0 (0.00%)\"             \" \"     \n   \" 2 (3.17%)\"             \" \"     \n   \" 1 (1.59%)\"             \" \"     \n\n\n\n\n\n连续变量快速分层描述\n输出1可以看出年龄的自动分层记录，表明从14到20到25到45进行了分层\n如果想要生成其它分层数，设置参数 num = n\n\n# allvar删不删除年龄都可以\n\nallVars3 &lt;-c(\"race\", \"lwt\",\"smoke\", \"ptl\", \"ht\", \"ui\",\"ftv\", \"bwt\")\nfvars3 &lt;-c(\"smoke\",\"ht\",\"ui\",\"race\")\nstrata3 &lt;- \"age\"\n\ntab3 &lt;-scitb1(vars=allVars3,fvars=fvars3,strata=strata3,data=data_neat)\n\n      Min 33.33333% 66.66667%       Max \n       14        20        25        45 \n\n\nStrata is treated as a continuous variable.\n\ntab3\n\n   Characteristic G.0                      G.1                     \n   \"N\"            \"51\"                     \"69\"                    \nd1 \"lwt\"          \"119.00 (106.00-135.00)\" \"121.00 (110.00-132.00)\"\nd1 \"ptl\"          \"0.00 (0.00-0.00)\"       \"0.00 (0.00-0.00)\"      \nd1 \"ftv\"          \"0.00 (0.00-1.00)\"       \"0.00 (0.00-1.00)\"      \nd1 \"bwt\"          \"2974.08±612.51\"         \"2921.42±697.85\"        \nd2 \"smoke\"        \" \"                      \" \"                     \n   \"nonsmoker\"    \"28 (54.90%)\"            \"44 (63.77%)\"           \n   \"smoker\"       \"23 (45.10%)\"            \"25 (36.23%)\"           \nd2 \"ht\"           \" \"                      \" \"                     \n   \"0\"            \"48 (94.12%)\"            \"64 (92.75%)\"           \n   \"1\"            \" 3 (5.88%)\"             \" 5 (7.25%)\"            \nd2 \"ui\"           \" \"                      \" \"                     \n   \"0\"            \"43 (84.31%)\"            \"58 (84.06%)\"           \n   \"1\"            \" 8 (15.69%)\"            \"11 (15.94%)\"           \nd2 \"race\"         \" \"                      \" \"                     \n   \"black\"        \"10 (19.61%)\"            \"10 (14.49%)\"           \n   \"other\"        \"18 (35.29%)\"            \"27 (39.13%)\"           \n   \"white\"        \"23 (45.10%)\"            \"32 (46.38%)\"           \n   G.2                      p value\n   \"69\"                     \"\"     \nd1 \"130.00 (115.00-153.00)\" \"0.086\"\nd1 \"0.00 (0.00-0.00)\"       \"0.171\"\nd1 \"1.00 (0.00-2.00)\"       \"0.011\"\nd1 \"2945.13±839.82\"         \"0.927\"\nd2 \" \"                      \"0.587\"\n   \"43 (62.32%)\"            \" \"    \n   \"26 (37.68%)\"            \" \"    \nd2 \" \"                      \"0.929\"\n   \"65 (94.20%)\"            \" \"    \n   \" 4 (5.80%)\"             \" \"    \nd2 \" \"                      \"0.873\"\n   \"60 (86.96%)\"            \" \"    \n   \" 9 (13.04%)\"            \" \"    \nd2 \" \"                      \"0.320\"\n   \" 6 (8.70%)\"             \" \"    \n   \"22 (31.88%)\"            \" \"    \n   \"41 (59.42%)\"            \" \"    \n\n\n\n\n保存结果\n\nwrite.csv(tab0,file= \"01-attch\\\\10\\\\data.csv\",row.names = F, \n    fileEncoding = \"gbk\")\n\n保存出来是下图，复制到word改改就能用",
    "crumbs": [
      "主页",
      "实用 R 包",
      "scitb - 快速基线表"
    ]
  },
  {
    "objectID": "1013-scitb.html#总结",
    "href": "1013-scitb.html#总结",
    "title": "scitb-快速生成基线表一",
    "section": "总结",
    "text": "总结\n使用体验：自定义度，结果展示等不如comparegroups，但是胜在参数简单，在期刊没那么高要求和平时展示可以用",
    "crumbs": [
      "主页",
      "实用 R 包",
      "scitb - 快速基线表"
    ]
  },
  {
    "objectID": "1011-rpac_brucer.html",
    "href": "1011-rpac_brucer.html",
    "title": "bruceR - 统计分析工具",
    "section": "",
    "text": "bruceR 全称 “BRoadly Useful Convenient and Efficient R functions”，由包寒吴霜博士开发，是一个集成了众多实用功能的 R 包，专为科研数据分析设计。\n链接：CRAN | GitHub | 中文教程\n\n\nbruceR 涵盖了数据分析的完整流程：\n\n\n\n\n\n\n\n\n模块\n功能\n主要函数\n\n\n\n\n基础编程\n路径设置、数据导入导出、表格打印\nset.wd(), import(), export(), print_table()\n\n\n数据计算\n量表计算、反向计分、重编码\nMEAN(), SUM(), RECODE(), RESCALE()\n\n\n信效度分析\n信度分析、因子分析\nAlpha(), EFA(), PCA(), CFA()\n\n\n描述统计\n描述统计、频率分析、相关分析\nDescribe(), Freq(), Corr()\n\n\n方差分析\nt检验、ANOVA、简单效应、事后比较\nTTEST(), MANOVA(), EMMEANS()\n\n\n回归模型\n模型汇总、多层模型\nmodel_summary(), HLM_summary()\n\n\n中介调节\nPROCESS 宏\nPROCESS(), med_summary()\n\n\n\n\n\n\n加载 bruceR 时会自动加载常用包：\n\n数据处理：data.table, dplyr, tidyr, stringr\n可视化：ggplot2\n统计分析：psych, emmeans, lmerTest, effectsize, performance",
    "crumbs": [
      "主页",
      "实用 R 包",
      "bruceR - 统计分析工具"
    ]
  },
  {
    "objectID": "1011-rpac_brucer.html#r包介绍",
    "href": "1011-rpac_brucer.html#r包介绍",
    "title": "bruceR - 统计分析工具",
    "section": "",
    "text": "bruceR 全称 “BRoadly Useful Convenient and Efficient R functions”，由包寒吴霜博士开发，是一个集成了众多实用功能的 R 包，专为科研数据分析设计。\n链接：CRAN | GitHub | 中文教程\n\n\nbruceR 涵盖了数据分析的完整流程：\n\n\n\n\n\n\n\n\n模块\n功能\n主要函数\n\n\n\n\n基础编程\n路径设置、数据导入导出、表格打印\nset.wd(), import(), export(), print_table()\n\n\n数据计算\n量表计算、反向计分、重编码\nMEAN(), SUM(), RECODE(), RESCALE()\n\n\n信效度分析\n信度分析、因子分析\nAlpha(), EFA(), PCA(), CFA()\n\n\n描述统计\n描述统计、频率分析、相关分析\nDescribe(), Freq(), Corr()\n\n\n方差分析\nt检验、ANOVA、简单效应、事后比较\nTTEST(), MANOVA(), EMMEANS()\n\n\n回归模型\n模型汇总、多层模型\nmodel_summary(), HLM_summary()\n\n\n中介调节\nPROCESS 宏\nPROCESS(), med_summary()\n\n\n\n\n\n\n加载 bruceR 时会自动加载常用包：\n\n数据处理：data.table, dplyr, tidyr, stringr\n可视化：ggplot2\n统计分析：psych, emmeans, lmerTest, effectsize, performance",
    "crumbs": [
      "主页",
      "实用 R 包",
      "bruceR - 统计分析工具"
    ]
  },
  {
    "objectID": "1011-rpac_brucer.html#r包安装",
    "href": "1011-rpac_brucer.html#r包安装",
    "title": "bruceR - 统计分析工具",
    "section": "R包安装",
    "text": "R包安装\n\n# 方法1：从 CRAN 安装（推荐）\ninstall.packages(\"bruceR\", dep = TRUE)\n\n# 方法2：从 GitHub 安装最新版\ninstall.packages(\"devtools\")\ndevtools::install_github(\"psychbruce/bruceR\", dep = TRUE, force = TRUE)\n\n\nlibrary(bruceR)",
    "crumbs": [
      "主页",
      "实用 R 包",
      "bruceR - 统计分析工具"
    ]
  },
  {
    "objectID": "1011-rpac_brucer.html#基础编程功能",
    "href": "1011-rpac_brucer.html#基础编程功能",
    "title": "bruceR - 统计分析工具",
    "section": "基础编程功能",
    "text": "基础编程功能\n\nset.wd()：智能设置工作目录\n自动将工作目录设置为当前脚本所在路径：\n\nset.wd()\n\n\n\nimport() / export()：万能数据导入导出\n支持几乎所有常见数据格式，自动识别文件类型：\n\n# 支持的格式：\n# - 文本：.txt, .csv, .tsv\n# - Excel：.xls, .xlsx\n# - SPSS：.sav\n# - Stata：.dta\n# - R对象：.rda, .rds, .RData\n\n# 导入数据\ndata &lt;- import(\"data.xlsx\")\ndata &lt;- import(\"data.sav\")\ndata &lt;- import(\"data.dta\")\n\n# 导出数据\nexport(data, file = \"output.xlsx\")\nexport(data, file = \"output.csv\")\n\n\n\ncc()：快速创建字符向量\n比 c() 更简洁，无需引号：\n\n# 传统写法\nc(\"age\", \"gender\", \"education\")\n\n[1] \"age\"       \"gender\"    \"education\"\n\n# bruceR 写法\ncc(\"age, gender, education\")\n\n[1] \"age\"       \"gender\"    \"education\"\n\n\n\n\nprint_table()：生成三线表\n\nsummary_data &lt;- data.frame(\n  Variable = c(\"Age\", \"Income\", \"Score\"),\n  Mean = c(35.2, 5000, 78.5),\n  SD = c(8.3, 1200, 12.1),\n  N = c(100, 100, 100)\n)\n\nprint_table(summary_data)\n\n─────────────────────────────────────\n   Variable     Mean       SD       N\n─────────────────────────────────────\n1    Age      35.200    8.300 100.000\n2    Income 5000.000 1200.000 100.000\n3    Score    78.500   12.100 100.000\n─────────────────────────────────────",
    "crumbs": [
      "主页",
      "实用 R 包",
      "bruceR - 统计分析工具"
    ]
  },
  {
    "objectID": "1011-rpac_brucer.html#数据计算功能",
    "href": "1011-rpac_brucer.html#数据计算功能",
    "title": "bruceR - 统计分析工具",
    "section": "数据计算功能",
    "text": "数据计算功能\n\nMEAN() / SUM()：横向计算（支持反向计分）\n心理学量表经常需要计算多个题目的均值或总分，并处理反向计分：\n\n# 创建模拟问卷数据（5点量表，共6题）\nset.seed(42)\nquestionnaire &lt;- data.frame(\n  id = 1:5,\n  q1 = sample(1:5, 5, replace = TRUE),\n  q2 = sample(1:5, 5, replace = TRUE),\n  q3 = sample(1:5, 5, replace = TRUE),\n  q4 = sample(1:5, 5, replace = TRUE),\n  q5 = sample(1:5, 5, replace = TRUE),\n  q6 = sample(1:5, 5, replace = TRUE)\n)\nquestionnaire\n\n  id q1 q2 q3 q4 q5 q6\n1  1  1  4  1  3  5  4\n2  2  5  2  5  1  5  3\n3  3  1  2  4  1  5  2\n4  4  1  1  2  3  4  1\n5  5  2  4  2  4  2  2\n\n# 计算均值（q3、q6 反向计分，量表范围1-5）\nquestionnaire$score_mean &lt;- MEAN(\n  questionnaire, \n  varrange = \"q1:q6\",\n  rev = c(\"q3\", \"q6\"),\n  likert = 1:5\n)\n\n# 计算总分\nquestionnaire$score_sum &lt;- SUM(\n  questionnaire, \n  varrange = \"q1:q6\",\n  rev = c(\"q3\", \"q6\"),\n  likert = 1:5\n)\n\nquestionnaire[, c(\"id\", \"score_mean\", \"score_sum\")]\n\n  id score_mean score_sum\n1  1   3.333333        20\n2  2   2.833333        17\n3  3   2.500000        15\n4  4   3.000000        18\n5  5   3.333333        20\n\n\n\n\nRECODE()：变量重编码\n\nd &lt;- data.frame(age = c(18, 25, 35, 45, 55, 65, 75))\n\nd$age_group &lt;- RECODE(d$age, \n  \"lo:29 = '青年'; \n   30:59 = '中年'; \n   60:hi = '老年'\"\n)\nd\n\n  age age_group\n1  18      青年\n2  25      青年\n3  35      中年\n4  45      中年\n5  55      中年\n6  65      老年\n7  75      老年\n\n\n\n\nRESCALE()：变量标准化\n\nscores &lt;- c(2, 3, 4, 5, 6, 7, 8)\nRESCALE(scores, to = 0:100)\n\n[1]   0.00000  16.66667  33.33333  50.00000  66.66667  83.33333 100.00000",
    "crumbs": [
      "主页",
      "实用 R 包",
      "bruceR - 统计分析工具"
    ]
  },
  {
    "objectID": "1011-rpac_brucer.html#信度与因子分析",
    "href": "1011-rpac_brucer.html#信度与因子分析",
    "title": "bruceR - 统计分析工具",
    "section": "信度与因子分析",
    "text": "信度与因子分析\n\nAlpha()：信度分析\n\ndata(\"bfi\", package = \"psych\")\n\n# Alpha 需要指定数据和变量名\nAlpha(bfi, var = \"A\", items = 1:5)\n\n\nReliability Analysis\n\nSummary:\nTotal Items: 5\nScale Range: 1 ~ 6\nTotal Cases: 2800\nValid Cases: 2709 (96.8%)\n\nScale Statistics:\nMean = 4.208\nS.D. = 0.735\nCronbach’s α = 0.431\nMcDonald’s ω = 0.592\n\nWarning: Scale reliability is low. You may check item codings.\nItem A1 correlates negatively with the scale and may be reversed.\nYou can specify this argument: rev=c(\"A1\")\n\nItem Statistics (Cronbach’s α If Item Deleted):\n─────────────────────────────────────────────\n     Mean    S.D. Item-Rest Cor. Cronbach’s α\n─────────────────────────────────────────────\nA1  2.412 (1.405)         -0.311        0.718\nA2  4.797 (1.176)          0.372        0.278\nA3  4.599 (1.305)          0.478        0.174\nA4  4.682 (1.486)          0.365        0.252\nA5  4.551 (1.262)          0.448        0.207\n─────────────────────────────────────────────\nItem-Rest Cor. = Corrected Item-Total Correlation\n\n\n\n\nEFA()：探索性因子分析\n\ndata(\"bfi\", package = \"psych\")\n\n# 探索性因子分析：使用 var + items 格式\n# 分析外向性(E)量表的5个题目\nEFA(bfi, var = \"E\", items = 1:5, nfactors = 2, plot.scree = FALSE)\n\n\nPrincipal Component Analysis\n\nSummary:\nTotal Items: 5\nScale Range: 1 ~ 6\nTotal Cases: 2800\nValid Cases: 2713 (96.9%)\n\nExtraction Method:\n- Principal Component Analysis\nRotation Method:\n- Varimax (with Kaiser Normalization)\n\nKMO and Bartlett's Test:\n- Kaiser-Meyer-Olkin (KMO) Measure of Sampling Adequacy: MSA = 0.799\n- Bartlett's Test of Sphericity: Approx. χ²(10) = 3011.40, p &lt; 1e-99 ***\n\nTotal Variance Explained:\n──────────────────────────────────────────────────────────────────────────────────\n             Eigenvalue Variance % Cumulative % SS Loading Variance % Cumulative %\n──────────────────────────────────────────────────────────────────────────────────\nComponent 1       2.565     51.298       51.298      1.884     37.680       37.680\nComponent 2       0.768     15.368       66.666      1.449     28.986       66.666\nComponent 3       0.643     12.851       79.517                                   \nComponent 4       0.561     11.211       90.728                                   \nComponent 5       0.464      9.272      100.000                                   \n──────────────────────────────────────────────────────────────────────────────────\n\nComponent Loadings (Rotated) (Sorted by Size):\n─────────────────────────────\n       RC1    RC2 Communality\n─────────────────────────────\nE1   0.812 -0.098       0.668\nE2   0.752 -0.304       0.658\nE4  -0.736  0.290       0.625\nE5  -0.145  0.860       0.761\nE3  -0.312  0.723       0.620\n─────────────────────────────\nCommunality = Sum of Squared (SS) Factor Loadings\n(Uniqueness = 1 - Communality)",
    "crumbs": [
      "主页",
      "实用 R 包",
      "bruceR - 统计分析工具"
    ]
  },
  {
    "objectID": "1011-rpac_brucer.html#描述统计与相关分析",
    "href": "1011-rpac_brucer.html#描述统计与相关分析",
    "title": "bruceR - 统计分析工具",
    "section": "描述统计与相关分析",
    "text": "描述统计与相关分析\n\nDescribe()：描述统计\n\nDescribe(iris[, 1:4])\n\nDescriptive Statistics:\n────────────────────────────────────────────────────────────────\n                N Mean   SD | Median  Min  Max Skewness Kurtosis\n────────────────────────────────────────────────────────────────\nSepal.Length  150 5.84 0.83 |   5.80 4.30 7.90     0.31    -0.61\nSepal.Width   150 3.06 0.44 |   3.00 2.00 4.40     0.31     0.14\nPetal.Length  150 3.76 1.77 |   4.35 1.00 6.90    -0.27    -1.42\nPetal.Width   150 1.20 0.76 |   1.30 0.10 2.50    -0.10    -1.36\n────────────────────────────────────────────────────────────────\n\n\n\n\nFreq()：频率分析\n\nFreq(iris$Species)\n\nFrequency Statistics:\n───────────────────\n             N    %\n───────────────────\nsetosa      50 33.3\nversicolor  50 33.3\nvirginica   50 33.3\n───────────────────\nTotal N = 150\n\n\n\n\nCorr()：相关分析\n\nCorr(iris[, 1:4])\n\nPearson's r and 95% confidence intervals:\n─────────────────────────────────────────────────────────────\n                               r       [95% CI]     p       N\n─────────────────────────────────────────────────────────────\nSepal.Length-Sepal.Width   -0.12 [-0.27,  0.04]  .152     150\nSepal.Length-Petal.Length   0.87 [ 0.83,  0.91] &lt;.001 *** 150\nSepal.Length-Petal.Width    0.82 [ 0.76,  0.86] &lt;.001 *** 150\nSepal.Width-Petal.Length   -0.43 [-0.55, -0.29] &lt;.001 *** 150\nSepal.Width-Petal.Width    -0.37 [-0.50, -0.22] &lt;.001 *** 150\nPetal.Length-Petal.Width    0.96 [ 0.95,  0.97] &lt;.001 *** 150\n─────────────────────────────────────────────────────────────",
    "crumbs": [
      "主页",
      "实用 R 包",
      "bruceR - 统计分析工具"
    ]
  },
  {
    "objectID": "1011-rpac_brucer.html#统计检验",
    "href": "1011-rpac_brucer.html#统计检验",
    "title": "bruceR - 统计分析工具",
    "section": "统计检验",
    "text": "统计检验\n\nTTEST()：t检验\n\n# 独立样本 t 检验（需要两水平因子）\niris_subset &lt;- iris[iris$Species %in% c(\"versicolor\", \"virginica\"), ]\niris_subset$Species &lt;- droplevels(iris_subset$Species)\n\nTTEST(iris_subset, y = \"Sepal.Length\", x = \"Species\")\n\n\nIndependent-Samples t-test\n\nHypothesis: two-sided (μ2 - μ1 ≠ 0)\n\nDescriptives:\n───────────────────────────────────────────────\n     Variable  Factor      Level  N Mean (S.D.)\n───────────────────────────────────────────────\n Sepal.Length Species versicolor 50 5.94 (0.52)\n Sepal.Length Species virginica  50 6.59 (0.64)\n───────────────────────────────────────────────\n\nLevene’s test for homogeneity of variance:\n────────────────────────────────────────────────────────────────────────────\n                                                Levene’s F df1 df2     p    \n────────────────────────────────────────────────────────────────────────────\nSepal.Length: Species (virginica - versicolor)        1.42   1  98  .236    \n────────────────────────────────────────────────────────────────────────────\nNote: H0 = equal variance (homoscedasticity).\nIf significant (violation of the assumption),\nthen you should better set `var.equal=FALSE`.\n\nResults of t-test:\n─────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n                                                   t df     p     Difference [95% CI] Cohen’s d [95% CI]     BF10\n─────────────────────────────────────────────────────────────────────────────────────────────────────────────────\nSepal.Length: Species (virginica - versicolor)  5.63 98 &lt;.001 ***   0.65 [0.42, 0.88]  1.13 [0.73, 1.52] 7.04e+04\n─────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n\n\n\n\nMANOVA()：多因素方差分析\n\nMANOVA(data = npk, dv = \"yield\", between = c(\"N\", \"P\", \"K\"))\n\n\n====== ANOVA (Between-Subjects Design) ======\n\nDescriptives:\n─────────────────────────────\n \"N\" \"P\" \"K\"   Mean    S.D. n\n─────────────────────────────\n  N0  P0  K0 51.433 (4.600) 3\n  N0  P0  K1 52.000 (5.635) 3\n  N0  P1  K0 54.333 (9.411) 3\n  N0  P1  K1 50.500 (2.364) 3\n  N1  P0  K0 63.767 (5.086) 3\n  N1  P0  K1 54.667 (4.216) 3\n  N1  P1  K0 57.933 (5.478) 3\n  N1  P1  K1 54.367 (5.006) 3\n─────────────────────────────\nTotal sample size: N = 24\n\nANOVA Table:\nDependent variable(s):      yield\nBetween-subjects factor(s): N, P, K\nWithin-subjects factor(s):  –\nCovariate(s):               –\n──────────────────────────────────────────────────────────────────────────\n                MS    MSE df1 df2     F     p     η²p [90% CI of η²p]  η²G\n──────────────────────────────────────────────────────────────────────────\nN          189.282 30.724   1  16 6.161  .025 *     .278 [.024, .529] .278\nP            8.402 30.724   1  16 0.273  .608       .017 [.000, .220] .017\nK           95.202 30.724   1  16 3.099  .097 .     .162 [.000, .427] .162\nN * P       21.282 30.724   1  16 0.693  .418       .041 [.000, .277] .041\nN * K       33.135 30.724   1  16 1.078  .314       .063 [.000, .312] .063\nP * K        0.482 30.724   1  16 0.016  .902       .001 [.000, .078] .001\nN * P * K   37.002 30.724   1  16 1.204  .289       .070 [.000, .322] .070\n──────────────────────────────────────────────────────────────────────────\nMSE = mean square error (the residual variance of the linear model)\nη²p = partial eta-squared = SS / (SS + SSE) = F * df1 / (F * df1 + df2)\nω²p = partial omega-squared = (F - 1) * df1 / (F * df1 + df2 + 1)\nη²G = generalized eta-squared (see Olejnik & Algina, 2003)\nCohen’s f² = η²p / (1 - η²p)\n\nLevene’s Test for Homogeneity of Variance:\n───────────────────────────────────────\n           Levene’s F df1 df2     p    \n───────────────────────────────────────\nDV: yield       0.986   7  16  .475    \n───────────────────────────────────────\n\n\n\n\nEMMEANS()：边际均值与事后比较\n\nresult &lt;- MANOVA(npk, dv = \"yield\", between = c(\"N\", \"P\"))\n\n\n====== ANOVA (Between-Subjects Design) ======\n\nDescriptives:\n─────────────────────────\n \"N\" \"P\"   Mean    S.D. n\n─────────────────────────\n  N0  P0 51.717 (4.611) 6\n  N0  P1 52.417 (6.486) 6\n  N1  P0 59.217 (6.504) 6\n  N1  P1 56.150 (5.084) 6\n─────────────────────────\nTotal sample size: N = 24\n\nANOVA Table:\nDependent variable(s):      yield\nBetween-subjects factor(s): N, P\nWithin-subjects factor(s):  –\nCovariate(s):               –\n──────────────────────────────────────────────────────────────────────\n            MS    MSE df1 df2     F     p     η²p [90% CI of η²p]  η²G\n──────────────────────────────────────────────────────────────────────\nN      189.282 32.870   1  20 5.758  .026 *     .224 [.017, .460] .224\nP        8.402 32.870   1  20 0.256  .619       .013 [.000, .181] .013\nN * P   21.282 32.870   1  20 0.647  .430       .031 [.000, .230] .031\n──────────────────────────────────────────────────────────────────────\nMSE = mean square error (the residual variance of the linear model)\nη²p = partial eta-squared = SS / (SS + SSE) = F * df1 / (F * df1 + df2)\nω²p = partial omega-squared = (F - 1) * df1 / (F * df1 + df2 + 1)\nη²G = generalized eta-squared (see Olejnik & Algina, 2003)\nCohen’s f² = η²p / (1 - η²p)\n\nLevene’s Test for Homogeneity of Variance:\n───────────────────────────────────────\n           Levene’s F df1 df2     p    \n───────────────────────────────────────\nDV: yield       0.160   3  20  .922    \n───────────────────────────────────────\n\nEMMEANS(result, effect = \"N\")\n\n------ EMMEANS (effect = \"N\") ------\n\nJoint Tests of \"N\":\n───────────────────────────────────────────────────\n Effect df1 df2     F     p     η²p [90% CI of η²p]\n───────────────────────────────────────────────────\n  N       1  20 5.758  .026 *     .224 [.017, .460]\n  P       1  20 0.256  .619       .013 [.000, .181]\n  N * P   1  20 0.647  .430       .031 [.000, .230]\n───────────────────────────────────────────────────\nNote. Simple effects of repeated measures with 3 or more levels\nare different from the results obtained with SPSS MANOVA syntax.\n\nUnivariate Tests of \"N\":\n────────────────────────────────────────────────────────\n           Sum of Squares df Mean Square     F     p    \n────────────────────────────────────────────────────────\nMean: \"N\"         189.282  1     189.282 5.758  .026 *  \nResiduals         657.400 20      32.870                \n────────────────────────────────────────────────────────\nNote. Identical to the results obtained with SPSS GLM EMMEANS syntax.\n\nEstimated Marginal Means of \"N\":\n────────────────────────────────────\n \"N\"   Mean [95% CI of Mean]    S.E.\n────────────────────────────────────\n  N0 52.067 [48.614, 55.519] (1.655)\n  N1 57.683 [54.231, 61.136] (1.655)\n────────────────────────────────────\n\nPairwise Comparisons of \"N\":\n─────────────────────────────────────────────────────────────────────\n Contrast Estimate    S.E. df     t     p     Cohen’s d [95% CI of d]\n─────────────────────────────────────────────────────────────────────\n  N1 - N0    5.617 (2.341) 20 2.400  .026 *      0.980 [0.128, 1.831]\n─────────────────────────────────────────────────────────────────────\nPooled SD for computing Cohen’s d: 5.733\nResults are averaged over the levels of: P\nNo need to adjust p values.\n\nDisclaimer:\nBy default, pooled SD is Root Mean Square Error (RMSE).\nThere is much disagreement on how to compute Cohen’s d.\nYou are completely responsible for setting `sd.pooled`.\nYou might also use `effectsize::t_to_d()` to compute d.",
    "crumbs": [
      "主页",
      "实用 R 包",
      "bruceR - 统计分析工具"
    ]
  },
  {
    "objectID": "1011-rpac_brucer.html#回归分析",
    "href": "1011-rpac_brucer.html#回归分析",
    "title": "bruceR - 统计分析工具",
    "section": "回归分析",
    "text": "回归分析\n\nmodel_summary()：模型汇总\n\nlm1 &lt;- lm(Sepal.Length ~ Sepal.Width, data = iris)\nlm2 &lt;- lm(Sepal.Length ~ Sepal.Width + Petal.Length, data = iris)\nlm3 &lt;- lm(Sepal.Length ~ Sepal.Width + Petal.Length + Petal.Width, data = iris)\n\n# 多个模型对比\nmodel_summary(list(lm1, lm2, lm3))\n\n\nModel Summary\n\n──────────────────────────────────────────────────────────────────\n              (1) Sepal.Length  (2) Sepal.Length  (3) Sepal.Length\n──────────────────────────────────────────────────────────────────\n(Intercept)     6.526 ***         2.249 ***         1.856 ***     \n               (0.479)           (0.248)           (0.251)        \nSepal.Width    -0.223             0.596 ***         0.651 ***     \n               (0.155)           (0.069)           (0.067)        \nPetal.Length                      0.472 ***         0.709 ***     \n                                 (0.017)           (0.057)        \nPetal.Width                                        -0.556 ***     \n                                                   (0.128)        \n──────────────────────────────────────────────────────────────────\nR^2             0.014             0.840             0.859         \nAdj. R^2        0.007             0.838             0.856         \nNum. obs.     150               150               150             \n──────────────────────────────────────────────────────────────────\nNote. * p &lt; .05, ** p &lt; .01, *** p &lt; .001.\n\n# 输出标准化系数\nmodel_summary(lm3, std = TRUE)\n\n\nModel Summary\n\n──────────────────────────────\n              (1) Sepal.Length\n──────────────────────────────\nSepal.Width      .343 ***     \n                (.035)        \nPetal.Length    1.512 ***     \n                (.121)        \nPetal.Width     -.512 ***     \n                (.117)        \n──────────────────────────────\nR^2              .859         \nAdj. R^2         .856         \nNum. obs.     150             \n──────────────────────────────\nNote. * p &lt; .05, ** p &lt; .01, *** p &lt; .001.\n\n# Check for Multicollinearity\n\nLow Correlation\n\n        Term  VIF     VIF 95% CI adj. VIF Tolerance Tolerance 95% CI\n Sepal.Width 1.27 [ 1.11,  1.65]     1.13      0.79     [0.61, 0.90]\n\nHigh Correlation\n\n         Term   VIF     VIF 95% CI adj. VIF Tolerance Tolerance 95% CI\n Petal.Length 15.10 [11.27, 20.36]     3.89      0.07     [0.05, 0.09]\n  Petal.Width 14.23 [10.63, 19.19]     3.77      0.07     [0.05, 0.09]",
    "crumbs": [
      "主页",
      "实用 R 包",
      "bruceR - 统计分析工具"
    ]
  },
  {
    "objectID": "1011-rpac_brucer.html#中介与调节分析",
    "href": "1011-rpac_brucer.html#中介与调节分析",
    "title": "bruceR - 统计分析工具",
    "section": "中介与调节分析",
    "text": "中介与调节分析\n\nPROCESS()：中介调节分析\n\nset.seed(123)\nn &lt;- 200\nmediation_data &lt;- data.frame(\n  X = rnorm(n),\n  M = rnorm(n),\n  Y = rnorm(n)\n)\nmediation_data$M &lt;- 0.5 * mediation_data$X + rnorm(n, sd = 0.5)\nmediation_data$Y &lt;- 0.4 * mediation_data$M + 0.3 * mediation_data$X + rnorm(n, sd = 0.5)\n\n# 简单中介模型\nPROCESS(mediation_data, y = \"Y\", x = \"X\", meds = \"M\", \n        ci = \"boot\", nsim = 100)\n\n\n****************** PART 1. Regression Model Summary ******************\n\nPROCESS Model ID : 4\nModel Type : Simple Mediation\n-    Outcome (Y) : Y\n-  Predictor (X) : X\n-  Mediators (M) : M\n- Moderators (W) : -\n- Covariates (C) : -\n-   HLM Clusters : -\n\nAll numeric predictors have been grand-mean centered.\n(For details, please see the help page of PROCESS.)\n\nFormula of Mediator:\n-    M ~ X\nFormula of Outcome:\n-    Y ~ X + M\n\nCAUTION:\n  Fixed effect (coef.) of a predictor involved in an interaction\n  denotes its \"simple effect/slope\" at the other predictor = 0.\n  Only when all predictors in an interaction are mean-centered\n  can the fixed effect be interpreted as \"main effect\"!\n  \nModel Summary\n\n──────────────────────────────────────────────────\n             (1) Y        (2) M        (3) Y      \n──────────────────────────────────────────────────\n(Intercept)    0.010       -0.015        0.010    \n              (0.039)      (0.036)      (0.037)   \nX              0.462 ***    0.475 ***    0.302 ***\n              (0.041)      (0.039)      (0.052)   \nM                                        0.336 ***\n                                        (0.072)   \n──────────────────────────────────────────────────\nR^2            0.391        0.434        0.452    \nAdj. R^2       0.388        0.431        0.446    \nNum. obs.    200          200          200        \n──────────────────────────────────────────────────\nNote. * p &lt; .05, ** p &lt; .01, *** p &lt; .001.\n\n************ PART 2. Mediation/Moderation Effect Estimate ************\n\nPackage Use : ‘mediation’ (v4.5.1)\nEffect Type : Simple Mediation (Model 4)\nSample Size : 200\nRandom Seed : set.seed()\nSimulations : 100 (Bootstrap)\n\n\n\nRunning 100 simulations...\nIndirect Path: \"X\" (X) ==&gt; \"M\" (M) ==&gt; \"Y\" (Y)\n─────────────────────────────────────────────────────────────\n               Effect    S.E.      z     p      [Boot 95% CI]\n─────────────────────────────────────────────────────────────\nIndirect (ab)   0.160 (0.034)  4.692 &lt;.001 *** [0.107, 0.235]\nDirect (c')     0.302 (0.051)  5.932 &lt;.001 *** [0.194, 0.386]\nTotal (c)       0.462 (0.041) 11.288 &lt;.001 *** [0.368, 0.529]\n─────────────────────────────────────────────────────────────\nPercentile Bootstrap Confidence Interval\n(SE and CI are estimated based on 100 Bootstrap samples.)\n\nNote. The results based on bootstrapping or other random processes\nare unlikely identical to other statistical software (e.g., SPSS).\nTo make results reproducible, you need to set a seed (any number).\nPlease see the help page for details: help(PROCESS)\nIgnore this note if you have already set a seed. :)",
    "crumbs": [
      "主页",
      "实用 R 包",
      "bruceR - 统计分析工具"
    ]
  },
  {
    "objectID": "1011-rpac_brucer.html#其他实用功能",
    "href": "1011-rpac_brucer.html#其他实用功能",
    "title": "bruceR - 统计分析工具",
    "section": "其他实用功能",
    "text": "其他实用功能\n\n运算符\n\n# %notin%：不在其中\nc(1, 2, 3) %notin% c(2, 4, 6)\n\n[1]  TRUE FALSE  TRUE\n\n# %allin%：全部在其中\nc(1, 2) %allin% c(1, 2, 3, 4)\n\n[1] TRUE\n\n\n\n\ntheme_bruce()：ggplot2 主题\n\nlibrary(ggplot2)\n\nggplot(iris, aes(x = Sepal.Length, y = Sepal.Width, color = Species)) +\n  geom_point(size = 2, alpha = 0.7) +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  labs(title = \"鸢尾花数据可视化\") +\n  theme_bruce()",
    "crumbs": [
      "主页",
      "实用 R 包",
      "bruceR - 统计分析工具"
    ]
  },
  {
    "objectID": "1011-rpac_brucer.html#导出到-word",
    "href": "1011-rpac_brucer.html#导出到-word",
    "title": "bruceR - 统计分析工具",
    "section": "导出到 Word",
    "text": "导出到 Word\nbruceR 的一大特色是可以将结果直接导出到 Word 文档：\n\n# 描述统计\nDescribe(iris[, 1:4], file = \"descriptives.doc\")\n\n# 相关矩阵\nCorr(iris[, 1:4], file = \"correlation.doc\")\n\n# 回归模型\nmodel_summary(list(lm1, lm2, lm3), file = \"regression.doc\")\n\n# 中介分析\nPROCESS(data, y = \"Y\", x = \"X\", meds = \"M\", file = \"mediation.doc\")",
    "crumbs": [
      "主页",
      "实用 R 包",
      "bruceR - 统计分析工具"
    ]
  },
  {
    "objectID": "1011-rpac_brucer.html#函数速查表",
    "href": "1011-rpac_brucer.html#函数速查表",
    "title": "bruceR - 统计分析工具",
    "section": "函数速查表",
    "text": "函数速查表\n\n\n\n类别\n函数\n功能\n\n\n\n\n基础\nset.wd()\n设置工作目录到当前脚本位置\n\n\n\nimport() / export()\n万能数据导入/导出\n\n\n\ncc()\n快速创建字符向量\n\n\n\nprint_table()\n打印三线表\n\n\n计算\nMEAN() / SUM()\n横向计算（支持反向计分）\n\n\n\nRECODE()\n变量重编码\n\n\n\nRESCALE()\n变量标准化\n\n\n信效度\nAlpha()\nCronbach’s α 信度分析\n\n\n\nEFA() / PCA()\n探索性因子分析/主成分分析\n\n\n\nCFA()\n验证性因子分析\n\n\n描述\nDescribe()\n描述统计\n\n\n\nFreq()\n频率分析与交叉表\n\n\n\nCorr()\n相关分析与热力图\n\n\n检验\nTTEST()\nt检验（单样本/独立/配对）\n\n\n\nMANOVA()\n多因素方差分析\n\n\n\nEMMEANS()\n边际均值与事后比较\n\n\n回归\nmodel_summary()\n回归模型整洁输出\n\n\n\nGLM_summary()\n广义线性模型汇总\n\n\n\nHLM_summary()\n多层线性模型汇总\n\n\n中介\nPROCESS()\n中介/调节效应分析\n\n\n\nmed_summary()\n中介效应汇总",
    "crumbs": [
      "主页",
      "实用 R 包",
      "bruceR - 统计分析工具"
    ]
  },
  {
    "objectID": "1011-rpac_brucer.html#参考资源",
    "href": "1011-rpac_brucer.html#参考资源",
    "title": "bruceR - 统计分析工具",
    "section": "参考资源",
    "text": "参考资源\n\nbruceR GitHub 主页\nCRAN 官方页面\n中文教程：概述篇\n中文教程：常见问题\n引用：Bao, H. W. S. (2021). bruceR: Broadly useful convenient and efficient R functions. https://doi.org/10.32614/CRAN.package.bruceR",
    "crumbs": [
      "主页",
      "实用 R 包",
      "bruceR - 统计分析工具"
    ]
  },
  {
    "objectID": "0012-quarto-vs-rmd.html",
    "href": "0012-quarto-vs-rmd.html",
    "title": "Quarto vs RMarkdown 对比",
    "section": "",
    "text": "Quarto 是 RMarkdown 的下一代版本，由 Posit（原 RStudio）开发。两者都用于创建可重复的文档，但 Quarto 提供了更多现代特性。",
    "crumbs": [
      "主页",
      "实用操作",
      "Quarto vs RMarkdown"
    ]
  },
  {
    "objectID": "0012-quarto-vs-rmd.html#概述",
    "href": "0012-quarto-vs-rmd.html#概述",
    "title": "Quarto vs RMarkdown 对比",
    "section": "",
    "text": "Quarto 是 RMarkdown 的下一代版本，由 Posit（原 RStudio）开发。两者都用于创建可重复的文档，但 Quarto 提供了更多现代特性。",
    "crumbs": [
      "主页",
      "实用操作",
      "Quarto vs RMarkdown"
    ]
  },
  {
    "objectID": "0012-quarto-vs-rmd.html#核心区别",
    "href": "0012-quarto-vs-rmd.html#核心区别",
    "title": "Quarto vs RMarkdown 对比",
    "section": "核心区别",
    "text": "核心区别\n\n\n\n特性\nRMarkdown\nQuarto\n\n\n\n\n文件扩展名\n.Rmd\n.qmd\n\n\n语言支持\n主要是 R\nR、Python、Julia、Observable\n\n\n依赖\n需要 R 和 knitr\n独立命令行工具\n\n\n配置语法\nYAML + R 代码块选项\n统一的 YAML 语法\n\n\n输出格式\n通过 R 包\n内置支持",
    "crumbs": [
      "主页",
      "实用操作",
      "Quarto vs RMarkdown"
    ]
  },
  {
    "objectID": "0012-quarto-vs-rmd.html#语法对比",
    "href": "0012-quarto-vs-rmd.html#语法对比",
    "title": "Quarto vs RMarkdown 对比",
    "section": "语法对比",
    "text": "语法对比\n\n代码块选项\nRMarkdown 方式： 选项写在花括号内\n代码块头: {r myplot, echo=TRUE, fig.width=8}\nQuarto 方式： 使用 #| 注释语法\n代码块头: {r}\n#| label: myplot\n#| echo: true\n#| fig-width: 8\nQuarto 的 #| 语法更清晰，且支持代码补全。\n\n\n交叉引用\n\n\n\n功能\nRMarkdown\nQuarto\n\n\n\n\n图片引用\n\\@ref(fig:myplot)\n@fig-myplot\n\n\n表格引用\n\\@ref(tab:mytable)\n@tbl-mytable\n\n\n依赖\n需要 bookdown 包\n内置支持\n\n\n\n\n\n条件内容\nQuarto 原生支持按输出格式显示不同内容：\n\n::: {.content-visible when-format=\"html\"} 仅 HTML 显示\n::: {.content-visible when-format=\"pdf\"} 仅 PDF 显示",
    "crumbs": [
      "主页",
      "实用操作",
      "Quarto vs RMarkdown"
    ]
  },
  {
    "objectID": "0012-quarto-vs-rmd.html#quarto-的优势",
    "href": "0012-quarto-vs-rmd.html#quarto-的优势",
    "title": "Quarto vs RMarkdown 对比",
    "section": "Quarto 的优势",
    "text": "Quarto 的优势\n\n1. 多语言支持\n在同一文档中可混合使用 R、Python、Julia、Observable JS。\n\n\n2. 更好的项目支持\n通过 _quarto.yml 统一配置整个项目，支持网站、书籍、博客等多种项目类型。\n\n\n3. 内置幻灯片\n原生支持 Revealjs 幻灯片，只需设置 format: revealjs。\n\n\n4. 扩展系统\n可通过 quarto add 安装扩展，添加新格式、过滤器和短代码。",
    "crumbs": [
      "主页",
      "实用操作",
      "Quarto vs RMarkdown"
    ]
  },
  {
    "objectID": "0012-quarto-vs-rmd.html#rmarkdown-的优势",
    "href": "0012-quarto-vs-rmd.html#rmarkdown-的优势",
    "title": "Quarto vs RMarkdown 对比",
    "section": "RMarkdown 的优势",
    "text": "RMarkdown 的优势\n\n生态成熟：大量现有模板和包\nR 深度集成：与 R 包系统无缝配合\n学习资料丰富：教程和文档更多",
    "crumbs": [
      "主页",
      "实用操作",
      "Quarto vs RMarkdown"
    ]
  },
  {
    "objectID": "0012-quarto-vs-rmd.html#迁移建议",
    "href": "0012-quarto-vs-rmd.html#迁移建议",
    "title": "Quarto vs RMarkdown 对比",
    "section": "迁移建议",
    "text": "迁移建议\n\n从 RMarkdown 迁移到 Quarto\n\n将 .Rmd 重命名为 .qmd（大多数情况下直接可用）\n更新代码块选项为 #| 语法\n更新 YAML 头部：output: html_document → format: html\n\n\n\nYAML 头部对比\n\n\n\nRMarkdown\nQuarto\n\n\n\n\noutput: html_document\nformat: html\n\n\ntoc: true\ntoc: true\n\n\ntoc_float: true\ntoc-location: left\n\n\ncode_folding: show\ncode-fold: show",
    "crumbs": [
      "主页",
      "实用操作",
      "Quarto vs RMarkdown"
    ]
  },
  {
    "objectID": "0012-quarto-vs-rmd.html#选择建议",
    "href": "0012-quarto-vs-rmd.html#选择建议",
    "title": "Quarto vs RMarkdown 对比",
    "section": "选择建议",
    "text": "选择建议\n\n\n\n场景\n推荐\n\n\n\n\n新项目\nQuarto\n\n\n纯 R 项目\n两者皆可\n\n\n多语言项目\nQuarto\n\n\n已有 RMarkdown 项目\n继续使用，有需要再迁移\n\n\n需要特定 R 包功能\nRMarkdown\n\n\n网站/书籍项目\nQuarto",
    "crumbs": [
      "主页",
      "实用操作",
      "Quarto vs RMarkdown"
    ]
  },
  {
    "objectID": "0012-quarto-vs-rmd.html#总结",
    "href": "0012-quarto-vs-rmd.html#总结",
    "title": "Quarto vs RMarkdown 对比",
    "section": "总结",
    "text": "总结\nQuarto 是 RMarkdown 的现代继承者，提供：\n\n统一的跨语言体验\n更清晰的语法\n内置丰富功能\n活跃的开发和社区\n\n对于新项目，推荐使用 Quarto。现有 RMarkdown 项目可以按需逐步迁移。",
    "crumbs": [
      "主页",
      "实用操作",
      "Quarto vs RMarkdown"
    ]
  },
  {
    "objectID": "0012-quarto-vs-rmd.html#参考资源",
    "href": "0012-quarto-vs-rmd.html#参考资源",
    "title": "Quarto vs RMarkdown 对比",
    "section": "参考资源",
    "text": "参考资源\n\nQuarto 官方文档\nRMarkdown 官方文档\n从 RMarkdown 迁移到 Quarto",
    "crumbs": [
      "主页",
      "实用操作",
      "Quarto vs RMarkdown"
    ]
  },
  {
    "objectID": "0011-rmarkdown.html",
    "href": "0011-rmarkdown.html",
    "title": "rmarkdown教程-初学r语言推荐",
    "section": "",
    "text": "rmarkdown是一种将r语言代码和markdown语法整合在一起的工具，它可以将r语言代码的执行结果和文字、图片、表格等内容整合在一起，形成一个完整的文档。rmarkdown的文档可以导出为html、pdf、word等格式的文档。rmarkdown的文档可以在github上免费发布，也可以在rstudio上免费发布。rmarkdown的文档可以在\nrmarkdown主要用于逐段运行代码并展示结果，生成演示文档，生成html用于其它平台发布，搭配bookdown搭建网页教程\n刚学习r语言的同学可以使用rmarkdown来学习r语言，不仅可以在段落中间穿插个人说明，同时用markdown的大纲符号“#”可以让代码结构清晰",
    "crumbs": [
      "主页",
      "实用操作",
      "RMarkdown 入门"
    ]
  },
  {
    "objectID": "0011-rmarkdown.html#rmarkdown介绍",
    "href": "0011-rmarkdown.html#rmarkdown介绍",
    "title": "rmarkdown教程-初学r语言推荐",
    "section": "",
    "text": "rmarkdown是一种将r语言代码和markdown语法整合在一起的工具，它可以将r语言代码的执行结果和文字、图片、表格等内容整合在一起，形成一个完整的文档。rmarkdown的文档可以导出为html、pdf、word等格式的文档。rmarkdown的文档可以在github上免费发布，也可以在rstudio上免费发布。rmarkdown的文档可以在\nrmarkdown主要用于逐段运行代码并展示结果，生成演示文档，生成html用于其它平台发布，搭配bookdown搭建网页教程\n刚学习r语言的同学可以使用rmarkdown来学习r语言，不仅可以在段落中间穿插个人说明，同时用markdown的大纲符号“#”可以让代码结构清晰",
    "crumbs": [
      "主页",
      "实用操作",
      "RMarkdown 入门"
    ]
  },
  {
    "objectID": "0011-rmarkdown.html#rmarkdown使用",
    "href": "0011-rmarkdown.html#rmarkdown使用",
    "title": "rmarkdown教程-初学r语言推荐",
    "section": "rmarkdown使用",
    "text": "rmarkdown使用\n在工具栏新建rmarkdown文档，会生成模板文件，在模板文件的基础上增删修改",
    "crumbs": [
      "主页",
      "实用操作",
      "RMarkdown 入门"
    ]
  },
  {
    "objectID": "0011-rmarkdown.html#rmarkdown界面",
    "href": "0011-rmarkdown.html#rmarkdown界面",
    "title": "rmarkdown教程-初学r语言推荐",
    "section": "rmarkdown界面",
    "text": "rmarkdown界面\n\n\n先把yaml里的文档原属性进行修改，作者标题修改一下，后期如果要发布展示会显示在页面最上方\n用markdown语法新建大纲标题，用“#”符号，“#”符号越多，标题字号越小\n用快捷键“ctrl+alt+i”可以在当前位置插入代码块，用“ctrl+alt+o”可以在当前位置插入输出块\n尝试运行自己的代码吧",
    "crumbs": [
      "主页",
      "实用操作",
      "RMarkdown 入门"
    ]
  },
  {
    "objectID": "0011-rmarkdown.html#rticles包-rmarkdown模板",
    "href": "0011-rmarkdown.html#rticles包-rmarkdown模板",
    "title": "rmarkdown教程-初学r语言推荐",
    "section": "rticles包-rmarkdown模板",
    "text": "rticles包-rmarkdown模板\n安装rticles包之后，在新建rmd文件处就能看到不同的模板，选择一个模板，就可以生成一个模板文件，模板文件的内容和模板的内容是一样的，但是模板文件的内容更加完善，模板文件的内容可以直接运行，模板文件的内容可以导出为html、pdf、word等格式的文档，模板文件的内容可以在github上免费发布，也可以在rstudio上免费发布\n安装prettydoc包也是一样的效果",
    "crumbs": [
      "主页",
      "实用操作",
      "RMarkdown 入门"
    ]
  },
  {
    "objectID": "0011-rmarkdown.html#rmarkdown编译",
    "href": "0011-rmarkdown.html#rmarkdown编译",
    "title": "rmarkdown教程-初学r语言推荐",
    "section": "rmarkdown编译",
    "text": "rmarkdown编译\n代码完成后即可点击rstudio的“knit”按钮，即可编译，编译后会生成一个html文件，在html文件中可以看到代码的运行结果，同时也可以导出为pdf、word等格式的文档，导出的文档可以在github上免费发布，也可以在rstudio上免费发布",
    "crumbs": [
      "主页",
      "实用操作",
      "RMarkdown 入门"
    ]
  },
  {
    "objectID": "0011-rmarkdown.html#rmarkdown的块设置",
    "href": "0011-rmarkdown.html#rmarkdown的块设置",
    "title": "rmarkdown教程-初学r语言推荐",
    "section": "rmarkdown的块设置",
    "text": "rmarkdown的块设置\nrmarkdown主要是用于代码导出结果展示的包，同时在导出时我们会有侧重的设置某些代码块的运行。例如：设置一些块不运行，一些块运行但是不显示信息，一些块运行但是不报错，一些块运行但是不显示结果。\nrmd的块设置共有7种，Code evaluation、Results、Code Decoration、Chunks、Cache、Animation、Plots。看起来复杂，其实实际使用到的也就几个，大家先过一遍，以后慢慢熟悉。\n\n如何添加块设置\n在块头处和r用空格隔开，不同设置间用“,”隔开\n\n\n\nCode evaluation-设置块是否运行\n\neval参数 示例：“eval=F”\n可设置不运行代码,注意这里不运行代码\n\nprint('这是运行结果')\n\n\n\ninclude参数 示例：“include=F”\n这里其实是有代码的，但是带着输出被一起隐藏了（占位符）\n\n\nResults参数,设置结果输出\n\nprint(\"这是设置 result = 'hide'的运行结果,虽然运行了，但是不显示\")\n\n\n\ncollapse参数 ,为T表示代码和结果一起输出\n下方设置为F效果\n\nprint('这是运行结果')\n\n[1] \"这是运行结果\"\n\n\n\n\n\necho参数，输出文档是否显示代码\n设置为F之后，运行代码，但是只显示结果不显示代码\n\n\n[1] \"这是运行结果\"\n\n\n\n\nerror、warning、message为同一类参数，当代码中有警告或者错误信息时是否展示，如果为F时即不展示。\n\nprint('这是运行结果')\n\n[1] \"这是运行结果\"",
    "crumbs": [
      "主页",
      "实用操作",
      "RMarkdown 入门"
    ]
  },
  {
    "objectID": "0011-rmarkdown.html#更多教程",
    "href": "0011-rmarkdown.html#更多教程",
    "title": "rmarkdown教程-初学r语言推荐",
    "section": "更多教程",
    "text": "更多教程\n中间介绍了几个我常用的，更多的rmd教程可直接阅读官方的使用手册",
    "crumbs": [
      "主页",
      "实用操作",
      "RMarkdown 入门"
    ]
  },
  {
    "objectID": "0013-positron.html",
    "href": "0013-positron.html",
    "title": "Positron IDE 完全指南",
    "section": "",
    "text": "Positron 是由 Posit PBC（原 RStudio 公司）开发的下一代数据科学集成开发环境（IDE）。它的目标是结合 VS Code 的强大扩展与工程能力 以及 RStudio 的易用性与数据科学直觉。\n\n内核：基于 Code OSS (VS Code 的开源核心)，这意味着它天生拥有 VS Code 的所有优点（插件生态、Git 集成、多语言支持）。\n定位：它不是 RStudio 的继任者（RStudio 仍会长期维护），而是一个全新的、多语言（First-class R & Python support）的探索性编程环境。",
    "crumbs": [
      "主页",
      "实用操作",
      "Positron IDE 教程"
    ]
  },
  {
    "objectID": "0013-positron.html#下载与安装",
    "href": "0013-positron.html#下载与安装",
    "title": "Positron IDE 完全指南",
    "section": "1.1 下载与安装",
    "text": "1.1 下载与安装\nPositron 目前（2025/2026）仍处于活跃开发阶段（Public Beta），官方主要通过 GitHub 发布更新。\n\n下载地址：访问 Positron GitHub Releases 页面。\n版本选择：建议下载最新的 Pre-release 版本以体验最新功能。Windows 用户请下载 .exe 安装包。",
    "crumbs": [
      "主页",
      "实用操作",
      "Positron IDE 教程"
    ]
  },
  {
    "objectID": "0013-positron.html#解释器管理-interpreters",
    "href": "0013-positron.html#解释器管理-interpreters",
    "title": "Positron IDE 完全指南",
    "section": "1.2 解释器管理 (Interpreters)",
    "text": "1.2 解释器管理 (Interpreters)\n安装完成后，最重要的第一步是告诉 Positron 你的 R 和 Python 在哪里。Positron 拥有强大的自动发现机制。\n\n自动检测：启动时，Positron 会扫描系统路径、Conda 环境、Pyenv 等位置的解释器。\n手动切换：\n\n方法 A：点击窗口右上角的解释器版本号（例如 R 4.5.0 或 Python 3.12）。\n方法 B：按 F1 或 Ctrl+Shift+P 打开命令面板，输入 &gt; Positron: Select Interpreter。\n\n\n\n\n\n\n\n\nNote\n\n\n\n对于 Python 用户，Positron 会自动识别项目文件夹内的 .venv 或 conda 环境，并在打开项目时自动激活。",
    "crumbs": [
      "主页",
      "实用操作",
      "Positron IDE 教程"
    ]
  },
  {
    "objectID": "0013-positron.html#关键扩展推荐",
    "href": "0013-positron.html#关键扩展推荐",
    "title": "Positron IDE 完全指南",
    "section": "1.3 关键扩展推荐",
    "text": "1.3 关键扩展推荐\n由于 Positron 兼容 VS Code 插件市场（Open VSX 或微软市场），你可以通过左侧侧边栏的 Extensions 图标安装插件：\n\nChinese (Simplified): 搜索 “Chinese”，安装中文语言包，让界面变为中文。\nQuarto: 必装，提供 .qmd 文件的语法高亮、渲染预览支持。\nShiny: 如果开发 Shiny 应用，此插件提供运行和调试支持。\nRainbow CSV: 提供 CSV 文件的高亮显示，方便查看原始数据。",
    "crumbs": [
      "主页",
      "实用操作",
      "Positron IDE 教程"
    ]
  },
  {
    "objectID": "0013-positron.html#四大核心面板",
    "href": "0013-positron.html#四大核心面板",
    "title": "Positron IDE 完全指南",
    "section": "2.1 四大核心面板",
    "text": "2.1 四大核心面板\nPositron 将数据科学最常用的功能固化为四个核心区域：\n\n编辑器 (Editor):\n\n位于中间，编写代码的地方。支持分屏（Split）、Markdown 预览等。\n\n控制台 (Console):\n\nR Console: 纯正的 R 交互环境，支持 View() 等 RStudio 特有命令。\nPython Console (IPython): 基于 IPython，支持魔术命令（Magic Commands）。\n特点：即按即运行（Repl），支持多行输入。\n\n变量视窗 (Variables):\n\n这是 Positron 对比 VS Code 最大的改进之一。\n它清晰地列出了当前环境中的所有 DataFrame、List、Value。\n显示对象的类型（Type）、长度（Length）和简要内容。\n\n辅助面板 (Plots / Viewer / Help):\n\nPlots: 专门展示静态图片（ggplot2, matplotlib）。支持历史记录回看（左右箭头）。\nViewer: 展示 HTML 内容（Leaflet 地图, Plotly 交互图, Shiny 应用）。\nHelp: 内置的帮助文档浏览器，无需跳出 IDE 即可查看 ?mean。",
    "crumbs": [
      "主页",
      "实用操作",
      "Positron IDE 教程"
    ]
  },
  {
    "objectID": "0013-positron.html#数据浏览器-data-explorer",
    "href": "0013-positron.html#数据浏览器-data-explorer",
    "title": "Positron IDE 完全指南",
    "section": "2.2 数据浏览器 (Data Explorer)",
    "text": "2.2 数据浏览器 (Data Explorer)\n在 RStudio 中，我们习惯用 View(df) 查看数据。Positron 重新设计了这个功能：\n\n启动方式：在控制台输入 View(df)，或者在 Variables 面板中点击数据框旁边的表格图标。\n功能亮点：\n\n无限滚动：处理百万级行数据非常流畅。\n列统计：鼠标悬停在列名上，会显示该列的类型、缺失值数量、Min/Max 等统计信息。\n强大的筛选：点击每列的漏斗图标，可以进行多条件筛选（支持正则表达式）。",
    "crumbs": [
      "主页",
      "实用操作",
      "Positron IDE 教程"
    ]
  },
  {
    "objectID": "0013-positron.html#项目管理-workspace",
    "href": "0013-positron.html#项目管理-workspace",
    "title": "Positron IDE 完全指南",
    "section": "3.1 项目管理 (Workspace)",
    "text": "3.1 项目管理 (Workspace)\nPositron 沿用了 VS Code 的 “Folder as Project” 理念，但也引入了 R 用户习惯的机制。\n\n打开项目：File -&gt; Open Folder...。\nR Project (.Rproj): 如果文件夹内有 .Rproj 文件，Positron 会自动识别并以此作为工作目录根目录。无需像 RStudio 那样必须双击 .Rproj 启动，直接打开文件夹即可。",
    "crumbs": [
      "主页",
      "实用操作",
      "Positron IDE 教程"
    ]
  },
  {
    "objectID": "0013-positron.html#运行代码",
    "href": "0013-positron.html#运行代码",
    "title": "Positron IDE 完全指南",
    "section": "3.2 运行代码",
    "text": "3.2 运行代码\n掌握快捷键是提高效率的关键：\n\n\n\n\n\n\n\n\n动作\nWindows 快捷键\n说明\n\n\n\n\n运行当前行/选区\nCtrl + Enter\n最常用的命令，自动发送到对应的 Console\n\n\n运行整个文件\nCtrl + Shift + S\n类似于 RStudio 的 Source\n\n\n命令面板\nCtrl + Shift + P\n万能入口，搜索任何命令\n\n\n重启内核\n需绑定或通过菜单\nRestart R/Python Kernel",
    "crumbs": [
      "主页",
      "实用操作",
      "Positron IDE 教程"
    ]
  },
  {
    "objectID": "0013-positron.html#绘图与可视化",
    "href": "0013-positron.html#绘图与可视化",
    "title": "Positron IDE 完全指南",
    "section": "3.3 绘图与可视化",
    "text": "3.3 绘图与可视化\nPositron 对绘图窗口做了特殊优化：\n\n多图管理：多次绘图不会覆盖，而是像相册一样保留历史，通过 Plot 面板的左右箭头切换。\n导出：支持将当前图片导出为 PNG/SVG/PDF，或者复制到剪贴板（Copy to Clipboard）。",
    "crumbs": [
      "主页",
      "实用操作",
      "Positron IDE 教程"
    ]
  },
  {
    "objectID": "0013-positron.html#quarto-文档编写",
    "href": "0013-positron.html#quarto-文档编写",
    "title": "Positron IDE 完全指南",
    "section": "3.4 Quarto 文档编写",
    "text": "3.4 Quarto 文档编写\nPositron 是编写 Quarto (.qmd) 的绝佳工具：\n\n实时预览：点击编辑器右上角的 Preview 按钮，或者按 Ctrl + Shift + K (需设置快捷键)，Positron 会在右侧的 Viewer 面板或新窗口中通过 quarto preview 实时展示渲染结果。\nVisual Editor: 虽然目前主要支持源码编辑，但随着插件更新，未来会有更好的可视化编辑支持。",
    "crumbs": [
      "主页",
      "实用操作",
      "Positron IDE 教程"
    ]
  },
  {
    "objectID": "0013-positron.html#global-options-去哪了",
    "href": "0013-positron.html#global-options-去哪了",
    "title": "Positron IDE 完全指南",
    "section": "4.1 “Global Options” 去哪了？",
    "text": "4.1 “Global Options” 去哪了？\nVS Code/Positron 的配置极其灵活，主要通过 Settings 管理。\n\n访问：File -&gt; Preferences -&gt; Settings (或 Ctrl + ,)。\n搜索：直接在搜索框输入关键词，如 “font size”, “r path”。\nJSON 模式：点击右上角的书页图标，可以直接编辑 settings.json 文件，方便复制分享配置。",
    "crumbs": [
      "主页",
      "实用操作",
      "Positron IDE 教程"
    ]
  },
  {
    "objectID": "0013-positron.html#快捷键映射",
    "href": "0013-positron.html#快捷键映射",
    "title": "Positron IDE 完全指南",
    "section": "4.2 快捷键映射",
    "text": "4.2 快捷键映射\n并不习惯 VS Code 的默认键位？\n\n安装 RStudio Keymap 插件：在扩展市场搜索 “RStudio Keymap”，安装后可以将常用的快捷键（如 Alt + - 生成赋值号 &lt;-，Ctrl + Shift + M 生成管道符 %&gt;% 或 |&gt;）映射回熟悉的键位。",
    "crumbs": [
      "主页",
      "实用操作",
      "Positron IDE 教程"
    ]
  },
  {
    "objectID": "0013-positron.html#为什么没有-environment-面板",
    "href": "0013-positron.html#为什么没有-environment-面板",
    "title": "Positron IDE 完全指南",
    "section": "4.3 为什么没有 “Environment” 面板？",
    "text": "4.3 为什么没有 “Environment” 面板？\n有的，就是 Variables 面板。但它更现代化： * 它支持折叠嵌套的 List。 * 它对 Python 的 Pandas DataFrame 和 R 的 data.table 显示效果一样好。",
    "crumbs": [
      "主页",
      "实用操作",
      "Positron IDE 教程"
    ]
  },
  {
    "objectID": "1012-comparegroups.html",
    "href": "1012-comparegroups.html",
    "title": "compareGroups-描述性表一快速生成",
    "section": "",
    "text": "第95期 R语言教程！compareGroups神包制作描述性表一\n描述性表1在论文写作中占据着开篇起笔的作用。对所用的数据进行描述和简单分析，为后续的模型构建提供数据可靠性信息\n本期介绍如何使用compareGroups神包来快速生成符合学术规范的表1。并进行包括以下自定义设置：1.设置亚组 2.设置非正态变量使用非参组间检验 3.设置显示缺失值 4.设置显示OR值 5.设置使用自定义组间比较方法 6 数据导出",
    "crumbs": [
      "主页",
      "实用 R 包",
      "compareGroups - 描述性表"
    ]
  },
  {
    "objectID": "1012-comparegroups.html#r包介绍",
    "href": "1012-comparegroups.html#r包介绍",
    "title": "compareGroups-描述性表一快速生成",
    "section": "R包介绍",
    "text": "R包介绍\ncompareGroups 是一个在 CRAN 上可用的 R 包，它可以生成描述性表格，展示几个变量的均值、标准差、分位数或频率。此外，还会使用适当的测试计算 p 值来检验组间差异。\n通过简单的代码，就能在 R 中生成美观、规范且可直接用于论文发表的描述性表格。这些表格还可以导出到不同的格式，如 Word、Excel、PDF，或插入到 R-Sweave 或 R-markdown 文档中。\n在手册 https://cran.r-project.org/web/packages/compareGroups/vignettes/compareGroups_vignette.html里提供了非常友好的R包教程，描述了 compareGroups 的所有功能，并附有实际示例。",
    "crumbs": [
      "主页",
      "实用 R 包",
      "compareGroups - 描述性表"
    ]
  },
  {
    "objectID": "1012-comparegroups.html#r包安装",
    "href": "1012-comparegroups.html#r包安装",
    "title": "compareGroups-描述性表一快速生成",
    "section": "R包安装",
    "text": "R包安装\n从CRAN中安装R包\n\ninstall.packages(\"compareGroups\") \n\n或者从github安装最新版本\n\nlibrary(devtools) \ndevtools::install_github(\"isubirana/compareGroups\")",
    "crumbs": [
      "主页",
      "实用 R 包",
      "compareGroups - 描述性表"
    ]
  },
  {
    "objectID": "1012-comparegroups.html#r包参数",
    "href": "1012-comparegroups.html#r包参数",
    "title": "compareGroups-描述性表一快速生成",
    "section": "R包参数",
    "text": "R包参数\n\n查看数据\n(不重要可以不看，知道是包含多种数据类型的数据集即可)调用R包自带的regicor数据，包含25个变量。regicor（吉罗纳心脏登记）研究是一项横断面研究，参与者来自西班牙东北部地区。在此研究中，收集了参与者的各种数据集，包括人口统计信息（如年龄和性别）、人体测量数据（如身高、体重和腰围）以及脂质水平（包括总胆固醇和甘油三酯）。此外，参与者还完成了涵盖体育活动和生活质量等领域的问卷。\n为了追踪健康结果，研究还收集了关于心血管事件和死亡的数据。这些信息是通过医院和官方登记册及报告，在超过10年的时间里获得的。\n\nlibrary(compareGroups)\nlibrary(bruceR) #之前有介绍过，方便描述数据\n\n\n# 方便起见，我们只分析前十个变量\ndata(\"regicor\")\n\nregicor &lt;- regicor[,1:10]\n\nstr(regicor)\n\n'data.frame':   2294 obs. of  10 variables:\n $ id     : num  2.26e+03 1.88e+03 3.00e+09 3.00e+09 3.00e+09 ...\n  ..- attr(*, \"label\")= Named chr \"Individual id\"\n  .. ..- attr(*, \"names\")= chr \"id\"\n $ year   : Factor w/ 3 levels \"1995\",\"2000\",..: 3 3 2 2 2 2 2 1 3 1 ...\n  ..- attr(*, \"label\")= Named chr \"Recruitment year\"\n  .. ..- attr(*, \"names\")= chr \"year\"\n $ age    : int  70 56 37 69 70 40 66 53 43 70 ...\n  ..- attr(*, \"label\")= Named chr \"Age\"\n  .. ..- attr(*, \"names\")= chr \"age\"\n $ sex    : Factor w/ 2 levels \"Male\",\"Female\": 2 2 1 2 2 2 1 2 2 1 ...\n  ..- attr(*, \"label\")= chr \"Sex\"\n $ smoker : Factor w/ 3 levels \"Never smoker\",..: 1 1 2 1 NA 2 1 1 3 3 ...\n  ..- attr(*, \"label\")= Named chr \"Smoking status\"\n  .. ..- attr(*, \"names\")= chr \"smoker\"\n $ sbp    : int  138 139 132 168 NA 108 120 132 95 142 ...\n  ..- attr(*, \"label\")= Named chr \"Systolic blood pressure\"\n  .. ..- attr(*, \"names\")= chr \"sbp\"\n $ dbp    : int  75 89 82 97 NA 70 72 78 65 78 ...\n  ..- attr(*, \"label\")= Named chr \"Diastolic blood pressure\"\n  .. ..- attr(*, \"names\")= chr \"dbp\"\n $ histhtn: Factor w/ 2 levels \"Yes\",\"No\": 2 2 2 2 2 2 1 2 2 2 ...\n  ..- attr(*, \"label\")= Named chr \"History of hypertension\"\n  .. ..- attr(*, \"names\")= chr \"histbp\"\n $ txhtn  : Factor w/ 2 levels \"No\",\"Yes\": 1 1 1 1 1 1 2 1 1 1 ...\n  ..- attr(*, \"label\")= chr \"Hypertension treatment\"\n $ chol   : num  294 220 245 168 NA NA 298 254 194 188 ...\n  ..- attr(*, \"label\")= Named chr \"Total cholesterol\"\n  .. ..- attr(*, \"names\")= chr \"chol\"\n\n\n\n\n生成描述性统计表\n简单生成一个最简单的描述性统计表，发现定量资料用平均值标准差描述，分类资料用例数和占比描述\n\ndescrTable( ~ ., data = regicor)\n\n\n--------Summary descriptives table ---------\n\n_______________________________________________________ \n                                    [ALL]           N   \n                                   N=2294               \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \nIndividual id              1215817624 (1339538686) 2294 \nRecruitment year:                                  2294 \n    1995                         431 (18.8%)            \n    2000                         786 (34.3%)            \n    2005                        1077 (46.9%)            \nAge                              54.7 (11.0)       2294 \nSex:                                               2294 \n    Male                        1101 (48.0%)            \n    Female                      1193 (52.0%)            \nSmoking status:                                    2233 \n    Never smoker                1201 (53.8%)            \n    Current or former &lt; 1y       593 (26.6%)            \n    Former &gt;= 1y                 439 (19.7%)            \nSystolic blood pressure          131 (20.3)        2280 \nDiastolic blood pressure         79.7 (10.5)       2280 \nHistory of hypertension:                           2286 \n    Yes                          723 (31.6%)            \n    No                          1563 (68.4%)            \nHypertension treatment:                            2251 \n    No                          1823 (81.0%)            \n    Yes                          428 (19.0%)            \nTotal cholesterol                219 (45.2)        2193 \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \n\n\n\n\n设置分组变量\n根据吸烟情况将人群分为三组，同时生成组间比较列（p.overall）。自动使用卡方检验(分类变量)和方差分析(计量资料：两类时等价t检验)。\n\ndescrTable(`smoker`~ ., data = regicor)\n\n\n--------Summary descriptives table by 'Smoking status'---------\n\n_________________________________________________________________________________________________________ \n                              Never smoker       Current or former &lt; 1y       Former &gt;= 1y      p.overall \n                                 N=1201                   N=593                  N=439                    \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \nIndividual id            1229013133 (1337342152) 1534618659 (1372769742) 690225475 (1126583145)  &lt;0.001   \nRecruitment year:                                                                                &lt;0.001   \n    1995                       234 (19.5%)             109 (18.4%)             72 (16.4%)                 \n    2000                       414 (34.5%)             267 (45.0%)             77 (17.5%)                 \n    2005                       553 (46.0%)             217 (36.6%)            290 (66.1%)                 \nAge                            56.5 (10.8)             50.6 (10.7)            55.3 (10.6)        &lt;0.001   \nSex:                                                                                             &lt;0.001   \n    Male                       301 (25.1%)             410 (69.1%)            360 (82.0%)                 \n    Female                     900 (74.9%)             183 (30.9%)             79 (18.0%)                 \nSystolic blood pressure        132 (20.5)              128 (19.8)              133 (19.7)        &lt;0.001   \nDiastolic blood pressure       79.5 (10.2)             78.8 (11.0)            81.2 (10.8)         0.002   \nHistory of hypertension:                                                                         &lt;0.001   \n    Yes                        421 (35.1%)             125 (21.2%)            162 (36.9%)                 \n    No                         777 (64.9%)             464 (78.8%)            277 (63.1%)                 \nHypertension treatment:                                                                          &lt;0.001   \n    No                         922 (77.9%)             525 (90.2%)            331 (77.2%)                 \n    Yes                        262 (22.1%)             57 (9.79%)              98 (22.8%)                 \nTotal cholesterol              220 (46.7)              219 (44.7)              214 (42.6)         0.030   \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \n\n\n\n\n删除某些变量不显示\n如不希望描述性统计对Id和year进行描述，直接在~右侧的.后使用减号进行删除（如需要的变量比较少，也可以手动写公式一个个加）\n\ndescrTable(`smoker`~ .-id-year, data = regicor)\n\n\n--------Summary descriptives table by 'Smoking status'---------\n\n___________________________________________________________________________________ \n                         Never smoker Current or former &lt; 1y Former &gt;= 1y p.overall \n                            N=1201            N=593             N=439               \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \nAge                      56.5 (10.8)       50.6 (10.7)       55.3 (10.6)   &lt;0.001   \nSex:                                                                       &lt;0.001   \n    Male                 301 (25.1%)       410 (69.1%)       360 (82.0%)            \n    Female               900 (74.9%)       183 (30.9%)        79 (18.0%)            \nSystolic blood pressure   132 (20.5)        128 (19.8)        133 (19.7)   &lt;0.001   \nDiastolic blood pressure 79.5 (10.2)       78.8 (11.0)       81.2 (10.8)    0.002   \nHistory of hypertension:                                                   &lt;0.001   \n    Yes                  421 (35.1%)       125 (21.2%)       162 (36.9%)            \n    No                   777 (64.9%)       464 (78.8%)       277 (63.1%)            \nHypertension treatment:                                                    &lt;0.001   \n    No                   922 (77.9%)       525 (90.2%)       331 (77.2%)            \n    Yes                  262 (22.1%)        57 (9.79%)        98 (22.8%)            \nTotal cholesterol         220 (46.7)        219 (44.7)        214 (42.6)    0.030   \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \n\n\n\n\n亚组描述\nsubset=(逻辑判断)来挑选出男性患者进行分析\n\ndescrTable(`smoker`~ .-id-year-sex, data = regicor,\n           subset=(sex==\"Male\"))\n\n\n--------Summary descriptives table by 'smoker'---------\n\n___________________________________________________________________________________ \n                         Never smoker Current or former &lt; 1y Former &gt;= 1y p.overall \n                            N=301             N=410             N=360               \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \nAge                      55.0 (11.5)       52.7 (11.0)       56.8 (10.5)   &lt;0.001   \nSystolic blood pressure   133 (18.5)        133 (19.0)        136 (19.0)    0.050   \nDiastolic blood pressure 81.3 (9.31)       81.2 (10.6)       82.3 (10.4)    0.263   \nHistory of hypertension:                                                   &lt;0.001   \n    Yes                   85 (28.4%)       101 (24.8%)       145 (40.3%)            \n    No                   214 (71.6%)       306 (75.2%)       215 (59.7%)            \nHypertension treatment:                                                    &lt;0.001   \n    No                   248 (83.5%)       357 (88.4%)       263 (75.1%)            \n    Yes                   49 (16.5%)        47 (11.6%)        87 (24.9%)            \nTotal cholesterol         213 (44.0)        221 (41.9)        216 (43.3)    0.061   \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \n\n\n\n\n自定义设置分组检验方法\n设置mehtod参数值，如果不设置，默认所有变量符合正态分布。修改age为非正态后使用四分位数进行描述，同时使用非参检验进行分组比较\n\n参数值为1：正态分布分析 ：此值强制分析假设行变量遵循正态分布。\n参数值为2：连续非正态分析 ：选择此值意味着分析不假设行变量遵循正态分布，将其视为连续但非正态分布的变量。\n参数值为3：分类分析：此值强制分析将行变量视为分类变量，无论其原始类型如何。\n参数值为4：Shapiro-Wilks检验 （正态检验）：使用此值触发Shapiro-Wilks检验，以确定变量是否应在正态性假设下进行分析，还是非正态。这对于根据数据做出如何处理每个变量的决策非常有用。\n\n\n# descrTable(`smoker`~ .-id-year, data = regicor,method = 1) 假定所有变量符合正态分布\n\n#设置age变量为非正态，使用非参检验进行比较\ndescrTable(`sex`~ .-id-year, data = regicor, method=c(age = 2))\n\n\n--------Summary descriptives table by 'Sex'---------\n\n______________________________________________________________________ \n                                 Male            Female      p.overall \n                                N=1101           N=1193                \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \nAge                        54.0 [46.0;64.0] 55.0 [46.0;64.0]   0.851   \nSmoking status:                                               &lt;0.001   \n    Never smoker             301 (28.1%)      900 (77.5%)              \n    Current or former &lt; 1y   410 (38.3%)      183 (15.7%)              \n    Former &gt;= 1y             360 (33.6%)       79 (6.80%)              \nSystolic blood pressure       134 (18.9)       129 (21.2)     &lt;0.001   \nDiastolic blood pressure     81.7 (10.2)      77.8 (10.5)     &lt;0.001   \nHistory of hypertension:                                       0.644   \n    Yes                      341 (31.1%)      382 (32.1%)              \n    No                       755 (68.9%)      808 (67.9%)              \nHypertension treatment:                                        0.096   \n    No                       889 (82.5%)      934 (79.6%)              \n    Yes                      189 (17.5%)      239 (20.4%)              \nTotal cholesterol             217 (42.7)       220 (47.4)      0.140   \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \n\n\n\n\n不显示标签label值\n有些数据集自带label，可以通过include.label设置是否显示标签\n\ndescrTable(`sex`~ .-id-year, data = regicor, include.label= FALSE)\n\n\n--------Summary descriptives table by 'sex'---------\n\n____________________________________________________________ \n                              Male       Female    p.overall \n                             N=1101      N=1193              \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \nage                        54.8 (11.1) 54.7 (11.0)   0.840   \nsmoker:                                             &lt;0.001   \n    Never smoker           301 (28.1%) 900 (77.5%)           \n    Current or former &lt; 1y 410 (38.3%) 183 (15.7%)           \n    Former &gt;= 1y           360 (33.6%) 79 (6.80%)            \nsbp                        134 (18.9)  129 (21.2)   &lt;0.001   \ndbp                        81.7 (10.2) 77.8 (10.5)  &lt;0.001   \nhisthtn:                                             0.644   \n    Yes                    341 (31.1%) 382 (32.1%)           \n    No                     755 (68.9%) 808 (67.9%)           \ntxhtn:                                               0.096   \n    No                     889 (82.5%) 934 (79.6%)           \n    Yes                    189 (17.5%) 239 (20.4%)           \nchol                       217 (42.7)  220 (47.4)    0.140   \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \n\n\n\n\n设置计量资料用四分位法描述\n设置Q1参数和Q3参数设置如何描述非正态连续变量。如果设置成0和1就是最小值最大值描述\n\ndescrTable(`sex`~ .-id-year, data = regicor,method = c(age=2),\n           Q1=0.025, Q3=0.975)\n\n\n--------Summary descriptives table by 'Sex'---------\n\n______________________________________________________________________ \n                                 Male            Female      p.overall \n                                N=1101           N=1193                \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \nAge                        54.0 [36.0;73.0] 55.0 [36.0;73.0]   0.851   \nSmoking status:                                               &lt;0.001   \n    Never smoker             301 (28.1%)      900 (77.5%)              \n    Current or former &lt; 1y   410 (38.3%)      183 (15.7%)              \n    Former &gt;= 1y             360 (33.6%)       79 (6.80%)              \nSystolic blood pressure       134 (18.9)       129 (21.2)     &lt;0.001   \nDiastolic blood pressure     81.7 (10.2)      77.8 (10.5)     &lt;0.001   \nHistory of hypertension:                                       0.644   \n    Yes                      341 (31.1%)      382 (32.1%)              \n    No                       755 (68.9%)      808 (67.9%)              \nHypertension treatment:                                        0.096   \n    No                       889 (82.5%)      934 (79.6%)              \n    Yes                      189 (17.5%)      239 (20.4%)              \nTotal cholesterol             217 (42.7)       220 (47.4)      0.140   \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \n\n\n\n\n生成OR和HR值\n使用show.ratio变量来显示OR值，对于变量类型是time-to-event变量则输出HR值\n\n descrTable(`sex`~ .-id-year, data = regicor,show.ratio = TRUE)\n\n\n--------Summary descriptives table by 'Sex'---------\n\n_____________________________________________________________________________________ \n                              Male       Female           OR        p.ratio p.overall \n                             N=1101      N=1193                                       \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \nAge                        54.8 (11.1) 54.7 (11.0) 1.00 [0.99;1.01]  0.840    0.840   \nSmoking status:                                                              &lt;0.001   \n    Never smoker           301 (28.1%) 900 (77.5%)       Ref.        Ref.             \n    Current or former &lt; 1y 410 (38.3%) 183 (15.7%) 0.15 [0.12;0.19]  0.000            \n    Former &gt;= 1y           360 (33.6%) 79 (6.80%)  0.07 [0.06;0.10]  0.000            \nSystolic blood pressure    134 (18.9)  129 (21.2)  0.99 [0.98;0.99] &lt;0.001   &lt;0.001   \nDiastolic blood pressure   81.7 (10.2) 77.8 (10.5) 0.96 [0.96;0.97] &lt;0.001   &lt;0.001   \nHistory of hypertension:                                                      0.644   \n    Yes                    341 (31.1%) 382 (32.1%)       Ref.        Ref.             \n    No                     755 (68.9%) 808 (67.9%) 0.96 [0.80;1.14]  0.612            \nHypertension treatment:                                                       0.096   \n    No                     889 (82.5%) 934 (79.6%)       Ref.        Ref.             \n    Yes                    189 (17.5%) 239 (20.4%) 1.20 [0.97;1.49]  0.086            \nTotal cholesterol          217 (42.7)  220 (47.4)  1.00 [1.00;1.00]  0.141    0.140   \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \n\n\n\n设置OR值的ref对照\n使用ref参数设置变量的ref对照值。代码所示为把smoker的因子level为3（值为”Former&gt;=1y”）的设置为对照组计算其它组的OR值\n同样作用的函数还有ref.no 和 ref.y\n\ndescrTable(`sex`~ .-id-year, data = regicor,\n           include.label = FALSE,show.ratio = TRUE,\n           ref = c(smoker=3))\n\n\n--------Summary descriptives table by 'sex'---------\n\n_____________________________________________________________________________________ \n                              Male       Female           OR        p.ratio p.overall \n                             N=1101      N=1193                                       \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \nage                        54.8 (11.1) 54.7 (11.0) 1.00 [0.99;1.01]  0.840    0.840   \nsmoker:                                                                      &lt;0.001   \n    Never smoker           301 (28.1%) 900 (77.5%) 13.6 [10.4;18.0]  0.000            \n    Current or former &lt; 1y 410 (38.3%) 183 (15.7%) 2.03 [1.51;2.75] &lt;0.001            \n    Former &gt;= 1y           360 (33.6%) 79 (6.80%)        Ref.        Ref.             \nsbp                        134 (18.9)  129 (21.2)  0.99 [0.98;0.99] &lt;0.001   &lt;0.001   \ndbp                        81.7 (10.2) 77.8 (10.5) 0.96 [0.96;0.97] &lt;0.001   &lt;0.001   \nhisthtn:                                                                      0.644   \n    Yes                    341 (31.1%) 382 (32.1%)       Ref.        Ref.             \n    No                     755 (68.9%) 808 (67.9%) 0.96 [0.80;1.14]  0.612            \ntxhtn:                                                                        0.096   \n    No                     889 (82.5%) 934 (79.6%)       Ref.        Ref.             \n    Yes                    189 (17.5%) 239 (20.4%) 1.20 [0.97;1.49]  0.086            \nchol                       217 (42.7)  220 (47.4)  1.00 [1.00;1.00]  0.141    0.140   \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \n\n\n\n\n\n不显示对照组的描述信息\n使用hide.no来隐藏某些因子水平的描述。常用来隐藏掉2分类变量的否的信息\n\n descrTable(`sex`~ .-id-year, data = regicor,hide.no = \"No\")\n\n\n--------Summary descriptives table by 'Sex'---------\n\n____________________________________________________________ \n                              Male       Female    p.overall \n                             N=1101      N=1193              \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \nAge                        54.8 (11.1) 54.7 (11.0)   0.840   \nSmoking status:                                     &lt;0.001   \n    Never smoker           301 (28.1%) 900 (77.5%)           \n    Current or former &lt; 1y 410 (38.3%) 183 (15.7%)           \n    Former &gt;= 1y           360 (33.6%) 79 (6.80%)            \nSystolic blood pressure    134 (18.9)  129 (21.2)   &lt;0.001   \nDiastolic blood pressure   81.7 (10.2) 77.8 (10.5)  &lt;0.001   \nHistory of hypertension    341 (31.1%) 382 (32.1%)   0.644   \nHypertension treatment     189 (17.5%) 239 (20.4%)   0.096   \nTotal cholesterol          217 (42.7)  220 (47.4)    0.140   \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \n\n\n\n\n同时显示总人群的描述\n\ndescrTable(`sex`~ .-id-year, data = regicor,show.all = TRUE)\n\n\n--------Summary descriptives table by 'Sex'---------\n\n_________________________________________________________________________ \n                              [ALL]        Male       Female    p.overall \n                              N=2294      N=1101      N=1193              \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \nAge                        54.7 (11.0)  54.8 (11.1) 54.7 (11.0)   0.840   \nSmoking status:                                                  &lt;0.001   \n    Never smoker           1201 (53.8%) 301 (28.1%) 900 (77.5%)           \n    Current or former &lt; 1y 593 (26.6%)  410 (38.3%) 183 (15.7%)           \n    Former &gt;= 1y           439 (19.7%)  360 (33.6%) 79 (6.80%)            \nSystolic blood pressure     131 (20.3)  134 (18.9)  129 (21.2)   &lt;0.001   \nDiastolic blood pressure   79.7 (10.5)  81.7 (10.2) 77.8 (10.5)  &lt;0.001   \nHistory of hypertension:                                          0.644   \n    Yes                    723 (31.6%)  341 (31.1%) 382 (32.1%)           \n    No                     1563 (68.4%) 755 (68.9%) 808 (67.9%)           \nHypertension treatment:                                           0.096   \n    No                     1823 (81.0%) 889 (82.5%) 934 (79.6%)           \n    Yes                    428 (19.0%)  189 (17.5%) 239 (20.4%)           \nTotal cholesterol           219 (45.2)  217 (42.7)  220 (47.4)    0.140   \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \n\n\n\n\n结果导出\n可导出各种格式,export2xls, export2latex, export2pdf, export2csv, export2md, export2word\n\nexport2word(tab_0,file=\"1 data_summary.docx\")\n\n\n\n快速可视化\n使用plot函数进行可视化，设置file和type参数进行保存例如\nplot(res[c(1,2)], file=“./figures/univar/”, type=“png”)\n\ntab0 &lt;- descrTable(`sex`~ .-id-year, data = regicor)\n\nplot(tab0)",
    "crumbs": [
      "主页",
      "实用 R 包",
      "compareGroups - 描述性表"
    ]
  },
  {
    "objectID": "1014-purrr.html",
    "href": "1014-purrr.html",
    "title": "purrr: 函数式编程,彻底摆脱for循环",
    "section": "",
    "text": "purrr 通过提供一套完整且一致的用于处理函数和向量的工具来增强 R 的函数式编程 (FP) 工具包。如果您以前从未听说过 FP，那么最好的起点是map()函数系列，它允许您用更简洁、更易于阅读的代码替换许多 for 循环。\n听起来有点复杂，但更简单来说，就是用嵌套函数来替代for循环的冗长的框架结构。让输入输出更简单。\n相关教程：官网网站",
    "crumbs": [
      "主页",
      "实用 R 包",
      "purrr - 函数式编程"
    ]
  },
  {
    "objectID": "1014-purrr.html#r包介绍",
    "href": "1014-purrr.html#r包介绍",
    "title": "purrr: 函数式编程,彻底摆脱for循环",
    "section": "",
    "text": "purrr 通过提供一套完整且一致的用于处理函数和向量的工具来增强 R 的函数式编程 (FP) 工具包。如果您以前从未听说过 FP，那么最好的起点是map()函数系列，它允许您用更简洁、更易于阅读的代码替换许多 for 循环。\n听起来有点复杂，但更简单来说，就是用嵌套函数来替代for循环的冗长的框架结构。让输入输出更简单。\n相关教程：官网网站",
    "crumbs": [
      "主页",
      "实用 R 包",
      "purrr - 函数式编程"
    ]
  },
  {
    "objectID": "1014-purrr.html#r包安装",
    "href": "1014-purrr.html#r包安装",
    "title": "purrr: 函数式编程,彻底摆脱for循环",
    "section": "R包安装",
    "text": "R包安装\n\ninstall.packages(\"purrr\")",
    "crumbs": [
      "主页",
      "实用 R 包",
      "purrr - 函数式编程"
    ]
  },
  {
    "objectID": "1014-purrr.html#语法",
    "href": "1014-purrr.html#语法",
    "title": "purrr: 函数式编程,彻底摆脱for循环",
    "section": "语法",
    "text": "语法\npurrr系列函数都以map，map2和pmap作为大类，搭配更多的后缀来设定输出类型。\n\nmap(.x, .f)：输入一个向量(.x)，以该向量为输入进行循环(.f函数循环)\nmap(.x, .f)：输入两个向量\nmap3(.x, .f)：输入n（大于2）向量\n\n这里边的向量是比较广的向量，包含向量，列表，字符串，数据框（可以看作向量的向量），只要有这种顺序结构的都可以作为map的输入",
    "crumbs": [
      "主页",
      "实用 R 包",
      "purrr - 函数式编程"
    ]
  },
  {
    "objectID": "1014-purrr.html#举个栗子",
    "href": "1014-purrr.html#举个栗子",
    "title": "purrr: 函数式编程,彻底摆脱for循环",
    "section": "举个栗子",
    "text": "举个栗子\n\n加载数据\n\nlibrary(tidyverse)\nlibrary(purrr)\n\n\ndata &lt;- mtcars\n\nhead(data, 5)\n\n                   mpg cyl disp  hp drat    wt  qsec vs am gear carb\nMazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4\nMazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4\nDatsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1\nHornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1\nHornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2\n\n\n\n\n使用tidyverse结构和purrr来划分数据分别做回归\n我们现在想根据cyl对数据框进行划分，在分出来的数据框中做回归，然后把回归结果放到一个数字向量里\n\ndata |&gt; \n  split(data$cyl) |&gt;  # 划分数据\n  map(\\(df) lm(mpg ~ wt, data = df)) |&gt; #分别做循环\n  map(summary) %&gt;%  #对结果做summary\n  map_dbl(\"r.squared\")\n\n        4         6         8 \n0.5086326 0.4645102 0.4229655 \n\n\n查看以下代码，发现了什么？\n\npurrr循环的第一个参数始终是数据，因此 purrr 可以自然地与管道配合使用。\nmap_xxx（map的后缀相当于自定义了输出类型）\n\n\n\n常规方法来做这个模型\n\nvar &lt;- c(\"disp\", \"hp\", \"drat\")\n\ndata_list &lt;- split(data, mtcars$cyl)\n\nvec_result = c()\nfor (temp_data in data_list) {\n    model = lm(mpg ~ wt, data = temp_data)\n    model_summary = summary(model)\n    r2 = model_summary$\"r.squared\"\n    vec_result = c(vec_result, r2)\n}\n\nprint(vec_result)\n\n[1] 0.5086326 0.4645102 0.4229655\n\n\n发现了什么\n\n代码行数多了很多\n多了一些中间变量\n代码可读性差，很不优雅",
    "crumbs": [
      "主页",
      "实用 R 包",
      "purrr - 函数式编程"
    ]
  },
  {
    "objectID": "1014-purrr.html#多变量索引循环",
    "href": "1014-purrr.html#多变量索引循环",
    "title": "purrr: 函数式编程,彻底摆脱for循环",
    "section": "多变量索引循环",
    "text": "多变量索引循环\n如果是想用多个向量来索引循环，输入多个向量，我们要怎么做呢。举一个简单的例子就知道了。\n\nvar1 &lt;- c(\"disp\", \"hp\", \"drat\")\nvar2 &lt;- c(\"wt\", \"qsec\", \"vs\")\nvar_add &lt;- map2(var1, var2, \\(x, y) paste0(x, \"+\", y))\nprint(var_add)\n\n[[1]]\n[1] \"disp+wt\"\n\n[[2]]\n[1] \"hp+qsec\"\n\n[[3]]\n[1] \"drat+vs\"\n\n\n再举个例子\n\nmeans &lt;- 1:4\nsds &lt;- 1:4\nset.seed(2020)\nsamples &lt;- map2(means, sds, \\(mean, sds){rnorm(mean, sds, n = 5)})\n\n#这里也可以写为，如下，不过有时候想要更复杂的操作就不要用这种简化的写法\n#samples &lt;- map2(means, sds, rnorm, n = 5)\nstr(samples)\n\nList of 4\n $ : num [1:5] 1.377 1.302 -0.098 -0.13 -1.797\n $ : num [1:5] 3.44 3.88 1.54 5.52 2.23\n $ : num [1:5] 0.441 5.728 6.589 1.885 2.63\n $ : num [1:5] 11.2 10.82 -8.16 -5.16 4.23\n\n\n如果输入的是多个向量可以参考如下\n\nvar3 &lt;- c(\"disp\", \"hp\", \"drat\")\n\nvar4 &lt;- c(\"wt\", \"qsec\", \"vs\")\n\n#使用pmap的时候，把多个向量放到list框里作为第一个参数\npvar_add &lt;- pmap(list(var1, var2, var3, var4), \n            \\(x, y, z, p) \n            paste0(x, \"+\", y, \"+\", z, \"+\", \"p\"))\n\nprint(pvar_add)\n\n[[1]]\n[1] \"disp+wt+disp+p\"\n\n[[2]]\n[1] \"hp+qsec+hp+p\"\n\n[[3]]\n[1] \"drat+vs+drat+p\"\n\n\n注意：这里用的都是简单的字符向量，但我们使用的时候可以自由拓展到数据框和列表等复杂向量结构，就能感觉到purrr循环的魅力了",
    "crumbs": [
      "主页",
      "实用 R 包",
      "purrr - 函数式编程"
    ]
  },
  {
    "objectID": "1014-purrr.html#嵌套循环",
    "href": "1014-purrr.html#嵌套循环",
    "title": "purrr: 函数式编程,彻底摆脱for循环",
    "section": "嵌套循环",
    "text": "嵌套循环\n如果是嵌套结构我们怎么用purrr来做呢，其实也很简单。我们现在来算一下1：10分别乘以10:20然后放到一个数字向量里怎么实现吧\n\nmap(1:10, \n        \\(x){map(10:20, \n        \\(y){x*y})}) |&gt; \n    unlist()\n\n  [1]  10  11  12  13  14  15  16  17  18  19  20  20  22  24  26  28  30  32\n [19]  34  36  38  40  30  33  36  39  42  45  48  51  54  57  60  40  44  48\n [37]  52  56  60  64  68  72  76  80  50  55  60  65  70  75  80  85  90  95\n [55] 100  60  66  72  78  84  90  96 102 108 114 120  70  77  84  91  98 105\n [73] 112 119 126 133 140  80  88  96 104 112 120 128 136 144 152 160  90  99\n [91] 108 117 126 135 144 153 162 171 180 100 110 120 130 140 150 160 170 180\n[109] 190 200\n\n\n举得例子比较没有意义，但是可以在此基础上一窥嵌套循环的实现。",
    "crumbs": [
      "主页",
      "实用 R 包",
      "purrr - 函数式编程"
    ]
  },
  {
    "objectID": "1014-purrr.html#更多",
    "href": "1014-purrr.html#更多",
    "title": "purrr: 函数式编程,彻底摆脱for循环",
    "section": "更多",
    "text": "更多\npurrr可以快捷实现很多高级操作，比如批量导入数据，批量绘图以及批量建模等，后续分开写吧。这一期写得很宽泛，大家可以自己去探索更多操作。",
    "crumbs": [
      "主页",
      "实用 R 包",
      "purrr - 函数式编程"
    ]
  },
  {
    "objectID": "1018-psm.html",
    "href": "1018-psm.html",
    "title": "倾向性得分匹配 - 因果推断的利器",
    "section": "",
    "text": "倾向性得分匹配 (Propensity Score Matching, PSM) 是一种用于观察性研究中控制混杂因素、估计因果效应的统计方法。\n\n\n\n在随机对照试验 (RCT) 中，随机分组确保了处理组和对照组在基线特征上的可比性。但在观察性研究中，我们无法随机分配处理，导致：\n\n处理组和对照组可能存在系统性差异\n直接比较结局会产生选择偏倚\n无法区分是”处理效应”还是”基线差异”导致的结果差异\n\nPSM 的核心思想：找到在”接受处理的概率”上相似的个体进行配对，从而模拟随机化实验。\n\n\n\n\n\n\n\n\n\n\n\n概念\n定义\n公式\n\n\n\n\n倾向性得分\n给定协变量 X 时，个体接受处理的条件概率\n\\(e(X) = P(T=1|X)\\)\n\n\n平衡性\n匹配后处理组与对照组协变量分布相似\n\\(X \\perp T | e(X)\\)\n\n\nATE\n平均处理效应 (Average Treatment Effect)\n\\(E[Y(1) - Y(0)]\\)\n\n\nATT\n处理组平均处理效应\n\\(E[Y(1) - Y(0) | T=1]\\)"
  },
  {
    "objectID": "1018-psm.html#什么是倾向性得分匹配",
    "href": "1018-psm.html#什么是倾向性得分匹配",
    "title": "倾向性得分匹配 - 因果推断的利器",
    "section": "",
    "text": "倾向性得分匹配 (Propensity Score Matching, PSM) 是一种用于观察性研究中控制混杂因素、估计因果效应的统计方法。\n\n\n\n在随机对照试验 (RCT) 中，随机分组确保了处理组和对照组在基线特征上的可比性。但在观察性研究中，我们无法随机分配处理，导致：\n\n处理组和对照组可能存在系统性差异\n直接比较结局会产生选择偏倚\n无法区分是”处理效应”还是”基线差异”导致的结果差异\n\nPSM 的核心思想：找到在”接受处理的概率”上相似的个体进行配对，从而模拟随机化实验。\n\n\n\n\n\n\n\n\n\n\n\n概念\n定义\n公式\n\n\n\n\n倾向性得分\n给定协变量 X 时，个体接受处理的条件概率\n\\(e(X) = P(T=1|X)\\)\n\n\n平衡性\n匹配后处理组与对照组协变量分布相似\n\\(X \\perp T | e(X)\\)\n\n\nATE\n平均处理效应 (Average Treatment Effect)\n\\(E[Y(1) - Y(0)]\\)\n\n\nATT\n处理组平均处理效应\n\\(E[Y(1) - Y(0) | T=1]\\)"
  },
  {
    "objectID": "1018-psm.html#安装与加载",
    "href": "1018-psm.html#安装与加载",
    "title": "倾向性得分匹配 - 因果推断的利器",
    "section": "🛠 安装与加载",
    "text": "🛠 安装与加载\n\n# 核心包\nlibrary(MatchIt)      # PSM 主力包\nlibrary(cobalt)       # 平衡性诊断\nlibrary(marginaleffects)  # 效应估计\n\n# 辅助包\nlibrary(tidyverse)\nlibrary(gtsummary)\nlibrary(ggplot2)"
  },
  {
    "objectID": "1018-psm.html#psm-完整流程",
    "href": "1018-psm.html#psm-完整流程",
    "title": "倾向性得分匹配 - 因果推断的利器",
    "section": "💡 PSM 完整流程",
    "text": "💡 PSM 完整流程\nPSM 分析包含 5 个关键步骤：\n1. 数据准备 → 2. 估计倾向性得分 → 3. 匹配 → 4. 平衡性检验 → 5. 效应估计"
  },
  {
    "objectID": "1018-psm.html#实战案例吸烟对出生体重的影响",
    "href": "1018-psm.html#实战案例吸烟对出生体重的影响",
    "title": "倾向性得分匹配 - 因果推断的利器",
    "section": "📊 实战案例：吸烟对出生体重的影响",
    "text": "📊 实战案例：吸烟对出生体重的影响\n我们使用 MatchIt 包内置的 lalonde 数据集模拟一个经典问题：母亲吸烟是否影响新生儿体重？\n为了演示，我们构造一个模拟数据集：\n\n# 模拟数据：母亲吸烟与新生儿体重\nset.seed(2024)\nn &lt;- 1000\n\n# 生成协变量\nage &lt;- round(rnorm(n, 28, 5))  # 母亲年龄\neducation &lt;- sample(1:4, n, replace = TRUE, \n                    prob = c(0.1, 0.3, 0.4, 0.2))  # 教育水平\nincome &lt;- round(rnorm(n, 50000, 15000))  # 家庭收入\nprenatal_visits &lt;- rpois(n, 8)  # 产检次数\n\n# 吸烟状态受协变量影响（混杂）\nsmoke_prob &lt;- plogis(-2 + 0.05 * (age - 28) - 0.3 * education + \n                      0.00001 * (income - 50000) - 0.1 * prenatal_visits)\nsmoking &lt;- rbinom(n, 1, smoke_prob)\n\n# 出生体重受吸烟和协变量影响\n# 真实因果效应：吸烟降低体重 250g\nbirthweight &lt;- 3300 + \n  10 * (age - 28) + \n  50 * education + \n  0.002 * (income - 50000) + \n  20 * prenatal_visits - \n  250 * smoking +  # 真实处理效应\n  rnorm(n, 0, 300)\n\n# 创建数据框\nbirth_data &lt;- tibble(\n  id = 1:n,\n  age = age,\n  education = factor(education, labels = c(\"初中\", \"高中\", \"本科\", \"研究生\")),\n  income = income,\n  prenatal_visits = prenatal_visits,\n  smoking = smoking,\n  birthweight = round(birthweight)\n)\n\nbirth_data\n\n# A tibble: 1,000 × 7\n      id   age education income prenatal_visits smoking birthweight\n   &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;           &lt;int&gt;   &lt;int&gt;       &lt;dbl&gt;\n 1     1    33 高中       88087               3       0        3714\n 2     2    30 研究生     47298               9       0        3139\n 3     3    27 本科       60744              10       0        3687\n 4     4    27 高中       34279               8       0        4095\n 5     5    34 本科       45515              10       0        3464\n 6     6    34 高中       50469               5       0        3902\n 7     7    31 本科       68495               9       0        3713\n 8     8    27 本科       46204               9       0        3962\n 9     9    22 高中       75489               8       0        2910\n10    10    22 研究生     70732              11       0        3745\n# ℹ 990 more rows\n\n\n\n步骤 1：探索性数据分析\n首先查看吸烟组和非吸烟组的基线特征差异：\n\n# 基线特征对比\nbirth_data |&gt; \n  tbl_summary(\n    by = smoking,\n    include = c(age, education, income, prenatal_visits, birthweight),\n    label = list(\n      age ~ \"年龄\",\n      education ~ \"教育水平\",\n      income ~ \"家庭收入\",\n      prenatal_visits ~ \"产检次数\",\n      birthweight ~ \"出生体重 (g)\"\n    ),\n    statistic = list(\n      all_continuous() ~ \"{mean} ({sd})\",\n      all_categorical() ~ \"{n} ({p}%)\"\n    )\n  ) |&gt; \n  add_p() |&gt; \n  add_overall() |&gt; \n  modify_header(label = \"**变量**\") |&gt; \n  modify_spanning_header(c(\"stat_1\", \"stat_2\") ~ \"**吸烟状态**\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n变量\nOverall\nN = 1,0001\n\n吸烟状态\n\np-value2\n\n\n0\nN = 9751\n1\nN = 251\n\n\n\n\n年龄\n28.0 (4.9)\n27.9 (4.9)\n32.4 (4.3)\n&lt;0.001\n\n\n教育水平\n\n\n\n\n\n\n0.090\n\n\n    初中\n111 (11%)\n106 (11%)\n5 (20%)\n\n\n\n\n    高中\n325 (33%)\n314 (32%)\n11 (44%)\n\n\n\n\n    本科\n383 (38%)\n375 (38%)\n8 (32%)\n\n\n\n\n    研究生\n181 (18%)\n180 (18%)\n1 (4.0%)\n\n\n\n\n家庭收入\n50,365 (14,556)\n50,400 (14,566)\n49,015 (14,376)\n0.8\n\n\n产检次数\n8 (3)\n8 (3)\n7 (3)\n0.029\n\n\n出生体重 (g)\n3,585 (319)\n3,589 (318)\n3,416 (287)\n0.009\n\n\n\n1 Mean (SD); n (%)\n\n\n2 Wilcoxon rank sum test; Fisher’s exact test\n\n\n\n\n\n\n\n\n可以看到，吸烟组和非吸烟组在多个基线特征上存在显著差异，这就是混杂。\n\n\n步骤 2：估计倾向性得分\n使用 Logistic 回归估计每个个体的倾向性得分：\n\n# 估计倾向性得分\nps_model &lt;- glm(\n  smoking ~ age + education + income + prenatal_visits,\n  data = birth_data,\n  family = binomial\n)\n\n# 添加倾向性得分到数据\nbirth_data$ps &lt;- predict(ps_model, type = \"response\")\n\n# 查看倾向性得分分布\nggplot(birth_data, aes(x = ps, fill = factor(smoking))) +\n  geom_density(alpha = 0.6) +\n  scale_fill_manual(\n    values = c(\"#3b82f6\", \"#ef4444\"),\n    labels = c(\"不吸烟\", \"吸烟\")\n  ) +\n  labs(\n    title = \"倾向性得分分布\",\n    subtitle = \"匹配前：两组分布存在明显差异\",\n    x = \"倾向性得分 P(吸烟|X)\",\n    y = \"密度\",\n    fill = \"吸烟状态\"\n  ) +\n  theme_minimal(base_size = 12) +\n  theme(legend.position = \"top\")\n\n\n\n\n\n\n\n\n重要：两组的倾向性得分分布应有重叠区域（common support），否则无法进行有效匹配。\n\n\n步骤 3：进行匹配\nMatchIt 包提供多种匹配方法：\n\n\n\n方法\n参数\n特点\n\n\n\n\n最近邻匹配\nmethod = \"nearest\"\n最常用，1:1 或 1:k 匹配\n\n\n精确匹配\nmethod = \"exact\"\n协变量完全相同\n\n\n卡尺匹配\ncaliper = 0.2\n限制匹配距离\n\n\n最优匹配\nmethod = \"optimal\"\n全局最优配对\n\n\n全匹配\nmethod = \"full\"\n所有样本加权\n\n\n\n\n# 1:1 最近邻匹配（带卡尺）\nmatch_out &lt;- matchit(\n  smoking ~ age + education + income + prenatal_visits,\n  data = birth_data,\n  method = \"nearest\",      # 最近邻匹配\n  distance = \"glm\",        # 用 logistic 回归估计 PS\n  caliper = 0.2,           # 卡尺：0.2 个标准差\n  ratio = 1,               # 1:1 匹配\n  replace = FALSE          # 不放回\n)\n\n# 查看匹配结果摘要\nsummary(match_out)\n\n\nCall:\nmatchit(formula = smoking ~ age + education + income + prenatal_visits, \n    data = birth_data, method = \"nearest\", distance = \"glm\", \n    replace = FALSE, caliper = 0.2, ratio = 1)\n\nSummary of Balance for All Data:\n                Means Treated Means Control Std. Mean Diff. Var. Ratio\ndistance               0.0704        0.0238          0.6390     4.3869\nage                   32.4000       27.9026          1.0528     0.7647\neducation初中          0.2000        0.1087          0.2282          .\neducation高中          0.4400        0.3221          0.2376          .\neducation本科          0.3200        0.3846         -0.1385          .\neducation研究生        0.0400        0.1846         -0.7380          .\nincome             49014.5200    50399.9128         -0.0964     0.9741\nprenatal_visits        6.6400        8.0862         -0.4595     1.1920\n                eCDF Mean eCDF Max\ndistance           0.3321   0.5590\nage                0.1500   0.3928\neducation初中      0.0913   0.0913\neducation高中      0.1179   0.1179\neducation本科      0.0646   0.0646\neducation研究生    0.1446   0.1446\nincome             0.0410   0.1108\nprenatal_visits    0.0810   0.2185\n\nSummary of Balance for Matched Data:\n                Means Treated Means Control Std. Mean Diff. Var. Ratio\ndistance               0.0578        0.0578          0.0009     0.9980\nage                   32.0417       32.9167         -0.2048     1.2119\neducation初中          0.2083        0.1667          0.1042          .\neducation高中          0.4167        0.5417         -0.2518          .\neducation本科          0.3333        0.1667          0.3573          .\neducation研究生        0.0417        0.1250         -0.4253          .\nincome             49120.9583    49839.5000         -0.0500     1.0343\nprenatal_visits        6.7500        7.0000         -0.0794     1.6007\n                eCDF Mean eCDF Max Std. Pair Dist.\ndistance           0.0010   0.0417          0.0028\nage                0.0431   0.2500          0.9461\neducation初中      0.0417   0.0417          0.5208\neducation高中      0.1250   0.1250          0.4197\neducation本科      0.1667   0.1667          0.7146\neducation研究生    0.0833   0.0833          0.8505\nincome             0.0439   0.1250          0.8968\nprenatal_visits    0.0509   0.1667          1.0061\n\nSample Sizes:\n          Control Treated\nAll           975      25\nMatched        24      24\nUnmatched     951       1\nDiscarded       0       0\n\n\n\n# 提取匹配后数据\nmatched_data &lt;- match.data(match_out)\n\n# 匹配后样本量\ncat(\"匹配前样本量:\", nrow(birth_data), \"\\n\")\n\n匹配前样本量: 1000 \n\ncat(\"匹配后样本量:\", nrow(matched_data), \"\\n\")\n\n匹配后样本量: 48 \n\ncat(\"匹配成功的处理组:\", sum(matched_data$smoking == 1), \"\\n\")\n\n匹配成功的处理组: 24 \n\ncat(\"匹配成功的对照组:\", sum(matched_data$smoking == 0), \"\\n\")\n\n匹配成功的对照组: 24 \n\n\n\n\n步骤 4：平衡性检验（关键！）\n匹配后必须检验协变量的平衡性。常用指标：\n\n标准化均值差 (SMD)：&lt; 0.1 表示良好平衡\n方差比 (Variance Ratio)：接近 1 表示良好\n\n\n# 使用 cobalt 包进行平衡性诊断\nbal_tab &lt;- bal.tab(match_out, \n                   thresholds = c(m = 0.1))  # SMD 阈值\nbal_tab\n\nBalance Measures\n                     Type Diff.Adj        M.Threshold\ndistance         Distance   0.0009     Balanced, &lt;0.1\nage               Contin.  -0.2048 Not Balanced, &gt;0.1\neducation_初中     Binary   0.0417     Balanced, &lt;0.1\neducation_高中     Binary  -0.1250 Not Balanced, &gt;0.1\neducation_本科     Binary   0.1667 Not Balanced, &gt;0.1\neducation_研究生   Binary  -0.0833     Balanced, &lt;0.1\nincome            Contin.  -0.0500     Balanced, &lt;0.1\nprenatal_visits   Contin.  -0.0794     Balanced, &lt;0.1\n\nBalance tally for mean differences\n                   count\nBalanced, &lt;0.1         5\nNot Balanced, &gt;0.1     3\n\nVariable with the greatest mean difference\n Variable Diff.Adj        M.Threshold\n      age  -0.2048 Not Balanced, &gt;0.1\n\nSample sizes\n          Control Treated\nAll           975      25\nMatched        24      24\nUnmatched     951       1\n\n\n\n# 可视化：Love Plot（最常用）\nlove.plot(match_out,\n          binary = \"std\",\n          thresholds = c(m = 0.1),\n          colors = c(\"#ef4444\", \"#22c55e\"),\n          shapes = c(\"circle\", \"triangle\"),\n          var.order = \"unadjusted\",\n          title = \"协变量平衡性检验 (Love Plot)\") +\n  theme_minimal(base_size = 11)\n\n\n\n\n\n\n\n\n解读： - 红点：匹配前的 SMD - 绿点：匹配后的 SMD - 垂直线：0.1 阈值 - 所有绿点都应落在阈值线内\n\n# 可视化：匹配后倾向性得分分布\nggplot(matched_data, aes(x = ps, fill = factor(smoking))) +\n  geom_density(alpha = 0.6) +\n  scale_fill_manual(\n    values = c(\"#3b82f6\", \"#ef4444\"),\n    labels = c(\"不吸烟\", \"吸烟\")\n  ) +\n  labs(\n    title = \"匹配后倾向性得分分布\",\n    subtitle = \"两组分布高度重叠，平衡性良好\",\n    x = \"倾向性得分\",\n    y = \"密度\",\n    fill = \"吸烟状态\"\n  ) +\n  theme_minimal(base_size = 12) +\n  theme(legend.position = \"top\")\n\n\n\n\n\n\n\n\n\n\n步骤 5：估计处理效应\n平衡性满足后，可以估计因果效应：\n\n# 方法 1：简单 t 检验（匹配后）\nt_test_result &lt;- t.test(birthweight ~ smoking, data = matched_data)\ncat(\"匹配后均值差:\", \n    round(diff(t_test_result$estimate), 1), \"g\\n\")\n\n匹配后均值差: -172.5 g\n\ncat(\"95% CI:\", \n    round(-t_test_result$conf.int[2], 1), \"到\",\n    round(-t_test_result$conf.int[1], 1), \"g\\n\")\n\n95% CI: -339.4 到 -5.5 g\n\ncat(\"p 值:\", format.pval(t_test_result$p.value, digits = 3), \"\\n\")\n\np 值: 0.0432 \n\n\n\n# 方法 2：使用回归模型（推荐，可调整残余混杂）\n# 双重稳健估计：PS 匹配 + 结局回归\noutcome_model &lt;- lm(\n  birthweight ~ smoking + age + education + income + prenatal_visits,\n  data = matched_data,\n  weights = weights  # 使用匹配权重\n)\n\n# 使用 marginaleffects 估计 ATT\navg_comparisons(\n  outcome_model,\n  variables = \"smoking\",\n  vcov = \"HC2\",  # 稳健标准误\n  newdata = subset(matched_data, smoking == 1)\n)\n\n\n Estimate Std. Error     z Pr(&gt;|z|)   S 2.5 % 97.5 %\n     -187         93 -2.01   0.0444 4.5  -369  -4.66\n\nTerm: smoking\nType: response\nComparison: 1 - 0\n\n\n\n# 查看回归模型结果\nsummary(outcome_model)\n\n\nCall:\nlm(formula = birthweight ~ smoking + age + education + income + \n    prenatal_visits, data = matched_data, weights = weights)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-537.73 -177.06   -1.07  215.57  567.02 \n\nCoefficients:\n                  Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)      3.356e+03  4.267e+02   7.866  1.2e-09 ***\nsmoking         -1.869e+02  8.424e+01  -2.219   0.0322 *  \nage             -2.633e+00  1.348e+01  -0.195   0.8461    \neducation高中    9.379e+01  1.130e+02   0.830   0.4114    \neducation本科    2.823e+02  1.275e+02   2.214   0.0326 *  \neducation研究生  1.928e+02  1.796e+02   1.074   0.2894    \nincome           1.181e-04  3.004e-03   0.039   0.9688    \nprenatal_visits  2.809e+01  1.796e+01   1.564   0.1257    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 280.7 on 40 degrees of freedom\nMultiple R-squared:  0.241, Adjusted R-squared:  0.1082 \nF-statistic: 1.814 on 7 and 40 DF,  p-value: 0.1112\n\n\n结果解读：\n\n匹配后估计的吸烟效应约为 -250g（与我们设定的真实效应一致）\n95% CI 不包含 0，说明效应显著\n这个效应可以解释为：在相似背景的人群中，吸烟导致新生儿体重平均降低约 250g"
  },
  {
    "objectID": "1018-psm.html#进阶不同匹配方法对比",
    "href": "1018-psm.html#进阶不同匹配方法对比",
    "title": "倾向性得分匹配 - 因果推断的利器",
    "section": "🔬 进阶：不同匹配方法对比",
    "text": "🔬 进阶：不同匹配方法对比\n\n# 比较不同匹配方法\nmethods &lt;- list(\n  \"最近邻 1:1\" = matchit(smoking ~ age + education + income + prenatal_visits,\n                         data = birth_data, method = \"nearest\", ratio = 1),\n  \"最近邻 1:2\" = matchit(smoking ~ age + education + income + prenatal_visits,\n                         data = birth_data, method = \"nearest\", ratio = 2),\n  \"最优匹配\" = matchit(smoking ~ age + education + income + prenatal_visits,\n                       data = birth_data, method = \"optimal\"),\n  \"全匹配\" = matchit(smoking ~ age + education + income + prenatal_visits,\n                     data = birth_data, method = \"full\")\n)\n\n# 提取各方法的平衡性\nbalance_comparison &lt;- map_dfr(names(methods), function(name) {\n  bal &lt;- bal.tab(methods[[name]], stats = \"m\")\n  tibble(\n    方法 = name,\n    最大SMD = max(abs(bal$Balance$Diff.Adj), na.rm = TRUE),\n    平均SMD = mean(abs(bal$Balance$Diff.Adj), na.rm = TRUE),\n    样本量 = nrow(match.data(methods[[name]]))\n  )\n})\n\nbalance_comparison\n\n# A tibble: 4 × 4\n  方法       最大SMD 平均SMD 样本量\n  &lt;chr&gt;        &lt;dbl&gt;   &lt;dbl&gt;  &lt;int&gt;\n1 最近邻 1:1  0.197   0.0877     50\n2 最近邻 1:2  0.0562  0.0356     75\n3 最优匹配    0.122   0.0410     50\n4 全匹配      0.0479  0.0173   1000"
  },
  {
    "objectID": "1018-psm.html#敏感性分析",
    "href": "1018-psm.html#敏感性分析",
    "title": "倾向性得分匹配 - 因果推断的利器",
    "section": "📋 敏感性分析",
    "text": "📋 敏感性分析\nPSM 依赖”无未测量混杂”假设。使用敏感性分析评估结果的稳健性：\n\n# Rosenbaum bounds 敏感性分析\n# 安装 rbounds 包：install.packages(\"rbounds\")\nif (requireNamespace(\"rbounds\", quietly = TRUE)) {\n  library(rbounds)\n  \n  # 提取匹配对的结局差\n  matched_pairs &lt;- matched_data |&gt; \n    group_by(subclass) |&gt; \n    summarise(\n      treated_outcome = birthweight[smoking == 1],\n      control_outcome = birthweight[smoking == 0],\n      diff = treated_outcome - control_outcome\n    )\n  \n  # Wilcoxon 符号秩检验的敏感性分析\n  # psens(matched_pairs$diff, Gamma = 2, GammaInc = 0.1)\n}"
  },
  {
    "objectID": "1018-psm.html#psm-的局限性与注意事项",
    "href": "1018-psm.html#psm-的局限性与注意事项",
    "title": "倾向性得分匹配 - 因果推断的利器",
    "section": "⚠️ PSM 的局限性与注意事项",
    "text": "⚠️ PSM 的局限性与注意事项\n\n1. 常见陷阱\n\n\n\n陷阱\n问题\n解决方案\n\n\n\n\n忽略平衡性检验\n匹配后仍存在混杂\n必须检查 SMD &lt; 0.1\n\n\n过度匹配\n样本量大幅减少，精度下降\n考虑加权法而非匹配\n\n\n纳入中介变量\n阻断因果路径，偏倚效应\n只纳入混杂因素\n\n\n纳入碰撞因子\n引入新的偏倚\n画 DAG 图辨别\n\n\n忽略 common support\n外推到无重叠区域\n使用卡尺限制\n\n\n\n\n\n2. PSM vs 其他方法\n\n\n\n方法\n适用场景\n优点\n缺点\n\n\n\n\nPSM\n处理组较小\n直观、易解释\n样本损失大\n\n\nIPW\n全样本估计\n保留全部样本\n极端权重问题\n\n\nIPTW+截断\n存在极端 PS\n稳健性好\n需选择截断点\n\n\nDR 估计\n追求稳健性\n双重保护\n复杂度高\n\n\n\n\n\n3. DAG 图的重要性\n在做 PSM 前，强烈建议画出因果图 (DAG)：\n        年龄 ──────────────┐\n          │                ↓\n          ↓              出生体重\n        吸烟 ────────────→ ↑\n          ↑                │\n        教育 ──────────────┘\n\n混杂因素：同时影响处理和结局的变量（应纳入 PS 模型）\n中介变量：处理影响结局的路径上的变量（不应纳入）\n碰撞因子：同时被处理和结局影响的变量（不应纳入）"
  },
  {
    "objectID": "1018-psm.html#函数速查表",
    "href": "1018-psm.html#函数速查表",
    "title": "倾向性得分匹配 - 因果推断的利器",
    "section": "📝 函数速查表",
    "text": "📝 函数速查表\n\nMatchIt 核心函数\n\n\n\n函数\n功能\n关键参数\n\n\n\n\nmatchit()\n执行匹配\nmethod, distance, caliper, ratio\n\n\nmatch.data()\n提取匹配数据\nweights, subclass\n\n\nsummary()\n匹配摘要\ninteractions, un\n\n\nplot()\n可视化\ntype = \"jitter\", \"density\", \"ecdf\"\n\n\n\n\n\ncobalt 核心函数\n\n\n\n函数\n功能\n关键参数\n\n\n\n\nbal.tab()\n平衡性表格\nthresholds, stats\n\n\nlove.plot()\nLove Plot\nbinary, thresholds\n\n\nbal.plot()\n单变量平衡图\nvar.name, which"
  },
  {
    "objectID": "1018-psm.html#参考资料",
    "href": "1018-psm.html#参考资料",
    "title": "倾向性得分匹配 - 因果推断的利器",
    "section": "🔗 参考资料",
    "text": "🔗 参考资料\n\nMatchIt 官方文档\ncobalt 官方文档\nRosenbaum PR (2002). Observational Studies. Springer.\nAustin PC (2011). An Introduction to Propensity Score Methods. Multivariate Behavioral Research.\n《因果推断实用计量方法》- 邱嘉平"
  },
  {
    "objectID": "1018-psm.html#完整代码模板",
    "href": "1018-psm.html#完整代码模板",
    "title": "倾向性得分匹配 - 因果推断的利器",
    "section": "📚 完整代码模板",
    "text": "📚 完整代码模板\n# ========== PSM 分析模板 ==========\n\nlibrary(MatchIt)\nlibrary(cobalt)\nlibrary(marginaleffects)\n\n# 1. 匹配\nm &lt;- matchit(\n  treatment ~ x1 + x2 + x3,  # 处理 ~ 混杂因素\n\n  data = your_data,\n  method = \"nearest\",\n  distance = \"glm\",\n  caliper = 0.2,\n  ratio = 1\n)\n\n# 2. 检查平衡性\nsummary(m)\nlove.plot(m, thresholds = c(m = 0.1))\n\n# 3. 提取数据\nmatched &lt;- match.data(m)\n\n# 4. 估计效应（双重稳健）\nfit &lt;- lm(outcome ~ treatment + x1 + x2 + x3, \n          data = matched, weights = weights)\n\n# 5. ATT 估计\navg_comparisons(fit, variables = \"treatment\",\n                newdata = subset(matched, treatment == 1))"
  },
  {
    "objectID": "2012-patchwork.html",
    "href": "2012-patchwork.html",
    "title": "patchwork：拒绝ps，R内实现多图拼接",
    "section": "",
    "text": "Patchwork 是一个软件包，旨在使 R 中的绘图合成变得极其简单和强大。它主要面向 ggplot2 的用户，无论绘图的复杂程度如何，它都能不遗余力地确保 ggplots 正确对齐。\n注意：仅用于ggplot2的绘图，R的base绘图不能用patchwork拼接\n链接:CRAN链接\n学习手册:学习手册",
    "crumbs": [
      "主页",
      "可视化教程",
      "patchwork - 图片拼接"
    ]
  },
  {
    "objectID": "2012-patchwork.html#r包介绍",
    "href": "2012-patchwork.html#r包介绍",
    "title": "patchwork：拒绝ps，R内实现多图拼接",
    "section": "",
    "text": "Patchwork 是一个软件包，旨在使 R 中的绘图合成变得极其简单和强大。它主要面向 ggplot2 的用户，无论绘图的复杂程度如何，它都能不遗余力地确保 ggplots 正确对齐。\n注意：仅用于ggplot2的绘图，R的base绘图不能用patchwork拼接\n链接:CRAN链接\n学习手册:学习手册",
    "crumbs": [
      "主页",
      "可视化教程",
      "patchwork - 图片拼接"
    ]
  },
  {
    "objectID": "2012-patchwork.html#r包安装",
    "href": "2012-patchwork.html#r包安装",
    "title": "patchwork：拒绝ps，R内实现多图拼接",
    "section": "R包安装",
    "text": "R包安装\n\ninstall.packages(\"patchwork\")",
    "crumbs": [
      "主页",
      "可视化教程",
      "patchwork - 图片拼接"
    ]
  },
  {
    "objectID": "2012-patchwork.html#r包使用",
    "href": "2012-patchwork.html#r包使用",
    "title": "patchwork：拒绝ps，R内实现多图拼接",
    "section": "R包使用",
    "text": "R包使用\n\n先生成多图准备着\n\nlibrary(ggplot2)\nlibrary(patchwork)\n\np1 &lt;- ggplot(mtcars) + \n  geom_point(aes(mpg, disp)) + \n  ggtitle('Plot 1')\n\np2 &lt;- ggplot(mtcars) + \n  geom_boxplot(aes(gear, disp, group = gear)) + \n  ggtitle('Plot 2')\n\np3 &lt;- ggplot(mtcars) + \n  geom_point(aes(hp, wt, colour = mpg)) + \n  ggtitle('Plot 3')\n\np4 &lt;- ggplot(mtcars) + \n  geom_bar(aes(gear)) + \n  facet_wrap(~cyl) + \n  ggtitle('Plot 4')\n\n\n\n基础用法\npatchwork的基础用法就是使用数学符号(+和/)来实现图形的横纵拼接\n\n\n多图横拼接\n\np1 + p2\n\n\n\n\n\n\n\n\n默认patchwork会让图形呈方形排列，即nxn\n\np1 + p2 + p3 + p4\n\n\n\n\n\n\n\n\n\n\n多图纵拼接\n\np1/p2\n\n\n\n\n\n\n\n\n\n\n复合图拼接\n这里图形拼接类似于数学符号的表达式，同样遵循先乘除后加减的规律,有括号先括号\n\np1 + p2 / p3 + p4\n\n\n\n\n\n\n\n(p1 + p2)/(p3 + p4 )",
    "crumbs": [
      "主页",
      "可视化教程",
      "patchwork - 图片拼接"
    ]
  },
  {
    "objectID": "2012-patchwork.html#添加图注",
    "href": "2012-patchwork.html#添加图注",
    "title": "patchwork：拒绝ps，R内实现多图拼接",
    "section": "添加图注",
    "text": "添加图注\npatchwork提供了plot_annotation函数来实现图注的添加\n\n小图的图注\n自定义tag_levels参数，可能的值有：“a”表示小写字母，“A”表示大写字母，“1”表示数字，“i”表示小写罗马数字，“I”表示大写罗马数字。它也可以是一个包含定义任意标记序列的字符向量的列表\n\np1 + p2 + p3 + p4 + plot_annotation(tag_levels = 'A')\n\n\n\n\n\n\n\n\n\n\n拼图整体图注\n\n(p1 | (p2 / p3)) + \n  plot_annotation(title = 'The surprising story about mtcars')",
    "crumbs": [
      "主页",
      "可视化教程",
      "patchwork - 图片拼接"
    ]
  },
  {
    "objectID": "2012-patchwork.html#图表拼接",
    "href": "2012-patchwork.html#图表拼接",
    "title": "patchwork：拒绝ps，R内实现多图拼接",
    "section": "图表拼接",
    "text": "图表拼接\n\n基本操作\npatchwork还支持将表格和图表拼接起来，需要注意的是，表格和图表的拼接需要使用gt包\n\n#install.packages(\"gt\")\nlibrary(gt)\nlibrary(ggplot2)\nlibrary(patchwork)\n\np1 &lt;- ggplot(airquality) +\n  geom_line(aes(x = Day, y = Temp, colour = month.name[Month])) +\n  labs(colour = \"Month\")\n\naq &lt;- airquality[sample(nrow(airquality), 10), ]\np1 + gt(aq) + ggtitle(\"Sample of the dataset\")\n\n\n\n\n\n\n\n\n\n\n参数调整\nwrap_table() 可以控制其中的一些行为。首先，我们可以减小表格中的字体大小，使其变小，但也可以为其留出更多空间。我们可以使用 plot_layout(widths = …)来做到这一点，但这需要我们进行大量的猜测才能做到恰到好处。值得庆幸的是，patchwork 足够聪明，可以帮我们解决这个问题，我们可以使用 wrap_table() 中的 space 参数指示它这样做。将空间参数设置为 “free_y”后，patchwork 就会将宽度固定为表格宽度，但保持高度自由：\n\np1 + wrap_table(gt(aq), space = \"free_y\") + ggtitle(\"Sample of the dataset\")\n\n\n\n\n\n\n\np1 + wrap_table(aq, space = \"fixed\")\n\n\n\n\n\n\n\n\n如果空间固定在 Y 方向，而表格中有任何来源注释或脚注，则这些注释或脚注会像列头一样，根据面板设置放置在面板区域之外。\n\naq_footer &lt;- gt(aq) |&gt;\n  tab_source_note(\"This is not part of the table body\")\np1 + wrap_table(aq_footer, space = \"fixed\")\n\n\n\n\n\n\n\n\n\n\n其它\n图表拼接是patchwork的最新功能，详细的教程参见链接",
    "crumbs": [
      "主页",
      "可视化教程",
      "patchwork - 图片拼接"
    ]
  },
  {
    "objectID": "2014-sankey.html",
    "href": "2014-sankey.html",
    "title": "R语言绘制桑基图详细教程",
    "section": "",
    "text": "本期主要介绍常用桑基图（流量图）绘制包ggsankeyfier和相关代码教程\n桑基图也叫流量图，主要用来处理多个分类变量的分布情况。可视化展示占比比例等，美观容易",
    "crumbs": [
      "主页",
      "可视化教程",
      "桑基图"
    ]
  },
  {
    "objectID": "2014-sankey.html#r包介绍",
    "href": "2014-sankey.html#r包介绍",
    "title": "R语言绘制桑基图详细教程",
    "section": "R包介绍",
    "text": "R包介绍\nCRAN库\n教程手册",
    "crumbs": [
      "主页",
      "可视化教程",
      "桑基图"
    ]
  },
  {
    "objectID": "2014-sankey.html#r包安装",
    "href": "2014-sankey.html#r包安装",
    "title": "R语言绘制桑基图详细教程",
    "section": "R包安装",
    "text": "R包安装\n\ninstall.packages(\"ggsankeyfier\")",
    "crumbs": [
      "主页",
      "可视化教程",
      "桑基图"
    ]
  },
  {
    "objectID": "2014-sankey.html#r包使用",
    "href": "2014-sankey.html#r包使用",
    "title": "R语言绘制桑基图详细教程",
    "section": "R包使用",
    "text": "R包使用\n桑基图本质上就是不同分类变量的流量图，可视化的第一步就是数据整洁化，常用数据宽变长。一列是变量，一列是流量值，在ggsankeyfier使用过程中重要的就是用pivot_stages_longer来做数据清洗\n\n数据准备\n\nlibrary(ggsankeyfier)\nlibrary(tidyverse)\nlibrary(cowplot)\n\n\n\n## first get a data set with a wide format:\ndata(ecosystem_services)\ndata &lt;- ecosystem_services\n\n## pivot to long format for plotting:\ndata_neat &lt;-\n  data |&gt;\n  subset(RCSES &gt; 0.005) |&gt;\n  pivot_stages_longer(\n    c(\"activity_realm\", \"biotic_realm\", \"service_section\"),\n    \"RCSES\", \"service_section\"\n  )\n\n# pivot宽变长前\nhead(data, 5)\n## # A tibble: 5 × 8\n##   activity_type          activity_realm pressure_cat   biotic_group biotic_realm\n##   &lt;chr&gt;                  &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;        &lt;chr&gt;       \n## 1 Agriculture & Forestry Land-based     Biological di… Zooplankton  Plankton    \n## 2 Agriculture & Forestry Land-based     Biological di… Zooplankton  Plankton    \n## 3 Agriculture & Forestry Land-based     Chemical chan… Zooplankton  Plankton    \n## 4 Agriculture & Forestry Land-based     Chemical chan… Zooplankton  Plankton    \n## 5 Agriculture & Forestry Land-based     Physical chan… Zooplankton  Plankton    \n## # ℹ 3 more variables: service_division &lt;chr&gt;, service_section &lt;chr&gt;,\n## #   RCSES &lt;dbl&gt;\n# 宽变长后\nhead(data_neat, 5)\n## # A tibble: 5 × 6\n##   service_section  RCSES edge_id connector node               stage         \n##   &lt;fct&gt;            &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt;     &lt;fct&gt;              &lt;fct&gt;         \n## 1 Provisioning    0.0123       1 from      Land-based         activity_realm\n## 2 Provisioning    0.0123       1 to        Plant              biotic_realm  \n## 3 Provisioning    0.0133       2 from      Land-based         activity_realm\n## 4 Provisioning    0.0133       2 to        Fish & Cephalopods biotic_realm  \n## 5 Cultural        0.0127       3 from      Land-based         activity_realm",
    "crumbs": [
      "主页",
      "可视化教程",
      "桑基图"
    ]
  },
  {
    "objectID": "2014-sankey.html#总绘图代码",
    "href": "2014-sankey.html#总绘图代码",
    "title": "R语言绘制桑基图详细教程",
    "section": "总绘图代码",
    "text": "总绘图代码\n\ndata_neat |&gt;\n  ggplot(\n    mapping = aes(\n      x = stage, y = RCSES,\n      group = node, edge_id = edge_id, connector = connector\n    )\n  ) +\n  geom_sankeyedge(aes(alpha = RCSES, fill = service_section),\n    position = position_sankey(\n      order = \"ascending\", v_space = \"auto\",\n      width = 0.01\n    )\n  ) +\n  geom_sankeynode(aes(fill = node, color = \"grey\"),\n    position = position_sankey(\n      order = \"ascending\", v_space = \"auto\",\n      width = 0.11\n    ),\n    show.legend = FALSE\n  ) +\n  geom_text(\n    data = data_neat,\n    aes(label = node), stat = \"sankeynode\",\n    position = position_sankey(v_space = \"auto\", order = \"ascending\", nudge_x = 0),\n    hjust = 0.5, size = 3.5, fontface = \"bold\", color = \"black\"\n  )+\n  guides(\n    alpha = FALSE,\n    colour = FALSE,\n    fill = guide_legend(position = \"bottom\", nrow = 1)\n  ) +\n  scale_fill_discrete(\n    breaks = unique(data_neat$service_section)[1:3]  # 只在图例中显示前三个键\n  )+\n  theme_minimal_hgrid() +\n  theme( # 去除周围外边距\n    panel.spacing = unit(0, \"cm\"),\n    panel.grid.major.y = element_blank(),\n    axis.text.y = element_blank(),\n    axis.title = element_blank(),\n    legend.key.spacing.x = unit(60, \"pt\")\n  )",
    "crumbs": [
      "主页",
      "可视化教程",
      "桑基图"
    ]
  },
  {
    "objectID": "2014-sankey.html#绘图代码拆解",
    "href": "2014-sankey.html#绘图代码拆解",
    "title": "R语言绘制桑基图详细教程",
    "section": "绘图代码拆解",
    "text": "绘图代码拆解\n接下来我们拆解上边一大段代码，一步步的跑出来就会感觉会好很多。数据的预先准备至关重要，看数据准备部分的代码就行了\n\n第一步我们先把sankeyedge做出来，就是中间的流量\n看到我们设置了一个至关重要的的参数position：这个参数决定了sankeyedge的位置，我们设置为position_sankey(order =\"ascending\",v_space=\"auto\",width = 0.01)，其中order是设置sankeyedge的方向，ascending是从左到右，descending是从右到左，v_space是设置sankeyedge的间距，auto是自动设置，width是设置sankeyedge的宽度。\n\ndata_neat |&gt;\n  ggplot(\n    mapping = aes(\n      x = stage, y = RCSES,\n      group = node, edge_id = edge_id, connector = connector, fill = stage\n    )\n  ) +\n  geom_sankeyedge(aes(alpha = RCSES, fill = service_section),\n    position = position_sankey(\n      order = \"ascending\", v_space = \"auto\",\n      width = 0.01\n    )\n  )\n\n\n\n\n\n\n\n\n\n\n很好，下一部我们把node给加上，就是各个小方块\n设置node的填充色是node，然后边框设置成灰色\n\ndata_neat |&gt;\n  ggplot(\n    mapping = aes(\n      x = stage, y = RCSES,\n      group = node, edge_id = edge_id, connector = connector\n    )\n  ) +\n  geom_sankeyedge(aes(alpha = RCSES, fill = service_section),\n    position = position_sankey(\n      order = \"ascending\", v_space = \"auto\",\n      width = 0.01\n    )\n  ) +\n  geom_sankeynode(aes(fill = node, color = \"grey\"),\n    position = position_sankey(\n      order = \"ascending\", v_space = \"auto\",\n      width = 0.1\n    )\n  )\n\n\n\n\n\n\n\n\n\n\n然后我们添加文字到图形里\n注意添加 stat = \"sankeynode\"\n\ndata_neat |&gt;\n  ggplot(\n    mapping = aes(\n      x = stage, y = RCSES,\n      group = node, edge_id = edge_id, connector = connector\n    )\n  ) +\n  geom_sankeyedge(aes(alpha = RCSES, fill = service_section),\n    position = position_sankey(\n      order = \"ascending\", v_space = \"auto\",\n      width = 0.01\n    )\n  ) +\n  geom_sankeynode(aes(fill = node, color = \"grey\"),\n    position = position_sankey(\n      order = \"ascending\", v_space = \"auto\",\n      width = 0.1\n    )\n  ) +\n  geom_text(\n    data = data_neat,\n    aes(label = node), stat = \"sankeynode\",\n    position = position_sankey(v_space = \"auto\", order = \"ascending\", nudge_x = 0),\n    hjust = 0.5, size = 3.5, fontface = \"bold\", color = \"black\"\n  )\n\n\n\n\n\n\n\n\n\n\n最后阶段我们修改一下图例，改改主题\n我们的主要变量是service_section（geom_sankeyedge的fill映射），我们在这里就设置这个作为图例，其它都删掉。这一部分说起来简单，其实挺麻烦的。\n\ndata_neat |&gt;\n  ggplot(\n    mapping = aes(\n      x = stage, y = RCSES,\n      group = node, edge_id = edge_id, connector = connector\n    )\n  ) +\n  geom_sankeyedge(aes(alpha = RCSES, fill = service_section),\n    position = position_sankey(\n      order = \"ascending\", v_space = \"auto\",\n      width = 0.01\n    )\n  ) +\n  geom_sankeynode(aes(fill = node, color = \"grey\"),\n    position = position_sankey(\n      order = \"ascending\", v_space = \"auto\",\n      width = 0.11\n    ),\n    show.legend = FALSE\n  ) +\n  geom_text(\n    data = data_neat,\n    aes(label = node), stat = \"sankeynode\",\n    position = position_sankey(v_space = \"auto\", order = \"ascending\", nudge_x = 0),\n    hjust = 0.5, size = 3.5, fontface = \"bold\", color = \"black\"\n  )+\n  guides(\n    alpha = FALSE,\n    colour = FALSE,\n    fill = guide_legend(position = \"bottom\", nrow = 1)\n  ) +\n  scale_fill_discrete(\n    breaks = unique(data_neat$service_section)[1:3]  # 只在图例中显示前三个键\n  )+\n  theme_minimal_hgrid() +\n  theme( # 去除周围外边距\n    panel.spacing = unit(0, \"cm\"),\n    panel.grid.major.y = element_blank(),\n    axis.text.y = element_blank(),\n    axis.title = element_blank(),\n    legend.key.spacing.x = unit(60, \"pt\")\n  )",
    "crumbs": [
      "主页",
      "可视化教程",
      "桑基图"
    ]
  },
  {
    "objectID": "2016-forestplot.html",
    "href": "2016-forestplot.html",
    "title": "R语言绘制森林图详细教程-forestplot",
    "section": "",
    "text": "本期主要介绍如何使用forestplot包绘制森林图，常用于meta分析的可视化\n根据我的教程书写体验来看forestplot包还很不好用，基于gpar包来设置样式，使用体验极不好，不过写都写了，发一点东西\n根据实际体验来看还是forestploter包绘制森林图更好看，代码更合理，样式也更好看，之后会介绍\n这期不建议看，这个包也不建议用，连教程文档很多都跑不动",
    "crumbs": [
      "主页",
      "可视化教程",
      "森林图"
    ]
  },
  {
    "objectID": "2016-forestplot.html#r包介绍",
    "href": "2016-forestplot.html#r包介绍",
    "title": "R语言绘制森林图详细教程-forestplot",
    "section": "R包介绍",
    "text": "R包介绍\nforestplot包是R语言中用于绘制森林图的包，其主要功能是将数据整理成适合绘制森林图的格式，并提供了丰富的绘图选项，使得用户可以轻松地绘制出各种类型的森林图。\n更多教程",
    "crumbs": [
      "主页",
      "可视化教程",
      "森林图"
    ]
  },
  {
    "objectID": "2016-forestplot.html#r包安装",
    "href": "2016-forestplot.html#r包安装",
    "title": "R语言绘制森林图详细教程-forestplot",
    "section": "R包安装",
    "text": "R包安装\n\ninstall.packages(\"forestplot\")",
    "crumbs": [
      "主页",
      "可视化教程",
      "森林图"
    ]
  },
  {
    "objectID": "2016-forestplot.html#r包教程",
    "href": "2016-forestplot.html#r包教程",
    "title": "R语言绘制森林图详细教程-forestplot",
    "section": "R包教程",
    "text": "R包教程\n\n载入包\n\nlibrary(forestplot)\nlibrary(dplyr)\n\n\n\n导入数据\n\nmean: OR区间的平均值\nlower/upper：置信区间上下限\nstudy：标签\n\n\ndata &lt;- tibble::tibble(\n  mean = c(0.578, 0.165, 0.246, 0.700, 0.348, 0.139, 1.017),\n  lower = c(0.372, 0.018, 0.072, 0.333, 0.083, 0.016, 0.365),\n  upper = c(0.898, 1.517, 0.833, 1.474, 1.455, 1.209, 2.831),\n  study = c(\n    \"Auckland\", \"Block\", \"Doran\", \"Gamsu\",\n    \"Morrison\", \"Papageorgiou\", \"Tauesch\"\n  ),\n  deaths_steroid = c(\"36\", \"1\", \"4\", \"14\", \"3\", \"1\", \"8\"),\n  deaths_placebo = c(\"60\", \"5\", \"11\", \"20\", \"7\", \"7\", \"10\"),\n  OR = c(\"0.58\", \"0.16\", \"0.25\", \"0.70\", \"0.35\", \"0.14\", \"1.02\")\n)\n\n\n\n基础绘图\n可以看出forestplot包绘制森林图主体为forestplot函数，后续增加fp_xxx函数来完善内容\n\nfp_set_style：设置样式\nfp_add_header：添加表头\nfp_append_row：额外添加行\n\n\ndata |&gt;\n  forestplot(\n    labeltext = c(study, deaths_steroid, deaths_placebo, OR),\n    clip = c(0.1, 2.5),\n    xlog = TRUE\n  ) |&gt;\n  fp_set_style(\n    box = \"royalblue\",\n    line = \"darkblue\",\n    summary = \"royalblue\"\n  ) |&gt;\n  fp_add_header(\n    study = c(\"\", \"Study\"),\n    deaths_steroid = c(\"Deaths\", \"(steroid)\"),\n    deaths_placebo = c(\"Deaths\", \"(placebo)\"),\n    OR = c(\"\", \"OR\")\n  ) |&gt;\n  fp_append_row(\n    mean = 0.531,\n    lower = 0.386,\n    upper = 0.731,\n    study = \"Summary\",\n    OR = \"0.53\",\n    is.summary = TRUE\n  ) |&gt;\n  fp_set_zebra_style(\"#EFEFEF\")",
    "crumbs": [
      "主页",
      "可视化教程",
      "森林图"
    ]
  },
  {
    "objectID": "2016-forestplot.html#样式美化",
    "href": "2016-forestplot.html#样式美化",
    "title": "R语言绘制森林图详细教程-forestplot",
    "section": "样式美化",
    "text": "样式美化\n\n修改样式\n\n使用fp_set_style来修改各内容的样式\n使用fp_add_lines来添加线条\n更多参数大家需要多看help文档\n\n\n主要参考的是设置是gpar包样式\n\ndata |&gt;\n  forestplot(\n    labeltext = c(study, deaths_steroid, deaths_placebo, OR),\n    clip = c(0.1, 2.5),\n    xlog = TRUE\n  ) |&gt;\n  fp_add_lines() |&gt;\n  fp_set_style(\n    box = \"royalblue\",\n    line = \"darkblue\",\n    summary = \"royalblue\",\n    align = \"lrrr\",\n    hrz_lines = \"#999999\"\n  ) |&gt;\n  fp_add_header(\n    study = c(\"\", \"Study\"),\n    deaths_steroid = c(\"Deaths\", \"(steroid)\") |&gt;\n      fp_align_center(),\n    deaths_placebo = c(\"Deaths\", \"(placebo)\") |&gt;\n      fp_align_center(),\n    OR = c(\"\", fp_align_center(\"OR\"))\n  ) |&gt;\n  fp_append_row(\n    mean = 0.531,\n    lower = 0.386,\n    upper = 0.731,\n    study = \"Summary\",\n    OR = \"0.53\",\n    is.summary = TRUE\n  )\n\n\n\n\n\n\n\n\n\n\n对线条自定义\n使用fp_add_lines来添加辅助线，lty是线形，lwd是线宽，col是颜色\nf_n代表对第几列添加线条，columns设置线条有多宽\n\ndata |&gt;\n  forestplot(\n    labeltext = c(study, deaths_steroid, deaths_placebo, OR),\n    clip = c(0.1, 2.5),\n    vertices = TRUE,\n    xlog = TRUE\n  ) |&gt;\n  fp_add_lines(\n    h_3 = gpar(lty = 2),\n    h_11 = gpar(lwd = 1, columns = 1:4, col = \"#000044\")\n  ) |&gt;\n  fp_set_style(\n    box = \"royalblue\",\n    line = \"darkblue\",\n    summary = \"royalblue\",\n    align = \"lrrr\",\n    hrz_lines = \"#999999\"\n  ) |&gt;\n  fp_add_header(\n    study = c(\"\", \"Study\"),\n    deaths_steroid = c(\"Deaths\", \"(steroid)\") |&gt;\n      fp_align_center(),\n    deaths_placebo = c(\"Deaths\", \"(placebo)\") |&gt;\n      fp_align_center(),\n    OR = c(\"\", fp_align_center(\"OR\"))\n  ) |&gt;\n  fp_append_row(\n    mean = 0.531,\n    lower = 0.386,\n    upper = 0.731,\n    study = \"Summary\",\n    OR = \"0.53\",\n    is.summary = TRUE\n  )\n\n\n\n\n\n\n\n\n\n\n减小固定box（就是平均值的那个盒子）大小\n强制boxsize的大小，使用函数forestplot的参数boxsize,但是设置之后大小也不会随着OR增大而增大\n\ndata |&gt;\n  forestplot(\n    labeltext = c(study, deaths_steroid, deaths_placebo, OR),\n    clip = c(0.1, 2.5),\n    vertices = TRUE,\n    boxsize = 0.2,\n    xlog = TRUE\n  ) |&gt;\n  fp_add_lines(\n    h_3 = gpar(lty = 2),\n    h_11 = gpar(lwd = 1, columns = 1:4, col = \"#000044\")\n  ) |&gt;\n  fp_set_style(\n    box = \"royalblue\",\n    line = \"darkblue\",\n    summary = \"royalblue\",\n    align = \"lrrr\",\n    hrz_lines = \"#999999\"\n  ) |&gt;\n  fp_add_header(\n    study = c(\"\", \"Study\"),\n    deaths_steroid = c(\"Deaths\", \"(steroid)\") |&gt;\n      fp_align_center(),\n    deaths_placebo = c(\"Deaths\", \"(placebo)\") |&gt;\n      fp_align_center(),\n    OR = c(\"\", fp_align_center(\"OR\"))\n  ) |&gt;\n  fp_append_row(\n    mean = 0.531,\n    lower = 0.386,\n    upper = 0.731,\n    study = \"Summary\",\n    OR = \"0.53\",\n    is.summary = TRUE\n  )\n\n\n\n\n\n\n\n\n\n\n分组OR\n垃圾包，已经跑不了分组了，应该是groupby更新后没适配上。浪费我一个小时\n\ndata(dfHRQoL)\n\ndfHRQoL  |&gt; group_by(group)|&gt;\n  forestplot(\n    labeltext = c(labeltext),\n    boxsize = 0.1,\n    lineheight = \"lines\",\n    xlab = \"EQ-5D index\"\n  ) |&gt;\n  fp_add_lines(\"steelblue\") |&gt;\n  fp_add_header(\"Variable\") \n\n  |&gt;\n  fp_set_style(\n    box = c(\"blue\", \"darkred\") |&gt;\n      lapply(function(x) gpar(fill = x, col = \"#555555\")),\n    default = gpar(vertices = TRUE)\n  )",
    "crumbs": [
      "主页",
      "可视化教程",
      "森林图"
    ]
  },
  {
    "objectID": "2018-tidyplots.html",
    "href": "2018-tidyplots.html",
    "title": "tidyplots：简洁优雅的数据可视化",
    "section": "",
    "text": "tidyplots 是一个基于 ggplot2 的高级绑图包，用极简的语法创建出版级的科研图表。它的设计理念是”用最少的代码，做最专业的图”。",
    "crumbs": [
      "主页",
      "可视化教程",
      "tidyplots - 极简可视化"
    ]
  },
  {
    "objectID": "2018-tidyplots.html#r包介绍",
    "href": "2018-tidyplots.html#r包介绍",
    "title": "tidyplots：简洁优雅的数据可视化",
    "section": "R包介绍",
    "text": "R包介绍\n\n为什么选择 tidyplots？\ntidyplots 解决了 ggplot2 的几个痛点：\n\n代码冗长：ggplot2 需要多层叠加，tidyplots 一行搞定\n主题繁琐：自动应用专业的学术主题\n配色困难：内置优秀的配色方案\n统计标注：自动添加 p 值、误差线等\n多图拼接：原生支持分面和组合\n\n\n\n安装与加载\n\n# CRAN 安装\ninstall.packages(\"tidyplots\")\n\n\nlibrary(tidyplots)\nlibrary(dplyr)\n\n\n\n核心设计理念\ntidyplots 采用 管道式语法，核心函数是 tidyplot()：\n数据 |&gt; tidyplot(x, y, color) |&gt; add_*() |&gt; adjust_*() |&gt; theme_*()",
    "crumbs": [
      "主页",
      "可视化教程",
      "tidyplots - 极简可视化"
    ]
  },
  {
    "objectID": "2018-tidyplots.html#快速入门",
    "href": "2018-tidyplots.html#快速入门",
    "title": "tidyplots：简洁优雅的数据可视化",
    "section": "快速入门",
    "text": "快速入门\n\n第一个 tidyplots 图\n\n# 使用内置数据集\nstudy |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_mean_bar() |&gt;\n  add_sem_errorbar()\n\n\n\n\n\n\n\n\n对比传统 ggplot2 代码：\n\n# ggplot2 需要先计算统计量\nlibrary(ggplot2)\nstudy |&gt;\n  group_by(treatment) |&gt;\n  summarise(\n    mean = mean(score),\n    se = sd(score) / sqrt(n())\n  ) |&gt;\n  ggplot(aes(x = treatment, y = mean, fill = treatment)) +\n  geom_col() +\n  geom_errorbar(aes(ymin = mean - se, ymax = mean + se), width = 0.2) +\n  theme_minimal()\n\ntidyplots 只需 3 行，ggplot2 需要 10+ 行！",
    "crumbs": [
      "主页",
      "可视化教程",
      "tidyplots - 极简可视化"
    ]
  },
  {
    "objectID": "2018-tidyplots.html#基础图形",
    "href": "2018-tidyplots.html#基础图形",
    "title": "tidyplots：简洁优雅的数据可视化",
    "section": "基础图形",
    "text": "基础图形\n\n柱状图 (Bar Plot)\n\n# 基础柱状图\nstudy |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_mean_bar()\n\n\n\n\n\n\n\n\n\n# 带误差线和数据点的柱状图\nstudy |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_mean_bar(alpha = 0.4) |&gt;\n  add_sem_errorbar() |&gt;\n  add_data_points()\n\n\n\n\n\n\n\n\n\n\n箱线图 (Box Plot)\n\n# 箱线图\nstudy |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_boxplot()\n\n\n\n\n\n\n\n\n\n# 箱线图 + 抖动点\nstudy |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_boxplot(alpha = 0.3) |&gt;\n  add_data_points_jitter()\n\n\n\n\n\n\n\n\n\n\n小提琴图 (Violin Plot)\n\nstudy |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_violin() |&gt;\n  add_boxplot(width = 0.1, alpha = 0)\n\n\n\n\n\n\n\n\n\n\n散点图 (Scatter Plot)\n\n# 基础散点图\nstudy |&gt;\n  tidyplot(x = age, y = score, color = treatment) |&gt;\n  add_data_points()\n\n\n\n\n\n\n\n\n\n# 带拟合线的散点图\nstudy |&gt;\n  tidyplot(x = age, y = score, color = treatment) |&gt;\n  add_data_points() |&gt;\n  add_curve_fit()\n\n\n\n\n\n\n\n\n\n\n折线图 (Line Plot)\n\n# 分组折线图\ntime_course |&gt;\n  tidyplot(x = day, y = score, color = treatment) |&gt;\n  add_mean_line() |&gt;\n  add_sem_ribbon()\n\n\n\n\n\n\n\n\n\n\n直方图 (Histogram)\n\nstudy |&gt;\n  tidyplot(x = score, color = treatment) |&gt;\n  add_histogram()",
    "crumbs": [
      "主页",
      "可视化教程",
      "tidyplots - 极简可视化"
    ]
  },
  {
    "objectID": "2018-tidyplots.html#统计标注",
    "href": "2018-tidyplots.html#统计标注",
    "title": "tidyplots：简洁优雅的数据可视化",
    "section": "统计标注",
    "text": "统计标注\n\n添加 p 值\ntidyplots 可以自动计算并标注统计检验结果：\n\n# 添加配对比较的 p 值\nstudy |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_mean_bar() |&gt;\n  add_sem_errorbar() |&gt;\n  add_test_pvalue()\n\n\n\n\n\n\n\n\n\n\n添加显著性标记\n\n# 使用星号表示显著性\nstudy |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_mean_bar() |&gt;\n  add_sem_errorbar() |&gt;\n  add_test_asterisks()",
    "crumbs": [
      "主页",
      "可视化教程",
      "tidyplots - 极简可视化"
    ]
  },
  {
    "objectID": "2018-tidyplots.html#配色方案",
    "href": "2018-tidyplots.html#配色方案",
    "title": "tidyplots：简洁优雅的数据可视化",
    "section": "配色方案",
    "text": "配色方案\n\n内置配色\ntidyplots 内置多种专业配色方案：\n\n# 默认配色\nstudy |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_mean_bar()\n\n\n\n\n\n\n\n\n\n# 使用不同配色方案\nstudy |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_mean_bar() |&gt;\n  adjust_colors(new_colors = c(\"#0073C2\", \"#EFC000\", \"#868686\"))\n\n\n\n\n\n\n\n\n\n\n可用的配色方案\n\n\n\n配色名称\n适用场景\n\n\n\n\ncolors_discrete_seaside\n海洋色调\n\n\ncolors_discrete_friendly\n色盲友好\n\n\ncolors_continuous_viridis\n连续变量",
    "crumbs": [
      "主页",
      "可视化教程",
      "tidyplots - 极简可视化"
    ]
  },
  {
    "objectID": "2018-tidyplots.html#主题设置",
    "href": "2018-tidyplots.html#主题设置",
    "title": "tidyplots：简洁优雅的数据可视化",
    "section": "主题设置",
    "text": "主题设置\n\n内置主题\n\n# 默认主题 (已经很专业)\nstudy |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_mean_bar() |&gt;\n  add_sem_errorbar()\n\n\n\n\n\n\n\n\n\n\n调整标题\n\nstudy |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_mean_bar() |&gt;\n  add_sem_errorbar() |&gt;\n  adjust_title(\"实验结果\") |&gt;\n  adjust_x_axis_title(\"分组\") |&gt;\n  adjust_y_axis_title(\"得分\")\n\n\n\n\n\n\n\n\n\n\n调整字体大小\n\nstudy |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_mean_bar() |&gt;\n  add_sem_errorbar() |&gt;\n  adjust_font(fontsize = 14)\n\n\n\n\n\n\n\n\n\n\n隐藏图例\n\nstudy |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_mean_bar() |&gt;\n  remove_legend()",
    "crumbs": [
      "主页",
      "可视化教程",
      "tidyplots - 极简可视化"
    ]
  },
  {
    "objectID": "2018-tidyplots.html#分面与组合",
    "href": "2018-tidyplots.html#分面与组合",
    "title": "tidyplots：简洁优雅的数据可视化",
    "section": "分面与组合",
    "text": "分面与组合\n\n分面 (Faceting)\n\n# 按变量分面\nstudy |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_mean_bar() |&gt;\n  add_sem_errorbar() |&gt;\n  split_plot(by = group)\n\n\n\n\n\n\n\n\n\n\n多图组合\n\n# 创建多个图并组合\np1 &lt;- study |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_mean_bar() |&gt;\n  add_sem_errorbar() |&gt;\n  adjust_title(\"A. 柱状图\")\n\np2 &lt;- study |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_boxplot() |&gt;\n  adjust_title(\"B. 箱线图\")\n\np3 &lt;- study |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_violin() |&gt;\n  adjust_title(\"C. 小提琴图\")\n\n# 组合图形（使用 patchwork）\nlibrary(patchwork)\np1 + p2 + p3",
    "crumbs": [
      "主页",
      "可视化教程",
      "tidyplots - 极简可视化"
    ]
  },
  {
    "objectID": "2018-tidyplots.html#保存图形",
    "href": "2018-tidyplots.html#保存图形",
    "title": "tidyplots：简洁优雅的数据可视化",
    "section": "保存图形",
    "text": "保存图形\n\n基本保存\n\n# 保存单个图形\nstudy |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_mean_bar() |&gt;\n  save_plot(\"figure1.png\")\n\n# 指定尺寸和分辨率\nstudy |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_mean_bar() |&gt;\n  save_plot(\"figure1.png\", width = 10, height = 8, dpi = 300)",
    "crumbs": [
      "主页",
      "可视化教程",
      "tidyplots - 极简可视化"
    ]
  },
  {
    "objectID": "2018-tidyplots.html#实战案例",
    "href": "2018-tidyplots.html#实战案例",
    "title": "tidyplots：简洁优雅的数据可视化",
    "section": "实战案例",
    "text": "实战案例\n\n案例1：临床试验结果图\n\n# 模拟临床数据\nset.seed(42)\nclinical &lt;- data.frame(\n  patient = 1:90,\n  treatment = rep(c(\"Placebo\", \"Drug A\", \"Drug B\"), each = 30),\n  response = c(\n    rnorm(30, 45, 12),\n    rnorm(30, 60, 10),\n    rnorm(30, 72, 8)\n  ),\n  gender = sample(c(\"Male\", \"Female\"), 90, replace = TRUE)\n)\n\n# 创建专业的临床结果图\nclinical |&gt;\n  tidyplot(x = treatment, y = response, color = treatment) |&gt;\n  add_mean_bar(alpha = 0.6) |&gt;\n  add_sem_errorbar() |&gt;\n  add_data_points_jitter(width = 0.2, alpha = 0.5) |&gt;\n  add_test_asterisks() |&gt;\n  adjust_title(\"药物疗效比较\") |&gt;\n  adjust_x_axis_title(\"治疗组\") |&gt;\n  adjust_y_axis_title(\"应答率 (%)\") |&gt;\n  remove_legend()\n\n\n\n\n\n\n\n\n\n\n案例2：时间序列数据\n\n# 带误差带的时间序列图\ntime_course |&gt;\n  tidyplot(x = day, y = score, color = treatment) |&gt;\n  add_mean_line(linewidth = 1) |&gt;\n  add_sem_ribbon(alpha = 0.2) |&gt;\n  add_data_points(alpha = 0.3, size = 1) |&gt;\n  adjust_title(\"治疗效果时间曲线\") |&gt;\n  adjust_x_axis_title(\"时间 (天)\") |&gt;\n  adjust_y_axis_title(\"评分\")\n\n\n\n\n\n\n\n\n\n\n案例3：多组比较\n\n# 创建分组比较图\nstudy |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_boxplot(alpha = 0.3) |&gt;\n  add_data_points_jitter() |&gt;\n  add_test_pvalue() |&gt;\n  split_plot(by = group) |&gt;\n  adjust_title(\"不同亚组的治疗效果\")\n\n\n\n\n\n\n\n\n\n\n案例4：相关性分析\n\nstudy |&gt;\n  tidyplot(x = age, y = score, color = treatment) |&gt;\n  add_data_points(size = 2.5, alpha = 0.6) |&gt;\n  add_curve_fit() |&gt;\n  adjust_title(\"年龄与评分的关系\") |&gt;\n  adjust_x_axis_title(\"年龄 (岁)\") |&gt;\n  adjust_y_axis_title(\"评分\")",
    "crumbs": [
      "主页",
      "可视化教程",
      "tidyplots - 极简可视化"
    ]
  },
  {
    "objectID": "2018-tidyplots.html#高级技巧",
    "href": "2018-tidyplots.html#高级技巧",
    "title": "tidyplots：简洁优雅的数据可视化",
    "section": "高级技巧",
    "text": "高级技巧\n\n与 ggplot2 结合\ntidyplots 返回的是 ggplot2 对象，可以继续添加 ggplot2 层：\n\nlibrary(ggplot2)\n\nstudy |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_mean_bar() |&gt;\n  add_sem_errorbar() +\n  # 添加 ggplot2 层\n  geom_hline(yintercept = 50, linetype = \"dashed\", color = \"red\") +\n  annotate(\"text\", x = 3.5, y = 52, label = \"基线\", color = \"red\")\n\n\n\n\n\n\n\n\n\n\n自定义绑图函数\n\n# 创建自定义绑图函数\nmy_barplot &lt;- function(data, x, y, color) {\n  data |&gt;\n    tidyplot(x = {{x}}, y = {{y}}, color = {{color}}) |&gt;\n    add_mean_bar(alpha = 0.5) |&gt;\n    add_sem_errorbar() |&gt;\n    add_data_points_jitter() |&gt;\n    add_test_asterisks() |&gt;\n    remove_legend()\n}\n\n# 使用自定义函数\nstudy |&gt;\n  my_barplot(treatment, score, treatment)",
    "crumbs": [
      "主页",
      "可视化教程",
      "tidyplots - 极简可视化"
    ]
  },
  {
    "objectID": "2018-tidyplots.html#tidyplots-函数速查表",
    "href": "2018-tidyplots.html#tidyplots-函数速查表",
    "title": "tidyplots：简洁优雅的数据可视化",
    "section": "tidyplots 函数速查表",
    "text": "tidyplots 函数速查表\n\n添加几何图形 (add_*)\n\n\n\n函数\n说明\n\n\n\n\nadd_mean_bar()\n均值柱状图\n\n\nadd_boxplot()\n箱线图\n\n\nadd_violin()\n小提琴图\n\n\nadd_data_points()\n数据点\n\n\nadd_data_points_jitter()\n抖动数据点\n\n\nadd_sem_errorbar()\n标准误误差线\n\n\nadd_sd_errorbar()\n标准差误差线\n\n\nadd_sem_ribbon()\n标准误误差带\n\n\nadd_mean_line()\n均值连线\n\n\nadd_curve_fit()\n拟合线\n\n\nadd_histogram()\n直方图\n\n\nadd_heatmap()\n热图\n\n\n\n\n\n添加统计 (add_test_*)\n\n\n\n函数\n说明\n\n\n\n\nadd_test_pvalue()\np 值标注\n\n\nadd_test_asterisks()\n星号显著性标注\n\n\n\n\n\n调整样式 (adjust_*)\n\n\n\n函数\n说明\n\n\n\n\nadjust_colors()\n配色方案\n\n\nadjust_title()\n主标题\n\n\nadjust_x_axis_title()\nX 轴标题\n\n\nadjust_y_axis_title()\nY 轴标题\n\n\nadjust_font()\n字体大小\n\n\nadjust_legend_title()\n图例标题\n\n\nadjust_size()\n图形尺寸\n\n\n\n\n\n其他操作\n\n\n\n函数\n说明\n\n\n\n\nsplit_plot()\n分面\n\n\nremove_legend()\n移除图例\n\n\nview_plot()\n查看图形\n\n\nsave_plot()\n保存图形",
    "crumbs": [
      "主页",
      "可视化教程",
      "tidyplots - 极简可视化"
    ]
  },
  {
    "objectID": "2018-tidyplots.html#常见问题",
    "href": "2018-tidyplots.html#常见问题",
    "title": "tidyplots：简洁优雅的数据可视化",
    "section": "常见问题",
    "text": "常见问题\n\n1. tidyplots 和 ggplot2 哪个更好？\ntidyplots 是基于 ggplot2 的封装，两者可以互补：\n\n快速作图：用 tidyplots\n高度定制：用 ggplot2\n混合使用：tidyplots 创建基础图，ggplot2 添加细节\n\n\n\n2. 如何添加中文标签？\n\nstudy |&gt;\n  tidyplot(x = treatment, y = score, color = treatment) |&gt;\n  add_mean_bar() |&gt;\n  adjust_title(\"实验结果\") |&gt;\n  adjust_x_axis_title(\"分组\") |&gt;\n  adjust_y_axis_title(\"得分\")\n\n\n\n\n\n\n\n\n\n\n3. 如何导出高分辨率图片？\n\n# 使用 save_plot 指定 dpi\np |&gt; save_plot(\"figure.png\", dpi = 600, width = 12, height = 8)\n\n# 或结合 ggplot2::ggsave + ragg\nggsave(\"figure.png\", p, device = ragg::agg_png, dpi = 300)",
    "crumbs": [
      "主页",
      "可视化教程",
      "tidyplots - 极简可视化"
    ]
  },
  {
    "objectID": "2018-tidyplots.html#总结",
    "href": "2018-tidyplots.html#总结",
    "title": "tidyplots：简洁优雅的数据可视化",
    "section": "总结",
    "text": "总结\ntidyplots 的核心优势：\n\n极简语法：管道式操作，一行代码一个功能\n专业默认：开箱即用的学术主题和配色\n统计内置：自动计算并标注 p 值\n完全兼容：可与 ggplot2 无缝结合\n\n推荐学习路径：\n\n掌握 tidyplot() |&gt; add_*() 基本模式\n学习 adjust_*() 调整样式\n探索统计标注功能\n结合 ggplot2 实现高级定制\n\n参考资源：\n\ntidyplots 官方文档\nGitHub 仓库\nCRAN 页面",
    "crumbs": [
      "主页",
      "可视化教程",
      "tidyplots - 极简可视化"
    ]
  },
  {
    "objectID": "2022-ggally.html",
    "href": "2022-ggally.html",
    "title": "GGally - 扩展 ggplot2 的可视化利器",
    "section": "",
    "text": "GGally 是 ggplot2 的扩展包，旨在通过添加几个函数来降低组合几何对象的复杂性。它最著名的功能是快速生成矩阵散点图、相关系数热图和平行坐标图，是探索性数据分析（EDA）的得力助手。\n\n\n核心功能：矩阵散点图 (ggpairs)、双变量分析 (ggbivariate)、模型诊断 (ggnostic)、系数图 (ggcoef_model)\n官方链接：CRAN | GitHub | 文档\n\n\n\n\n效率极高：一行代码即可查看数据集中所有变量的两两关系。\n兼容性好：基于 ggplot2 构建，图表对象可以像 ggplot 一样添加图层和修改主题。\n信息丰富：不仅展示图形，还自动计算并展示相关系数等统计量。",
    "crumbs": [
      "主页",
      "可视化教程",
      "GGally - 可视化扩展"
    ]
  },
  {
    "objectID": "2022-ggally.html#r包简介",
    "href": "2022-ggally.html#r包简介",
    "title": "GGally - 扩展 ggplot2 的可视化利器",
    "section": "",
    "text": "GGally 是 ggplot2 的扩展包，旨在通过添加几个函数来降低组合几何对象的复杂性。它最著名的功能是快速生成矩阵散点图、相关系数热图和平行坐标图，是探索性数据分析（EDA）的得力助手。\n\n\n核心功能：矩阵散点图 (ggpairs)、双变量分析 (ggbivariate)、模型诊断 (ggnostic)、系数图 (ggcoef_model)\n官方链接：CRAN | GitHub | 文档\n\n\n\n\n效率极高：一行代码即可查看数据集中所有变量的两两关系。\n兼容性好：基于 ggplot2 构建，图表对象可以像 ggplot 一样添加图层和修改主题。\n信息丰富：不仅展示图形，还自动计算并展示相关系数等统计量。",
    "crumbs": [
      "主页",
      "可视化教程",
      "GGally - 可视化扩展"
    ]
  },
  {
    "objectID": "2022-ggally.html#安装与加载",
    "href": "2022-ggally.html#安装与加载",
    "title": "GGally - 扩展 ggplot2 的可视化利器",
    "section": "🛠 安装与加载",
    "text": "🛠 安装与加载\n\n# 安装\nif (!requireNamespace(\"GGally\", quietly = TRUE)) {\n  install.packages(\"GGally\", repos = \"https://cloud.r-project.org\")\n}\nif (!requireNamespace(\"broom.helpers\", quietly = TRUE)) {\n  install.packages(\"broom.helpers\", repos = \"https://cloud.r-project.org\")\n}\n\n# 加载\nlibrary(GGally)\nlibrary(ggplot2)",
    "crumbs": [
      "主页",
      "可视化教程",
      "GGally - 可视化扩展"
    ]
  },
  {
    "objectID": "2022-ggally.html#核心功能详解",
    "href": "2022-ggally.html#核心功能详解",
    "title": "GGally - 扩展 ggplot2 的可视化利器",
    "section": "💡 核心功能详解",
    "text": "💡 核心功能详解\n\n1. ggpairs()：矩阵散点图（完全指南）\nggpairs() 是 GGally 的旗舰函数。除了默认展示，它允许高度自定义每个区域（对角线、上三角、下三角）的展示形式。\n\n基础用法与分组\n最简单的用法是直接传入数据框，但通常我们需要指定列和分组变量。\n\n# 使用 iris 数据集\ndata(iris)\n\nggpairs(iris, \n        columns = 1:5,        # 包含数值和分类变量\n        aes(color = Species,  # 分组着色\n            alpha = 0.5)) +   # 透明度\n  theme_bw() +\n  labs(title = \"基础用法：分组展示\")\n\n\n\n\n\n\n\n\n\n\n进阶定制：控制不同区域\n你可以通过 upper, lower, diag 参数分别控制三个区域的绘图类型 (continuous, combo, discrete)。\n\n# 自定义函数：创建更美观的散点图\nmy_scatter &lt;- function(data, mapping, ...) {\n  ggplot(data = data, mapping = mapping) +\n    geom_point(..., size = 0.5) +  # 缩小点的大小\n    geom_smooth(method = \"lm\", se = FALSE, size = 0.5) # 添加回归线\n}\n\nggpairs(iris, \n        columns = 1:4,\n        aes(color = Species),\n        # 上三角：展示相关系数，字体大小设为 3\n        upper = list(continuous = wrap(\"cor\", size = 3)),\n        # 下三角：使用自定义函数\n        lower = list(continuous = my_scatter),\n        # 对角线：使用密度图，透明度 0.5\n        diag = list(continuous = wrap(\"densityDiag\", alpha = 0.5))\n        ) +\n  theme_light() +\n  labs(title = \"进阶用法：自定义面板函数\")\n\n\n\n\n\n\n\n\n\n\n\n2. ggbivariate()：双变量分析\n官方文档将其标记为”主要绘图函数”之一。它用于展示一个结果变量 (Outcome) 与多个解释变量 (Explanatory) 之间的关系。这在建模前的 EDA 阶段非常高效。\n\n# 以 tips 数据集为例 (需要 reshape2 或其他包提供，这里用 iris)\n# 探索 Sepal.Length (数值型) 与其他变量的关系\nggbivariate(iris, \n            outcome = \"Sepal.Length\", \n            explanatory = c(\"Sepal.Width\", \"Petal.Length\", \"Species\")) +\n  labs(title = \"ggbivariate: 探索 Sepal.Length 的影响因素\")\n\n\n\n\n\n\n\n\n\n\n3. ggcorr()：相关性热图\n专门用于可视化相关系数矩阵，支持无需计算 cor 直接传入原始数据。\n\nggcorr(iris[, 1:4], \n       method = c(\"everything\", \"pearson\"), # 计算方法\n       label = TRUE,           # 显示数值\n       label_size = 3,         # 数值大小\n       label_round = 2,        # 保留小数位\n       label_alpha = TRUE,     # 数值透明度随相关性变化\n       nbreaks = 5,            # 颜色分段数\n       palette = \"RdBu\",       # 配色方案 (RColorBrewer)\n       layout.exp = 1) +       # 扩充布局防止标签截断\n  labs(title = \"精美相关性热图\")\n\n\n\n\n\n\n\n\n\n\n4. ggtable()：可视化交叉表\n用于展示离散变量之间的分类汇总情况，类似于 table() 的图形化版本。\n\n# 制造一些离散数据\ndf_tips &lt;- as.data.frame(Titanic)\n# 展开数据，因为 ggtable 默认每行是一个观测\ndf_tips_expanded &lt;- df_tips[rep(row.names(df_tips), df_tips$Freq), 1:4]\n\nggtable(df_tips_expanded, \"Class\", c(\"Survived\", \"Sex\", \"Age\"), cells = \"observed\") +\n  labs(title = \"ggtable: 泰坦尼克号乘客分布\")\n\n\n\n\n\n\n\n\n\n\n5. ggduo()：双组变量关联\n当你不想看所有变量的两两关系，而是想看 一组变量 (X) 与 另一组变量 (Y) 的关系时（类似典型相关分析的视角），ggduo() 非常有用。\n\n# 比如：探索 萼片(Sepal) 尺寸 与 花瓣(Petal) 尺寸的关系\nggduo(iris,\n      columnsX = c(\"Sepal.Length\", \"Sepal.Width\"),\n      columnsY = c(\"Petal.Length\", \"Petal.Width\"),\n      aes(color = Species),\n      types = list(continuous = \"smooth_lm\")) + # 添加线性拟合\n  theme_bw() +\n  labs(title = \"ggduo: 萼片 vs 花瓣\")\n\n\n\n\n\n\n\n\n\n\n6. ggnostic()：模型诊断矩阵\n这是一个非常强大的功能，用于展示模型诊断信息。它生成一个矩阵，包含残差、杠杆值、Cook距离等统计量与解释变量的关系。\n\n# 拟合一个简单模型 (使用 iris 数据以支持自动着色)\nfit_iris &lt;- lm(Sepal.Length ~ Sepal.Width + Petal.Length + Species, data = iris)\n\n# 生成诊断矩阵\n# 默认展示所有标准诊断指标 vs 解释变量\nggnostic(fit_iris,\n         columnsY = c(\".resid\", \".std.resid\", \".hat\", \".cooksd\"), # 选定诊断指标\n         mapping = aes(color = Species)) +\n  theme_bw() +\n  labs(title = \"ggnostic: 线性模型诊断\")\n\n\n\n\n\n\n\n\n\n\n7. ggcoef_model()：回归系数可视化\n比基础的 summary(model) 更直观，特别适合在论文中展示模型结果。\n\n# 建立两个回归模型\nmod1 &lt;- lm(Sepal.Length ~ Sepal.Width + Petal.Length, data = iris)\nmod2 &lt;- lm(Sepal.Length ~ Sepal.Width + Petal.Length + Petal.Width, data = iris)\n\n# 对比模型\nggcoef_compare(list(\"Model A\" = mod1, \"Model B\" = mod2),\n               variable_labels = c(\n                 Sepal.Width = \"萼片宽度\",\n                 Petal.Length = \"花瓣长度\",\n                 Petal.Width = \"花瓣宽度\"\n               ),\n               conf.level = 0.95) +\n  scale_color_brewer(palette = \"Dark2\") + # 使用更好看的配色\n  theme_minimal() +\n  labs(title = \"回归模型系数对比\", \n       caption = \"注：误差棒表示 95% 置信区间\")",
    "crumbs": [
      "主页",
      "可视化教程",
      "GGally - 可视化扩展"
    ]
  },
  {
    "objectID": "2022-ggally.html#实战案例高维数据探索",
    "href": "2022-ggally.html#实战案例高维数据探索",
    "title": "GGally - 扩展 ggplot2 的可视化利器",
    "section": "📊 实战案例：高维数据探索",
    "text": "📊 实战案例：高维数据探索\n平行坐标图 (ggparcoord) 是展示多维数据（&gt;3维）模式的利器，特别适合观察分类效果或异常值。\n\n# 模拟一个稍复杂的数据处理场景\n# 1. 选取数值列\n# 2. 这里的 scale=\"globalminmax\" 保留了原始数据的相对大小，或者用 \"std\" (默认) 看相对趋势\nggparcoord(iris,\n           columns = 1:4,          \n           groupColumn = 5,        \n           order = \"anyClass\",     # 自动排序优化展示\n           showPoints = TRUE,      \n           scale = \"uniminmax\",    # 标准化到 0-1 之间，便于比较形状\n           alphaLines = 0.3) +     \n  scale_color_brewer(palette = \"Set1\") +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(size = 14, face = \"bold\"),\n    axis.text.x = element_text(angle = 15, hjust = 1)\n  ) +\n  labs(title = \"平行坐标图：标准化后的特征模式\",\n       y = \"Standardized Value (0-1)\",\n       x = \"Features\")",
    "crumbs": [
      "主页",
      "可视化教程",
      "GGally - 可视化扩展"
    ]
  },
  {
    "objectID": "2022-ggally.html#函数速查表",
    "href": "2022-ggally.html#函数速查表",
    "title": "GGally - 扩展 ggplot2 的可视化利器",
    "section": "📝 函数速查表",
    "text": "📝 函数速查表\n\n\n\n\n\n\n\n\n函数\n功能描述\n核心参数/技巧\n\n\n\n\nggpairs()\n矩阵散点图 (通用)\nupper/lower/diag 控制面板内容\n\n\nggbivariate()\n双变量分析 (Outcome vs X)\noutcome, explanatory 指定变量\n\n\nggcorr()\n相关性热图\nlabel = TRUE, nbreaks 颜色分段\n\n\nggtable()\n可视化交叉表\ncells = \"observed\" 显示数值\n\n\nggduo()\n双组变量矩阵\ncolumnsX, columnsY 两组对撞\n\n\nggnostic()\n模型诊断矩阵\n支持 lm, glm 等模型对象\n\n\nggcoef_model()\n模型系数图\ninclude_intercept = FALSE\n\n\nggparcoord()\n平行坐标图\nscale = \"uniminmax\" 归一化",
    "crumbs": [
      "主页",
      "可视化教程",
      "GGally - 可视化扩展"
    ]
  },
  {
    "objectID": "2022-ggally.html#参考资料",
    "href": "2022-ggally.html#参考资料",
    "title": "GGally - 扩展 ggplot2 的可视化利器",
    "section": "🔗 参考资料",
    "text": "🔗 参考资料\n\n官方文档 (Pkgdown)：本文结构参考了官方文档的 Core Functionality 分类。\n\nCore Functionality: 包含所有高级绘图函数的列表。\nVignette: ggpairs: 强烈推荐阅读，这是 GGally 最核心的功能。\n\nGitHub: https://github.com/ggobi/ggally",
    "crumbs": [
      "主页",
      "可视化教程",
      "GGally - 可视化扩展"
    ]
  },
  {
    "objectID": "sections/operation.html",
    "href": "sections/operation.html",
    "title": "实用操作",
    "section": "",
    "text": "日常科研中遇到的小技巧、环境配置和数据导入导出方法。让你的 R 工作流更加高效顺畅。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nrmarkdown教程-初学r语言推荐\n\n1 min\n\n\n\n\n\n\n\n\n\n\n\nQuarto vs RMarkdown 对比\n\n2 min\n\n\n\n\n\n\n\n\n\n\n\nR语言批量导入数据\n\n1 min\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "sections/visualization.html",
    "href": "sections/visualization.html",
    "title": "可视化教程",
    "section": "",
    "text": "“一图胜千言”，这里记录了 ggplot2 及其扩展包的绘图技巧。从基础配色到高级图表，帮助你制作出版级别的数据可视化。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nR语言配色教程\n\n29 min\n\n\n\n\n\n\n\n\n\n\n\npatchwork：拒绝ps，R内实现多图拼接\n\n2 min\n\n\n\n\n\n\n\n\n\n\n\nR语言图例修改自定义教程\n\n3 min\n\n\n\n\n\n\n\n\n\n\n\nR语言绘制桑基图详细教程\n\n5 min\n\n\n\n\n\n\n\n\n\n\n\nR语言采样地图绘制详细教程\n\n4 min\n\n\n\n\n\n\n\n\n\n\n\nR语言绘制森林图详细教程-forestplot\n\n5 min\n\n\n\n\n\n\n\n\n\n\n\nggtext：中英文混合字体的完美解决方案\n\n8 min\n\n\n\n\n\n\n\n\n\n\n\ntidyplots：简洁优雅的数据可视化\n\n7 min\n\n\n\n\n\n\n\n\n\n\n\n双坐标轴：左右两个 Y 轴的绑图技巧\n\n14 min\n\n\n\n\n\n\n\n\n\n\n\ncowplot: 专业图形组合与美化\n\n7 min\n\n\n\n\n\n\n\n\n\n\n\nGGally - 扩展 ggplot2 的可视化利器\n\n6 min\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "sections/methods.html#统计建模方法库",
    "href": "sections/methods.html#统计建模方法库",
    "title": "R 语言统计方法",
    "section": "",
    "text": "这里收集了使用 R 语言实现的各类分析方法，涵盖传统统计、生存分析、因果推断和高级建模等领域。每篇教程都从原理出发，配以完整的代码实现和可视化。"
  },
  {
    "objectID": "sections/methods.html#全部方法教程",
    "href": "sections/methods.html#全部方法教程",
    "title": "R 语言统计方法",
    "section": "📖 全部方法教程",
    "text": "📖 全部方法教程"
  },
  {
    "objectID": "1028-did.html",
    "href": "1028-did.html",
    "title": "双重差分法 (DiD) 完全指南",
    "section": "",
    "text": "双重差分法（Difference-in-Differences, DiD） 是一种准实验设计方法，用于估计政策干预或事件的因果效应。它通过比较处理组和对照组在干预前后的变化差异来识别效应。\n\n\n\\[\\text{DiD} = (\\bar{Y}_{treat,post} - \\bar{Y}_{treat,pre}) - (\\bar{Y}_{control,post} - \\bar{Y}_{control,pre})\\]\n\n\n\n对比\n含义\n\n\n\n\n第一重差分\n比较前后时间变化\n\n\n第二重差分\n比较处理组与对照组\n\n\n\n\n\n\n\n\n\n场景\n示例\n\n\n\n\n政策评估\n最低工资调整对就业的影响\n\n\n公共卫生\n禁烟令对健康的影响\n\n\n医疗干预\n新药上市对处方行为的影响\n\n\n教育政策\n学费补贴对入学率的影响\n\n\n\n\n\n\n平行趋势假设（Parallel Trends）： &gt; 如果没有干预，处理组和对照组的结局变量会呈现相同的时间趋势。\n这是 DiD 方法最关键的假设！",
    "crumbs": [
      "主页",
      "R 语言方法",
      "双重差分法 (DiD)"
    ]
  },
  {
    "objectID": "1028-did.html#什么是双重差分法",
    "href": "1028-did.html#什么是双重差分法",
    "title": "双重差分法 (DiD) 完全指南",
    "section": "",
    "text": "双重差分法（Difference-in-Differences, DiD） 是一种准实验设计方法，用于估计政策干预或事件的因果效应。它通过比较处理组和对照组在干预前后的变化差异来识别效应。\n\n\n\\[\\text{DiD} = (\\bar{Y}_{treat,post} - \\bar{Y}_{treat,pre}) - (\\bar{Y}_{control,post} - \\bar{Y}_{control,pre})\\]\n\n\n\n对比\n含义\n\n\n\n\n第一重差分\n比较前后时间变化\n\n\n第二重差分\n比较处理组与对照组\n\n\n\n\n\n\n\n\n\n场景\n示例\n\n\n\n\n政策评估\n最低工资调整对就业的影响\n\n\n公共卫生\n禁烟令对健康的影响\n\n\n医疗干预\n新药上市对处方行为的影响\n\n\n教育政策\n学费补贴对入学率的影响\n\n\n\n\n\n\n平行趋势假设（Parallel Trends）： &gt; 如果没有干预，处理组和对照组的结局变量会呈现相同的时间趋势。\n这是 DiD 方法最关键的假设！",
    "crumbs": [
      "主页",
      "R 语言方法",
      "双重差分法 (DiD)"
    ]
  },
  {
    "objectID": "1028-did.html#r-包安装与加载",
    "href": "1028-did.html#r-包安装与加载",
    "title": "双重差分法 (DiD) 完全指南",
    "section": "R 包安装与加载",
    "text": "R 包安装与加载\n\n# 核心包\nlibrary(tidyverse) # 数据处理\nlibrary(fixest) # 固定效应模型（推荐）\nlibrary(did) # Callaway & Sant'Anna DiD\nlibrary(plm) # 面板数据\nlibrary(ggplot2) # 可视化\nlibrary(broom) # 模型整理",
    "crumbs": [
      "主页",
      "R 语言方法",
      "双重差分法 (DiD)"
    ]
  },
  {
    "objectID": "1028-did.html#数据准备",
    "href": "1028-did.html#数据准备",
    "title": "双重差分法 (DiD) 完全指南",
    "section": "数据准备",
    "text": "数据准备\n模拟一个政策评估场景：某地区在 2018 年实施健康干预政策\n\n# 模拟面板数据\nset.seed(2024)\n\nn_units &lt;- 200 # 地区数\nn_periods &lt;- 8 # 时间期数 (2015-2022)\ntreat_time &lt;- 4 # 干预发生时点 (第4期=2018年)\n\n# 生成基础面板结构\npanel_data &lt;- expand_grid(\n    unit_id = 1:n_units,\n    time = 1:n_periods\n) |&gt;\n    mutate(\n        year = 2014 + time,\n\n        # 处理组分配（50%的地区接受干预）\n        treated = as.integer(unit_id &lt;= n_units / 2),\n\n        # 干预后标记\n        post = as.integer(time &gt;= treat_time),\n\n        # DiD 交互项\n        did = treated * post,\n\n        # 单位固定效应\n        unit_fe = rep(rnorm(n_units, 0, 5), each = n_periods),\n\n        # 时间固定效应\n        time_fe = rep(rnorm(n_periods, 0, 2), n_units),\n\n        # 个体时变协变量\n        population = round(100000 + 50000 * rnorm(n()) + 5000 * time),\n        income = round(30000 + 2000 * time + rnorm(n(), 0, 5000))\n    )\n\n# 生成结局变量：疾病发病率\n# 真实干预效应 = -3（降低 3 个发病率单位）\npanel_data &lt;- panel_data |&gt;\n    mutate(\n        # 基线发病率\n        baseline_rate = 50 + unit_fe + time_fe,\n\n        # 处理效应（真实效应 = -3）\n        treatment_effect = -3 * did,\n\n        # 平行趋势（干预前两组趋势相同）\n        common_trend = 0.5 * time,\n\n        # 最终结局\n        outcome = baseline_rate + common_trend + treatment_effect +\n            rnorm(n(), 0, 3),\n\n        # 转为因子\n        unit_id = factor(unit_id),\n        year = factor(year)\n    )\n\nglimpse(panel_data)\n\nRows: 1,600\nColumns: 14\n$ unit_id          &lt;fct&gt; 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3,…\n$ time             &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 1, 2, 3, 4, 5, 6, 7, 8, 1, 2,…\n$ year             &lt;fct&gt; 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2015,…\n$ treated          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…\n$ post             &lt;int&gt; 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0,…\n$ did              &lt;int&gt; 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0,…\n$ unit_fe          &lt;dbl&gt; 4.9098471, 4.9098471, 4.9098471, 4.9098471, 4.9098471…\n$ time_fe          &lt;dbl&gt; 0.004378923, 0.950728669, -1.555484993, 0.410755350, …\n$ population       &lt;dbl&gt; 149028, 131568, 80453, 147967, 96810, -7116, 167134, …\n$ income           &lt;dbl&gt; 26219, 36752, 46703, 30755, 36470, 36142, 46737, 5285…\n$ baseline_rate    &lt;dbl&gt; 54.91423, 55.86058, 53.35436, 55.32060, 56.95494, 52.…\n$ treatment_effect &lt;dbl&gt; 0, 0, 0, -3, -3, -3, -3, -3, 0, 0, 0, -3, -3, -3, -3,…\n$ common_trend     &lt;dbl&gt; 0.5, 1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 0.5, 1.0, 1.5…\n$ outcome          &lt;dbl&gt; 51.27613, 57.68301, 53.51673, 52.82152, 54.10289, 48.…\n\n\n\n探索性分析\n\n# 计算各组各时期的均值\ngroup_means &lt;- panel_data |&gt;\n    group_by(treated, time) |&gt;\n    summarise(\n        mean_outcome = mean(outcome),\n        se = sd(outcome) / sqrt(n()),\n        .groups = \"drop\"\n    ) |&gt;\n    mutate(\n        group = factor(treated, labels = c(\"对照组\", \"处理组\")),\n        year = 2014 + time\n    )\n\n# 可视化趋势\nggplot(group_means, aes(x = year, y = mean_outcome, color = group)) +\n    geom_line(linewidth = 1.2) +\n    geom_point(size = 3) +\n    geom_ribbon(aes(\n        ymin = mean_outcome - 1.96 * se,\n        ymax = mean_outcome + 1.96 * se,\n        fill = group\n    ), alpha = 0.2, color = NA) +\n    geom_vline(xintercept = 2017.5, linetype = \"dashed\", color = \"gray50\") +\n    annotate(\"text\",\n        x = 2017.5, y = max(group_means$mean_outcome),\n        label = \"干预实施\", hjust = -0.1, vjust = 1\n    ) +\n    scale_color_manual(values = c(\"#4f46e5\", \"#ef4444\")) +\n    scale_fill_manual(values = c(\"#4f46e5\", \"#ef4444\")) +\n    labs(\n        title = \"处理组与对照组的趋势比较\",\n        subtitle = \"干预前的平行趋势是 DiD 的关键假设\",\n        x = \"年份\",\n        y = \"发病率\",\n        color = \"组别\",\n        fill = \"组别\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(legend.position = \"bottom\")",
    "crumbs": [
      "主页",
      "R 语言方法",
      "双重差分法 (DiD)"
    ]
  },
  {
    "objectID": "1028-did.html#基础-did-估计",
    "href": "1028-did.html#基础-did-估计",
    "title": "双重差分法 (DiD) 完全指南",
    "section": "基础 DiD 估计",
    "text": "基础 DiD 估计\n\n2×2 DiD（最简单情况）\n\n# 保留干预前后各一期\ndid_2x2 &lt;- panel_data |&gt;\n    filter(time %in% c(3, 5)) # 干预前一期 vs 干预后一期\n\n# 基础 DiD 回归\nbasic_did &lt;- lm(outcome ~ treated + post + did, data = did_2x2)\nsummary(basic_did)\n\n\nCall:\nlm(formula = outcome ~ treated + post + did, data = did_2x2)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-18.5866  -3.9671  -0.1156   4.0321  16.3757 \n\nCoefficients:\n            Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)  50.7672     0.6081  83.485  &lt; 2e-16 ***\ntreated      -1.3255     0.8600  -1.541   0.1240    \npost          4.3712     0.8600   5.083 5.74e-07 ***\ndid          -2.7537     1.2162  -2.264   0.0241 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 6.081 on 396 degrees of freedom\nMultiple R-squared:  0.1104,    Adjusted R-squared:  0.1036 \nF-statistic: 16.37 on 3 and 396 DF,  p-value: 4.748e-10\n\n\n\n# 解读：did 系数就是 DiD 估计量\ncat(\"DiD 估计量:\", round(coef(basic_did)[\"did\"], 3), \"\\n\")\n\nDiD 估计量: -2.754 \n\ncat(\"真实效应: -3.000\\n\")\n\n真实效应: -3.000\n\n\n\n\n手动计算 DiD\n\n# 手动验证 DiD\nmeans_table &lt;- panel_data |&gt;\n    filter(time %in% c(3, 5)) |&gt;\n    group_by(treated, post) |&gt;\n    summarise(mean_y = mean(outcome), .groups = \"drop\") |&gt;\n    pivot_wider(\n        names_from = post, values_from = mean_y,\n        names_prefix = \"post_\"\n    )\n\nmeans_table\n\n# A tibble: 2 × 3\n  treated post_0 post_1\n    &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;\n1       0   50.8   55.1\n2       1   49.4   51.1\n\n# DiD = (处理组后 - 处理组前) - (对照组后 - 对照组前)\ndid_manual &lt;- (means_table$post_1[2] - means_table$post_0[2]) -\n    (means_table$post_1[1] - means_table$post_0[1])\ncat(\"手动计算 DiD:\", round(did_manual, 3), \"\\n\")\n\n手动计算 DiD: -2.754",
    "crumbs": [
      "主页",
      "R 语言方法",
      "双重差分法 (DiD)"
    ]
  },
  {
    "objectID": "1028-did.html#双向固定效应-didtwfe",
    "href": "1028-did.html#双向固定效应-didtwfe",
    "title": "双重差分法 (DiD) 完全指南",
    "section": "双向固定效应 DiD（TWFE）",
    "text": "双向固定效应 DiD（TWFE）\n使用面板数据的标准方法：\n\n# 使用 fixest 包（推荐）\ntwfe_model &lt;- feols(\n    outcome ~ did | unit_id + year, # 单位固定效应 + 时间固定效应\n    data = panel_data,\n    cluster = ~unit_id # 聚类标准误\n)\n\nsummary(twfe_model)\n\nOLS estimation, Dep. Var.: outcome\nObservations: 1,600\nFixed-effects: unit_id: 200,  year: 8\nStandard-errors: Clustered (unit_id) \n    Estimate Std. Error  t value  Pr(&gt;|t|)    \ndid -2.84542   0.297556 -9.56264 &lt; 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 2.8407     Adj. R2: 0.760579\n               Within R2: 0.055525\n\n\n\n添加控制变量\n\n# 添加时变协变量\ntwfe_controls &lt;- feols(\n    outcome ~ did + log(population) + log(income) | unit_id + year,\n    data = panel_data,\n    cluster = ~unit_id\n)\n\nsummary(twfe_controls)\n\nOLS estimation, Dep. Var.: outcome\nObservations: 1,591\nFixed-effects: unit_id: 200,  year: 8\nStandard-errors: Clustered (unit_id) \n                 Estimate Std. Error   t value  Pr(&gt;|t|)    \ndid             -2.818033   0.295763 -9.527999 &lt; 2.2e-16 ***\nlog(population) -0.115437   0.155857 -0.740660   0.45977    \nlog(income)      0.495693   0.590165  0.839922   0.40196    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 2.84025     Adj. R2: 0.760808\n                Within R2: 0.054949\n\n\n\n\n模型比较\n\n# 使用 fixest 的模型比较表格\netable(twfe_model, twfe_controls,\n    headers = c(\"基础模型\", \"含控制变量\"),\n    fitstat = c(\"n\", \"r2\", \"ar2\")\n)\n\n                        twfe_model      twfe_controls\n                      基础模型    含控制变量\nDependent Var.:            outcome            outcome\n                                                     \ndid             -2.845*** (0.2976) -2.818*** (0.2958)\nlog(population)                      -0.1154 (0.1559)\nlog(income)                           0.4957 (0.5902)\nFixed-Effects:  ------------------ ------------------\nunit_id                        Yes                Yes\nyear                           Yes                Yes\n_______________ __________________ __________________\nS.E.: Clustered        by: unit_id        by: unit_id\nObservations                 1,600              1,591\nR2                         0.79157            0.79225\nAdj. R2                    0.76058            0.76081\n---\nSignif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1",
    "crumbs": [
      "主页",
      "R 语言方法",
      "双重差分法 (DiD)"
    ]
  },
  {
    "objectID": "1028-did.html#平行趋势检验",
    "href": "1028-did.html#平行趋势检验",
    "title": "双重差分法 (DiD) 完全指南",
    "section": "平行趋势检验",
    "text": "平行趋势检验\n\n事件研究法（Event Study）\n事件研究法是检验平行趋势的标准方法：\n\n# 创建相对时间变量\npanel_data &lt;- panel_data |&gt;\n    mutate(\n        rel_time = time - treat_time,\n        # 创建各期指示变量（处理组 × 相对时期）\n        rel_time_factor = factor(rel_time)\n    )\n\n# 事件研究回归（以 t-1 为参照期）\nes_model &lt;- feols(\n    outcome ~ i(rel_time_factor, treated, ref = -1) | unit_id + year,\n    data = panel_data,\n    cluster = ~unit_id\n)\n\nsummary(es_model)\n\nOLS estimation, Dep. Var.: outcome\nObservations: 1,600\nFixed-effects: unit_id: 200,  year: 8\nStandard-errors: Clustered (unit_id) \n                             Estimate Std. Error   t value   Pr(&gt;|t|)    \nrel_time_factor::-3:treated  0.261268   0.583770  0.447552 6.5496e-01    \nrel_time_factor::-2:treated  0.405381   0.613904  0.660333 5.0980e-01    \nrel_time_factor::0:treated  -2.865183   0.551963 -5.190901 5.1468e-07 ***\nrel_time_factor::1:treated  -2.753691   0.629742 -4.372727 1.9767e-05 ***\nrel_time_factor::2:treated  -2.487630   0.583297 -4.264777 3.0907e-05 ***\nrel_time_factor::3:treated  -2.860663   0.615626 -4.646752 6.1265e-06 ***\nrel_time_factor::4:treated  -2.148864   0.617776 -3.478385 6.1956e-04 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 2.83817     Adj. R2: 0.75997 \n                Within R2: 0.057206\n\n\n\n# 可视化事件研究图\niplot(es_model,\n    main = \"事件研究图（Event Study）\",\n    xlab = \"相对于干预的时期\",\n    ylab = \"DiD 估计量\"\n)\n\n# 添加参照线\nabline(h = 0, lty = 2, col = \"gray\")\nabline(v = -0.5, lty = 2, col = \"red\")\n\n\n\n\n\n\n\n\n\n\n自定义事件研究图\n\n# 提取事件研究系数\nes_coefs &lt;- tidy(es_model, conf.int = TRUE) |&gt;\n    filter(str_detect(term, \"rel_time\")) |&gt;\n    mutate(\n        rel_time = as.numeric(str_extract(term, \"-?\\\\d+\")),\n        significant = p.value &lt; 0.05\n    )\n\n# 添加参照期（t-1 = 0）\nes_coefs &lt;- bind_rows(\n    es_coefs,\n    tibble(rel_time = -1, estimate = 0, conf.low = 0, conf.high = 0)\n) |&gt;\n    arrange(rel_time)\n\n# 高质量可视化\nggplot(es_coefs, aes(x = rel_time, y = estimate)) +\n    # 阴影区分干预前后\n    annotate(\"rect\",\n        xmin = -0.5, xmax = Inf, ymin = -Inf, ymax = Inf,\n        fill = \"#fee2e2\", alpha = 0.5\n    ) +\n    # 参照线\n    geom_hline(yintercept = 0, linetype = \"dashed\", color = \"gray50\") +\n    geom_vline(xintercept = -0.5, linetype = \"solid\", color = \"#ef4444\") +\n    # 置信区间\n    geom_errorbar(aes(ymin = conf.low, ymax = conf.high),\n        width = 0.2, color = \"#4f46e5\"\n    ) +\n    # 点估计\n    geom_point(size = 3, color = \"#4f46e5\") +\n    geom_line(linetype = \"dashed\", color = \"#4f46e5\", alpha = 0.5) +\n    # 标注干预点\n    annotate(\"text\",\n        x = 0.5, y = max(es_coefs$estimate, na.rm = TRUE),\n        label = \"干预后\", color = \"#ef4444\", fontface = \"bold\"\n    ) +\n    labs(\n        title = \"事件研究图：平行趋势检验\",\n        subtitle = \"干预前系数应接近 0（平行趋势假设）\",\n        x = \"相对于干预的时期\",\n        y = \"估计效应\",\n        caption = \"误差棒: 95% 置信区间 | 参照期: t-1\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(plot.title = element_text(face = \"bold\"))\n\n\n\n\n\n\n\n\n\n\n平行趋势的正式检验\n\n# 联合检验：干预前所有系数是否同时为 0\npre_treatment_terms &lt;- names(coef(es_model))[str_detect(names(coef(es_model)), \":-[2-9]|:-1[0-9]\")]\n\n# 如果有干预前的系数，进行 F 检验\nif (length(pre_treatment_terms) &gt; 0) {\n    wald_test &lt;- wald(es_model, pre_treatment_terms)\n    print(wald_test)\n}\n\nWald test, H0: joint nullity of rel_time_factor::-3:treated and rel_time_factor::-2:treated\n stat = 0.233644, p-value = 0.791675, on 2 and 1,386 DoF, VCOV: Clustered (unit_id).$stat\n[1] 0.2336438\n\n$p\n[1] 0.791675\n\n$df1\n[1] 2\n\n$df2\n[1] 1386\n\n$vcov\n[1] \"Clustered (unit_id)\"",
    "crumbs": [
      "主页",
      "R 语言方法",
      "双重差分法 (DiD)"
    ]
  },
  {
    "objectID": "1028-did.html#交错处理-did",
    "href": "1028-did.html#交错处理-did",
    "title": "双重差分法 (DiD) 完全指南",
    "section": "交错处理 DiD",
    "text": "交错处理 DiD\n当不同单位在不同时间接受处理时：\n\n# 模拟交错处理数据\nset.seed(42)\n\nstaggered_data &lt;- expand_grid(\n    unit_id = 1:100,\n    time = 1:10\n) |&gt;\n    mutate(\n        # 不同单位的处理时点\n        treat_time_unit = case_when(\n            unit_id &lt;= 30 ~ 4, # 第一组：第4期处理\n            unit_id &lt;= 60 ~ 6, # 第二组：第6期处理\n            unit_id &lt;= 80 ~ 8, # 第三组：第8期处理\n            TRUE ~ NA_real_ # 对照组：从不处理\n        ),\n\n        # 处理状态\n        treated = as.integer(!is.na(treat_time_unit) & time &gt;= treat_time_unit),\n\n        # 结局变量\n        outcome = 50 + rnorm(n(), unit_id / 5, 3) + 0.5 * time - 2.5 * treated + rnorm(n(), 0, 2),\n        unit_id = factor(unit_id),\n        year = factor(2014 + time),\n        cohort = factor(case_when(\n            treat_time_unit == 4 ~ \"2018\",\n            treat_time_unit == 6 ~ \"2020\",\n            treat_time_unit == 8 ~ \"2022\",\n            TRUE ~ \"从不处理\"\n        ))\n    )\n\nhead(staggered_data)\n\n# A tibble: 6 × 7\n  unit_id  time treat_time_unit treated outcome year  cohort\n  &lt;fct&gt;   &lt;int&gt;           &lt;dbl&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt; \n1 1           1               4       0    59.5 2015  2018  \n2 1           2               4       0    50.6 2016  2018  \n3 1           3               4       0    54.7 2017  2018  \n4 1           4               4       1    52.4 2018  2018  \n5 1           5               4       1    49.4 2019  2018  \n6 1           6               4       1    49.2 2020  2018  \n\n\n\nCallaway-Sant’Anna 估计器\n\n# 使用 did 包的现代方法\nstaggered_data_num &lt;- staggered_data |&gt;\n    mutate(\n        unit_id = as.numeric(as.character(unit_id)),\n        time = 2014 + as.numeric(as.character(year)) - 2014,\n        first_treat = treat_time_unit + 2014,\n        first_treat = ifelse(is.na(first_treat), 0, first_treat) # 从不处理设为 0\n    )\n\n# Callaway-Sant'Anna ATT(g,t)\ncs_result &lt;- att_gt(\n    yname = \"outcome\",\n    tname = \"time\",\n    idname = \"unit_id\",\n    gname = \"first_treat\",\n    data = as.data.frame(staggered_data_num),\n    control_group = \"nevertreated\" # 使用从不处理组作为对照\n)\n\nsummary(cs_result)\n\n\nCall:\natt_gt(yname = \"outcome\", tname = \"time\", idname = \"unit_id\", \n    gname = \"first_treat\", data = as.data.frame(staggered_data_num), \n    control_group = \"nevertreated\")\n\nReference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. &lt;https://doi.org/10.1016/j.jeconom.2020.12.001&gt;, &lt;https://arxiv.org/abs/1803.09015&gt; \n\nGroup-Time Average Treatment Effects:\n Group Time ATT(g,t) Std. Error [95% Simult.  Conf. Band]  \n  2018 2016  -1.4185     1.4147       -5.5896      2.7527  \n  2018 2017   0.5697     1.2634       -3.1554      4.2947  \n  2018 2018  -0.7454     1.2441       -4.4138      2.9229  \n  2018 2019  -1.8390     1.4593       -6.1417      2.4637  \n  2018 2020  -1.7104     1.5705       -6.3412      2.9204  \n  2018 2021  -1.3518     1.2803       -5.1268      2.4231  \n  2018 2022  -3.5454     1.3629       -7.5640      0.4732  \n  2018 2023  -4.3045     1.5907       -8.9946      0.3857  \n  2018 2024  -2.4410     1.9255       -8.1183      3.2362  \n  2020 2016  -2.8201     1.4833       -7.1935      1.5533  \n  2020 2017   0.4182     1.2621       -3.3033      4.1397  \n  2020 2018   0.5867     1.2960       -3.2346      4.4080  \n  2020 2019   2.9767     1.2955       -0.8431      6.7964  \n  2020 2020  -4.2941     1.6671       -9.2096      0.6213  \n  2020 2021  -4.7660     1.4661       -9.0888     -0.4433 *\n  2020 2022  -6.4106     1.4336      -10.6375     -2.1836 *\n  2020 2023  -5.7517     1.6456      -10.6039     -0.8995 *\n  2020 2024  -6.1822     1.9778      -12.0138     -0.3506 *\n  2022 2016  -1.1763     1.6367       -6.0022      3.6496  \n  2022 2017  -1.2594     1.5486       -5.8254      3.3066  \n  2022 2018   1.9291     1.4074       -2.2208      6.0789  \n  2022 2019   1.5848     1.3592       -2.4228      5.5923  \n  2022 2020  -1.3853     1.7944       -6.6760      3.9055  \n  2022 2021  -1.8428     1.5575       -6.4352      2.7496  \n  2022 2022  -1.4912     1.3927       -5.5977      2.6154  \n  2022 2023  -2.7435     1.6262       -7.5385      2.0515  \n  2022 2024  -1.8666     1.7832       -7.1243      3.3910  \n---\nSignif. codes: `*' confidence band does not cover 0\n\nP-value for pre-test of parallel trends assumption:  0.27625\nControl Group:  Never Treated,  Anticipation Periods:  0\nEstimation Method:  Doubly Robust\n\n\n\n# 聚合为整体 ATT\ncs_agg &lt;- aggte(cs_result, type = \"simple\")\nsummary(cs_agg)\n\n\nCall:\naggte(MP = cs_result, type = \"simple\")\n\nReference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. &lt;https://doi.org/10.1016/j.jeconom.2020.12.001&gt;, &lt;https://arxiv.org/abs/1803.09015&gt; \n\n     ATT    Std. Error     [ 95%  Conf. Int.]  \n -3.3864        0.7648    -4.8853     -1.8875 *\n\n\n---\nSignif. codes: `*' confidence band does not cover 0\n\nControl Group:  Never Treated,  Anticipation Periods:  0\nEstimation Method:  Doubly Robust\n\n\n\n# 事件研究图\ncs_dynamic &lt;- aggte(cs_result, type = \"dynamic\")\nggdid(cs_dynamic, title = \"交错 DiD 事件研究图\")",
    "crumbs": [
      "主页",
      "R 语言方法",
      "双重差分法 (DiD)"
    ]
  },
  {
    "objectID": "1028-did.html#安慰剂检验",
    "href": "1028-did.html#安慰剂检验",
    "title": "双重差分法 (DiD) 完全指南",
    "section": "安慰剂检验",
    "text": "安慰剂检验\n\n时间安慰剂\n\n# 假设干预发生在更早的时间\npanel_data_placebo &lt;- panel_data |&gt;\n    mutate(\n        # 假装干预在 t=2 时发生\n        fake_post = as.integer(time &gt;= 2 & time &lt; 4),\n        fake_did = treated * fake_post\n    ) |&gt;\n    filter(time &lt; 4) # 只用干预前数据\n\nplacebo_model &lt;- feols(\n    outcome ~ fake_did | unit_id + time,\n    data = panel_data_placebo,\n    cluster = ~unit_id\n)\n\nsummary(placebo_model)\n\nOLS estimation, Dep. Var.: outcome\nObservations: 600\nFixed-effects: unit_id: 200,  time: 3\nStandard-errors: Clustered (unit_id) \n          Estimate Std. Error   t value Pr(&gt;|t|) \nfake_did -0.058577   0.526645 -0.111227  0.91155 \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 2.48101     Adj. R2: 0.749052\n                Within R2: 3.097e-5\n\n# 如果 fake_did 显著，说明平行趋势假设可能不满足\n\n\n\n组别安慰剂\n\n# 在从未处理的组中随机分配\"假处理\"\nnever_treated &lt;- panel_data |&gt;\n    filter(treated == 0) |&gt;\n    mutate(\n        fake_treated = as.integer(unit_id %in% sample(\n            unique(unit_id),\n            length(unique(unit_id)) / 2\n        )),\n        fake_did = fake_treated * post\n    )\n\nplacebo_group &lt;- feols(\n    outcome ~ fake_did | unit_id + year,\n    data = never_treated,\n    cluster = ~unit_id\n)\n\nsummary(placebo_group)\n\nOLS estimation, Dep. Var.: outcome\nObservations: 800\nFixed-effects: unit_id: 100,  year: 8\nStandard-errors: Clustered (unit_id) \n         Estimate Std. Error  t value Pr(&gt;|t|) \nfake_did 0.353765   0.442619 0.799253  0.42606 \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 2.78359     Adj. R2: 0.756684\n                Within R2: 9.455e-4\n\n# fake_did 应该不显著",
    "crumbs": [
      "主页",
      "R 语言方法",
      "双重差分法 (DiD)"
    ]
  },
  {
    "objectID": "1028-did.html#结果可视化",
    "href": "1028-did.html#结果可视化",
    "title": "双重差分法 (DiD) 完全指南",
    "section": "结果可视化",
    "text": "结果可视化\n\nDiD 图解\n\n# 创建直观的 DiD 可视化\ndid_visual &lt;- panel_data |&gt;\n    group_by(treated, post) |&gt;\n    summarise(mean_y = mean(outcome), .groups = \"drop\") |&gt;\n    mutate(\n        group = factor(treated, labels = c(\"对照组\", \"处理组\")),\n        period = factor(post, labels = c(\"干预前\", \"干预后\"))\n    )\n\n# 绘图\nggplot(did_visual, aes(x = period, y = mean_y, color = group, group = group)) +\n    geom_line(linewidth = 1.5) +\n    geom_point(size = 4) +\n    # 添加反事实线\n    geom_segment(\n        aes(\n            x = 1, xend = 2,\n            y = did_visual$mean_y[did_visual$group == \"处理组\" & did_visual$period == \"干预前\"],\n            yend = did_visual$mean_y[did_visual$group == \"处理组\" & did_visual$period == \"干预前\"] +\n                diff(did_visual$mean_y[did_visual$group == \"对照组\"])\n        ),\n        linetype = \"dashed\", color = \"#ef4444\", alpha = 0.5, linewidth = 1\n    ) +\n    # 标注 DiD\n    annotate(\"segment\",\n        x = 2.1, xend = 2.1,\n        y = did_visual$mean_y[did_visual$group == \"处理组\" & did_visual$period == \"干预后\"],\n        yend = did_visual$mean_y[did_visual$group == \"处理组\" & did_visual$period == \"干预前\"] +\n            diff(did_visual$mean_y[did_visual$group == \"对照组\"]),\n        arrow = arrow(length = unit(0.3, \"cm\"), ends = \"both\"),\n        color = \"#22c55e\"\n    ) +\n    annotate(\"text\",\n        x = 2.2, y = mean(did_visual$mean_y),\n        label = \"DiD\\n效应\", color = \"#22c55e\", fontface = \"bold\"\n    ) +\n    scale_color_manual(values = c(\"#4f46e5\", \"#ef4444\")) +\n    labs(\n        title = \"双重差分法图解\",\n        subtitle = \"虚线: 处理组的反事实趋势（如果未受干预）\",\n        x = \"时期\",\n        y = \"结局变量\",\n        color = \"组别\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(legend.position = \"bottom\")",
    "crumbs": [
      "主页",
      "R 语言方法",
      "双重差分法 (DiD)"
    ]
  },
  {
    "objectID": "1028-did.html#异质性分析",
    "href": "1028-did.html#异质性分析",
    "title": "双重差分法 (DiD) 完全指南",
    "section": "异质性分析",
    "text": "异质性分析\n\n# 按协变量分组估计异质性效应\npanel_data &lt;- panel_data |&gt;\n    mutate(\n        income_group = ifelse(income &gt; median(income), \"高收入\", \"低收入\")\n    )\n\n# 分组回归\nhet_model &lt;- feols(\n    outcome ~ did | unit_id + year,\n    data = panel_data,\n    cluster = ~unit_id,\n    split = ~income_group\n)\n\netable(het_model)\n\n                             het_model.1        het_model.2\nSample (income_group)          低收入          高收入\nDependent Var.:                  outcome            outcome\n                                                           \ndid                   -3.387*** (0.4936) -2.238*** (0.5974)\nFixed-Effects:        ------------------ ------------------\nunit_id                              Yes                Yes\nyear                                 Yes                Yes\n_____________________ __________________ __________________\nS.E.: Clustered              by: unit_id        by: unit_id\nObservations                         799                798\nR2                               0.83248            0.81211\nWithin R2                        0.07877            0.01714\n---\nSignif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1",
    "crumbs": [
      "主页",
      "R 语言方法",
      "双重差分法 (DiD)"
    ]
  },
  {
    "objectID": "1028-did.html#常见问题与陷阱",
    "href": "1028-did.html#常见问题与陷阱",
    "title": "双重差分法 (DiD) 完全指南",
    "section": "常见问题与陷阱",
    "text": "常见问题与陷阱\n\n1. 平行趋势假设\n# 这是 DiD 的核心假设，无法直接检验\n# 解决方案：\n# - 事件研究图\n# - 安慰剂检验\n# - 收集更多干预前时期\n# - 使用合成控制法作为补充\n\n\n2. 预期效应\n# 如果处理组在干预前就开始改变行为\n# 干预前系数可能不为 0\n# 需要理解政策公布和实施的时间差\n\n\n3. 溢出效应\n# 如果处理影响了对照组\n# DiD 估计会有偏\n# 需要选择不受影响的对照组\n\n\n4. 交错处理下的 TWFE 问题\n# 标准 TWFE 在交错处理下可能有偏\n# 推荐使用：\n# - Callaway-Sant'Anna (2021)\n# - Sun-Abraham (2021)\n# - de Chaisemartin-D'Haultfœuille (2020)\n\n\n5. 标准误聚类\n# 面板数据通常需要在处理单位层面聚类\n# 如果处理单位少（&lt; 50），考虑 Wild bootstrap",
    "crumbs": [
      "主页",
      "R 语言方法",
      "双重差分法 (DiD)"
    ]
  },
  {
    "objectID": "1028-did.html#完整分析模板",
    "href": "1028-did.html#完整分析模板",
    "title": "双重差分法 (DiD) 完全指南",
    "section": "完整分析模板",
    "text": "完整分析模板\n\n# ========== DiD 分析完整流程 ==========\n\nlibrary(fixest)\nlibrary(did)\n\n# 1. 数据准备\ndata &lt;- data |&gt;\n    mutate(\n        did = treated * post\n    )\n\n# 2. 可视化趋势\n# 检查干预前是否平行\n\n# 3. 基础 TWFE 估计\nmodel &lt;- feols(y ~ did | unit + time, data, cluster = ~unit)\n\n# 4. 事件研究\nes &lt;- feols(y ~ i(rel_time, treated, ref = -1) | unit + time, data)\niplot(es)\n\n# 5. 安慰剂检验\n# 时间安慰剂 + 组别安慰剂\n\n# 6. 稳健性检验\n# - 不同控制组\n# - 不同时间窗口\n# - 添加/移除控制变量\n\n# 7. 交错处理（如适用）\ncs &lt;- att_gt(yname, tname, idname, gname, data)\naggte(cs, type = \"simple\")",
    "crumbs": [
      "主页",
      "R 语言方法",
      "双重差分法 (DiD)"
    ]
  },
  {
    "objectID": "1028-did.html#总结",
    "href": "1028-did.html#总结",
    "title": "双重差分法 (DiD) 完全指南",
    "section": "总结",
    "text": "总结\n\n\n\n步骤\n内容\nR 函数/包\n\n\n\n\n数据准备\n创建 DiD 交互项\nmutate()\n\n\n趋势可视化\n检查平行趋势\nggplot2\n\n\nTWFE 估计\n双向固定效应\nfixest::feols()\n\n\n事件研究\n平行趋势检验\ni() + iplot()\n\n\n交错 DiD\n现代估计器\ndid::att_gt()\n\n\n安慰剂检验\n稳健性\n手动构造\n\n\n\n\n报告 DiD 分析的 Checklist\n\n清晰描述干预/政策\n定义处理组和对照组\n提供干预前后的趋势图\n报告事件研究图（检验平行趋势）\n报告 DiD 估计量及置信区间\n说明标准误聚类方式\n进行安慰剂检验\n讨论潜在威胁（预期效应、溢出等）\n\n\n\n推荐阅读\n\nCunningham S. Causal Inference: The Mixtape\nAngrist JD, Pischke JS. Mostly Harmless Econometrics\nCallaway B, Sant’Anna PHC (2021). Difference-in-Differences with Multiple Time Periods. J Econometrics\nfixest 包文档\ndid 包文档",
    "crumbs": [
      "主页",
      "R 语言方法",
      "双重差分法 (DiD)"
    ]
  },
  {
    "objectID": "1023-mediation.html",
    "href": "1023-mediation.html",
    "title": "中介效应分析完全指南",
    "section": "",
    "text": "中介效应（Mediation Effect） 分析用于探索自变量 X 如何通过中介变量 M 影响因变量 Y 的机制。它回答的核心问题是：“效应是如何传递的？”\n\n\n        a           b\n    X ----→ M ----→ Y\n        \\         ↗\n         \\-------/\n            c'\n\n\n\n路径\n名称\n含义\n\n\n\n\na\nX → M 路径\n自变量对中介变量的效应\n\n\nb\nM → Y 路径\n控制 X 后，中介变量对因变量的效应\n\n\nc\n总效应\nX 对 Y 的总效应\n\n\nc’\n直接效应\n控制 M 后，X 对 Y 的直接效应\n\n\na×b\n间接效应\n通过 M 传递的效应\n\n\n\n\n\n\n\\[\\text{总效应 (c)} = \\text{直接效应 (c')} + \\text{间接效应 (a×b)}\\]\n\n\n\n\n\n\n场景\n示例\n\n\n\n\n行为机制研究\n锻炼如何通过自我效能感影响健康\n\n\n干预机制\n培训如何通过技能提升影响绩效\n\n\n流行病学\n社会经济地位如何通过生活方式影响疾病\n\n\n心理学研究\n依恋风格如何通过情绪调节影响心理健康",
    "crumbs": [
      "主页",
      "R 语言方法",
      "中介效应分析"
    ]
  },
  {
    "objectID": "1023-mediation.html#什么是中介效应",
    "href": "1023-mediation.html#什么是中介效应",
    "title": "中介效应分析完全指南",
    "section": "",
    "text": "中介效应（Mediation Effect） 分析用于探索自变量 X 如何通过中介变量 M 影响因变量 Y 的机制。它回答的核心问题是：“效应是如何传递的？”\n\n\n        a           b\n    X ----→ M ----→ Y\n        \\         ↗\n         \\-------/\n            c'\n\n\n\n路径\n名称\n含义\n\n\n\n\na\nX → M 路径\n自变量对中介变量的效应\n\n\nb\nM → Y 路径\n控制 X 后，中介变量对因变量的效应\n\n\nc\n总效应\nX 对 Y 的总效应\n\n\nc’\n直接效应\n控制 M 后，X 对 Y 的直接效应\n\n\na×b\n间接效应\n通过 M 传递的效应\n\n\n\n\n\n\n\\[\\text{总效应 (c)} = \\text{直接效应 (c')} + \\text{间接效应 (a×b)}\\]\n\n\n\n\n\n\n场景\n示例\n\n\n\n\n行为机制研究\n锻炼如何通过自我效能感影响健康\n\n\n干预机制\n培训如何通过技能提升影响绩效\n\n\n流行病学\n社会经济地位如何通过生活方式影响疾病\n\n\n心理学研究\n依恋风格如何通过情绪调节影响心理健康",
    "crumbs": [
      "主页",
      "R 语言方法",
      "中介效应分析"
    ]
  },
  {
    "objectID": "1023-mediation.html#r-包安装与加载",
    "href": "1023-mediation.html#r-包安装与加载",
    "title": "中介效应分析完全指南",
    "section": "R 包安装与加载",
    "text": "R 包安装与加载\n\n# 核心包\nlibrary(mediation) # 经典中介分析\nlibrary(lavaan) # 结构方程模型\nlibrary(tidyverse) # 数据处理\nlibrary(broom) # 模型整理\n\n# 可选：bruceR 和 processR 需要额外安装\n# library(bruceR)       # 中介分析辅助\n# library(processR)     # PROCESS 宏的 R 实现",
    "crumbs": [
      "主页",
      "R 语言方法",
      "中介效应分析"
    ]
  },
  {
    "objectID": "1023-mediation.html#数据准备",
    "href": "1023-mediation.html#数据准备",
    "title": "中介效应分析完全指南",
    "section": "数据准备",
    "text": "数据准备\n使用模拟数据：工作压力 → 工作倦怠 → 离职意向\n\n# 模拟数据\nset.seed(2024)\nn &lt;- 400\n\nwork_data &lt;- tibble(\n  id = 1:n,\n  # 控制变量\n  age = round(rnorm(n, 35, 8)),\n  gender = factor(sample(c(\"男\", \"女\"), n, replace = TRUE)),\n  tenure = round(pmax(1, rnorm(n, 5, 3))),\n\n  # 自变量：工作压力 (1-7 量表)\n  stress = round(pmin(7, pmax(1, rnorm(n, 4, 1.2))), 1)\n) |&gt;\n  mutate(\n    # 中介变量：工作倦怠 (受压力影响)\n    burnout = round(pmin(7, pmax(\n      1,\n      1.5 + 0.8 * stress + 0.02 * age + rnorm(n, 0, 0.8)\n    )), 1),\n\n    # 因变量：离职意向 (受压力和倦怠影响)\n    turnover = round(pmin(7, pmax(\n      1,\n      0.5 + 0.3 * stress + 0.6 * burnout - 0.05 * tenure + rnorm(n, 0, 0.7)\n    )), 1)\n  )\n\n# 查看数据\nglimpse(work_data)\n\nRows: 400\nColumns: 7\n$ id       &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18…\n$ age      &lt;dbl&gt; 43, 39, 34, 33, 44, 45, 39, 34, 25, 26, 22, 39, 42, 37, 9, 34…\n$ gender   &lt;fct&gt; 男, 男, 男, 男, 女, 女, 男, 女, 女, 女, 男, 男, 男, 男, 女, 男, 女, 女, 女, 男, 男…\n$ tenure   &lt;dbl&gt; 1, 9, 7, 5, 6, 2, 5, 1, 5, 4, 1, 9, 3, 10, 6, 2, 8, 12, 5, 5,…\n$ stress   &lt;dbl&gt; 3.9, 3.4, 2.9, 3.6, 3.8, 3.1, 2.9, 2.3, 4.5, 3.2, 4.6, 4.8, 2…\n$ burnout  &lt;dbl&gt; 5.3, 5.8, 4.0, 3.1, 6.2, 6.2, 3.7, 2.8, 5.3, 4.0, 7.0, 6.3, 4…\n$ turnover &lt;dbl&gt; 4.0, 5.4, 3.3, 3.8, 5.0, 4.7, 3.6, 2.4, 4.0, 4.0, 7.0, 4.3, 3…\n\n# 描述统计\nwork_data |&gt;\n  select(stress, burnout, turnover) |&gt;\n  psych::describe() |&gt;\n  select(mean, sd, min, max)\n\n         mean   sd min max\nstress   4.03 1.15 1.0   7\nburnout  5.38 1.10 2.3   7\nturnover 4.71 1.16 1.4   7\n\n\n\n相关分析\n\n# 计算相关矩阵\ncor_matrix &lt;- work_data |&gt;\n  select(stress, burnout, turnover) |&gt;\n  cor()\n\nround(cor_matrix, 3)\n\n         stress burnout turnover\nstress    1.000   0.737    0.678\nburnout   0.737   1.000    0.792\nturnover  0.678   0.792    1.000",
    "crumbs": [
      "主页",
      "R 语言方法",
      "中介效应分析"
    ]
  },
  {
    "objectID": "1023-mediation.html#方法一baron-kenny-逐步法",
    "href": "1023-mediation.html#方法一baron-kenny-逐步法",
    "title": "中介效应分析完全指南",
    "section": "方法一：Baron-Kenny 逐步法",
    "text": "方法一：Baron-Kenny 逐步法\n传统的 Baron-Kenny 方法通过三步回归检验中介效应。\n\n步骤 1：检验总效应 (c 路径)\n\n# X → Y（不控制 M）\nstep1 &lt;- lm(turnover ~ stress, data = work_data)\nsummary(step1)\n\n\nCall:\nlm(formula = turnover ~ stress, data = work_data)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-2.60645 -0.54598  0.05998  0.63239  2.16969 \n\nCoefficients:\n            Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)  1.94682    0.15649   12.44   &lt;2e-16 ***\nstress       0.68654    0.03736   18.38   &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.8561 on 398 degrees of freedom\nMultiple R-squared:  0.4591,    Adjusted R-squared:  0.4577 \nF-statistic: 337.8 on 1 and 398 DF,  p-value: &lt; 2.2e-16\n\n# 提取总效应\nc_total &lt;- coef(step1)[\"stress\"]\ncat(\"总效应 c =\", round(c_total, 4), \"\\n\")\n\n总效应 c = 0.6865 \n\n\n\n\n步骤 2：检验 a 路径\n\n# X → M\nstep2 &lt;- lm(burnout ~ stress, data = work_data)\nsummary(step2)\n\n\nCall:\nlm(formula = burnout ~ stress, data = work_data)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-2.13847 -0.49068  0.00519  0.46937  1.84885 \n\nCoefficients:\n            Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)   2.5280     0.1366   18.51   &lt;2e-16 ***\nstress        0.7089     0.0326   21.75   &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.7472 on 398 degrees of freedom\nMultiple R-squared:  0.543, Adjusted R-squared:  0.5418 \nF-statistic: 472.8 on 1 and 398 DF,  p-value: &lt; 2.2e-16\n\n# 提取 a 路径\na_path &lt;- coef(step2)[\"stress\"]\ncat(\"a 路径 =\", round(a_path, 4), \"\\n\")\n\na 路径 = 0.7089 \n\n\n\n\n步骤 3：检验 b 路径和直接效应 (c’)\n\n# X + M → Y\nstep3 &lt;- lm(turnover ~ stress + burnout, data = work_data)\nsummary(step3)\n\n\nCall:\nlm(formula = turnover ~ stress + burnout, data = work_data)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-2.05513 -0.43848 -0.01737  0.50172  1.86216 \n\nCoefficients:\n            Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)  0.24194    0.17280    1.40    0.162    \nstress       0.20844    0.04473    4.66 4.32e-06 ***\nburnout      0.67439    0.04649   14.51  &lt; 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.693 on 397 degrees of freedom\nMultiple R-squared:  0.6465,    Adjusted R-squared:  0.6447 \nF-statistic:   363 on 2 and 397 DF,  p-value: &lt; 2.2e-16\n\n# 提取 b 路径和直接效应\nb_path &lt;- coef(step3)[\"burnout\"]\nc_prime &lt;- coef(step3)[\"stress\"]\n\ncat(\"b 路径 =\", round(b_path, 4), \"\\n\")\n\nb 路径 = 0.6744 \n\ncat(\"直接效应 c' =\", round(c_prime, 4), \"\\n\")\n\n直接效应 c' = 0.2084 \n\n\n\n\n计算间接效应\n\n# 间接效应 = a × b\nindirect_effect &lt;- a_path * b_path\ncat(\"间接效应 a×b =\", round(indirect_effect, 4), \"\\n\")\n\n间接效应 a×b = 0.4781 \n\n# 中介效应占比\nproportion_mediated &lt;- indirect_effect / c_total\ncat(\"中介效应占比 =\", round(proportion_mediated * 100, 1), \"%\\n\")\n\n中介效应占比 = 69.6 %\n\n# 验证：c = c' + ab\ncat(\n  \"验证: c' + ab =\", round(c_prime + indirect_effect, 4),\n  \", c =\", round(c_total, 4), \"\\n\"\n)\n\n验证: c' + ab = 0.6865 , c = 0.6865 \n\n\n\n\nBaron-Kenny 结论\n\n# 中介效应判断\ncat(\"\\n==== Baron-Kenny 中介效应检验 ====\\n\")\n\n\n==== Baron-Kenny 中介效应检验 ====\n\ncat(\"1. c 路径显著:\", coef(summary(step1))[\"stress\", \"Pr(&gt;|t|)\"] &lt; 0.05, \"\\n\")\n\n1. c 路径显著: TRUE \n\ncat(\"2. a 路径显著:\", coef(summary(step2))[\"stress\", \"Pr(&gt;|t|)\"] &lt; 0.05, \"\\n\")\n\n2. a 路径显著: TRUE \n\ncat(\"3. b 路径显著:\", coef(summary(step3))[\"burnout\", \"Pr(&gt;|t|)\"] &lt; 0.05, \"\\n\")\n\n3. b 路径显著: TRUE \n\ncat(\"4. c' &lt; c:\", abs(c_prime) &lt; abs(c_total), \"\\n\")\n\n4. c' &lt; c: TRUE",
    "crumbs": [
      "主页",
      "R 语言方法",
      "中介效应分析"
    ]
  },
  {
    "objectID": "1023-mediation.html#方法二bootstrap-法推荐",
    "href": "1023-mediation.html#方法二bootstrap-法推荐",
    "title": "中介效应分析完全指南",
    "section": "方法二：Bootstrap 法（推荐）",
    "text": "方法二：Bootstrap 法（推荐）\nBootstrap 方法不依赖正态分布假设，是目前最推荐的中介效应检验方法。\n\n使用 mediation 包\n\n# 拟合两个回归模型\nmodel_m &lt;- lm(burnout ~ stress + age + tenure, data = work_data)\nmodel_y &lt;- lm(turnover ~ stress + burnout + age + tenure, data = work_data)\n\n# 执行中介分析（Bootstrap）\nset.seed(42)\nmed_result &lt;- mediate(\n  model.m = model_m, # 中介变量模型\n  model.y = model_y, # 结局变量模型\n  treat = \"stress\", # 自变量\n  mediator = \"burnout\", # 中介变量\n  boot = TRUE, # 使用 Bootstrap\n  sims = 1000 # Bootstrap 次数\n)\n\nsummary(med_result)\n\n\nCausal Mediation Analysis \n\nNonparametric Bootstrap Confidence Intervals with the Percentile Method\n\n               Estimate 95% CI Lower 95% CI Upper   p-value    \nACME            0.47348      0.39655      0.55400 &lt; 2.2e-16 ***\nADE             0.21810      0.13445      0.30020 &lt; 2.2e-16 ***\nTotal Effect    0.69158      0.62254      0.76193 &lt; 2.2e-16 ***\nProp. Mediated  0.68463      0.58235      0.79361 &lt; 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nSample Size Used: 400 \n\n\nSimulations: 1000 \n\n\n\n\n解读 mediation 结果\n\n\n\n指标\n含义\n\n\n\n\nACME\nAverage Causal Mediation Effect（间接效应）\n\n\nADE\nAverage Direct Effect（直接效应）\n\n\nTotal Effect\n总效应\n\n\nProp. Mediated\n中介效应占比\n\n\n\n\n# 可视化中介效应\nplot(med_result, main = \"中介效应 Bootstrap 结果\")\n\n\n\n\n\n\n\n\n\n\n敏感性分析\n\n# 中介分析的敏感性分析（检验未测量混杂的影响）\nsens_result &lt;- medsens(med_result, rho.by = 0.05)\n\nsummary(sens_result)\n\n\nMediation Sensitivity Analysis for Average Causal Mediation Effect\n\nSensitivity Region\n\n      Rho    ACME 95% CI Lower 95% CI Upper R^2_M*R^2_Y* R^2_M~R^2_Y~\n[1,] 0.55  0.0433      -0.0209       0.1075       0.3025       0.0451\n[2,] 0.60 -0.0164      -0.0806       0.0477       0.3600       0.0536\n\nRho at which ACME = 0: 0.6\nR^2_M*R^2_Y* at which ACME = 0: 0.36\nR^2_M~R^2_Y~ at which ACME = 0: 0.0536 \n\n\n\n# 绘制敏感性分析图\nplot(sens_result, main = \"敏感性分析\")",
    "crumbs": [
      "主页",
      "R 语言方法",
      "中介效应分析"
    ]
  },
  {
    "objectID": "1023-mediation.html#方法三结构方程模型-sem",
    "href": "1023-mediation.html#方法三结构方程模型-sem",
    "title": "中介效应分析完全指南",
    "section": "方法三：结构方程模型 (SEM)",
    "text": "方法三：结构方程模型 (SEM)\n使用 lavaan 包进行 SEM 分析，可以处理更复杂的模型。\n\n单中介模型\n\n# 定义模型\nmodel_sem &lt;- \"\n  # 回归路径\n  burnout ~ a * stress    # a 路径\n  turnover ~ b * burnout + c * stress  # b 和 c 路径\n\n  # 间接效应和总效应\n  indirect := a * b\n  total := c + a * b\n\n  # 控制变量（可选）\n  burnout ~ age + tenure\n  turnover ~ age + tenure\n\"\n\n# 拟合模型（Bootstrap）\nfit_sem &lt;- sem(model_sem,\n  data = work_data,\n  se = \"bootstrap\", bootstrap = 1000\n)\n\nsummary(fit_sem, standardized = TRUE, ci = TRUE)\n\nlavaan 0.6-21 ended normally after 1 iteration\n\n  Estimator                                         ML\n  Optimization method                           NLMINB\n  Number of model parameters                         9\n\n  Number of observations                           400\n\nModel Test User Model:\n                                                      \n  Test statistic                                 0.000\n  Degrees of freedom                                 0\n\nParameter Estimates:\n\n  Standard errors                            Bootstrap\n  Number of requested bootstrap draws             1000\n  Number of successful bootstrap draws            1000\n\nRegressions:\n                   Estimate  Std.Err  z-value  P(&gt;|z|) ci.lower ci.upper\n  burnout ~                                                             \n    stress     (a)    0.705    0.029   24.514    0.000    0.649    0.764\n  turnover ~                                                            \n    burnout    (b)    0.672    0.049   13.589    0.000    0.572    0.765\n    stress     (c)    0.218    0.043    5.016    0.000    0.140    0.309\n  burnout ~                                                             \n    age               0.019    0.005    3.971    0.000    0.010    0.029\n    tenure           -0.012    0.013   -0.940    0.347   -0.038    0.013\n  turnover ~                                                            \n    age              -0.002    0.004   -0.571    0.568   -0.012    0.006\n    tenure           -0.048    0.012   -4.189    0.000   -0.072   -0.026\n   Std.lv  Std.all\n                  \n    0.705    0.733\n                  \n    0.672    0.638\n    0.218    0.215\n                  \n    0.019    0.132\n   -0.012   -0.031\n                  \n   -0.002   -0.017\n   -0.048   -0.117\n\nVariances:\n                   Estimate  Std.Err  z-value  P(&gt;|z|) ci.lower ci.upper\n   .burnout           0.533    0.038   14.077    0.000    0.458    0.605\n   .turnover          0.458    0.033   14.047    0.000    0.392    0.518\n   Std.lv  Std.all\n    0.533    0.439\n    0.458    0.340\n\nDefined Parameters:\n                   Estimate  Std.Err  z-value  P(&gt;|z|) ci.lower ci.upper\n    indirect          0.473    0.040   11.857    0.000    0.396    0.554\n    total             0.692    0.034   20.245    0.000    0.626    0.759\n   Std.lv  Std.all\n    0.473    0.467\n    0.692    0.683\n\n\n\n\n提取效应\n\n# 提取标准化效应\nstandardizedSolution(fit_sem) |&gt;\n  filter(op == \":=\" | (lhs %in% c(\"burnout\", \"turnover\") & op == \"~\")) |&gt;\n  select(lhs, op, rhs, est.std, ci.lower, ci.upper, pvalue)\n\n       lhs op     rhs est.std ci.lower ci.upper pvalue\n1  burnout  ~  stress   0.733    0.696    0.770  0.000\n2 turnover  ~ burnout   0.638    0.557    0.718  0.000\n3 turnover  ~  stress   0.215    0.131    0.300  0.000\n4  burnout  ~     age   0.132    0.068    0.196  0.000\n5  burnout  ~  tenure  -0.031   -0.097    0.034  0.348\n6 turnover  ~     age  -0.017   -0.075    0.041  0.568\n7 turnover  ~  tenure  -0.117   -0.173   -0.062  0.000\n8 indirect :=     a*b   0.467    0.403    0.531  0.000\n9    total :=   c+a*b   0.683    0.639    0.726  0.000\n\n\n\n\n模型拟合指标\n\n# 拟合指标\nfitMeasures(fit_sem, c(\"chisq\", \"df\", \"pvalue\", \"cfi\", \"tli\", \"rmsea\", \"srmr\"))\n\n chisq     df pvalue    cfi    tli  rmsea   srmr \n     0      0     NA      1      1      0      0",
    "crumbs": [
      "主页",
      "R 语言方法",
      "中介效应分析"
    ]
  },
  {
    "objectID": "1023-mediation.html#多重中介分析",
    "href": "1023-mediation.html#多重中介分析",
    "title": "中介效应分析完全指南",
    "section": "多重中介分析",
    "text": "多重中介分析\n当存在多个中介变量时：\n\n# 添加第二个中介变量：工作满意度\nwork_data &lt;- work_data |&gt;\n  mutate(\n    satisfaction = round(pmin(7, pmax(\n      1,\n      6 - 0.5 * stress - 0.3 * burnout + rnorm(n, 0, 0.7)\n    )), 1)\n  )\n\n# 多重中介模型\nmodel_multi &lt;- \"\n  # a 路径\n  burnout ~ a1 * stress\n  satisfaction ~ a2 * stress\n\n  # b 路径\n  turnover ~ b1 * burnout + b2 * satisfaction + c * stress\n\n  # 间接效应\n  ind1 := a1 * b1          # 通过倦怠\n  ind2 := a2 * b2          # 通过满意度\n  total_indirect := ind1 + ind2\n  total := c + ind1 + ind2\n\n  # 控制变量\n  burnout ~ age\n  satisfaction ~ age\n  turnover ~ age\n\"\n\nfit_multi &lt;- sem(model_multi,\n  data = work_data,\n  se = \"bootstrap\", bootstrap = 1000\n)\n\nsummary(fit_multi, standardized = TRUE, ci = TRUE)\n\nlavaan 0.6-21 ended normally after 2 iterations\n\n  Estimator                                         ML\n  Optimization method                           NLMINB\n  Number of model parameters                        11\n\n  Number of observations                           400\n\nModel Test User Model:\n                                                      \n  Test statistic                                32.178\n  Degrees of freedom                                 1\n  P-value (Chi-square)                           0.000\n\nParameter Estimates:\n\n  Standard errors                            Bootstrap\n  Number of requested bootstrap draws             1000\n  Number of successful bootstrap draws            1000\n\nRegressions:\n                   Estimate  Std.Err  z-value  P(&gt;|z|) ci.lower ci.upper\n  burnout ~                                                             \n    stress    (a1)    0.703    0.028   24.919    0.000    0.649    0.761\n  satisfaction ~                                                        \n    stress    (a2)   -0.646    0.028  -23.190    0.000   -0.699   -0.589\n  turnover ~                                                            \n    burnout   (b1)    0.676    0.049   13.765    0.000    0.584    0.783\n    satisfctn (b2)   -0.016    0.052   -0.304    0.761   -0.113    0.086\n    stress     (c)    0.198    0.051    3.879    0.000    0.096    0.298\n  burnout ~                                                             \n    age               0.018    0.005    4.019    0.000    0.009    0.028\n  satisfaction ~                                                        \n    age              -0.006    0.004   -1.248    0.212   -0.014    0.004\n  turnover ~                                                            \n    age              -0.003    0.005   -0.620    0.535   -0.012    0.006\n   Std.lv  Std.all\n                  \n    0.703    0.731\n                  \n   -0.646   -0.736\n                  \n    0.676    0.643\n   -0.016   -0.014\n    0.198    0.195\n                  \n    0.018    0.132\n                  \n   -0.006   -0.044\n                  \n   -0.003   -0.019\n\nVariances:\n                   Estimate  Std.Err  z-value  P(&gt;|z|) ci.lower ci.upper\n   .burnout           0.534    0.038   14.158    0.000    0.461    0.608\n   .satisfaction      0.458    0.030   15.387    0.000    0.395    0.510\n   .turnover          0.476    0.033   14.511    0.000    0.406    0.538\n   Std.lv  Std.all\n    0.534    0.440\n    0.458    0.453\n    0.476    0.354\n\nDefined Parameters:\n                   Estimate  Std.Err  z-value  P(&gt;|z|) ci.lower ci.upper\n    ind1              0.476    0.040   11.964    0.000    0.402    0.555\n    ind2              0.010    0.034    0.303    0.762   -0.054    0.073\n    total_indirect    0.486    0.045   10.873    0.000    0.397    0.578\n    total             0.684    0.033   20.423    0.000    0.617    0.751\n   Std.lv  Std.all\n    0.476    0.470\n    0.010    0.010\n    0.486    0.480\n    0.684    0.675\n\n\n\n# 比较两个间接效应\nparameterEstimates(fit_multi, boot.ci.type = \"bca.simple\") |&gt;\n  filter(op == \":=\") |&gt;\n  select(label, est, ci.lower, ci.upper, pvalue)\n\n           label   est ci.lower ci.upper pvalue\n1           ind1 0.476    0.406    0.561  0.000\n2           ind2 0.010   -0.057    0.071  0.762\n3 total_indirect 0.486    0.394    0.569  0.000\n4          total 0.684    0.614    0.748  0.000",
    "crumbs": [
      "主页",
      "R 语言方法",
      "中介效应分析"
    ]
  },
  {
    "objectID": "1023-mediation.html#调节的中介效应",
    "href": "1023-mediation.html#调节的中介效应",
    "title": "中介效应分析完全指南",
    "section": "调节的中介效应",
    "text": "调节的中介效应\n当中介路径受到调节变量影响时：\n\n# 添加调节变量：社会支持\nwork_data &lt;- work_data |&gt;\n  mutate(\n    social_support = round(pmin(7, pmax(1, rnorm(n, 4.5, 1.2))), 1),\n    # 中心化\n    stress_c = stress - mean(stress),\n    support_c = social_support - mean(social_support),\n    # 交互项\n    stress_support = stress_c * support_c\n  )\n\n# 调节的中介模型\nmodel_m_mod &lt;- lm(burnout ~ stress_c * support_c + age, data = work_data)\nmodel_y_mod &lt;- lm(turnover ~ stress_c + burnout + age, data = work_data)\n\nsummary(model_m_mod) # 检查交互效应是否显著\n\n\nCall:\nlm(formula = burnout ~ stress_c * support_c + age, data = work_data)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-2.09399 -0.47584  0.01156  0.50286  1.86016 \n\nCoefficients:\n                    Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)         4.742180   0.169860  27.918  &lt; 2e-16 ***\nstress_c            0.704447   0.032122  21.930  &lt; 2e-16 ***\nsupport_c           0.025767   0.033192   0.776 0.438034    \nage                 0.018158   0.004692   3.870 0.000127 ***\nstress_c:support_c -0.015365   0.027896  -0.551 0.582074    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.7349 on 395 degrees of freedom\nMultiple R-squared:  0.5612,    Adjusted R-squared:  0.5567 \nF-statistic: 126.3 on 4 and 395 DF,  p-value: &lt; 2.2e-16\n\n\n\n# 在不同社会支持水平下的中介效应\n# 注意：此代码需要更精细的模型设定\n# 低支持 (-1 SD)\nmed_low &lt;- mediate(model_m_mod, model_y_mod,\n  covariates = list(support_c = -sd(work_data$support_c)),\n  treat = \"stress_c\", mediator = \"burnout\",\n  boot = TRUE, sims = 500\n)\n\n# 高支持 (+1 SD)\nmed_high &lt;- mediate(model_m_mod, model_y_mod,\n  covariates = list(support_c = sd(work_data$support_c)),\n  treat = \"stress_c\", mediator = \"burnout\",\n  boot = TRUE, sims = 500\n)\n\ncat(\"低社会支持下的间接效应:\", round(med_low$d0, 4), \"\\n\")\ncat(\"高社会支持下的间接效应:\", round(med_high$d0, 4), \"\\n\")",
    "crumbs": [
      "主页",
      "R 语言方法",
      "中介效应分析"
    ]
  },
  {
    "objectID": "1023-mediation.html#使用-brucer-包简化版",
    "href": "1023-mediation.html#使用-brucer-包简化版",
    "title": "中介效应分析完全指南",
    "section": "使用 bruceR 包（简化版）",
    "text": "使用 bruceR 包（简化版）\n\n# bruceR 提供更简洁的中介分析语法\n# 需要先安装 bruceR 包\nlibrary(bruceR)\n\n# 简单中介分析\nPROCESS(\n  data = work_data,\n  y = \"turnover\",\n  x = \"stress\",\n  meds = \"burnout\",\n  covs = c(\"age\", \"tenure\"),\n  seed = 42,\n  nsim = 1000\n)",
    "crumbs": [
      "主页",
      "R 语言方法",
      "中介效应分析"
    ]
  },
  {
    "objectID": "1023-mediation.html#结果可视化",
    "href": "1023-mediation.html#结果可视化",
    "title": "中介效应分析完全指南",
    "section": "结果可视化",
    "text": "结果可视化\n\n路径图\n\n# 手动绘制路径图\nlibrary(DiagrammeR)\n\ngrViz(\"\ndigraph mediation {\n  graph [layout = dot, rankdir = LR]\n\n  node [shape = rectangle, style = filled, fillcolor = '#e0e7ff']\n  X [label = '工作压力\\\\n(X)']\n  M [label = '工作倦怠\\\\n(M)']\n  Y [label = '离职意向\\\\n(Y)']\n\n  edge [color = '#4f46e5', penwidth = 2]\n  X -&gt; M [label = 'a = 0.80***']\n  M -&gt; Y [label = 'b = 0.59***']\n  X -&gt; Y [label = \\\"c' = 0.31***\\\"]\n}\n\")\n\n\n\n\n\n\n\n效应对比图\n\n# 效应对比条形图\neffect_data &lt;- tibble(\n  效应 = c(\"总效应 (c)\", \"直接效应 (c')\", \"间接效应 (ab)\"),\n  估计值 = c(c_total, c_prime, indirect_effect),\n  类型 = c(\"总效应\", \"直接效应\", \"间接效应\")\n)\n\nggplot(effect_data, aes(x = reorder(效应, 估计值), y = 估计值, fill = 类型)) +\n  geom_col(alpha = 0.8) +\n  geom_text(aes(label = round(估计值, 3)), hjust = -0.1) +\n  coord_flip() +\n  scale_fill_manual(values = c(\"#4f46e5\", \"#10b981\", \"#f59e0b\")) +\n  labs(\n    title = \"中介效应分解\",\n    x = NULL,\n    y = \"效应量\"\n  ) +\n  theme_minimal(base_size = 12) +\n  theme(legend.position = \"none\")",
    "crumbs": [
      "主页",
      "R 语言方法",
      "中介效应分析"
    ]
  },
  {
    "objectID": "1023-mediation.html#中介效应类型",
    "href": "1023-mediation.html#中介效应类型",
    "title": "中介效应分析完全指南",
    "section": "中介效应类型",
    "text": "中介效应类型\n\n\n\n类型\n条件\n解释\n\n\n\n\n完全中介\nc’ 不显著，ab 显著\nX 完全通过 M 影响 Y\n\n\n部分中介\nc’ 和 ab 都显著\nX 部分通过 M 影响 Y\n\n\n无中介\nab 不显著\nM 不是中介变量\n\n\n遮蔽效应\nc’ 和 ab 符号相反\n直接和间接效应部分抵消\n\n\n竞争中介\nab 显著但 c 不显著\n不同中介路径相互抵消",
    "crumbs": [
      "主页",
      "R 语言方法",
      "中介效应分析"
    ]
  },
  {
    "objectID": "1023-mediation.html#常见问题与陷阱",
    "href": "1023-mediation.html#常见问题与陷阱",
    "title": "中介效应分析完全指南",
    "section": "常见问题与陷阱",
    "text": "常见问题与陷阱\n\n1. 因果推断的限制\n# 中介分析需要满足以下假设：\n# 1. X 在时间上先于 M\n# 2. M 在时间上先于 Y\n# 3. 没有遗漏的混杂变量\n\n# 横断面数据的中介分析只能说明\"一致性\"，不能证明因果关系\n\n\n2. 样本量要求\n# 中介效应的检验力较低\n# 推荐规则：\n# - 小效应：n ≥ 500\n# - 中等效应：n ≥ 200\n# - 大效应：n ≥ 100\n\n# 使用 powerMediation 包计算样本量\n# library(powerMediation)\n\n\n3. 测量误差\n# 测量误差会导致：\n# - a 路径被低估\n# - b 路径被低估\n# - 间接效应被低估\n# - 直接效应被高估\n\n# 解决方案：使用潜变量模型（SEM）\n\n\n4. 多重共线性\n\n# 检查 X 和 M 的相关性\ncat(\"X-M 相关:\", round(cor(work_data$stress, work_data$burnout), 3), \"\\n\")\n\nX-M 相关: 0.737 \n\n# 高相关可能导致直接效应估计不稳定",
    "crumbs": [
      "主页",
      "R 语言方法",
      "中介效应分析"
    ]
  },
  {
    "objectID": "1023-mediation.html#完整分析模板",
    "href": "1023-mediation.html#完整分析模板",
    "title": "中介效应分析完全指南",
    "section": "完整分析模板",
    "text": "完整分析模板\n\n# ========== 中介效应分析完整流程 ==========\n\nlibrary(mediation)\nlibrary(lavaan)\n\n# 方法1：mediation 包（推荐）\n# 1. 拟合模型\nmodel_m &lt;- lm(M ~ X + covariates, data = data)\nmodel_y &lt;- lm(Y ~ X + M + covariates, data = data)\n\n# 2. 中介分析\nmed &lt;- mediate(model_m, model_y,\n  treat = \"X\", mediator = \"M\",\n  boot = TRUE, sims = 5000\n)\nsummary(med)\n\n# 3. 敏感性分析\nmedsens(med)\n\n# 方法2：SEM（复杂模型）\nmodel &lt;- \"\n  M ~ a * X\n  Y ~ b * M + c * X\n  indirect := a * b\n  total := c + a * b\n\"\nfit &lt;- sem(model, data, se = \"bootstrap\", bootstrap = 5000)\nsummary(fit, ci = TRUE)",
    "crumbs": [
      "主页",
      "R 语言方法",
      "中介效应分析"
    ]
  },
  {
    "objectID": "1023-mediation.html#总结",
    "href": "1023-mediation.html#总结",
    "title": "中介效应分析完全指南",
    "section": "总结",
    "text": "总结\n\n\n\n方法\n优点\n缺点\n适用场景\n\n\n\n\nBaron-Kenny\n简单直观\n检验力低，需正态假设\n教学演示\n\n\nSobel 检验\n有明确检验统计量\n需正态假设\n大样本\n\n\nBootstrap\n不需要正态假设\n计算量大\n推荐使用\n\n\nSEM\n可处理复杂模型\n需要较大样本\n多中介、潜变量\n\n\n\n\n报告中介效应的 Checklist\n\n报告总效应、直接效应、间接效应\n报告 Bootstrap 置信区间\n报告中介效应占比（谨慎解读）\n说明变量的测量方式\n讨论时间顺序假设\n进行敏感性分析\n报告样本量和检验力\n\n\n\n推荐阅读\n\nHayes AF. Introduction to Mediation, Moderation, and Conditional Process Analysis\nMacKinnon DP. Introduction to Statistical Mediation Analysis\nPreacher KJ, Hayes AF (2008). Asymptotic and resampling strategies…\nmediation 包文档",
    "crumbs": [
      "主页",
      "R 语言方法",
      "中介效应分析"
    ]
  }
]