---
title: 孟德尔随机化 (Mendelian Randomization) 教程
date: '2026-01-14'
categories:
- 统计分析方法
- 因果推断
- 遗传流行病学
image: images/mendelian_randomization_cover.svg
description: 一篇详细的孟德尔随机化（MR）入门教程，深入浅出地讲解核心概念、分析流程及结果解读，无需运行代码即可掌握两样本MR分析方法。
---

# 孟德尔随机化：流行病学中的"自然随机对照试验"

在流行病学研究中，我们经常想知道：**暴露因素 X 是否真的是导致疾病结局 Y 的原因？**

传统的观察性研究（如队列研究、病例对照研究）虽然能发现 X 和 Y 之间的**关联**，但很难证明**因果关系**。最主要的问题是**混杂因素（Confounders）**和**反向因果（Reverse Causality）**的干扰。

**孟德尔随机化（Mendelian Randomization, MR）** 提供了一个巧妙的解决方案。它利用**遗传变异（通常是SNP）**作为工具变量，来推断暴露因素与结局之间的因果效应。

## 为什么说它是"自然的RCT"？

想象一下随机对照试验（RCT）：我们将人群随机分为两组，一组接受干预（暴露 X），一组不接受。由于分组是随机的，两组在其他特征上是均衡的，因此两组结局的差异可以归因于暴露 X。

而在孟德尔随机化中：
1.  **随机分配**：在受精卵形成时，等位基因是随机分配给后代的（孟德尔第二定律）。这就像大自然进行了一次随机分组。
2.  **不受后天影响**：基因型生来注定，一般不受后天环境、生活方式甚至疾病状态的影响。这完美规避了"反向因果"和大部分"混杂因素"。

如果特定的基因变异（如与高BMI相关的基因）能显著增加疾病风险，而这些基因除了影响BMI外不通过其他途径影响疾病，那么我们就有理由相信：BMI是导致该疾病的原因。

---

# 核心原理：工具变量的三个假设

要进行有效的孟德尔随机化分析，我们选择的遗传变异（工具变量，Instrumental Variable, IV）必须满足三个极其严格的核心假设。理解这三个假设是做MR的前提。

1.  **关联性假设 (Relevance Assumption)**
    *   **内容**：工具变量（遗传变异）必须与暴露因素（如BMI）强相关。
    *   **直观理解**：如果你选的基因根本不影响BMI，那就无法通过该基因来推断BMI的作用。
    *   **检验方法**：通常查看全基因组关联研究（GWAS）中的 P 值（通常要求 $P < 5 \times 10^{-8}$）和 F 统计量（要求 F > 10）。

2.  **独立性假设 (Independence Assumption)**
    *   **内容**：工具变量必须与影响结局的混杂因素（如吸烟、饮酒、社会经济地位等）无关。
    *   **直观理解**：如果这个基因不仅影响BMI，还让这一组人更爱抽烟（而抽烟也会致病），那你就分不清是BMI致病还是抽烟致病了。
    *   **难点**：这一假设很难直接统计检验，更多依赖生物学知识和敏感性分析。

3.  **排他性假设 (Exclusion Restriction Assumption)**
    *   **内容**：工具变量只能通过暴露因素来影响结局，而不能通过其他途径。
    *   **直观理解**：基因 -> BMI -> 糖尿病（成立）。如果存在“基因 -> 炎症 -> 糖尿病”这样的旁路（即**水平多效性**），那么MR推断就是错误的。
    *   **检验方法**：通过MR-Egger回归截距项、MR-PRESSO等敏感性分析方法来检测是否存在多效性。

---

# 准备工作：R包与数据

本教程主要介绍目前最主流的 **两样本孟德尔随机化 (Two-Sample MR)**。这种方法不需要你拥有同一个群体的基因和表型数据，而是利用两个公开的大型 **GWAS 汇总数据 (Summary Statistics)**。

*   **样本1 (Exposure)**：暴露因素的 GWAS 数据（例如 BMI 的 GWAS）。
*   **样本2 (Outcome)**：结局变量的 GWAS 数据（例如 2型糖尿病的 GWAS）。

## 1. 安装 TwoSampleMR 包

这是目前功能最为强大的 MR 分析 R 包，集成了数据获取、协调、分析和可视化的全流程。

```r
# 安装 remotes 包（如果未安装）
install.packages("remotes")

# 从 GitHub 安装 TwoSampleMR
remotes::install_github("MRCIEU/TwoSampleMR")

# 加载包
library(TwoSampleMR)
library(tidyverse)
```

## 2. 理解数据结构

在 MR 分析中，我们处理的数据框通常包含以下关键列：
*   `SNP`: 变异位点ID (如 rs123456)
*   `beta`: 效应值 (该SNP每增加一个等位基因，表型改变多少)
*   `se`: 标准误 (beta 的精确度)
*   `effect_allele`: 效应等位基因 (如 A)
*   `other_allele`: 其他等位基因 (如 G)
*   `eaf`: 效应等位基因频率
*   `pval`: P值

---

# 实战流程：两样本 MR 分析五步走

我们将以 **"BMI 是否因果影响 2型糖尿病风险"** 为例，演示标准分析流程。

## 步骤一：获取暴露数据 (Extract Exposures)

首先，我们需要找到与 BMI 强相关的 SNP 作为工具变量。我们可以直接连接 IEU OpenGWAS 数据库下载。

**操作逻辑**：
1.  指定暴露 ID（如 `ieu-a-2` 是一个著名的 BMI GWAS）。
2.  设定显著性阈值（`p1 = 5e-8`），只选显著相关的 SNP。
3.  进行连锁不平衡（LD）去除（`clump = TRUE`），确保选出的 SNP 相互独立，避免重复计算。

```r
# 获取 BMI 的工具变量
bmi_pd <- extract_instruments(
    outcomes = "ieu-a-2",    # 暴露数据的ID
    p1 = 5e-8,               # 显著性阈值
    clump = TRUE,            # 是否去除连锁不平衡
    r2 = 0.001,              # LD 阈值
    kb = 10000               # 窗口大小
)

print(dim(bmi_pd)) # 查看筛选出了多少个工具变量
```

## 步骤二：获取结局数据 (Extract Outcome)

接下来，我们需要在结局（2型糖尿病）的 GWAS 数据中，找到上述这些 SNP 的信息。

**操作逻辑**：
1.  利用上一步提取的 SNP 列表（`bmi_pd$SNP`）。
2.  在结局数据（ID: `ieu-a-26`）中提取这些 SNP 的统计量。
3.  如果找不到某些 SNP，可能需要寻找替代 SNP（Proxy），或者直接丢弃。

```r
# 提取结局数据
t2d_outcome <- extract_outcome_data(
    snps = bmi_pd$SNP,       # 使用暴露数据中的 SNP
    outcomes = "ieu-a-26"    # 结局数据的ID
)
```

## 步骤三：数据协调 (Harmonise Data)

这是极其关键的一步。因为暴露和结局的 GWAS 可能参考了不同的等位基因方向。
例如：
*   暴露研究中，rs123 的效应等位基因是 **A**（增加BMI）。
*   结局研究中，rs123 的效应等位基因是 **G**（降低糖尿病风险）。

如果不统一方向，我们就会得出错误的相反结论。`harmonise_data` 函数会自动处理这些正负翻转，确保所有效应都指向同一个方向。

```r
# 协调数据
dat <- harmonise_data(
    exposure_dat = bmi_pd, 
    outcome_dat = t2d_outcome
)
```

## 步骤四：进行 MR 分析 (Main Analysis)

现在数据准备就绪，我们可以进行核心的因果推断了。最常用的方法是 **逆方差加权法 (Inverse Variance Weighted, IVW)**。

*   **IVW**: 假设所有 SNP 都是有效的，将每个 SNP 的估算结果加权平均。这是最主要的参考结果。
*   **MR-Egger**: 允许 SNP 存在多效性（即截距不为0），尽管统计效力较低，但这是一种稳健性检验。
*   **Weighted Median**: 只要有一半以上的权重来自有效 SNP，结果就是可靠的。

```r
# 运行多种 MR 方法
res <- mr(dat)

# 整理结果，计算 OR 值
# 主要关注 method, nsnp (SNP数), pval, b (回归系数)
res_table <- generate_odds_ratios(res)
print(res_table)
```

### 结果解读指南
*   **b (beta)**: 暴露改变一个单位，结局改变多少（对数比值比）。
*   **OR (Odds Ratio)**: `exp(b)`。如果 OR = 1.20，说明 BMI 每增加一个单位（或标准差），糖尿病风险增加 20%。
*   **pval**: P < 0.05 通常认为具有统计学意义。

**结论判定**：如果 IVW 方法的 P < 0.05，且方向与其他方法（如 Weighted Median）一致，我们可以初步认为存在因果关系。

## 步骤五：敏感性分析 (Sensitivity Analysis)

做完主要分析并未结束，必须进行"体检"，确保结果不是由偏倚导致的。

### 异质性检验 (Heterogeneity Test)
检查这些 SNP 给出的因果估计是否差异很大。如果异质性显著（Q 检验 P < 0.05），说明可能存在不可靠的 SNP 或多效性。

```r
mr_heterogeneity(dat)
```

### 水平多效性检验 (Pleiotropy Test)
主要看 **MR-Egger 的截距项 (intercept)**。
*   如果截距项显著不为 0 (P < 0.05)，说明存在定向水平多效性，IVW 结果可能不可靠。
*   如果截距项接近 0 且 P > 0.05，说明主要结果比较稳健。

```r
mr_pleiotropy_test(dat)
```

### 留一法 (Leave-one-out Analysis)
依次去掉每一个 SNP，重新计算 MR 结果。如果去掉某个 SNP 后结果发生剧烈变化，说明该 SNP 是"捣乱分子"（离群值），分析结果不稳定。

```r
res_loo <- mr_leaveoneout(dat)
mr_leaveoneout_plot(res_loo)
```

---

# 进阶建议

1.  **关于 F 统计量**：
    虽然 `TwoSampleMR` 自动处理了很多事，但手动计算 F 统计量很必要。对于以 SNP 为工具的 MR，通常建议 $F > 10$ 以避免弱工具变量偏倚。
    $$ F = \frac{R^2(N-2)}{1-R^2} $$
    其中 $R^2$ 是 SNP 解释暴露的变异比例。

2.  **可视化**：
    不管是写论文还是做报告，漂亮的散点图是必不可少的。
    ```r
    mr_scatter_plot(res, dat)
    ```
    这张图的斜率就是因果效应估计值。

3.  **结果报告规范**：
    请遵循 **STROBE-MR** 指南进行报告。必须诚实报告所有的敏感性分析结果，而不仅仅是显著的 IVW 结果。如果存在异质性或多效性，应在讨论中充分阐述。

通过以上教程，你已经掌握了两样本孟德尔随机化的核心逻辑和标准操作流程。MR 是一个不断发展的领域，建议在实际操作中多阅读最新的高分文献，学习他们是如何处理细节和解释结果的。
