---
title: R语言读取PDF完全指南
date: '2026-01-14'
categories:
- 实用操作
- 数据导入导出
- 数据获取
- PDF
image: images/pdf_reading_cover.svg
description: 使用 pdftools、tabulizer 等 R 包读取和解析 PDF 文件，提取文本、表格和图像。
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
    echo = TRUE,
    warning = FALSE,
    message = FALSE,
    fig.width = 8,
    fig.height = 5,
    fig.retina = 2,
    out.width = "100%",
    dpi = 150
)
```

## 为什么需要读取PDF

PDF 是最常见的文档格式，但R语言处理PDF并不直接。以下场景需要从PDF提取数据：

| 场景 | 示例 |
|------|------|
| 学术研究 | 从论文PDF提取表格数据 |
| 数据分析 | 读取政府/企业发布的PDF报告 |
| 文本挖掘 | 分析大量PDF文档内容 |
| 自动化处理 | 批量提取发票、合同信息 |

---

## R包概览

| R包 | 功能 | 适用场景 |
|-----|------|----------|
| **pdftools** | 提取文本和元数据 | 通用文本提取 |
| **tabulizer** | 提取表格 | 表格数据提取 |
| **tesseract** | OCR识别 | 扫描版PDF |
| **qpdf** | PDF操作 | 合并、拆分、加密 |

---

## 安装与加载

```{r}
# 安装pdftools（CRAN）
# install.packages("pdftools")

# 安装tabulizer（需要Java环境）
# install.packages("tabulizer")

# 加载包
library(pdftools)
library(tidyverse)
```

> **注意**：`tabulizer` 需要先安装 Java（JDK 8或更高版本）。

---

## pdftools：基础文本提取

### 提取全部文本

```{r eval=FALSE}
# 读取PDF文本
text <- pdf_text("document.pdf")

# 返回一个字符向量，每个元素对应一页
length(text) # 页数
text[1] # 第一页内容
```

### 实例：读取在线PDF

```{r}
# 读取R官方文档（演示用）
url <- "https://cran.r-project.org/doc/manuals/r-release/R-intro.pdf"

# 下载并读取
temp_file <- tempfile(fileext = ".pdf")
download.file(url, temp_file, mode = "wb", quiet = TRUE)

# 提取文本
text <- pdf_text(temp_file)

# 查看页数
cat("总页数:", length(text), "\n")

# 查看第一页（前500字符）
cat(substr(text[1], 1, 500), "...\n")
```

### 提取PDF元数据

```{r}
# 获取PDF信息
info <- pdf_info(temp_file)

# 查看元数据
cat("标题:", info$keys$Title, "\n")
cat("作者:", info$keys$Author, "\n")
cat("创建时间:", as.character(info$created), "\n")
cat("页数:", info$pages, "\n")
```

### 按行分割文本

```{r}
# 第一页按行分割
lines <- strsplit(text[1], "\n")[[1]]

# 查看前10行
head(lines, 10)
```

---

## 提取表格数据

### 使用 tabulizer

```{r eval=FALSE}
library(tabulizer)

# 提取PDF中的所有表格
tables <- extract_tables("report.pdf")

# 返回一个列表，每个元素是一个表格矩阵
length(tables) # 表格数量

# 转换为数据框
df <- as.data.frame(tables[[1]])
head(df)
```

### 提取特定页面的表格

```{r eval=FALSE}
# 只提取第2-3页的表格
tables <- extract_tables("report.pdf", pages = c(2, 3))

# 提取特定区域（需要知道坐标）
# area参数：c(top, left, bottom, right)
tables <- extract_tables("report.pdf",
    pages = 1,
    area = list(c(100, 50, 400, 550))
)
```

### 交互式选择区域

```{r eval=FALSE}
# 在弹出窗口中手动选择表格区域
tables <- extract_tables("report.pdf",
    method = "decide",
    output = "data.frame"
)
```

---

## 文本清理与处理

PDF提取的文本通常需要清理：

```{r}
# 示例：清理提取的文本
clean_pdf_text <- function(text) {
    text %>%
        # 合并所有页
        paste(collapse = "\n") %>%
        # 移除多余空白
        str_squish() %>%
        # 移除页眉页脚（示例模式）
        str_remove_all("Page \\d+ of \\d+") %>%
        # 移除特殊字符
        str_remove_all("[\\x00-\\x1f]")
}

# 清理文本
cleaned <- clean_pdf_text(text[1:3])
cat(substr(cleaned, 1, 300), "...\n")
```

### 提取特定模式

```{r}
# 提取所有邮箱
extract_emails <- function(text) {
    pattern <- "[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}"
    str_extract_all(text, pattern) %>%
        unlist() %>%
        unique()
}

# 提取所有URL
extract_urls <- function(text) {
    pattern <- "https?://[\\w./%-]+"
    str_extract_all(text, pattern) %>%
        unlist() %>%
        unique()
}

# 提取数字
extract_numbers <- function(text) {
    pattern <- "\\d+\\.?\\d*"
    str_extract_all(text, pattern) %>% unlist()
}
```

---

## 处理扫描版PDF（OCR）

扫描版PDF是图像，需要OCR识别：

```{r eval=FALSE}
# 安装tesseract
# install.packages("tesseract")

library(tesseract)

# 下载中文语言包（首次使用）
# tesseract_download("chi_sim")

# 初始化OCR引擎
eng <- tesseract("eng") # 英文
chi <- tesseract("chi_sim") # 简体中文

# 对PDF进行OCR
# 首先将PDF转换为图像
library(pdftools)
images <- pdf_convert("scanned_document.pdf", dpi = 300)

# 对每张图像进行OCR
ocr_results <- lapply(images, function(img) {
    ocr(img, engine = eng)
})

# 合并结果
full_text <- paste(ocr_results, collapse = "\n")
```

---

## qpdf：PDF操作

```{r eval=FALSE}
library(qpdf)

# 合并多个PDF
pdf_combine(c("file1.pdf", "file2.pdf"), output = "combined.pdf")

# 拆分PDF（每页一个文件）
pdf_split("document.pdf", output = "pages/page")

# 提取特定页面
pdf_subset("document.pdf", pages = 1:5, output = "first5pages.pdf")

# 压缩PDF
pdf_compress("large.pdf", output = "compressed.pdf")

# 获取页数
pdf_length("document.pdf")
```

---

## 批量处理PDF

### 批量提取文本

```{r eval=FALSE}
# 获取文件夹中所有PDF
pdf_files <- list.files("pdf_folder", pattern = "\\.pdf$", full.names = TRUE)

# 批量提取
results <- lapply(pdf_files, function(file) {
    tryCatch(
        {
            text <- pdf_text(file)
            tibble(
                file = basename(file),
                pages = length(text),
                text = paste(text, collapse = "\n")
            )
        },
        error = function(e) {
            tibble(file = basename(file), pages = NA, text = NA)
        }
    )
})

# 合并结果
all_texts <- bind_rows(results)
```

### 并行处理

```{r eval=FALSE}
library(future)
library(furrr)

# 设置并行
plan(multisession, workers = 4)

# 并行提取
results <- future_map(pdf_files, function(file) {
    text <- pdf_text(file)
    tibble(file = basename(file), text = paste(text, collapse = "\n"))
}, .progress = TRUE)
```

---

## 实战案例：提取论文表格

```{r eval=FALSE}
# 从学术论文PDF提取表格
extract_paper_tables <- function(pdf_path) {
    library(tabulizer)

    # 提取所有表格
    tables <- extract_tables(pdf_path, output = "data.frame")

    # 清理每个表格
    cleaned_tables <- lapply(seq_along(tables), function(i) {
        df <- tables[[i]]

        # 使用第一行作为列名（如果合适）
        if (nrow(df) > 1) {
            names(df) <- as.character(df[1, ])
            df <- df[-1, ]
        }

        # 添加表格编号
        df$table_id <- paste0("Table_", i)

        df
    })

    cleaned_tables
}

# 使用示例
tables <- extract_paper_tables("research_paper.pdf")

# 保存为Excel
library(openxlsx)
wb <- createWorkbook()
for (i in seq_along(tables)) {
    addWorksheet(wb, paste0("Table", i))
    writeData(wb, i, tables[[i]])
}
saveWorkbook(wb, "extracted_tables.xlsx", overwrite = TRUE)
```

---

## 常见问题解决

### 1. 编码问题

```{r eval=FALSE}
# 尝试不同编码
text <- pdf_text("document.pdf")
text <- iconv(text, from = "UTF-8", to = "UTF-8", sub = "")
```

### 2. 表格识别不准确

```{r eval=FALSE}
# 调整表格提取参数
tables <- extract_tables(
    "document.pdf",
    method = "lattice", # 或 "stream"
    guess = FALSE, # 不自动猜测
    output = "data.frame"
)
```

### 3. 密码保护的PDF

```{r eval=FALSE}
# 使用密码打开
text <- pdf_text("protected.pdf", upw = "password")
```

### 4. Java环境问题（tabulizer）

```{r eval=FALSE}
# 设置Java路径
Sys.setenv(JAVA_HOME = "C:/Program Files/Java/jdk1.8.0_301")

# 或使用rJava
library(rJava)
.jinit()
```

---

## 总结

| 任务 | 推荐方案 |
|------|----------|
| 提取文本 | `pdftools::pdf_text()` |
| 提取表格 | `tabulizer::extract_tables()` |
| 扫描版OCR | `tesseract::ocr()` |
| PDF操作 | `qpdf` |
| 批量处理 | `purrr` + `future` |

### 最佳实践

1. **先检查PDF类型**：文字型还是扫描型决定了处理方式
2. **表格提取要验证**：自动提取的表格经常需要手动调整
3. **批量处理加入错误处理**：使用 `tryCatch` 防止单个文件失败中断
4. **OCR需要好的图像质量**：至少300 DPI

### 推荐资源

- [pdftools文档](https://docs.ropensci.org/pdftools/)
- [tabulizer GitHub](https://github.com/ropensci/tabulizer)
- [tesseract文档](https://docs.ropensci.org/tesseract/)
