<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2026-01-11">

<title>倾向性得分匹配 - 因果推断的利器 – R 语言学习笔记</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-234273d1456647dabc34a594ac50e507.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-374967827064a263f620006ef06629b3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">R 语言学习笔记</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">主页</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-r-包" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">实用 R 包</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-r-包">    
        <li>
    <a class="dropdown-item" href="./sections/packages.html#表格制作">
 <span class="dropdown-text">📊 表格制作</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./sections/packages.html#数据处理">
 <span class="dropdown-text">🔄 数据处理</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./sections/packages.html#模型整理">
 <span class="dropdown-text">📈 模型整理</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">可视化教程</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-">    
        <li>
    <a class="dropdown-item" href="./sections/visualization.html#图形基础">
 <span class="dropdown-text">🏗️ 图形基础</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./sections/visualization.html#图形组合">
 <span class="dropdown-text">🔀 图形组合</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./sections/visualization.html#统计图表">
 <span class="dropdown-text">📊 统计图表</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./sections/visualization.html#专题图类">
 <span class="dropdown-text">🗺️ 专题图类</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./sections/visualization.html#进阶美化">
 <span class="dropdown-text">✨ 进阶美化</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-r-语言方法" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">R 语言方法</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-r-语言方法">    
        <li>
    <a class="dropdown-item" href="./sections/methods.html#回归分析">
 <span class="dropdown-text">🔢 回归分析</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./sections/methods.html#生存分析">
 <span class="dropdown-text">⏱️ 生存分析</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./sections/methods.html#因果推断">
 <span class="dropdown-text">🎯 因果推断</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./sections/methods.html#高级建模">
 <span class="dropdown-text">📐 高级建模</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./sections/methods.html#机器学习">
 <span class="dropdown-text">🤖 机器学习</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./sections/methods.html#数据预处理">
 <span class="dropdown-text">📋 数据预处理</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./sections/methods.html#综述方法">
 <span class="dropdown-text">📚 综述方法</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./sections/methods.html#特殊方法">
 <span class="dropdown-text">🔬 特殊方法</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu--1" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">实用操作</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu--1">    
        <li>
    <a class="dropdown-item" href="./sections/operation.html#数据输入输出">
 <span class="dropdown-text">📥 数据输入输出</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./sections/operation.html#文档写作">
 <span class="dropdown-text">📝 文档写作</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./sections/operation.html#开发环境">
 <span class="dropdown-text">💻 开发环境</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/KangWang42/R_note_for_Epidemiology"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">R 语言方法</li><li class="breadcrumb-item"><a href="./1018-psm.html">🎯 因果推断</a></li><li class="breadcrumb-item"><a href="./1018-psm.html">倾向性得分匹配</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">实用 R 包</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">📊 表格制作</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1011-rpac_brucer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">bruceR - 统计分析工具</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1012-comparegroups.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">compareGroups - 描述性表</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1013-scitb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">scitb - 快速基线表</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1053-gtsummary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">gtsummary - 发表级表格</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">🔄 数据处理</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1014-purrr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">purrr - 函数式编程</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1014-future.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">future - 并行计算</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1045-rstatix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">rstatix - 管道式统计</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">📈 模型整理</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1043-broom.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">broom - 模型整理</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">可视化教程</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">🏗️ 图形基础</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2032-ggplot2-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ggplot2 可视化入门</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2033-ggplot2-styling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ggplot2 样式设置详解</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2011-viscolor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">配色方案</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2013-legend.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">图例自定义</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false">
 <span class="menu-text">🔀 图形组合</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2012-patchwork.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">patchwork - 图片拼接</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2021-cowplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">cowplot - 图形组合</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2031-bindcomplex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">复杂组合图</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="false">
 <span class="menu-text">📊 统计图表</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2025-bindboxplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">箱线图与小提琴图</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2026-bindscatterplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">散点图与趋势线</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2027-bindhistogram.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">直方图与密度图</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2028-bindbarchart.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">柱状图与饼图</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2029-bindlineplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">折线图与时间序列</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2030-bindareaplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">面积图与堆叠图</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2035-bindlollipop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">棒棒糖图与排序图</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2036-binddivergent.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">发散型图表</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2037-bindwaffle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">华夫饼图与树形图</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2038-bindpyramid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">人口金字塔图</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2039-binddumbbell.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">哑铃图与坡度图</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2040-bindbubblechart.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">气泡图</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2041-bindjitter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">抖动图与蜂群图</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2042-bindmarginal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">边缘分布图</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2043-bindjoyplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Joy Plot 山脊图</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2044-bindcalendar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">日历热图</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2045-binddonut.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">环形图与甜甜圈图</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2046-bindwaterfall.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">瀑布图</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2047-bindbullet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">子弹图</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2048-bindpeakvalley.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">时序峰谷标记图</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2049-bindcorrplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">相关图矩阵</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false">
 <span class="menu-text">🗺️ 专题图类</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2015-map.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">地图绑制</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2014-sankey.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">桑基图</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2016-forestplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">森林图</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2020-heatmap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">热图绑制完全指南</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2024-venn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">韦恩图</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2023-radar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">雷达图</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="false">
 <span class="menu-text">✨ 进阶美化</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2017-ggtext.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ggtext - 中英文字体混合</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2018-tidyplots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">tidyplots - 极简可视化</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2022-ggally.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GGally - 可视化扩展</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2019-dualaxis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">双坐标轴</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2034-ggguides.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ggguides - 图例简化</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="true">
 <span class="menu-text">R 语言方法</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="false">
 <span class="menu-text">🔢 回归分析</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1019-logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Logistic 回归</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1021-linear-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">多元线性回归</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1026-poisson.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Poisson/负二项回归</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1036-anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">方差分析 (ANOVA)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" role="navigation" aria-expanded="false">
 <span class="menu-text">⏱️ 生存分析</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-13" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1020-survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">生存分析</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1050-competing-risks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">竞争风险分析</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1027-rcs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">限制性立方样条 (RCS)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1017-timeseries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">时间序列分析</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1055-tx-effects-survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">治疗效果分析 (TxEffects)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1061-random-survival-forest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">随机生存森林 (RSF)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" role="navigation" aria-expanded="true">
 <span class="menu-text">🎯 因果推断</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-14" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1018-psm.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">倾向性得分匹配</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1028-did.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">双重差分法 (DiD)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1023-mediation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">中介效应分析</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1054-subgroup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">亚组分析与交互作用</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1056-dag.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DAG 因果图</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1057-target-trial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">目标试验模拟</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1058-mendelian-randomization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">孟德尔随机化</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1060-instrumental-variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">工具变量法 (IV)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1059-evalue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">E值敏感性分析</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" role="navigation" aria-expanded="false">
 <span class="menu-text">📐 高级建模</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-15" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1024-multilevel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">多水平模型</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1025-gam.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">广义加性模型 (GAM)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1032-sem.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">结构方程模型 (SEM)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1031-lca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">潜类别分析 (LCA)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1039-pca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">主成分分析 (PCA)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1038-efa-cfa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">因子分析 (EFA/CFA)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1037-plspm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PLS-PM 路径模型</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-16" role="navigation" aria-expanded="false">
 <span class="menu-text">🤖 机器学习</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-16" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-16" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1016-mlr3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">mlr3 机器学习</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1042-tidymodels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">tidymodels 机器学习</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1044-lstm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">LSTM 深度学习</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1052-bootstrap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bootstrap与置换检验</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1051-bayesian.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">贝叶斯统计入门</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-17" role="navigation" aria-expanded="false">
 <span class="menu-text">📋 数据预处理</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-17" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-17" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1046-missing-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">缺失值处理</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1047-roc-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ROC 分析</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1048-power-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">样本量计算</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1049-eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">探索性数据分析</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-18" role="navigation" aria-expanded="false">
 <span class="menu-text">📚 综述方法</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-18" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-18" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1022-meta-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Meta 分析</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1041-network-meta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">网状 Meta 分析</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1029-umbrella-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">伞状综述</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1040-scoping-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">范围综述</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-19" role="navigation" aria-expanded="false">
 <span class="menu-text">🔬 特殊方法</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-19" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-19" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1015-health-economics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">卫生经济学分析</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1062-treeage-pro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TreeAge Pro 决策分析</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1030-qualitative-research.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">质性研究与文本挖掘</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1033-dlnm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">分布滞后非线性模型 (DLNM)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1034-nvmd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">变分模态分解 (VMD)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1035-fft-nvmd-gmm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FFT + VMD + GMM</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-20" role="navigation" aria-expanded="true">
 <span class="menu-text">实用操作</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-20" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-20" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-21" role="navigation" aria-expanded="false">
 <span class="menu-text">📥 数据输入输出</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-21" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-21" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3001-imports.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">数据导入导出</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3002-datatable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">data.table 完全指南</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3003-dplyr-tidyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">dplyr/tidyr 数据处理</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3004-web-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">网络爬虫入门</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3008-regexp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">正则表达式</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3010-stringr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">stringr - 字符串处理</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3009-datetime.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">日期时间处理</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3011-forcats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">forcats - 因子处理</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3012-readr-readxl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">readr/readxl - 高效读取</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3005-pdf-reading.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PDF文件读取</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3007-research-databases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">主流科研数据库指南</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-22" role="navigation" aria-expanded="false">
 <span class="menu-text">📝 文档写作</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-22" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-22" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0011-rmarkdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RMarkdown 入门</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0012-quarto-vs-rmd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto vs RMarkdown</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-23" role="navigation" aria-expanded="false">
 <span class="menu-text">💻 开发环境</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-23" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-23" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0013-positron.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Positron IDE 教程</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4001-shiny.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Shiny Web 应用</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3006-reproducible-research.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">可重复研究工作流</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目录</h2>
   
  <ul>
  <li><a href="#什么是倾向性得分匹配" id="toc-什么是倾向性得分匹配" class="nav-link active" data-scroll-target="#什么是倾向性得分匹配">📦 什么是倾向性得分匹配？</a>
  <ul class="collapse">
  <li><a href="#为什么需要-psm" id="toc-为什么需要-psm" class="nav-link" data-scroll-target="#为什么需要-psm">为什么需要 PSM？</a></li>
  <li><a href="#核心概念" id="toc-核心概念" class="nav-link" data-scroll-target="#核心概念">核心概念</a></li>
  </ul></li>
  <li><a href="#安装与加载" id="toc-安装与加载" class="nav-link" data-scroll-target="#安装与加载">🛠 安装与加载</a></li>
  <li><a href="#psm-完整流程" id="toc-psm-完整流程" class="nav-link" data-scroll-target="#psm-完整流程">💡 PSM 完整流程</a></li>
  <li><a href="#实战案例吸烟对出生体重的影响" id="toc-实战案例吸烟对出生体重的影响" class="nav-link" data-scroll-target="#实战案例吸烟对出生体重的影响">📊 实战案例：吸烟对出生体重的影响</a>
  <ul class="collapse">
  <li><a href="#步骤-1探索性数据分析" id="toc-步骤-1探索性数据分析" class="nav-link" data-scroll-target="#步骤-1探索性数据分析">步骤 1：探索性数据分析</a></li>
  <li><a href="#步骤-2估计倾向性得分" id="toc-步骤-2估计倾向性得分" class="nav-link" data-scroll-target="#步骤-2估计倾向性得分">步骤 2：估计倾向性得分</a></li>
  <li><a href="#步骤-3进行匹配" id="toc-步骤-3进行匹配" class="nav-link" data-scroll-target="#步骤-3进行匹配">步骤 3：进行匹配</a></li>
  <li><a href="#步骤-4平衡性检验关键" id="toc-步骤-4平衡性检验关键" class="nav-link" data-scroll-target="#步骤-4平衡性检验关键">步骤 4：平衡性检验（关键！）</a></li>
  <li><a href="#步骤-5估计处理效应" id="toc-步骤-5估计处理效应" class="nav-link" data-scroll-target="#步骤-5估计处理效应">步骤 5：估计处理效应</a></li>
  </ul></li>
  <li><a href="#进阶不同匹配方法对比" id="toc-进阶不同匹配方法对比" class="nav-link" data-scroll-target="#进阶不同匹配方法对比">🔬 进阶：不同匹配方法对比</a></li>
  <li><a href="#敏感性分析" id="toc-敏感性分析" class="nav-link" data-scroll-target="#敏感性分析">📋 敏感性分析</a></li>
  <li><a href="#psm-的局限性与注意事项" id="toc-psm-的局限性与注意事项" class="nav-link" data-scroll-target="#psm-的局限性与注意事项">⚠️ PSM 的局限性与注意事项</a>
  <ul class="collapse">
  <li><a href="#常见陷阱" id="toc-常见陷阱" class="nav-link" data-scroll-target="#常见陷阱">1. 常见陷阱</a></li>
  <li><a href="#psm-vs-其他方法" id="toc-psm-vs-其他方法" class="nav-link" data-scroll-target="#psm-vs-其他方法">2. PSM vs 其他方法</a></li>
  <li><a href="#dag-图的重要性" id="toc-dag-图的重要性" class="nav-link" data-scroll-target="#dag-图的重要性">3. DAG 图的重要性</a></li>
  </ul></li>
  <li><a href="#函数速查表" id="toc-函数速查表" class="nav-link" data-scroll-target="#函数速查表">📝 函数速查表</a>
  <ul class="collapse">
  <li><a href="#matchit-核心函数" id="toc-matchit-核心函数" class="nav-link" data-scroll-target="#matchit-核心函数">MatchIt 核心函数</a></li>
  <li><a href="#cobalt-核心函数" id="toc-cobalt-核心函数" class="nav-link" data-scroll-target="#cobalt-核心函数">cobalt 核心函数</a></li>
  </ul></li>
  <li><a href="#参考资料" id="toc-参考资料" class="nav-link" data-scroll-target="#参考资料">🔗 参考资料</a></li>
  <li><a href="#完整代码模板" id="toc-完整代码模板" class="nav-link" data-scroll-target="#完整代码模板">📚 完整代码模板</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">R 语言方法</li><li class="breadcrumb-item"><a href="./1018-psm.html">🎯 因果推断</a></li><li class="breadcrumb-item"><a href="./1018-psm.html">倾向性得分匹配</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">倾向性得分匹配 - 因果推断的利器</h1>
  <div class="quarto-categories">
    <div class="quarto-category">因果推断</div>
    <div class="quarto-category">统计方法</div>
    <div class="quarto-category">R包</div>
  </div>
  </div>



<div class="quarto-title-meta column-body">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 11, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="什么是倾向性得分匹配" class="level2">
<h2 class="anchored" data-anchor-id="什么是倾向性得分匹配">📦 什么是倾向性得分匹配？</h2>
<blockquote class="blockquote">
<p>倾向性得分匹配 (Propensity Score Matching, PSM) 是一种用于观察性研究中控制混杂因素、估计因果效应的统计方法。</p>
</blockquote>
<section id="为什么需要-psm" class="level3">
<h3 class="anchored" data-anchor-id="为什么需要-psm">为什么需要 PSM？</h3>
<p>在<strong>随机对照试验 (RCT)</strong> 中，随机分组确保了处理组和对照组在基线特征上的可比性。但在<strong>观察性研究</strong>中，我们无法随机分配处理，导致：</p>
<ul>
<li>处理组和对照组可能存在系统性差异</li>
<li>直接比较结局会产生<strong>选择偏倚</strong></li>
<li>无法区分是”处理效应”还是”基线差异”导致的结果差异</li>
</ul>
<p><strong>PSM 的核心思想</strong>：找到在”接受处理的概率”上相似的个体进行配对，从而模拟随机化实验。</p>
</section>
<section id="核心概念" class="level3">
<h3 class="anchored" data-anchor-id="核心概念">核心概念</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>概念</th>
<th>定义</th>
<th>公式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>倾向性得分</td>
<td>给定协变量 X 时，个体接受处理的条件概率</td>
<td><span class="math inline">\(e(X) = P(T=1|X)\)</span></td>
</tr>
<tr class="even">
<td>平衡性</td>
<td>匹配后处理组与对照组协变量分布相似</td>
<td><span class="math inline">\(X \perp T | e(X)\)</span></td>
</tr>
<tr class="odd">
<td>ATE</td>
<td>平均处理效应 (Average Treatment Effect)</td>
<td><span class="math inline">\(E[Y(1) - Y(0)]\)</span></td>
</tr>
<tr class="even">
<td>ATT</td>
<td>处理组平均处理效应</td>
<td><span class="math inline">\(E[Y(1) - Y(0) | T=1]\)</span></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="安装与加载" class="level2">
<h2 class="anchored" data-anchor-id="安装与加载">🛠 安装与加载</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 核心包</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MatchIt)      <span class="co"># PSM 主力包</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cobalt)       <span class="co"># 平衡性诊断</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marginaleffects)  <span class="co"># 效应估计</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 辅助包</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="psm-完整流程" class="level2">
<h2 class="anchored" data-anchor-id="psm-完整流程">💡 PSM 完整流程</h2>
<p>PSM 分析包含 <strong>5 个关键步骤</strong>：</p>
<pre><code>1. 数据准备 → 2. 估计倾向性得分 → 3. 匹配 → 4. 平衡性检验 → 5. 效应估计</code></pre>
<hr>
</section>
<section id="实战案例吸烟对出生体重的影响" class="level2">
<h2 class="anchored" data-anchor-id="实战案例吸烟对出生体重的影响">📊 实战案例：吸烟对出生体重的影响</h2>
<p>我们使用 <code>MatchIt</code> 包内置的 <code>lalonde</code> 数据集模拟一个经典问题：<strong>母亲吸烟是否影响新生儿体重？</strong></p>
<p>为了演示，我们构造一个模拟数据集：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 模拟数据：母亲吸烟与新生儿体重</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2024</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 生成协变量</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n, <span class="dv">28</span>, <span class="dv">5</span>))  <span class="co"># 母亲年龄</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>education <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, n, <span class="at">replace =</span> <span class="cn">TRUE</span>, </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.2</span>))  <span class="co"># 教育水平</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>income <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n, <span class="dv">50000</span>, <span class="dv">15000</span>))  <span class="co"># 家庭收入</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>prenatal_visits <span class="ot">&lt;-</span> <span class="fu">rpois</span>(n, <span class="dv">8</span>)  <span class="co"># 产检次数</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 吸烟状态受协变量影响（混杂）</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>smoke_prob <span class="ot">&lt;-</span> <span class="fu">plogis</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.05</span> <span class="sc">*</span> (age <span class="sc">-</span> <span class="dv">28</span>) <span class="sc">-</span> <span class="fl">0.3</span> <span class="sc">*</span> education <span class="sc">+</span> </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>                      <span class="fl">0.00001</span> <span class="sc">*</span> (income <span class="sc">-</span> <span class="dv">50000</span>) <span class="sc">-</span> <span class="fl">0.1</span> <span class="sc">*</span> prenatal_visits)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>smoking <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, smoke_prob)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 出生体重受吸烟和协变量影响</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 真实因果效应：吸烟降低体重 250g</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>birthweight <span class="ot">&lt;-</span> <span class="dv">3300</span> <span class="sc">+</span> </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span> <span class="sc">*</span> (age <span class="sc">-</span> <span class="dv">28</span>) <span class="sc">+</span> </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="dv">50</span> <span class="sc">*</span> education <span class="sc">+</span> </span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.002</span> <span class="sc">*</span> (income <span class="sc">-</span> <span class="dv">50000</span>) <span class="sc">+</span> </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="dv">20</span> <span class="sc">*</span> prenatal_visits <span class="sc">-</span> </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="dv">250</span> <span class="sc">*</span> smoking <span class="sc">+</span>  <span class="co"># 真实处理效应</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">300</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建数据框</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>birth_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> age,</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">education =</span> <span class="fu">factor</span>(education, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"初中"</span>, <span class="st">"高中"</span>, <span class="st">"本科"</span>, <span class="st">"研究生"</span>)),</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">income =</span> income,</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">prenatal_visits =</span> prenatal_visits,</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">smoking =</span> smoking,</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">birthweight =</span> <span class="fu">round</span>(birthweight)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>birth_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,000 × 7
      id   age education income prenatal_visits smoking birthweight
   &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;           &lt;int&gt;   &lt;int&gt;       &lt;dbl&gt;
 1     1    33 高中       88087               3       0        3714
 2     2    30 研究生     47298               9       0        3139
 3     3    27 本科       60744              10       0        3687
 4     4    27 高中       34279               8       0        4095
 5     5    34 本科       45515              10       0        3464
 6     6    34 高中       50469               5       0        3902
 7     7    31 本科       68495               9       0        3713
 8     8    27 本科       46204               9       0        3962
 9     9    22 高中       75489               8       0        2910
10    10    22 研究生     70732              11       0        3745
# ℹ 990 more rows</code></pre>
</div>
</div>
<section id="步骤-1探索性数据分析" class="level3">
<h3 class="anchored" data-anchor-id="步骤-1探索性数据分析">步骤 1：探索性数据分析</h3>
<p>首先查看吸烟组和非吸烟组的基线特征差异：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 基线特征对比</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>birth_data <span class="sc">|&gt;</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_summary</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> smoking,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">include =</span> <span class="fu">c</span>(age, education, income, prenatal_visits, birthweight),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">list</span>(</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">~</span> <span class="st">"年龄"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>      education <span class="sc">~</span> <span class="st">"教育水平"</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>      income <span class="sc">~</span> <span class="st">"家庭收入"</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>      prenatal_visits <span class="sc">~</span> <span class="st">"产检次数"</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>      birthweight <span class="sc">~</span> <span class="st">"出生体重 (g)"</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">statistic =</span> <span class="fu">list</span>(</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">all_continuous</span>() <span class="sc">~</span> <span class="st">"{mean} ({sd})"</span>,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">all_categorical</span>() <span class="sc">~</span> <span class="st">"{n} ({p}%)"</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_p</span>() <span class="sc">|&gt;</span> </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_overall</span>() <span class="sc">|&gt;</span> </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modify_header</span>(<span class="at">label =</span> <span class="st">"**变量**"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modify_spanning_header</span>(<span class="fu">c</span>(<span class="st">"stat_1"</span>, <span class="st">"stat_2"</span>) <span class="sc">~</span> <span class="st">"**吸烟状态**"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="mzttfjsqop" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#mzttfjsqop table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#mzttfjsqop thead, #mzttfjsqop tbody, #mzttfjsqop tfoot, #mzttfjsqop tr, #mzttfjsqop td, #mzttfjsqop th {
  border-style: none;
}

#mzttfjsqop p {
  margin: 0;
  padding: 0;
}

#mzttfjsqop .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mzttfjsqop .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#mzttfjsqop .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mzttfjsqop .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mzttfjsqop .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mzttfjsqop .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mzttfjsqop .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mzttfjsqop .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mzttfjsqop .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mzttfjsqop .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mzttfjsqop .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mzttfjsqop .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mzttfjsqop .gt_spanner_row {
  border-bottom-style: hidden;
}

#mzttfjsqop .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#mzttfjsqop .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mzttfjsqop .gt_from_md > :first-child {
  margin-top: 0;
}

#mzttfjsqop .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mzttfjsqop .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mzttfjsqop .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#mzttfjsqop .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#mzttfjsqop .gt_row_group_first td {
  border-top-width: 2px;
}

#mzttfjsqop .gt_row_group_first th {
  border-top-width: 2px;
}

#mzttfjsqop .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mzttfjsqop .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#mzttfjsqop .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#mzttfjsqop .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mzttfjsqop .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mzttfjsqop .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mzttfjsqop .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#mzttfjsqop .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mzttfjsqop .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mzttfjsqop .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mzttfjsqop .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mzttfjsqop .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mzttfjsqop .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mzttfjsqop .gt_left {
  text-align: left;
}

#mzttfjsqop .gt_center {
  text-align: center;
}

#mzttfjsqop .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mzttfjsqop .gt_font_normal {
  font-weight: normal;
}

#mzttfjsqop .gt_font_bold {
  font-weight: bold;
}

#mzttfjsqop .gt_font_italic {
  font-style: italic;
}

#mzttfjsqop .gt_super {
  font-size: 65%;
}

#mzttfjsqop .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#mzttfjsqop .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#mzttfjsqop .gt_indent_1 {
  text-indent: 5px;
}

#mzttfjsqop .gt_indent_2 {
  text-indent: 10px;
}

#mzttfjsqop .gt_indent_3 {
  text-indent: 15px;
}

#mzttfjsqop .gt_indent_4 {
  text-indent: 20px;
}

#mzttfjsqop .gt_indent_5 {
  text-indent: 25px;
}

#mzttfjsqop .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#mzttfjsqop div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="gt_col_headings gt_spanner_row header">
<th rowspan="2" id="label" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>变量</strong></th>
<th rowspan="2" id="stat_0" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Overall</strong><br>
N = 1,000<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
<th colspan="2" id="level 1; stat_1" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><div class="gt_column_spanner">
<strong>吸烟状态</strong>
</div></th>
<th rowspan="2" id="p.value" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>p-value</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>2</sup></span></th>
</tr>
<tr class="gt_col_headings even">
<th id="stat_1" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>0</strong><br>
N = 975<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
<th id="stat_2" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>1</strong><br>
N = 25<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">年龄</td>
<td class="gt_row gt_center" headers="stat_0">28.0 (4.9)</td>
<td class="gt_row gt_center" headers="stat_1">27.9 (4.9)</td>
<td class="gt_row gt_center" headers="stat_2">32.4 (4.3)</td>
<td class="gt_row gt_center" headers="p.value">&lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">教育水平</td>
<td class="gt_row gt_center" headers="stat_0"><br>
</td>
<td class="gt_row gt_center" headers="stat_1"><br>
</td>
<td class="gt_row gt_center" headers="stat_2"><br>
</td>
<td class="gt_row gt_center" headers="p.value">0.090</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;初中</td>
<td class="gt_row gt_center" headers="stat_0">111 (11%)</td>
<td class="gt_row gt_center" headers="stat_1">106 (11%)</td>
<td class="gt_row gt_center" headers="stat_2">5 (20%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;高中</td>
<td class="gt_row gt_center" headers="stat_0">325 (33%)</td>
<td class="gt_row gt_center" headers="stat_1">314 (32%)</td>
<td class="gt_row gt_center" headers="stat_2">11 (44%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;本科</td>
<td class="gt_row gt_center" headers="stat_0">383 (38%)</td>
<td class="gt_row gt_center" headers="stat_1">375 (38%)</td>
<td class="gt_row gt_center" headers="stat_2">8 (32%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;研究生</td>
<td class="gt_row gt_center" headers="stat_0">181 (18%)</td>
<td class="gt_row gt_center" headers="stat_1">180 (18%)</td>
<td class="gt_row gt_center" headers="stat_2">1 (4.0%)</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">家庭收入</td>
<td class="gt_row gt_center" headers="stat_0">50,365 (14,556)</td>
<td class="gt_row gt_center" headers="stat_1">50,400 (14,566)</td>
<td class="gt_row gt_center" headers="stat_2">49,015 (14,376)</td>
<td class="gt_row gt_center" headers="p.value">0.8</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">产检次数</td>
<td class="gt_row gt_center" headers="stat_0">8 (3)</td>
<td class="gt_row gt_center" headers="stat_1">8 (3)</td>
<td class="gt_row gt_center" headers="stat_2">7 (3)</td>
<td class="gt_row gt_center" headers="p.value">0.029</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">出生体重 (g)</td>
<td class="gt_row gt_center" headers="stat_0">3,585 (319)</td>
<td class="gt_row gt_center" headers="stat_1">3,589 (318)</td>
<td class="gt_row gt_center" headers="stat_2">3,416 (287)</td>
<td class="gt_row gt_center" headers="p.value">0.009</td>
</tr>
</tbody><tfoot>
<tr class="gt_footnotes odd">
<td colspan="5" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span> Mean (SD); n (%)</td>
</tr>
<tr class="gt_footnotes even">
<td colspan="5" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>2</sup></span> Wilcoxon rank sum test; Fisher’s exact test</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
<p>可以看到，吸烟组和非吸烟组在多个基线特征上存在显著差异，这就是<strong>混杂</strong>。</p>
</section>
<section id="步骤-2估计倾向性得分" class="level3">
<h3 class="anchored" data-anchor-id="步骤-2估计倾向性得分">步骤 2：估计倾向性得分</h3>
<p>使用 Logistic 回归估计每个个体的倾向性得分：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 估计倾向性得分</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>ps_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  smoking <span class="sc">~</span> age <span class="sc">+</span> education <span class="sc">+</span> income <span class="sc">+</span> prenatal_visits,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> birth_data,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 添加倾向性得分到数据</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>birth_data<span class="sc">$</span>ps <span class="ot">&lt;-</span> <span class="fu">predict</span>(ps_model, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看倾向性得分分布</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(birth_data, <span class="fu">aes</span>(<span class="at">x =</span> ps, <span class="at">fill =</span> <span class="fu">factor</span>(smoking))) <span class="sc">+</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#3b82f6"</span>, <span class="st">"#ef4444"</span>),</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"不吸烟"</span>, <span class="st">"吸烟"</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"倾向性得分分布"</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"匹配前：两组分布存在明显差异"</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"倾向性得分 P(吸烟|X)"</span>,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"密度"</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"吸烟状态"</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1018-psm_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p><strong>重要</strong>：两组的倾向性得分分布应有重叠区域（common support），否则无法进行有效匹配。</p>
</section>
<section id="步骤-3进行匹配" class="level3">
<h3 class="anchored" data-anchor-id="步骤-3进行匹配">步骤 3：进行匹配</h3>
<p><code>MatchIt</code> 包提供多种匹配方法：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>方法</th>
<th>参数</th>
<th>特点</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>最近邻匹配</td>
<td><code>method = "nearest"</code></td>
<td>最常用，1:1 或 1:k 匹配</td>
</tr>
<tr class="even">
<td>精确匹配</td>
<td><code>method = "exact"</code></td>
<td>协变量完全相同</td>
</tr>
<tr class="odd">
<td>卡尺匹配</td>
<td><code>caliper = 0.2</code></td>
<td>限制匹配距离</td>
</tr>
<tr class="even">
<td>最优匹配</td>
<td><code>method = "optimal"</code></td>
<td>全局最优配对</td>
</tr>
<tr class="odd">
<td>全匹配</td>
<td><code>method = "full"</code></td>
<td>所有样本加权</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1:1 最近邻匹配（带卡尺）</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>match_out <span class="ot">&lt;-</span> <span class="fu">matchit</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  smoking <span class="sc">~</span> age <span class="sc">+</span> education <span class="sc">+</span> income <span class="sc">+</span> prenatal_visits,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> birth_data,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"nearest"</span>,      <span class="co"># 最近邻匹配</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance =</span> <span class="st">"glm"</span>,        <span class="co"># 用 logistic 回归估计 PS</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">caliper =</span> <span class="fl">0.2</span>,           <span class="co"># 卡尺：0.2 个标准差</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ratio =</span> <span class="dv">1</span>,               <span class="co"># 1:1 匹配</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> <span class="cn">FALSE</span>          <span class="co"># 不放回</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看匹配结果摘要</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(match_out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
matchit(formula = smoking ~ age + education + income + prenatal_visits, 
    data = birth_data, method = "nearest", distance = "glm", 
    replace = FALSE, caliper = 0.2, ratio = 1)

Summary of Balance for All Data:
                Means Treated Means Control Std. Mean Diff. Var. Ratio
distance               0.0704        0.0238          0.6390     4.3869
age                   32.4000       27.9026          1.0528     0.7647
education初中          0.2000        0.1087          0.2282          .
education高中          0.4400        0.3221          0.2376          .
education本科          0.3200        0.3846         -0.1385          .
education研究生        0.0400        0.1846         -0.7380          .
income             49014.5200    50399.9128         -0.0964     0.9741
prenatal_visits        6.6400        8.0862         -0.4595     1.1920
                eCDF Mean eCDF Max
distance           0.3321   0.5590
age                0.1500   0.3928
education初中      0.0913   0.0913
education高中      0.1179   0.1179
education本科      0.0646   0.0646
education研究生    0.1446   0.1446
income             0.0410   0.1108
prenatal_visits    0.0810   0.2185

Summary of Balance for Matched Data:
                Means Treated Means Control Std. Mean Diff. Var. Ratio
distance               0.0578        0.0578          0.0009     0.9980
age                   32.0417       32.9167         -0.2048     1.2119
education初中          0.2083        0.1667          0.1042          .
education高中          0.4167        0.5417         -0.2518          .
education本科          0.3333        0.1667          0.3573          .
education研究生        0.0417        0.1250         -0.4253          .
income             49120.9583    49839.5000         -0.0500     1.0343
prenatal_visits        6.7500        7.0000         -0.0794     1.6007
                eCDF Mean eCDF Max Std. Pair Dist.
distance           0.0010   0.0417          0.0028
age                0.0431   0.2500          0.9461
education初中      0.0417   0.0417          0.5208
education高中      0.1250   0.1250          0.4197
education本科      0.1667   0.1667          0.7146
education研究生    0.0833   0.0833          0.8505
income             0.0439   0.1250          0.8968
prenatal_visits    0.0509   0.1667          1.0061

Sample Sizes:
          Control Treated
All           975      25
Matched        24      24
Unmatched     951       1
Discarded       0       0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取匹配后数据</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>matched_data <span class="ot">&lt;-</span> <span class="fu">match.data</span>(match_out)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 匹配后样本量</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"匹配前样本量:"</span>, <span class="fu">nrow</span>(birth_data), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>匹配前样本量: 1000 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"匹配后样本量:"</span>, <span class="fu">nrow</span>(matched_data), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>匹配后样本量: 48 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"匹配成功的处理组:"</span>, <span class="fu">sum</span>(matched_data<span class="sc">$</span>smoking <span class="sc">==</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>匹配成功的处理组: 24 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"匹配成功的对照组:"</span>, <span class="fu">sum</span>(matched_data<span class="sc">$</span>smoking <span class="sc">==</span> <span class="dv">0</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>匹配成功的对照组: 24 </code></pre>
</div>
</div>
</section>
<section id="步骤-4平衡性检验关键" class="level3">
<h3 class="anchored" data-anchor-id="步骤-4平衡性检验关键">步骤 4：平衡性检验（关键！）</h3>
<p>匹配后<strong>必须</strong>检验协变量的平衡性。常用指标：</p>
<ul>
<li><strong>标准化均值差 (SMD)</strong>：&lt; 0.1 表示良好平衡</li>
<li><strong>方差比 (Variance Ratio)</strong>：接近 1 表示良好</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用 cobalt 包进行平衡性诊断</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>bal_tab <span class="ot">&lt;-</span> <span class="fu">bal.tab</span>(match_out, </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">m =</span> <span class="fl">0.1</span>))  <span class="co"># SMD 阈值</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>bal_tab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Balance Measures
                     Type Diff.Adj        M.Threshold
distance         Distance   0.0009     Balanced, &lt;0.1
age               Contin.  -0.2048 Not Balanced, &gt;0.1
education_初中     Binary   0.0417     Balanced, &lt;0.1
education_高中     Binary  -0.1250 Not Balanced, &gt;0.1
education_本科     Binary   0.1667 Not Balanced, &gt;0.1
education_研究生   Binary  -0.0833     Balanced, &lt;0.1
income            Contin.  -0.0500     Balanced, &lt;0.1
prenatal_visits   Contin.  -0.0794     Balanced, &lt;0.1

Balance tally for mean differences
                   count
Balanced, &lt;0.1         5
Not Balanced, &gt;0.1     3

Variable with the greatest mean difference
 Variable Diff.Adj        M.Threshold
      age  -0.2048 Not Balanced, &gt;0.1

Sample sizes
          Control Treated
All           975      25
Matched        24      24
Unmatched     951       1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 可视化：Love Plot（最常用）</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">love.plot</span>(match_out,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">binary =</span> <span class="st">"std"</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">m =</span> <span class="fl">0.1</span>),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"#ef4444"</span>, <span class="st">"#22c55e"</span>),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">shapes =</span> <span class="fu">c</span>(<span class="st">"circle"</span>, <span class="st">"triangle"</span>),</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">var.order =</span> <span class="st">"unadjusted"</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"协变量平衡性检验 (Love Plot)"</span>) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1018-psm_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p><strong>解读</strong>： - 红点：匹配前的 SMD - 绿点：匹配后的 SMD - 垂直线：0.1 阈值 - 所有绿点都应落在阈值线内</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 可视化：匹配后倾向性得分分布</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(matched_data, <span class="fu">aes</span>(<span class="at">x =</span> ps, <span class="at">fill =</span> <span class="fu">factor</span>(smoking))) <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#3b82f6"</span>, <span class="st">"#ef4444"</span>),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"不吸烟"</span>, <span class="st">"吸烟"</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"匹配后倾向性得分分布"</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"两组分布高度重叠，平衡性良好"</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"倾向性得分"</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"密度"</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"吸烟状态"</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1018-psm_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="步骤-5估计处理效应" class="level3">
<h3 class="anchored" data-anchor-id="步骤-5估计处理效应">步骤 5：估计处理效应</h3>
<p>平衡性满足后，可以估计因果效应：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 方法 1：简单 t 检验（匹配后）</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>t_test_result <span class="ot">&lt;-</span> <span class="fu">t.test</span>(birthweight <span class="sc">~</span> smoking, <span class="at">data =</span> matched_data)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"匹配后均值差:"</span>, </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">diff</span>(t_test_result<span class="sc">$</span>estimate), <span class="dv">1</span>), <span class="st">"g</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>匹配后均值差: -172.5 g</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"95% CI:"</span>, </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="sc">-</span>t_test_result<span class="sc">$</span>conf.int[<span class="dv">2</span>], <span class="dv">1</span>), <span class="st">"到"</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="sc">-</span>t_test_result<span class="sc">$</span>conf.int[<span class="dv">1</span>], <span class="dv">1</span>), <span class="st">"g</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>95% CI: -339.4 到 -5.5 g</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"p 值:"</span>, <span class="fu">format.pval</span>(t_test_result<span class="sc">$</span>p.value, <span class="at">digits =</span> <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>p 值: 0.0432 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 方法 2：使用回归模型（推荐，可调整残余混杂）</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 双重稳健估计：PS 匹配 + 结局回归</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>outcome_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  birthweight <span class="sc">~</span> smoking <span class="sc">+</span> age <span class="sc">+</span> education <span class="sc">+</span> income <span class="sc">+</span> prenatal_visits,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> matched_data,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> weights  <span class="co"># 使用匹配权重</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用 marginaleffects 估计 ATT</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_comparisons</span>(</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  outcome_model,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"smoking"</span>,</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">vcov =</span> <span class="st">"HC2"</span>,  <span class="co"># 稳健标准误</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">subset</span>(matched_data, smoking <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Estimate Std. Error     z Pr(&gt;|z|)   S 2.5 % 97.5 %
     -187         93 -2.01   0.0444 4.5  -369  -4.66

Term: smoking
Type: response
Comparison: 1 - 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看回归模型结果</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(outcome_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = birthweight ~ smoking + age + education + income + 
    prenatal_visits, data = matched_data, weights = weights)

Residuals:
    Min      1Q  Median      3Q     Max 
-537.73 -177.06   -1.07  215.57  567.02 

Coefficients:
                  Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)      3.356e+03  4.267e+02   7.866  1.2e-09 ***
smoking         -1.869e+02  8.424e+01  -2.219   0.0322 *  
age             -2.633e+00  1.348e+01  -0.195   0.8461    
education高中    9.379e+01  1.130e+02   0.830   0.4114    
education本科    2.823e+02  1.275e+02   2.214   0.0326 *  
education研究生  1.928e+02  1.796e+02   1.074   0.2894    
income           1.181e-04  3.004e-03   0.039   0.9688    
prenatal_visits  2.809e+01  1.796e+01   1.564   0.1257    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 280.7 on 40 degrees of freedom
Multiple R-squared:  0.241, Adjusted R-squared:  0.1082 
F-statistic: 1.814 on 7 and 40 DF,  p-value: 0.1112</code></pre>
</div>
</div>
<p><strong>结果解读</strong>：</p>
<ul>
<li>匹配后估计的吸烟效应约为 <strong>-250g</strong>（与我们设定的真实效应一致）</li>
<li>95% CI 不包含 0，说明效应显著</li>
<li>这个效应可以解释为：<strong>在相似背景的人群中，吸烟导致新生儿体重平均降低约 250g</strong></li>
</ul>
<hr>
</section>
</section>
<section id="进阶不同匹配方法对比" class="level2">
<h2 class="anchored" data-anchor-id="进阶不同匹配方法对比">🔬 进阶：不同匹配方法对比</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 比较不同匹配方法</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>methods <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"最近邻 1:1"</span> <span class="ot">=</span> <span class="fu">matchit</span>(smoking <span class="sc">~</span> age <span class="sc">+</span> education <span class="sc">+</span> income <span class="sc">+</span> prenatal_visits,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> birth_data, <span class="at">method =</span> <span class="st">"nearest"</span>, <span class="at">ratio =</span> <span class="dv">1</span>),</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"最近邻 1:2"</span> <span class="ot">=</span> <span class="fu">matchit</span>(smoking <span class="sc">~</span> age <span class="sc">+</span> education <span class="sc">+</span> income <span class="sc">+</span> prenatal_visits,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> birth_data, <span class="at">method =</span> <span class="st">"nearest"</span>, <span class="at">ratio =</span> <span class="dv">2</span>),</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"最优匹配"</span> <span class="ot">=</span> <span class="fu">matchit</span>(smoking <span class="sc">~</span> age <span class="sc">+</span> education <span class="sc">+</span> income <span class="sc">+</span> prenatal_visits,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> birth_data, <span class="at">method =</span> <span class="st">"optimal"</span>),</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"全匹配"</span> <span class="ot">=</span> <span class="fu">matchit</span>(smoking <span class="sc">~</span> age <span class="sc">+</span> education <span class="sc">+</span> income <span class="sc">+</span> prenatal_visits,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> birth_data, <span class="at">method =</span> <span class="st">"full"</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取各方法的平衡性</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>balance_comparison <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="fu">names</span>(methods), <span class="cf">function</span>(name) {</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  bal <span class="ot">&lt;-</span> <span class="fu">bal.tab</span>(methods[[name]], <span class="at">stats =</span> <span class="st">"m"</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    方法 <span class="ot">=</span> name,</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    最大<span class="at">SMD =</span> <span class="fu">max</span>(<span class="fu">abs</span>(bal<span class="sc">$</span>Balance<span class="sc">$</span>Diff.Adj), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    平均<span class="at">SMD =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(bal<span class="sc">$</span>Balance<span class="sc">$</span>Diff.Adj), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    样本量 <span class="ot">=</span> <span class="fu">nrow</span>(<span class="fu">match.data</span>(methods[[name]]))</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>balance_comparison</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  方法       最大SMD 平均SMD 样本量
  &lt;chr&gt;        &lt;dbl&gt;   &lt;dbl&gt;  &lt;int&gt;
1 最近邻 1:1  0.197   0.0877     50
2 最近邻 1:2  0.0562  0.0356     75
3 最优匹配    0.122   0.0410     50
4 全匹配      0.0479  0.0173   1000</code></pre>
</div>
</div>
<hr>
</section>
<section id="敏感性分析" class="level2">
<h2 class="anchored" data-anchor-id="敏感性分析">📋 敏感性分析</h2>
<p>PSM 依赖”无未测量混杂”假设。使用敏感性分析评估结果的稳健性：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rosenbaum bounds 敏感性分析</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 安装 rbounds 包：install.packages("rbounds")</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"rbounds"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(rbounds)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 提取匹配对的结局差</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  matched_pairs <span class="ot">&lt;-</span> matched_data <span class="sc">|&gt;</span> </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(subclass) <span class="sc">|&gt;</span> </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">treated_outcome =</span> birthweight[smoking <span class="sc">==</span> <span class="dv">1</span>],</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">control_outcome =</span> birthweight[smoking <span class="sc">==</span> <span class="dv">0</span>],</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">diff =</span> treated_outcome <span class="sc">-</span> control_outcome</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Wilcoxon 符号秩检验的敏感性分析</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># psens(matched_pairs$diff, Gamma = 2, GammaInc = 0.1)</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="psm-的局限性与注意事项" class="level2">
<h2 class="anchored" data-anchor-id="psm-的局限性与注意事项">⚠️ PSM 的局限性与注意事项</h2>
<section id="常见陷阱" class="level3">
<h3 class="anchored" data-anchor-id="常见陷阱">1. 常见陷阱</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>陷阱</th>
<th>问题</th>
<th>解决方案</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>忽略平衡性检验</td>
<td>匹配后仍存在混杂</td>
<td><strong>必须</strong>检查 SMD &lt; 0.1</td>
</tr>
<tr class="even">
<td>过度匹配</td>
<td>样本量大幅减少，精度下降</td>
<td>考虑加权法而非匹配</td>
</tr>
<tr class="odd">
<td>纳入中介变量</td>
<td>阻断因果路径，偏倚效应</td>
<td>只纳入混杂因素</td>
</tr>
<tr class="even">
<td>纳入碰撞因子</td>
<td>引入新的偏倚</td>
<td>画 DAG 图辨别</td>
</tr>
<tr class="odd">
<td>忽略 common support</td>
<td>外推到无重叠区域</td>
<td>使用卡尺限制</td>
</tr>
</tbody>
</table>
</section>
<section id="psm-vs-其他方法" class="level3">
<h3 class="anchored" data-anchor-id="psm-vs-其他方法">2. PSM vs 其他方法</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>方法</th>
<th>适用场景</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PSM</td>
<td>处理组较小</td>
<td>直观、易解释</td>
<td>样本损失大</td>
</tr>
<tr class="even">
<td>IPW</td>
<td>全样本估计</td>
<td>保留全部样本</td>
<td>极端权重问题</td>
</tr>
<tr class="odd">
<td>IPTW+截断</td>
<td>存在极端 PS</td>
<td>稳健性好</td>
<td>需选择截断点</td>
</tr>
<tr class="even">
<td>DR 估计</td>
<td>追求稳健性</td>
<td>双重保护</td>
<td>复杂度高</td>
</tr>
</tbody>
</table>
</section>
<section id="dag-图的重要性" class="level3">
<h3 class="anchored" data-anchor-id="dag-图的重要性">3. DAG 图的重要性</h3>
<p>在做 PSM 前，<strong>强烈建议</strong>画出因果图 (DAG)：</p>
<pre><code>        年龄 ──────────────┐
          │                ↓
          ↓              出生体重
        吸烟 ────────────→ ↑
          ↑                │
        教育 ──────────────┘</code></pre>
<ul>
<li><strong>混杂因素</strong>：同时影响处理和结局的变量（应纳入 PS 模型）</li>
<li><strong>中介变量</strong>：处理影响结局的路径上的变量（不应纳入）</li>
<li><strong>碰撞因子</strong>：同时被处理和结局影响的变量（不应纳入）</li>
</ul>
<hr>
</section>
</section>
<section id="函数速查表" class="level2">
<h2 class="anchored" data-anchor-id="函数速查表">📝 函数速查表</h2>
<section id="matchit-核心函数" class="level3">
<h3 class="anchored" data-anchor-id="matchit-核心函数">MatchIt 核心函数</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>函数</th>
<th>功能</th>
<th>关键参数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>matchit()</code></td>
<td>执行匹配</td>
<td><code>method</code>, <code>distance</code>, <code>caliper</code>, <code>ratio</code></td>
</tr>
<tr class="even">
<td><code>match.data()</code></td>
<td>提取匹配数据</td>
<td><code>weights</code>, <code>subclass</code></td>
</tr>
<tr class="odd">
<td><code>summary()</code></td>
<td>匹配摘要</td>
<td><code>interactions</code>, <code>un</code></td>
</tr>
<tr class="even">
<td><code>plot()</code></td>
<td>可视化</td>
<td><code>type = "jitter"</code>, <code>"density"</code>, <code>"ecdf"</code></td>
</tr>
</tbody>
</table>
</section>
<section id="cobalt-核心函数" class="level3">
<h3 class="anchored" data-anchor-id="cobalt-核心函数">cobalt 核心函数</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>函数</th>
<th>功能</th>
<th>关键参数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>bal.tab()</code></td>
<td>平衡性表格</td>
<td><code>thresholds</code>, <code>stats</code></td>
</tr>
<tr class="even">
<td><code>love.plot()</code></td>
<td>Love Plot</td>
<td><code>binary</code>, <code>thresholds</code></td>
</tr>
<tr class="odd">
<td><code>bal.plot()</code></td>
<td>单变量平衡图</td>
<td><code>var.name</code>, <code>which</code></td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="参考资料" class="level2">
<h2 class="anchored" data-anchor-id="参考资料">🔗 参考资料</h2>
<ul>
<li><a href="https://kosukeimai.github.io/MatchIt/">MatchIt 官方文档</a></li>
<li><a href="https://ngreifer.github.io/cobalt/">cobalt 官方文档</a></li>
<li>Rosenbaum PR (2002). Observational Studies. Springer.</li>
<li>Austin PC (2011). An Introduction to Propensity Score Methods. <em>Multivariate Behavioral Research</em>.</li>
<li>《因果推断实用计量方法》- 邱嘉平</li>
</ul>
<hr>
</section>
<section id="完整代码模板" class="level2">
<h2 class="anchored" data-anchor-id="完整代码模板">📚 完整代码模板</h2>
<div class="sourceCode" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ========== PSM 分析模板 ==========</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MatchIt)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cobalt)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marginaleffects)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. 匹配</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">matchit</span>(</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  treatment <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3,  <span class="co"># 处理 ~ 混杂因素</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> your_data,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"nearest"</span>,</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance =</span> <span class="st">"glm"</span>,</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">caliper =</span> <span class="fl">0.2</span>,</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">ratio =</span> <span class="dv">1</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. 检查平衡性</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="fu">love.plot</span>(m, <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">m =</span> <span class="fl">0.1</span>))</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. 提取数据</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>matched <span class="ot">&lt;-</span> <span class="fu">match.data</span>(m)</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. 估计效应（双重稳健）</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(outcome <span class="sc">~</span> treatment <span class="sc">+</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3, </span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> matched, <span class="at">weights =</span> weights)</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. ATT 估计</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_comparisons</span>(fit, <span class="at">variables =</span> <span class="st">"treatment"</span>,</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>                <span class="at">newdata =</span> <span class="fu">subset</span>(matched, treatment <span class="sc">==</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>


</section>

</main> <!-- /main -->
<!-- Hypothesis 文字划线评论功能 -->

<!-- 用户可以选中任意文字添加批注，所有人都能看到 -->

<script>

    window.hypothesisConfig = function () {

        return {

            branding: {

                appBackgroundColor: 'white',

                ctaBackgroundColor: '#4f46e5',

                ctaTextColor: 'white',

                selectionFontFamily: 'inherit'

            },

            enableExperimentalNewNoteButton: true,

            showHighlights: 'always'

        };

    };

</script>

<script async="" src="https://hypothes.is/embed.js"></script>



<!-- Hypothesis 使用提示 -->

<style>

    .hypothesis-hint {

        position: fixed;

        bottom: 100px;

        right: 20px;

        background: linear-gradient(135deg, #4f46e5, #7c3aed);

        color: white;

        padding: 12px 16px;

        border-radius: 12px;

        font-size: 0.85rem;

        box-shadow: 0 4px 20px rgba(79, 70, 229, 0.3);

        z-index: 999;

        opacity: 0;

        transform: translateY(20px);

        transition: all 0.3s ease;

        pointer-events: none;

        max-width: 200px;

        line-height: 1.4;

    }

    

    .hypothesis-hint.show {

        opacity: 1;

        transform: translateY(0);

    }

    

    .hypothesis-hint::before {

        content: "💡";

        margin-right: 6px;

    }

    

    @media (max-width: 768px) {

        .hypothesis-hint {

            bottom: 80px;

            right: 10px;

            left: 10px;

            max-width: none;

        }

    }

</style>



<div class="hypothesis-hint" id="hypothesis-hint">

    选中文字可以添加批注，与其他读者互动！

</div>



<script>

    // 首次访问时显示提示

    document.addEventListener('DOMContentLoaded', function() {

        const hint = document.getElementById('hypothesis-hint');

        const hintShown = localStorage.getItem('hypothesis_hint_shown');

        

        if (!hintShown && hint) {

            setTimeout(() => {

                hint.classList.add('show');

                setTimeout(() => {

                    hint.classList.remove('show');

                    localStorage.setItem('hypothesis_hint_shown', 'true');

                }, 5000);

            }, 3000);

        }

    });

</script>



<!-- Back to Top Button -->

<button id="back-to-top" aria-label="Back to Top">

    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">

        <path d="M18 15l-6-6-6 6"></path>

    </svg>

</button>



<!-- Floating TOC Button (Mobile Only) -->

<button id="toc-floating-btn" aria-label="Table of Contents">

    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">

        <line x1="8" y1="6" x2="21" y2="6"></line>

        <line x1="8" y1="12" x2="21" y2="12"></line>

        <line x1="8" y1="18" x2="21" y2="18"></line>

        <line x1="3" y1="6" x2="3.01" y2="6"></line>

        <line x1="3" y1="12" x2="3.01" y2="12"></line>

        <line x1="3" y1="18" x2="3.01" y2="18"></line>

    </svg>

</button>



<!-- TOC Modal -->

<div class="toc-modal-overlay">

    <div class="toc-modal-content">

        <div class="toc-modal-header">

            <div class="toc-modal-title">目录</div>

            <button class="toc-modal-close" aria-label="Close">×</button>

        </div>

        <div class="toc-modal-body" id="toc-modal-body">

            <!-- TOC content will be injected here -->

        </div>

    </div>

</div>



<script>

    // Back to Top Logic

    const backToTopBtn = document.getElementById('back-to-top');



    window.addEventListener('scroll', () => {

        if (window.scrollY > 300) {

            backToTopBtn.classList.add('visible');

        } else {

            backToTopBtn.classList.remove('visible');

        }

    });



    backToTopBtn.addEventListener('click', () => {

        window.scrollTo({

            top: 0,

            behavior: 'smooth'

        });

    });



    // Mobile Table Scrolling Logic

    document.addEventListener("DOMContentLoaded", function () {

        const tables = document.querySelectorAll('table');

        tables.forEach(table => {

            if (!table.parentElement.classList.contains('table-responsive')) {

                const wrapper = document.createElement('div');

                wrapper.className = 'table-responsive';

                wrapper.style.overflowX = 'auto'; // Force scroll

                table.parentNode.insertBefore(wrapper, table);

                wrapper.appendChild(table);

            }

        });



        // Floating TOC Logic

        const tocBtn = document.getElementById('toc-floating-btn');

        const tocOverlay = document.querySelector('.toc-modal-overlay');

        const tocClose = document.querySelector('.toc-modal-close');

        const tocBody = document.getElementById('toc-modal-body');

        const originalToc = document.getElementById('TOC');



        if (originalToc && tocBtn) {

            // Check if TOC has content

            const tocLinks = originalToc.querySelectorAll('a');

            if (tocLinks.length > 0) {

                tocBtn.style.display = 'flex';



                // Function to populate modal

                const populateToc = () => {

                    tocBody.innerHTML = '';

                    const tocClone = originalToc.querySelector('ul').cloneNode(true);

                    tocBody.appendChild(tocClone);



                    // Add click listeners to close modal on link click

                    tocBody.querySelectorAll('a').forEach(link => {

                        link.addEventListener('click', () => {

                            tocOverlay.classList.remove('active');

                            // Smooth scroll to target (handled by browser usually, but ensure modal closes first)

                        });

                    });

                };



                tocBtn.addEventListener('click', () => {

                    populateToc();

                    tocOverlay.classList.add('active');

                });



                tocClose.addEventListener('click', () => {

                    tocOverlay.classList.remove('active');

                });



                tocOverlay.addEventListener('click', (e) => {

                    if (e.target === tocOverlay) {

                        tocOverlay.classList.remove('active');

                    }

                });

            } else {

                tocBtn.style.display = 'none';

            }

        } else if (tocBtn) {

            tocBtn.style.display = 'none';

        }



        // Article Footer Random Recommendation

        // Only run on article pages (has sidebar and main content)

        const sidebar = document.querySelector('#quarto-sidebar') || document.querySelector('.sidebar');

        const mainContent = document.querySelector('main');



        if (sidebar && mainContent) {

            const links = Array.from(sidebar.querySelectorAll('a.sidebar-item-text'));



            // If no links found with specific class, try generic anchor in sidebar

            const allLinks = links.length > 0 ? links : Array.from(sidebar.querySelectorAll('a'));



            // Filter out section headers if they are just toggles (usually href is # or empty)

            const validLinks = allLinks.filter(a => a.href && !a.href.endsWith('#') && !a.href.includes('javascript:'));



            // Article Footer Navigation (Prev/Next + Random)

            const currentUrl = window.location.href.split('#')[0];

            let currentIndex = -1;



            // Find current article index

            for (let i = 0; i < validLinks.length; i++) {

                if (validLinks[i].href.split('#')[0] === currentUrl) {

                    currentIndex = i;

                    break;

                }

            }



            // Create Container

            const footerNav = document.createElement('div');

            footerNav.className = 'article-footer-nav-container';

            footerNav.style.marginTop = '4rem';

            footerNav.style.paddingTop = '2rem';

            footerNav.style.borderTop = '1px solid #e5e7eb';



            // 1. Prev/Next Navigation

            if (currentIndex !== -1) {

                let navHtml = '<div class="article-footer-nav">';



                // Previous

                if (currentIndex > 0) {

                    const prevLink = validLinks[currentIndex - 1];

                    const prevTitle = prevLink.innerText.trim();

                    navHtml += `

                        <a href="${prevLink.href}" class="article-nav-link">

                            <span class="nav-label">上一篇</span>

                            <span class="nav-title">« ${prevTitle}</span>

                        </a>

                    `;

                } else {

                    navHtml += `<div></div>`;

                }



                // Next

                if (currentIndex < validLinks.length - 1) {

                    const nextLink = validLinks[currentIndex + 1];

                    const nextTitle = nextLink.innerText.trim();

                    navHtml += `

                        <a href="${nextLink.href}" class="article-nav-link" style="text-align: right;">

                            <span class="nav-label">下一篇</span>

                            <span class="nav-title">${nextTitle} »</span>

                        </a>

                    `;

                } else {

                    navHtml += `<div></div>`;

                }



                navHtml += '</div>';



                // Append Prev/Next HTML

                const navDiv = document.createElement('div');

                navDiv.innerHTML = navHtml;

                footerNav.appendChild(navDiv);

            }



            // 2. Random Recommendation

            const otherLinks = validLinks.filter((_, idx) => idx !== currentIndex);

            if (otherLinks.length > 0) {

                const randomIdx = Math.floor(Math.random() * otherLinks.length);

                const randomLink = otherLinks[randomIdx];

                const randomTitle = randomLink.innerText.trim(); // Use innerText for title



                if (randomTitle) {

                    const randomDiv = document.createElement('div');

                    randomDiv.innerHTML = `

                        <div class="random-recommendation">

                            <h4>👋 随便看看</h4>

                            <p>探索更多 R 语言精彩内容</p>

                            <a href="${randomLink.href}" class="random-btn">

                                🎲 ${randomTitle}

                            </a>

                        </div>

                    `;

                    footerNav.appendChild(randomDiv);

                }

            }



            mainContent.appendChild(footerNav);

        }

    });

</script>



<!-- Like Button Styles -->

<style>

    .article-like-container {

        display: flex;

        justify-content: flex-start;

        margin: 1.5rem 0 2rem 0;

        padding: 0;

    }



    .like-wrapper {

        display: flex;

        flex-direction: column;

        align-items: flex-start;

        gap: 0.4rem;

    }



    .like-btn {

        display: inline-flex;

        align-items: center;

        gap: 0.5rem;

        padding: 0.6rem 1.2rem;

        border: 2px solid #e5e7eb;

        border-radius: 50px;

        background: white;

        color: #6b7280;

        font-size: 0.95rem;

        font-weight: 500;

        cursor: pointer;

        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);

        user-select: none;

    }



    .like-btn:hover {

        border-color: #f472b6;

        color: #ec4899;

        background: #fdf2f8;

    }



    .like-btn.liked {

        border-color: #ec4899;

        color: #ec4899;

        background: #fdf2f8;

    }



    .like-btn.pop {

        animation: pop-animation 0.3s ease;

    }



    @keyframes pop-animation {

        0% {

            transform: scale(1);

        }



        50% {

            transform: scale(1.15);

        }



        100% {

            transform: scale(1);

        }

    }



    .like-icon {

        width: 20px;

        height: 20px;

        transition: transform 0.2s;

    }



    .like-btn:hover .like-icon {

        transform: scale(1.1);

    }



    .like-icon .heart-outline {

        fill: none;

        stroke: currentColor;

        stroke-width: 2;

    }



    .like-icon .heart-fill {

        fill: currentColor;

        opacity: 0;

        transition: opacity 0.2s;

    }



    .like-btn.liked .heart-fill {

        opacity: 1;

    }



    .like-btn.liked .heart-outline {

        stroke: none;

    }



    .like-text {

        font-size: 0.9rem;

    }



    .like-count {

        font-size: 0.85rem;

        min-width: 1rem;

        text-align: center;

    }



    .like-hint {

        font-size: 0.75rem;

        color: #9ca3af;

        padding-left: 0.25rem;

    }



    /* Mobile optimization */

    @media (max-width: 768px) {

        .article-like-container {

            margin: 1rem 0 1.5rem 0;

        }



        .like-btn {

            padding: 0.5rem 1rem;

            font-size: 0.9rem;

        }



        .like-icon {

            width: 18px;

            height: 18px;

        }

    }

</style>



<!-- Like Section Script with Supabase Backend -->

<script>

    // Supabase Configuration

    const SUPABASE_URL = 'https://zyfdzyifhvglibpganxt.supabase.co';

    const SUPABASE_ANON_KEY = 'sb_publishable_XhaP4hFZ30sHZybEjVRQxg_iwlPTxz8';



    document.addEventListener('DOMContentLoaded', async function () {

        const mainContent = document.querySelector('main');



        // Only show on article pages (not index, not sections)

        const isArticlePage = !window.location.pathname.includes('index.html') &&

            !window.location.pathname.includes('sections/') &&

            !window.location.pathname.endsWith('/');



        if (!isArticlePage || !mainContent) return;



        const articleId = window.location.pathname.replace(/[^a-zA-Z0-9]/g, '_');

        const likeKey = `article_like_${articleId}`; // localStorage key for current user's like state



        // Create Like Section (at page bottom)

        const likeSection = document.createElement('div');

        likeSection.className = 'article-like-section';



        // Initial state from localStorage (for immediate UI feedback)

        const isLiked = localStorage.getItem(likeKey) === 'true';

        let likeCount = 0;



        likeSection.innerHTML = `

            <div class="like-section-inner">

                <p class="like-prompt">觉得有帮助？点赞支持一下 👇</p>

                <button class="like-btn ${isLiked ? 'liked' : ''}" id="article-like-btn" aria-label="点赞">

                    <svg class="like-icon" viewBox="0 0 24 24" width="24" height="24">

                        <path class="heart-outline" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>

                        <path class="heart-fill" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>

                    </svg>

                    <span class="like-text">${isLiked ? '已喜欢' : '喜欢这篇文章'}</span>

                    <span class="like-count" id="like-count"><span class="loading-dots">...</span></span>

                </button>

            </div>

        `;



        mainContent.appendChild(likeSection);



        const likeBtn = document.getElementById('article-like-btn');

        const likeCountSpan = document.getElementById('like-count');

        const likeText = likeBtn.querySelector('.like-text');



        // Supabase API helper

        async function supabaseRequest(method, endpoint, body = null) {

            const options = {

                method: method,

                headers: {

                    'apikey': SUPABASE_ANON_KEY,

                    'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,

                    'Content-Type': 'application/json',

                    'Prefer': method === 'POST' ? 'return=representation' : 'return=minimal'

                }

            };

            if (body) options.body = JSON.stringify(body);



            try {

                const response = await fetch(`${SUPABASE_URL}/rest/v1/${endpoint}`, options);

                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const text = await response.text();

                return text ? JSON.parse(text) : null;

            } catch (error) {

                console.error('Supabase error:', error);

                return null;

            }

        }



        // Fetch current like count from Supabase

        async function fetchLikeCount() {

            const data = await supabaseRequest('GET', `article_likes?article_id=eq.${articleId}&select=like_count`);

            if (data && data.length > 0) {

                return data[0].like_count;

            }

            return 0;

        }



        // Update like count in Supabase

        async function updateLikeCount(newCount) {

            // Try to update existing record

            const existing = await supabaseRequest('GET', `article_likes?article_id=eq.${articleId}&select=id`);



            if (existing && existing.length > 0) {

                // Update existing

                await supabaseRequest('PATCH', `article_likes?article_id=eq.${articleId}`, {

                    like_count: newCount

                });

            } else {

                // Insert new record

                await supabaseRequest('POST', 'article_likes', {

                    article_id: articleId,

                    like_count: newCount

                });

            }

        }



        // Load initial like count

        try {

            likeCount = await fetchLikeCount();

            likeCountSpan.textContent = likeCount > 0 ? likeCount : '';

        } catch (e) {

            console.error('Failed to fetch likes:', e);

            likeCountSpan.textContent = '';

        }



        // Like button click handler

        likeBtn.addEventListener('click', async function () {

            const currentlyLiked = this.classList.contains('liked');



            // Optimistic UI update

            if (currentlyLiked) {

                this.classList.remove('liked');

                likeCount = Math.max(0, likeCount - 1);

                likeText.textContent = '喜欢这篇文章';

                localStorage.setItem(likeKey, 'false');

            } else {

                this.classList.add('liked');

                likeCount++;

                likeText.textContent = '已喜欢';

                localStorage.setItem(likeKey, 'true');



                this.classList.add('pop');

                setTimeout(() => this.classList.remove('pop'), 300);

            }



            likeCountSpan.textContent = likeCount > 0 ? likeCount : '';



            // Sync with Supabase in background

            try {

                await updateLikeCount(likeCount);

            } catch (e) {

                console.error('Failed to sync like:', e);

            }

        });



        // ============================================

        // Comment Section with Supabase

        // ============================================



        // Create comment section HTML

        const commentSection = document.createElement('div');

        commentSection.className = 'comment-section';

        commentSection.innerHTML = `

            <h4 class="comment-title">💬 评论区</h4>

            <div class="comment-form">

                <input type="text" id="comment-nickname" class="comment-nickname" placeholder="昵称（可选）" maxlength="20">

                <textarea id="comment-content" class="comment-textarea" placeholder="写下你的想法..." maxlength="500" rows="3"></textarea>

                <div class="comment-form-footer">

                    <span class="char-count"><span id="char-count">0</span>/500</span>

                    <button id="submit-comment" class="comment-submit-btn">发表评论</button>

                </div>

            </div>

            <div id="comment-list" class="comment-list">

                <div class="loading-comments">加载评论中...</div>

            </div>

        `;



        // Append comment section after like section

        const likeSectionEl = document.querySelector('.article-like-section');

        if (likeSectionEl) {

            likeSectionEl.after(commentSection);

        } else {

            mainContent.appendChild(commentSection);

        }



        const commentNickname = document.getElementById('comment-nickname');

        const commentContent = document.getElementById('comment-content');

        const submitBtn = document.getElementById('submit-comment');

        const commentList = document.getElementById('comment-list');

        const charCount = document.getElementById('char-count');



        // Visitor ID for identifying own comments

        let visitorId = localStorage.getItem('visitor_id');

        if (!visitorId) {

            visitorId = 'v_' + Math.random().toString(36).substr(2, 9) + Date.now().toString(36);

            localStorage.setItem('visitor_id', visitorId);

        }



        // Character counter

        commentContent.addEventListener('input', () => {

            charCount.textContent = commentContent.value.length;

        });



        // Format time helper

        function formatTime(timestamp) {

            const date = new Date(timestamp);

            const now = new Date();

            const diff = now - date;



            if (diff < 60000) return '刚刚';

            if (diff < 3600000) return Math.floor(diff / 60000) + ' 分钟前';

            if (diff < 86400000) return Math.floor(diff / 3600000) + ' 小时前';

            if (diff < 604800000) return Math.floor(diff / 86400000) + ' 天前';



            return date.toLocaleDateString('zh-CN');

        }



        // Escape HTML to prevent XSS

        function escapeHtml(text) {

            const div = document.createElement('div');

            div.textContent = text;

            return div.innerHTML;

        }



        // Fetch comments from Supabase

        async function fetchComments() {

            const data = await supabaseRequest('GET', `article_comments?article_id=eq.${articleId}&order=created_at.desc`);

            return data || [];

        }



        // Post new comment

        async function postComment(nickname, content) {

            return await supabaseRequest('POST', 'article_comments', {

                article_id: articleId,

                nickname: nickname || '匿名用户',

                content: content,

                visitor_id: visitorId

            });

        }



        // Delete comment

        async function deleteComment(commentId) {

            await supabaseRequest('DELETE', `article_comments?id=eq.${commentId}&visitor_id=eq.${visitorId}`);

        }



        // Render comments

        function renderComments(comments) {

            if (!comments || comments.length === 0) {

                commentList.innerHTML = '<div class="no-comments">暂无评论，来做第一个留言的人吧 🎉</div>';

                return;

            }



            commentList.innerHTML = comments.map(c => `

                <div class="comment-item" data-id="${c.id}">

                    <div class="comment-header">

                        <span class="comment-author">${escapeHtml(c.nickname || '匿名用户')}</span>

                        <span class="comment-time">${formatTime(c.created_at)}</span>

                        ${c.visitor_id === visitorId ? `<button class="comment-delete" data-id="${c.id}">删除</button>` : ''}

                    </div>

                    <div class="comment-body">${escapeHtml(c.content)}</div>

                </div>

            `).join('');



            // Add delete handlers

            commentList.querySelectorAll('.comment-delete').forEach(btn => {

                btn.addEventListener('click', async function () {

                    const id = this.dataset.id;

                    await deleteComment(id);

                    loadComments();

                });

            });

        }



        // Load and display comments

        async function loadComments() {

            try {

                const comments = await fetchComments();

                renderComments(comments);

            } catch (e) {

                console.error('Failed to load comments:', e);

                commentList.innerHTML = '<div class="no-comments">加载评论失败</div>';

            }

        }



        // Submit comment handler

        submitBtn.addEventListener('click', async function () {

            const content = commentContent.value.trim();

            if (!content) {

                alert('请输入评论内容');

                return;

            }



            submitBtn.disabled = true;

            submitBtn.textContent = '发送中...';



            try {

                await postComment(commentNickname.value.trim(), content);

                commentContent.value = '';

                charCount.textContent = '0';

                await loadComments();

            } catch (e) {

                console.error('Failed to post comment:', e);

                alert('评论发送失败，请重试');

            }



            submitBtn.disabled = false;

            submitBtn.textContent = '发表评论';

        });



        // Initial load

        loadComments();

    });

</script>



<!-- Interaction Section Styles -->

<style>

    .article-interaction-section {

        margin-top: 3rem;

        padding-top: 2rem;

        border-top: 2px solid #e5e7eb;

    }



    .interaction-header {

        text-align: center;

        margin-bottom: 2rem;

    }



    .interaction-header h3 {

        font-size: 1.4rem;

        color: #1f2937;

        margin: 0 0 0.5rem 0;

    }



    .interaction-header p {

        color: #6b7280;

        font-size: 0.95rem;

        margin: 0;

    }



    /* Like Section at Bottom */

    .article-like-section {

        margin-top: 3rem;

        padding: 2rem 0;

        border-top: 2px solid #e5e7eb;

        text-align: center;

    }



    .like-section-inner {

        display: flex;

        flex-direction: column;

        align-items: center;

        gap: 1rem;

    }



    .like-prompt {

        color: #6b7280;

        font-size: 0.95rem;

        margin: 0;

    }



    .article-like-section .like-btn {

        padding: 0.75rem 2rem;

        font-size: 1rem;

    }



    .article-like-section .like-icon {

        width: 22px;

        height: 22px;

    }



    /* Mobile */

    @media (max-width: 768px) {

        .article-like-section {

            margin-top: 2rem;

            padding: 1.5rem 0;

        }



        .like-prompt {

            font-size: 0.9rem;

        }

    }



    /* Comment Section */

    .comment-section {

        margin-top: 2rem;

        padding: 1.5rem;

        background: #f9fafb;

        border-radius: 12px;

    }



    .comment-title {

        font-size: 1.1rem;

        color: #1f2937;

        margin: 0 0 1rem 0;

    }



    .comment-form {

        margin-bottom: 1.5rem;

    }



    .comment-nickname {

        width: 200px;

        padding: 0.5rem 0.75rem;

        border: 1px solid #e5e7eb;

        border-radius: 8px;

        font-size: 0.9rem;

        margin-bottom: 0.75rem;

        background: white;

    }



    .comment-textarea {

        width: 100%;

        padding: 0.75rem;

        border: 1px solid #e5e7eb;

        border-radius: 8px;

        font-size: 0.95rem;

        resize: vertical;

        min-height: 80px;

        background: white;

        font-family: inherit;

        box-sizing: border-box;

        margin-bottom: 0.5rem;

    }



    .comment-nickname:focus,

    .comment-textarea:focus {

        outline: none;

        border-color: #4f46e5;

        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);

    }



    .comment-form-footer {

        display: flex;

        justify-content: space-between;

        align-items: center;

    }



    .char-count {

        font-size: 0.8rem;

        color: #9ca3af;

    }



    .comment-submit-btn {

        padding: 0.6rem 1.5rem;

        background: #4f46e5;

        color: white;

        border: none;

        border-radius: 8px;

        font-size: 0.9rem;

        font-weight: 500;

        cursor: pointer;

        transition: all 0.2s;

    }



    .comment-submit-btn:hover:not(:disabled) {

        background: #4338ca;

        transform: translateY(-1px);

    }



    .comment-submit-btn:disabled {

        opacity: 0.6;

        cursor: not-allowed;

    }



    .comment-list {

        margin-top: 1rem;

    }



    .loading-comments,

    .no-comments {

        text-align: center;

        color: #9ca3af;

        padding: 1.5rem;

        font-size: 0.95rem;

    }



    .comment-item {

        background: white;

        border-radius: 8px;

        padding: 1rem;

        margin-bottom: 0.75rem;

        border: 1px solid #e5e7eb;

    }



    .comment-header {

        display: flex;

        align-items: center;

        gap: 0.75rem;

        margin-bottom: 0.5rem;

    }



    .comment-author {

        font-weight: 600;

        color: #1f2937;

        font-size: 0.9rem;

    }



    .comment-time {

        font-size: 0.8rem;

        color: #9ca3af;

    }



    .comment-delete {

        margin-left: auto;

        background: none;

        border: none;

        color: #ef4444;

        font-size: 0.8rem;

        cursor: pointer;

        padding: 0.2rem 0.5rem;

        border-radius: 4px;

    }



    .comment-delete:hover {

        background: #fef2f2;

    }



    .comment-body {

        color: #374151;

        font-size: 0.95rem;

        line-height: 1.6;

        white-space: pre-wrap;

        word-break: break-word;

    }



    /* Mobile Comment Styles */

    @media (max-width: 768px) {

        .comment-section {

            padding: 1rem;

        }



        .comment-nickname {

            width: 100%;

        }



        .comment-title {

            font-size: 1rem;

        }

    }

</style>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Made with <a href="https://quarto.org/">Quarto</a> | © 2024-2026</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>