{"title":"bruceR - 统计分析工具","markdown":{"yaml":{"title":"bruceR - 统计分析工具","date":"2025-01-10","categories":["R包","统计分析","数据处理"]},"headingText":"R包介绍","containsRefs":false,"markdown":"\n\n\n\n\n**bruceR** 全称 \"**BR**oadly **U**seful **C**onvenient and **E**fficient **R** functions\"，由包寒吴霜博士开发，是一个集成了众多实用功能的 R 包，专为科研数据分析设计。\n\n链接：[CRAN](https://cran.r-project.org/package=bruceR) | [GitHub](https://github.com/psychbruce/bruceR) | [中文教程](https://zhuanlan.zhihu.com/p/281150493)\n\n### 核心功能\n\nbruceR 涵盖了数据分析的完整流程：\n\n| 模块 | 功能 | 主要函数 |\n|------|------|----------|\n| 基础编程 | 路径设置、数据导入导出、表格打印 | `set.wd()`, `import()`, `export()`, `print_table()` |\n| 数据计算 | 量表计算、反向计分、重编码 | `MEAN()`, `SUM()`, `RECODE()`, `RESCALE()` |\n| 信效度分析 | 信度分析、因子分析 | `Alpha()`, `EFA()`, `PCA()`, `CFA()` |\n| 描述统计 | 描述统计、频率分析、相关分析 | `Describe()`, `Freq()`, `Corr()` |\n| 方差分析 | t检验、ANOVA、简单效应、事后比较 | `TTEST()`, `MANOVA()`, `EMMEANS()` |\n| 回归模型 | 模型汇总、多层模型 | `model_summary()`, `HLM_summary()` |\n| 中介调节 | PROCESS 宏 | `PROCESS()`, `med_summary()` |\n\n### 依赖包自动加载\n\n加载 bruceR 时会自动加载常用包：\n\n- **数据处理**：`data.table`, `dplyr`, `tidyr`, `stringr`\n- **可视化**：`ggplot2`\n- **统计分析**：`psych`, `emmeans`, `lmerTest`, `effectsize`, `performance`\n\n## R包安装\n\n\n``` r\n# 方法1：从 CRAN 安装（推荐）\ninstall.packages(\"bruceR\", dep = TRUE)\n\n# 方法2：从 GitHub 安装最新版\ninstall.packages(\"devtools\")\ndevtools::install_github(\"psychbruce/bruceR\", dep = TRUE, force = TRUE)\n```\n\n\n``` r\nlibrary(bruceR)\n```\n\n---\n\n## 基础编程功能\n\n### set.wd()：智能设置工作目录\n\n自动将工作目录设置为当前脚本所在路径：\n\n\n``` r\nset.wd()\n```\n\n### import() / export()：万能数据导入导出\n\n支持几乎所有常见数据格式，自动识别文件类型：\n\n\n``` r\n# 支持的格式：\n# - 文本：.txt, .csv, .tsv\n# - Excel：.xls, .xlsx\n# - SPSS：.sav\n# - Stata：.dta\n# - R对象：.rda, .rds, .RData\n\n# 导入数据\ndata <- import(\"data.xlsx\")\ndata <- import(\"data.sav\")\ndata <- import(\"data.dta\")\n\n# 导出数据\nexport(data, file = \"output.xlsx\")\nexport(data, file = \"output.csv\")\n```\n\n### cc()：快速创建字符向量\n\n比 `c()` 更简洁，无需引号：\n\n\n``` r\n# 传统写法\nc(\"age\", \"gender\", \"education\")\n```\n\n```\n## [1] \"age\"       \"gender\"    \"education\"\n```\n\n``` r\n# bruceR 写法\ncc(\"age, gender, education\")\n```\n\n```\n## [1] \"age\"       \"gender\"    \"education\"\n```\n\n### print_table()：生成三线表\n\n\n``` r\nsummary_data <- data.frame(\n  Variable = c(\"Age\", \"Income\", \"Score\"),\n  Mean = c(35.2, 5000, 78.5),\n  SD = c(8.3, 1200, 12.1),\n  N = c(100, 100, 100)\n)\n\nprint_table(summary_data)\n```\n\n```\n## ─────────────────────────────────────\n##    Variable     Mean       SD       N\n## ─────────────────────────────────────\n## 1    Age      35.200    8.300 100.000\n## 2    Income 5000.000 1200.000 100.000\n## 3    Score    78.500   12.100 100.000\n## ─────────────────────────────────────\n```\n\n---\n\n## 数据计算功能\n\n### MEAN() / SUM()：横向计算（支持反向计分）\n\n心理学量表经常需要计算多个题目的均值或总分，并处理反向计分：\n\n\n``` r\n# 创建模拟问卷数据（5点量表，共6题）\nset.seed(42)\nquestionnaire <- data.frame(\n  id = 1:5,\n  q1 = sample(1:5, 5, replace = TRUE),\n  q2 = sample(1:5, 5, replace = TRUE),\n  q3 = sample(1:5, 5, replace = TRUE),\n  q4 = sample(1:5, 5, replace = TRUE),\n  q5 = sample(1:5, 5, replace = TRUE),\n  q6 = sample(1:5, 5, replace = TRUE)\n)\nquestionnaire\n```\n\n```\n##   id q1 q2 q3 q4 q5 q6\n## 1  1  1  4  1  3  5  4\n## 2  2  5  2  5  1  5  3\n## 3  3  1  2  4  1  5  2\n## 4  4  1  1  2  3  4  1\n## 5  5  2  4  2  4  2  2\n```\n\n``` r\n# 计算均值（q3、q6 反向计分，量表范围1-5）\nquestionnaire$score_mean <- MEAN(\n  questionnaire, \n  varrange = \"q1:q6\",\n  rev = c(\"q3\", \"q6\"),\n  likert = 1:5\n)\n\n# 计算总分\nquestionnaire$score_sum <- SUM(\n  questionnaire, \n  varrange = \"q1:q6\",\n  rev = c(\"q3\", \"q6\"),\n  likert = 1:5\n)\n\nquestionnaire[, c(\"id\", \"score_mean\", \"score_sum\")]\n```\n\n```\n##   id score_mean score_sum\n## 1  1   3.333333        20\n## 2  2   2.833333        17\n## 3  3   2.500000        15\n## 4  4   3.000000        18\n## 5  5   3.333333        20\n```\n\n### RECODE()：变量重编码\n\n\n``` r\nd <- data.frame(age = c(18, 25, 35, 45, 55, 65, 75))\n\nd$age_group <- RECODE(d$age, \n  \"lo:29 = '青年'; \n   30:59 = '中年'; \n   60:hi = '老年'\"\n)\nd\n```\n\n```\n##   age age_group\n## 1  18      青年\n## 2  25      青年\n## 3  35      中年\n## 4  45      中年\n## 5  55      中年\n## 6  65      老年\n## 7  75      老年\n```\n\n### RESCALE()：变量标准化\n\n\n``` r\nscores <- c(2, 3, 4, 5, 6, 7, 8)\nRESCALE(scores, to = 0:100)\n```\n\n```\n## [1]   0.00000  16.66667  33.33333  50.00000  66.66667  83.33333 100.00000\n```\n\n---\n\n## 信度与因子分析\n\n### Alpha()：信度分析\n\n\n``` r\ndata(\"bfi\", package = \"psych\")\n\n# Alpha 需要指定数据和变量名\nAlpha(bfi, var = \"A\", items = 1:5)\n```\n\n```\n## \n## Reliability Analysis\n## \n## Summary:\n## Total Items: 5\n## Scale Range: 1 ~ 6\n## Total Cases: 2800\n## Valid Cases: 2709 (96.8%)\n## \n## Scale Statistics:\n## Mean = 4.208\n## S.D. = 0.735\n## Cronbach’s α = 0.431\n## McDonald’s ω = 0.592\n## \n## Warning: Scale reliability is low. You may check item codings.\n## Item A1 correlates negatively with the scale and may be reversed.\n## You can specify this argument: rev=c(\"A1\")\n## \n## Item Statistics (Cronbach’s α If Item Deleted):\n## ─────────────────────────────────────────────\n##      Mean    S.D. Item-Rest Cor. Cronbach’s α\n## ─────────────────────────────────────────────\n## A1  2.412 (1.405)         -0.311        0.718\n## A2  4.797 (1.176)          0.372        0.278\n## A3  4.599 (1.305)          0.478        0.174\n## A4  4.682 (1.486)          0.365        0.252\n## A5  4.551 (1.262)          0.448        0.207\n## ─────────────────────────────────────────────\n## Item-Rest Cor. = Corrected Item-Total Correlation\n```\n\n### EFA()：探索性因子分析\n\n\n``` r\ndata(\"bfi\", package = \"psych\")\n\n# 探索性因子分析：使用 var + items 格式\n# 分析外向性(E)量表的5个题目\nEFA(bfi, var = \"E\", items = 1:5, nfactors = 2, plot.scree = FALSE)\n```\n\n```\n## \n## Principal Component Analysis\n## \n## Summary:\n## Total Items: 5\n## Scale Range: 1 ~ 6\n## Total Cases: 2800\n## Valid Cases: 2713 (96.9%)\n## \n## Extraction Method:\n## - Principal Component Analysis\n## Rotation Method:\n## - Varimax (with Kaiser Normalization)\n## \n## KMO and Bartlett's Test:\n## - Kaiser-Meyer-Olkin (KMO) Measure of Sampling Adequacy: MSA = 0.799\n## - Bartlett's Test of Sphericity: Approx. χ²(10) = 3011.40, p < 1e-99 ***\n## \n## Total Variance Explained:\n## ──────────────────────────────────────────────────────────────────────────────────\n##              Eigenvalue Variance % Cumulative % SS Loading Variance % Cumulative %\n## ──────────────────────────────────────────────────────────────────────────────────\n## Component 1       2.565     51.298       51.298      1.884     37.680       37.680\n## Component 2       0.768     15.368       66.666      1.449     28.986       66.666\n## Component 3       0.643     12.851       79.517                                   \n## Component 4       0.561     11.211       90.728                                   \n## Component 5       0.464      9.272      100.000                                   \n## ──────────────────────────────────────────────────────────────────────────────────\n## \n## Component Loadings (Rotated) (Sorted by Size):\n## ─────────────────────────────\n##        RC1    RC2 Communality\n## ─────────────────────────────\n## E1   0.812 -0.098       0.668\n## E2   0.752 -0.304       0.658\n## E4  -0.736  0.290       0.625\n## E5  -0.145  0.860       0.761\n## E3  -0.312  0.723       0.620\n## ─────────────────────────────\n## Communality = Sum of Squared (SS) Factor Loadings\n## (Uniqueness = 1 - Communality)\n```\n\n---\n\n## 描述统计与相关分析\n\n### Describe()：描述统计\n\n\n``` r\nDescribe(iris[, 1:4])\n```\n\n```\n## Descriptive Statistics:\n## ────────────────────────────────────────────────────────────────\n##                 N Mean   SD | Median  Min  Max Skewness Kurtosis\n## ────────────────────────────────────────────────────────────────\n## Sepal.Length  150 5.84 0.83 |   5.80 4.30 7.90     0.31    -0.61\n## Sepal.Width   150 3.06 0.44 |   3.00 2.00 4.40     0.31     0.14\n## Petal.Length  150 3.76 1.77 |   4.35 1.00 6.90    -0.27    -1.42\n## Petal.Width   150 1.20 0.76 |   1.30 0.10 2.50    -0.10    -1.36\n## ────────────────────────────────────────────────────────────────\n```\n\n### Freq()：频率分析\n\n\n``` r\nFreq(iris$Species)\n```\n\n```\n## Frequency Statistics:\n## ───────────────────\n##              N    %\n## ───────────────────\n## setosa      50 33.3\n## versicolor  50 33.3\n## virginica   50 33.3\n## ───────────────────\n## Total N = 150\n```\n\n### Corr()：相关分析\n\n\n``` r\nCorr(iris[, 1:4])\n```\n\n```\n## Pearson's r and 95% confidence intervals:\n## ─────────────────────────────────────────────────────────────\n##                                r       [95% CI]     p       N\n## ─────────────────────────────────────────────────────────────\n## Sepal.Length-Sepal.Width   -0.12 [-0.27,  0.04]  .152     150\n## Sepal.Length-Petal.Length   0.87 [ 0.83,  0.91] <.001 *** 150\n## Sepal.Length-Petal.Width    0.82 [ 0.76,  0.86] <.001 *** 150\n## Sepal.Width-Petal.Length   -0.43 [-0.55, -0.29] <.001 *** 150\n## Sepal.Width-Petal.Width    -0.37 [-0.50, -0.22] <.001 *** 150\n## Petal.Length-Petal.Width    0.96 [ 0.95,  0.97] <.001 *** 150\n## ─────────────────────────────────────────────────────────────\n```\n\n<div class=\"figure\">\n<img src=\"figure/unnamed-chunk-14-1.png\" alt=\"plot of chunk unnamed-chunk-14\" width=\"100%\" />\n<p class=\"caption\">plot of chunk unnamed-chunk-14</p>\n</div>\n\n---\n\n## 统计检验\n\n### TTEST()：t检验\n\n\n``` r\n# 独立样本 t 检验（需要两水平因子）\niris_subset <- iris[iris$Species %in% c(\"versicolor\", \"virginica\"), ]\niris_subset$Species <- droplevels(iris_subset$Species)\n\nTTEST(iris_subset, y = \"Sepal.Length\", x = \"Species\")\n```\n\n```\n## \n## Independent-Samples t-test\n## \n## Hypothesis: two-sided (μ2 - μ1 ≠ 0)\n## \n## Descriptives:\n## ───────────────────────────────────────────────\n##      Variable  Factor      Level  N Mean (S.D.)\n## ───────────────────────────────────────────────\n##  Sepal.Length Species versicolor 50 5.94 (0.52)\n##  Sepal.Length Species virginica  50 6.59 (0.64)\n## ───────────────────────────────────────────────\n## \n## Levene’s test for homogeneity of variance:\n## ────────────────────────────────────────────────────────────────────────────\n##                                                 Levene’s F df1 df2     p    \n## ────────────────────────────────────────────────────────────────────────────\n## Sepal.Length: Species (virginica - versicolor)        1.42   1  98  .236    \n## ────────────────────────────────────────────────────────────────────────────\n## Note: H0 = equal variance (homoscedasticity).\n## If significant (violation of the assumption),\n## then you should better set `var.equal=FALSE`.\n## \n## Results of t-test:\n## ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n##                                                    t df     p     Difference [95% CI] Cohen’s d [95% CI]     BF10\n## ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n## Sepal.Length: Species (virginica - versicolor)  5.63 98 <.001 ***   0.65 [0.42, 0.88]  1.13 [0.73, 1.52] 7.04e+04\n## ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n```\n\n### MANOVA()：多因素方差分析\n\n\n``` r\nMANOVA(data = npk, dv = \"yield\", between = c(\"N\", \"P\", \"K\"))\n```\n\n```\n## \n## ====== ANOVA (Between-Subjects Design) ======\n## \n## Descriptives:\n## ─────────────────────────────\n##  \"N\" \"P\" \"K\"   Mean    S.D. n\n## ─────────────────────────────\n##   N0  P0  K0 51.433 (4.600) 3\n##   N0  P0  K1 52.000 (5.635) 3\n##   N0  P1  K0 54.333 (9.411) 3\n##   N0  P1  K1 50.500 (2.364) 3\n##   N1  P0  K0 63.767 (5.086) 3\n##   N1  P0  K1 54.667 (4.216) 3\n##   N1  P1  K0 57.933 (5.478) 3\n##   N1  P1  K1 54.367 (5.006) 3\n## ─────────────────────────────\n## Total sample size: N = 24\n## \n## ANOVA Table:\n## Dependent variable(s):      yield\n## Between-subjects factor(s): N, P, K\n## Within-subjects factor(s):  –\n## Covariate(s):               –\n## ──────────────────────────────────────────────────────────────────────────\n##                 MS    MSE df1 df2     F     p     η²p [90% CI of η²p]  η²G\n## ──────────────────────────────────────────────────────────────────────────\n## N          189.282 30.724   1  16 6.161  .025 *     .278 [.024, .529] .278\n## P            8.402 30.724   1  16 0.273  .608       .017 [.000, .220] .017\n## K           95.202 30.724   1  16 3.099  .097 .     .162 [.000, .427] .162\n## N * P       21.282 30.724   1  16 0.693  .418       .041 [.000, .277] .041\n## N * K       33.135 30.724   1  16 1.078  .314       .063 [.000, .312] .063\n## P * K        0.482 30.724   1  16 0.016  .902       .001 [.000, .078] .001\n## N * P * K   37.002 30.724   1  16 1.204  .289       .070 [.000, .322] .070\n## ──────────────────────────────────────────────────────────────────────────\n## MSE = mean square error (the residual variance of the linear model)\n## η²p = partial eta-squared = SS / (SS + SSE) = F * df1 / (F * df1 + df2)\n## ω²p = partial omega-squared = (F - 1) * df1 / (F * df1 + df2 + 1)\n## η²G = generalized eta-squared (see Olejnik & Algina, 2003)\n## Cohen’s f² = η²p / (1 - η²p)\n## \n## Levene’s Test for Homogeneity of Variance:\n## ───────────────────────────────────────\n##            Levene’s F df1 df2     p    \n## ───────────────────────────────────────\n## DV: yield       0.986   7  16  .475    \n## ───────────────────────────────────────\n```\n\n### EMMEANS()：边际均值与事后比较\n\n\n``` r\nresult <- MANOVA(npk, dv = \"yield\", between = c(\"N\", \"P\"))\n```\n\n```\n## \n## ====== ANOVA (Between-Subjects Design) ======\n## \n## Descriptives:\n## ─────────────────────────\n##  \"N\" \"P\"   Mean    S.D. n\n## ─────────────────────────\n##   N0  P0 51.717 (4.611) 6\n##   N0  P1 52.417 (6.486) 6\n##   N1  P0 59.217 (6.504) 6\n##   N1  P1 56.150 (5.084) 6\n## ─────────────────────────\n## Total sample size: N = 24\n## \n## ANOVA Table:\n## Dependent variable(s):      yield\n## Between-subjects factor(s): N, P\n## Within-subjects factor(s):  –\n## Covariate(s):               –\n## ──────────────────────────────────────────────────────────────────────\n##             MS    MSE df1 df2     F     p     η²p [90% CI of η²p]  η²G\n## ──────────────────────────────────────────────────────────────────────\n## N      189.282 32.870   1  20 5.758  .026 *     .224 [.017, .460] .224\n## P        8.402 32.870   1  20 0.256  .619       .013 [.000, .181] .013\n## N * P   21.282 32.870   1  20 0.647  .430       .031 [.000, .230] .031\n## ──────────────────────────────────────────────────────────────────────\n## MSE = mean square error (the residual variance of the linear model)\n## η²p = partial eta-squared = SS / (SS + SSE) = F * df1 / (F * df1 + df2)\n## ω²p = partial omega-squared = (F - 1) * df1 / (F * df1 + df2 + 1)\n## η²G = generalized eta-squared (see Olejnik & Algina, 2003)\n## Cohen’s f² = η²p / (1 - η²p)\n## \n## Levene’s Test for Homogeneity of Variance:\n## ───────────────────────────────────────\n##            Levene’s F df1 df2     p    \n## ───────────────────────────────────────\n## DV: yield       0.160   3  20  .922    \n## ───────────────────────────────────────\n```\n\n``` r\nEMMEANS(result, effect = \"N\")\n```\n\n```\n## ------ EMMEANS (effect = \"N\") ------\n## \n## Joint Tests of \"N\":\n## ───────────────────────────────────────────────────\n##  Effect df1 df2     F     p     η²p [90% CI of η²p]\n## ───────────────────────────────────────────────────\n##   N       1  20 5.758  .026 *     .224 [.017, .460]\n##   P       1  20 0.256  .619       .013 [.000, .181]\n##   N * P   1  20 0.647  .430       .031 [.000, .230]\n## ───────────────────────────────────────────────────\n## Note. Simple effects of repeated measures with 3 or more levels\n## are different from the results obtained with SPSS MANOVA syntax.\n## \n## Univariate Tests of \"N\":\n## ────────────────────────────────────────────────────────\n##            Sum of Squares df Mean Square     F     p    \n## ────────────────────────────────────────────────────────\n## Mean: \"N\"         189.282  1     189.282 5.758  .026 *  \n## Residuals         657.400 20      32.870                \n## ────────────────────────────────────────────────────────\n## Note. Identical to the results obtained with SPSS GLM EMMEANS syntax.\n## \n## Estimated Marginal Means of \"N\":\n## ────────────────────────────────────\n##  \"N\"   Mean [95% CI of Mean]    S.E.\n## ────────────────────────────────────\n##   N0 52.067 [48.614, 55.519] (1.655)\n##   N1 57.683 [54.231, 61.136] (1.655)\n## ────────────────────────────────────\n## \n## Pairwise Comparisons of \"N\":\n## ─────────────────────────────────────────────────────────────────────\n##  Contrast Estimate    S.E. df     t     p     Cohen’s d [95% CI of d]\n## ─────────────────────────────────────────────────────────────────────\n##   N1 - N0    5.617 (2.341) 20 2.400  .026 *      0.980 [0.128, 1.831]\n## ─────────────────────────────────────────────────────────────────────\n## Pooled SD for computing Cohen’s d: 5.733\n## Results are averaged over the levels of: P\n## No need to adjust p values.\n## \n## Disclaimer:\n## By default, pooled SD is Root Mean Square Error (RMSE).\n## There is much disagreement on how to compute Cohen’s d.\n## You are completely responsible for setting `sd.pooled`.\n## You might also use `effectsize::t_to_d()` to compute d.\n```\n\n---\n\n## 回归分析\n\n### model_summary()：模型汇总\n\n\n``` r\nlm1 <- lm(Sepal.Length ~ Sepal.Width, data = iris)\nlm2 <- lm(Sepal.Length ~ Sepal.Width + Petal.Length, data = iris)\nlm3 <- lm(Sepal.Length ~ Sepal.Width + Petal.Length + Petal.Width, data = iris)\n\n# 多个模型对比\nmodel_summary(list(lm1, lm2, lm3))\n```\n\n```\n## \n## Model Summary\n## \n## ──────────────────────────────────────────────────────────────────\n##               (1) Sepal.Length  (2) Sepal.Length  (3) Sepal.Length\n## ──────────────────────────────────────────────────────────────────\n## (Intercept)     6.526 ***         2.249 ***         1.856 ***     \n##                (0.479)           (0.248)           (0.251)        \n## Sepal.Width    -0.223             0.596 ***         0.651 ***     \n##                (0.155)           (0.069)           (0.067)        \n## Petal.Length                      0.472 ***         0.709 ***     \n##                                  (0.017)           (0.057)        \n## Petal.Width                                        -0.556 ***     \n##                                                    (0.128)        \n## ──────────────────────────────────────────────────────────────────\n## R^2             0.014             0.840             0.859         \n## Adj. R^2        0.007             0.838             0.856         \n## Num. obs.     150               150               150             \n## ──────────────────────────────────────────────────────────────────\n## Note. * p < .05, ** p < .01, *** p < .001.\n```\n\n``` r\n# 输出标准化系数\nmodel_summary(lm3, std = TRUE)\n```\n\n```\n## \n## Model Summary\n## \n## ──────────────────────────────\n##               (1) Sepal.Length\n## ──────────────────────────────\n## Sepal.Width      .343 ***     \n##                 (.035)        \n## Petal.Length    1.512 ***     \n##                 (.121)        \n## Petal.Width     -.512 ***     \n##                 (.117)        \n## ──────────────────────────────\n## R^2              .859         \n## Adj. R^2         .856         \n## Num. obs.     150             \n## ──────────────────────────────\n## Note. * p < .05, ** p < .01, *** p < .001.\n## \n## # Check for Multicollinearity\n## \n## Low Correlation\n## \n##         Term  VIF     VIF 95% CI adj. VIF Tolerance Tolerance 95% CI\n##  Sepal.Width 1.27 [ 1.11,  1.65]     1.13      0.79     [0.61, 0.90]\n## \n## High Correlation\n## \n##          Term   VIF     VIF 95% CI adj. VIF Tolerance Tolerance 95% CI\n##  Petal.Length 15.10 [11.27, 20.36]     3.89      0.07     [0.05, 0.09]\n##   Petal.Width 14.23 [10.63, 19.19]     3.77      0.07     [0.05, 0.09]\n```\n\n---\n\n## 中介与调节分析\n\n### PROCESS()：中介调节分析\n\n\n``` r\nset.seed(123)\nn <- 200\nmediation_data <- data.frame(\n  X = rnorm(n),\n  M = rnorm(n),\n  Y = rnorm(n)\n)\nmediation_data$M <- 0.5 * mediation_data$X + rnorm(n, sd = 0.5)\nmediation_data$Y <- 0.4 * mediation_data$M + 0.3 * mediation_data$X + rnorm(n, sd = 0.5)\n\n# 简单中介模型\nPROCESS(mediation_data, y = \"Y\", x = \"X\", meds = \"M\", \n        ci = \"boot\", nsim = 100)\n```\n\n```\n## \n## ****************** PART 1. Regression Model Summary ******************\n## \n## PROCESS Model ID : 4\n## Model Type : Simple Mediation\n## -    Outcome (Y) : Y\n## -  Predictor (X) : X\n## -  Mediators (M) : M\n## - Moderators (W) : -\n## - Covariates (C) : -\n## -   HLM Clusters : -\n## \n## All numeric predictors have been grand-mean centered.\n## (For details, please see the help page of PROCESS.)\n## \n## Formula of Mediator:\n## -    M ~ X\n## Formula of Outcome:\n## -    Y ~ X + M\n## \n## CAUTION:\n##   Fixed effect (coef.) of a predictor involved in an interaction\n##   denotes its \"simple effect/slope\" at the other predictor = 0.\n##   Only when all predictors in an interaction are mean-centered\n##   can the fixed effect be interpreted as \"main effect\"!\n##   \n## Model Summary\n## \n## ──────────────────────────────────────────────────\n##              (1) Y        (2) M        (3) Y      \n## ──────────────────────────────────────────────────\n## (Intercept)    0.010       -0.015        0.010    \n##               (0.039)      (0.036)      (0.037)   \n## X              0.462 ***    0.475 ***    0.302 ***\n##               (0.041)      (0.039)      (0.052)   \n## M                                        0.336 ***\n##                                         (0.072)   \n## ──────────────────────────────────────────────────\n## R^2            0.391        0.434        0.452    \n## Adj. R^2       0.388        0.431        0.446    \n## Num. obs.    200          200          200        \n## ──────────────────────────────────────────────────\n## Note. * p < .05, ** p < .01, *** p < .001.\n## \n## ************ PART 2. Mediation/Moderation Effect Estimate ************\n## \n## Package Use : ‘mediation’ (v4.5.0)\n## Effect Type : Simple Mediation (Model 4)\n## Sample Size : 200\n## Random Seed : set.seed()\n## Simulations : 100 (Bootstrap)\n```\n\n```\n## \n## Running 100 simulations...\n## Indirect Path: \"X\" (X) ==> \"M\" (M) ==> \"Y\" (Y)\n## ─────────────────────────────────────────────────────────────\n##                Effect    S.E.      z     p      [Boot 95% CI]\n## ─────────────────────────────────────────────────────────────\n## Indirect (ab)   0.160 (0.039)  4.046 <.001 *** [0.098, 0.240]\n## Direct (c')     0.302 (0.053)  5.713 <.001 *** [0.192, 0.387]\n## Total (c)       0.462 (0.040) 11.623 <.001 *** [0.399, 0.545]\n## ─────────────────────────────────────────────────────────────\n## Percentile Bootstrap Confidence Interval\n## (SE and CI are estimated based on 100 Bootstrap samples.)\n## \n## Note. The results based on bootstrapping or other random processes\n## are unlikely identical to other statistical software (e.g., SPSS).\n## To make results reproducible, you need to set a seed (any number).\n## Please see the help page for details: help(PROCESS)\n## Ignore this note if you have already set a seed. :)\n```\n\n---\n\n## 其他实用功能\n\n### 运算符\n\n\n``` r\n# %notin%：不在其中\nc(1, 2, 3) %notin% c(2, 4, 6)\n```\n\n```\n## [1]  TRUE FALSE  TRUE\n```\n\n``` r\n# %allin%：全部在其中\nc(1, 2) %allin% c(1, 2, 3, 4)\n```\n\n```\n## [1] TRUE\n```\n\n### theme_bruce()：ggplot2 主题\n\n\n``` r\nlibrary(ggplot2)\n\nggplot(iris, aes(x = Sepal.Length, y = Sepal.Width, color = Species)) +\n  geom_point(size = 2, alpha = 0.7) +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  labs(title = \"鸢尾花数据可视化\") +\n  theme_bruce()\n```\n\n<div class=\"figure\">\n<img src=\"figure/unnamed-chunk-21-1.png\" alt=\"plot of chunk unnamed-chunk-21\" width=\"100%\" />\n<p class=\"caption\">plot of chunk unnamed-chunk-21</p>\n</div>\n\n---\n\n## 导出到 Word\n\nbruceR 的一大特色是可以将结果直接导出到 Word 文档：\n\n\n``` r\n# 描述统计\nDescribe(iris[, 1:4], file = \"descriptives.doc\")\n\n# 相关矩阵\nCorr(iris[, 1:4], file = \"correlation.doc\")\n\n# 回归模型\nmodel_summary(list(lm1, lm2, lm3), file = \"regression.doc\")\n\n# 中介分析\nPROCESS(data, y = \"Y\", x = \"X\", meds = \"M\", file = \"mediation.doc\")\n```\n\n---\n\n## 函数速查表\n\n| 类别 | 函数 | 功能 |\n|------|------|------|\n| **基础** | `set.wd()` | 设置工作目录到当前脚本位置 |\n| | `import()` / `export()` | 万能数据导入/导出 |\n| | `cc()` | 快速创建字符向量 |\n| | `print_table()` | 打印三线表 |\n| **计算** | `MEAN()` / `SUM()` | 横向计算（支持反向计分） |\n| | `RECODE()` | 变量重编码 |\n| | `RESCALE()` | 变量标准化 |\n| **信效度** | `Alpha()` | Cronbach's α 信度分析 |\n| | `EFA()` / `PCA()` | 探索性因子分析/主成分分析 |\n| | `CFA()` | 验证性因子分析 |\n| **描述** | `Describe()` | 描述统计 |\n| | `Freq()` | 频率分析与交叉表 |\n| | `Corr()` | 相关分析与热力图 |\n| **检验** | `TTEST()` | t检验（单样本/独立/配对） |\n| | `MANOVA()` | 多因素方差分析 |\n| | `EMMEANS()` | 边际均值与事后比较 |\n| **回归** | `model_summary()` | 回归模型整洁输出 |\n| | `GLM_summary()` | 广义线性模型汇总 |\n| | `HLM_summary()` | 多层线性模型汇总 |\n| **中介** | `PROCESS()` | 中介/调节效应分析 |\n| | `med_summary()` | 中介效应汇总 |\n\n---\n\n## 参考资源\n\n- [bruceR GitHub 主页](https://github.com/psychbruce/bruceR)\n- [CRAN 官方页面](https://cran.r-project.org/package=bruceR)\n- [中文教程：概述篇](https://zhuanlan.zhihu.com/p/281150493)\n- [中文教程：常见问题](https://zhuanlan.zhihu.com/p/432931518)\n- 引用：Bao, H. W. S. (2021). bruceR: Broadly useful convenient and efficient R functions. https://doi.org/10.32614/CRAN.package.bruceR\n","srcMarkdownNoYaml":"\n\n\n\n## R包介绍\n\n**bruceR** 全称 \"**BR**oadly **U**seful **C**onvenient and **E**fficient **R** functions\"，由包寒吴霜博士开发，是一个集成了众多实用功能的 R 包，专为科研数据分析设计。\n\n链接：[CRAN](https://cran.r-project.org/package=bruceR) | [GitHub](https://github.com/psychbruce/bruceR) | [中文教程](https://zhuanlan.zhihu.com/p/281150493)\n\n### 核心功能\n\nbruceR 涵盖了数据分析的完整流程：\n\n| 模块 | 功能 | 主要函数 |\n|------|------|----------|\n| 基础编程 | 路径设置、数据导入导出、表格打印 | `set.wd()`, `import()`, `export()`, `print_table()` |\n| 数据计算 | 量表计算、反向计分、重编码 | `MEAN()`, `SUM()`, `RECODE()`, `RESCALE()` |\n| 信效度分析 | 信度分析、因子分析 | `Alpha()`, `EFA()`, `PCA()`, `CFA()` |\n| 描述统计 | 描述统计、频率分析、相关分析 | `Describe()`, `Freq()`, `Corr()` |\n| 方差分析 | t检验、ANOVA、简单效应、事后比较 | `TTEST()`, `MANOVA()`, `EMMEANS()` |\n| 回归模型 | 模型汇总、多层模型 | `model_summary()`, `HLM_summary()` |\n| 中介调节 | PROCESS 宏 | `PROCESS()`, `med_summary()` |\n\n### 依赖包自动加载\n\n加载 bruceR 时会自动加载常用包：\n\n- **数据处理**：`data.table`, `dplyr`, `tidyr`, `stringr`\n- **可视化**：`ggplot2`\n- **统计分析**：`psych`, `emmeans`, `lmerTest`, `effectsize`, `performance`\n\n## R包安装\n\n\n``` r\n# 方法1：从 CRAN 安装（推荐）\ninstall.packages(\"bruceR\", dep = TRUE)\n\n# 方法2：从 GitHub 安装最新版\ninstall.packages(\"devtools\")\ndevtools::install_github(\"psychbruce/bruceR\", dep = TRUE, force = TRUE)\n```\n\n\n``` r\nlibrary(bruceR)\n```\n\n---\n\n## 基础编程功能\n\n### set.wd()：智能设置工作目录\n\n自动将工作目录设置为当前脚本所在路径：\n\n\n``` r\nset.wd()\n```\n\n### import() / export()：万能数据导入导出\n\n支持几乎所有常见数据格式，自动识别文件类型：\n\n\n``` r\n# 支持的格式：\n# - 文本：.txt, .csv, .tsv\n# - Excel：.xls, .xlsx\n# - SPSS：.sav\n# - Stata：.dta\n# - R对象：.rda, .rds, .RData\n\n# 导入数据\ndata <- import(\"data.xlsx\")\ndata <- import(\"data.sav\")\ndata <- import(\"data.dta\")\n\n# 导出数据\nexport(data, file = \"output.xlsx\")\nexport(data, file = \"output.csv\")\n```\n\n### cc()：快速创建字符向量\n\n比 `c()` 更简洁，无需引号：\n\n\n``` r\n# 传统写法\nc(\"age\", \"gender\", \"education\")\n```\n\n```\n## [1] \"age\"       \"gender\"    \"education\"\n```\n\n``` r\n# bruceR 写法\ncc(\"age, gender, education\")\n```\n\n```\n## [1] \"age\"       \"gender\"    \"education\"\n```\n\n### print_table()：生成三线表\n\n\n``` r\nsummary_data <- data.frame(\n  Variable = c(\"Age\", \"Income\", \"Score\"),\n  Mean = c(35.2, 5000, 78.5),\n  SD = c(8.3, 1200, 12.1),\n  N = c(100, 100, 100)\n)\n\nprint_table(summary_data)\n```\n\n```\n## ─────────────────────────────────────\n##    Variable     Mean       SD       N\n## ─────────────────────────────────────\n## 1    Age      35.200    8.300 100.000\n## 2    Income 5000.000 1200.000 100.000\n## 3    Score    78.500   12.100 100.000\n## ─────────────────────────────────────\n```\n\n---\n\n## 数据计算功能\n\n### MEAN() / SUM()：横向计算（支持反向计分）\n\n心理学量表经常需要计算多个题目的均值或总分，并处理反向计分：\n\n\n``` r\n# 创建模拟问卷数据（5点量表，共6题）\nset.seed(42)\nquestionnaire <- data.frame(\n  id = 1:5,\n  q1 = sample(1:5, 5, replace = TRUE),\n  q2 = sample(1:5, 5, replace = TRUE),\n  q3 = sample(1:5, 5, replace = TRUE),\n  q4 = sample(1:5, 5, replace = TRUE),\n  q5 = sample(1:5, 5, replace = TRUE),\n  q6 = sample(1:5, 5, replace = TRUE)\n)\nquestionnaire\n```\n\n```\n##   id q1 q2 q3 q4 q5 q6\n## 1  1  1  4  1  3  5  4\n## 2  2  5  2  5  1  5  3\n## 3  3  1  2  4  1  5  2\n## 4  4  1  1  2  3  4  1\n## 5  5  2  4  2  4  2  2\n```\n\n``` r\n# 计算均值（q3、q6 反向计分，量表范围1-5）\nquestionnaire$score_mean <- MEAN(\n  questionnaire, \n  varrange = \"q1:q6\",\n  rev = c(\"q3\", \"q6\"),\n  likert = 1:5\n)\n\n# 计算总分\nquestionnaire$score_sum <- SUM(\n  questionnaire, \n  varrange = \"q1:q6\",\n  rev = c(\"q3\", \"q6\"),\n  likert = 1:5\n)\n\nquestionnaire[, c(\"id\", \"score_mean\", \"score_sum\")]\n```\n\n```\n##   id score_mean score_sum\n## 1  1   3.333333        20\n## 2  2   2.833333        17\n## 3  3   2.500000        15\n## 4  4   3.000000        18\n## 5  5   3.333333        20\n```\n\n### RECODE()：变量重编码\n\n\n``` r\nd <- data.frame(age = c(18, 25, 35, 45, 55, 65, 75))\n\nd$age_group <- RECODE(d$age, \n  \"lo:29 = '青年'; \n   30:59 = '中年'; \n   60:hi = '老年'\"\n)\nd\n```\n\n```\n##   age age_group\n## 1  18      青年\n## 2  25      青年\n## 3  35      中年\n## 4  45      中年\n## 5  55      中年\n## 6  65      老年\n## 7  75      老年\n```\n\n### RESCALE()：变量标准化\n\n\n``` r\nscores <- c(2, 3, 4, 5, 6, 7, 8)\nRESCALE(scores, to = 0:100)\n```\n\n```\n## [1]   0.00000  16.66667  33.33333  50.00000  66.66667  83.33333 100.00000\n```\n\n---\n\n## 信度与因子分析\n\n### Alpha()：信度分析\n\n\n``` r\ndata(\"bfi\", package = \"psych\")\n\n# Alpha 需要指定数据和变量名\nAlpha(bfi, var = \"A\", items = 1:5)\n```\n\n```\n## \n## Reliability Analysis\n## \n## Summary:\n## Total Items: 5\n## Scale Range: 1 ~ 6\n## Total Cases: 2800\n## Valid Cases: 2709 (96.8%)\n## \n## Scale Statistics:\n## Mean = 4.208\n## S.D. = 0.735\n## Cronbach’s α = 0.431\n## McDonald’s ω = 0.592\n## \n## Warning: Scale reliability is low. You may check item codings.\n## Item A1 correlates negatively with the scale and may be reversed.\n## You can specify this argument: rev=c(\"A1\")\n## \n## Item Statistics (Cronbach’s α If Item Deleted):\n## ─────────────────────────────────────────────\n##      Mean    S.D. Item-Rest Cor. Cronbach’s α\n## ─────────────────────────────────────────────\n## A1  2.412 (1.405)         -0.311        0.718\n## A2  4.797 (1.176)          0.372        0.278\n## A3  4.599 (1.305)          0.478        0.174\n## A4  4.682 (1.486)          0.365        0.252\n## A5  4.551 (1.262)          0.448        0.207\n## ─────────────────────────────────────────────\n## Item-Rest Cor. = Corrected Item-Total Correlation\n```\n\n### EFA()：探索性因子分析\n\n\n``` r\ndata(\"bfi\", package = \"psych\")\n\n# 探索性因子分析：使用 var + items 格式\n# 分析外向性(E)量表的5个题目\nEFA(bfi, var = \"E\", items = 1:5, nfactors = 2, plot.scree = FALSE)\n```\n\n```\n## \n## Principal Component Analysis\n## \n## Summary:\n## Total Items: 5\n## Scale Range: 1 ~ 6\n## Total Cases: 2800\n## Valid Cases: 2713 (96.9%)\n## \n## Extraction Method:\n## - Principal Component Analysis\n## Rotation Method:\n## - Varimax (with Kaiser Normalization)\n## \n## KMO and Bartlett's Test:\n## - Kaiser-Meyer-Olkin (KMO) Measure of Sampling Adequacy: MSA = 0.799\n## - Bartlett's Test of Sphericity: Approx. χ²(10) = 3011.40, p < 1e-99 ***\n## \n## Total Variance Explained:\n## ──────────────────────────────────────────────────────────────────────────────────\n##              Eigenvalue Variance % Cumulative % SS Loading Variance % Cumulative %\n## ──────────────────────────────────────────────────────────────────────────────────\n## Component 1       2.565     51.298       51.298      1.884     37.680       37.680\n## Component 2       0.768     15.368       66.666      1.449     28.986       66.666\n## Component 3       0.643     12.851       79.517                                   \n## Component 4       0.561     11.211       90.728                                   \n## Component 5       0.464      9.272      100.000                                   \n## ──────────────────────────────────────────────────────────────────────────────────\n## \n## Component Loadings (Rotated) (Sorted by Size):\n## ─────────────────────────────\n##        RC1    RC2 Communality\n## ─────────────────────────────\n## E1   0.812 -0.098       0.668\n## E2   0.752 -0.304       0.658\n## E4  -0.736  0.290       0.625\n## E5  -0.145  0.860       0.761\n## E3  -0.312  0.723       0.620\n## ─────────────────────────────\n## Communality = Sum of Squared (SS) Factor Loadings\n## (Uniqueness = 1 - Communality)\n```\n\n---\n\n## 描述统计与相关分析\n\n### Describe()：描述统计\n\n\n``` r\nDescribe(iris[, 1:4])\n```\n\n```\n## Descriptive Statistics:\n## ────────────────────────────────────────────────────────────────\n##                 N Mean   SD | Median  Min  Max Skewness Kurtosis\n## ────────────────────────────────────────────────────────────────\n## Sepal.Length  150 5.84 0.83 |   5.80 4.30 7.90     0.31    -0.61\n## Sepal.Width   150 3.06 0.44 |   3.00 2.00 4.40     0.31     0.14\n## Petal.Length  150 3.76 1.77 |   4.35 1.00 6.90    -0.27    -1.42\n## Petal.Width   150 1.20 0.76 |   1.30 0.10 2.50    -0.10    -1.36\n## ────────────────────────────────────────────────────────────────\n```\n\n### Freq()：频率分析\n\n\n``` r\nFreq(iris$Species)\n```\n\n```\n## Frequency Statistics:\n## ───────────────────\n##              N    %\n## ───────────────────\n## setosa      50 33.3\n## versicolor  50 33.3\n## virginica   50 33.3\n## ───────────────────\n## Total N = 150\n```\n\n### Corr()：相关分析\n\n\n``` r\nCorr(iris[, 1:4])\n```\n\n```\n## Pearson's r and 95% confidence intervals:\n## ─────────────────────────────────────────────────────────────\n##                                r       [95% CI]     p       N\n## ─────────────────────────────────────────────────────────────\n## Sepal.Length-Sepal.Width   -0.12 [-0.27,  0.04]  .152     150\n## Sepal.Length-Petal.Length   0.87 [ 0.83,  0.91] <.001 *** 150\n## Sepal.Length-Petal.Width    0.82 [ 0.76,  0.86] <.001 *** 150\n## Sepal.Width-Petal.Length   -0.43 [-0.55, -0.29] <.001 *** 150\n## Sepal.Width-Petal.Width    -0.37 [-0.50, -0.22] <.001 *** 150\n## Petal.Length-Petal.Width    0.96 [ 0.95,  0.97] <.001 *** 150\n## ─────────────────────────────────────────────────────────────\n```\n\n<div class=\"figure\">\n<img src=\"figure/unnamed-chunk-14-1.png\" alt=\"plot of chunk unnamed-chunk-14\" width=\"100%\" />\n<p class=\"caption\">plot of chunk unnamed-chunk-14</p>\n</div>\n\n---\n\n## 统计检验\n\n### TTEST()：t检验\n\n\n``` r\n# 独立样本 t 检验（需要两水平因子）\niris_subset <- iris[iris$Species %in% c(\"versicolor\", \"virginica\"), ]\niris_subset$Species <- droplevels(iris_subset$Species)\n\nTTEST(iris_subset, y = \"Sepal.Length\", x = \"Species\")\n```\n\n```\n## \n## Independent-Samples t-test\n## \n## Hypothesis: two-sided (μ2 - μ1 ≠ 0)\n## \n## Descriptives:\n## ───────────────────────────────────────────────\n##      Variable  Factor      Level  N Mean (S.D.)\n## ───────────────────────────────────────────────\n##  Sepal.Length Species versicolor 50 5.94 (0.52)\n##  Sepal.Length Species virginica  50 6.59 (0.64)\n## ───────────────────────────────────────────────\n## \n## Levene’s test for homogeneity of variance:\n## ────────────────────────────────────────────────────────────────────────────\n##                                                 Levene’s F df1 df2     p    \n## ────────────────────────────────────────────────────────────────────────────\n## Sepal.Length: Species (virginica - versicolor)        1.42   1  98  .236    \n## ────────────────────────────────────────────────────────────────────────────\n## Note: H0 = equal variance (homoscedasticity).\n## If significant (violation of the assumption),\n## then you should better set `var.equal=FALSE`.\n## \n## Results of t-test:\n## ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n##                                                    t df     p     Difference [95% CI] Cohen’s d [95% CI]     BF10\n## ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n## Sepal.Length: Species (virginica - versicolor)  5.63 98 <.001 ***   0.65 [0.42, 0.88]  1.13 [0.73, 1.52] 7.04e+04\n## ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n```\n\n### MANOVA()：多因素方差分析\n\n\n``` r\nMANOVA(data = npk, dv = \"yield\", between = c(\"N\", \"P\", \"K\"))\n```\n\n```\n## \n## ====== ANOVA (Between-Subjects Design) ======\n## \n## Descriptives:\n## ─────────────────────────────\n##  \"N\" \"P\" \"K\"   Mean    S.D. n\n## ─────────────────────────────\n##   N0  P0  K0 51.433 (4.600) 3\n##   N0  P0  K1 52.000 (5.635) 3\n##   N0  P1  K0 54.333 (9.411) 3\n##   N0  P1  K1 50.500 (2.364) 3\n##   N1  P0  K0 63.767 (5.086) 3\n##   N1  P0  K1 54.667 (4.216) 3\n##   N1  P1  K0 57.933 (5.478) 3\n##   N1  P1  K1 54.367 (5.006) 3\n## ─────────────────────────────\n## Total sample size: N = 24\n## \n## ANOVA Table:\n## Dependent variable(s):      yield\n## Between-subjects factor(s): N, P, K\n## Within-subjects factor(s):  –\n## Covariate(s):               –\n## ──────────────────────────────────────────────────────────────────────────\n##                 MS    MSE df1 df2     F     p     η²p [90% CI of η²p]  η²G\n## ──────────────────────────────────────────────────────────────────────────\n## N          189.282 30.724   1  16 6.161  .025 *     .278 [.024, .529] .278\n## P            8.402 30.724   1  16 0.273  .608       .017 [.000, .220] .017\n## K           95.202 30.724   1  16 3.099  .097 .     .162 [.000, .427] .162\n## N * P       21.282 30.724   1  16 0.693  .418       .041 [.000, .277] .041\n## N * K       33.135 30.724   1  16 1.078  .314       .063 [.000, .312] .063\n## P * K        0.482 30.724   1  16 0.016  .902       .001 [.000, .078] .001\n## N * P * K   37.002 30.724   1  16 1.204  .289       .070 [.000, .322] .070\n## ──────────────────────────────────────────────────────────────────────────\n## MSE = mean square error (the residual variance of the linear model)\n## η²p = partial eta-squared = SS / (SS + SSE) = F * df1 / (F * df1 + df2)\n## ω²p = partial omega-squared = (F - 1) * df1 / (F * df1 + df2 + 1)\n## η²G = generalized eta-squared (see Olejnik & Algina, 2003)\n## Cohen’s f² = η²p / (1 - η²p)\n## \n## Levene’s Test for Homogeneity of Variance:\n## ───────────────────────────────────────\n##            Levene’s F df1 df2     p    \n## ───────────────────────────────────────\n## DV: yield       0.986   7  16  .475    \n## ───────────────────────────────────────\n```\n\n### EMMEANS()：边际均值与事后比较\n\n\n``` r\nresult <- MANOVA(npk, dv = \"yield\", between = c(\"N\", \"P\"))\n```\n\n```\n## \n## ====== ANOVA (Between-Subjects Design) ======\n## \n## Descriptives:\n## ─────────────────────────\n##  \"N\" \"P\"   Mean    S.D. n\n## ─────────────────────────\n##   N0  P0 51.717 (4.611) 6\n##   N0  P1 52.417 (6.486) 6\n##   N1  P0 59.217 (6.504) 6\n##   N1  P1 56.150 (5.084) 6\n## ─────────────────────────\n## Total sample size: N = 24\n## \n## ANOVA Table:\n## Dependent variable(s):      yield\n## Between-subjects factor(s): N, P\n## Within-subjects factor(s):  –\n## Covariate(s):               –\n## ──────────────────────────────────────────────────────────────────────\n##             MS    MSE df1 df2     F     p     η²p [90% CI of η²p]  η²G\n## ──────────────────────────────────────────────────────────────────────\n## N      189.282 32.870   1  20 5.758  .026 *     .224 [.017, .460] .224\n## P        8.402 32.870   1  20 0.256  .619       .013 [.000, .181] .013\n## N * P   21.282 32.870   1  20 0.647  .430       .031 [.000, .230] .031\n## ──────────────────────────────────────────────────────────────────────\n## MSE = mean square error (the residual variance of the linear model)\n## η²p = partial eta-squared = SS / (SS + SSE) = F * df1 / (F * df1 + df2)\n## ω²p = partial omega-squared = (F - 1) * df1 / (F * df1 + df2 + 1)\n## η²G = generalized eta-squared (see Olejnik & Algina, 2003)\n## Cohen’s f² = η²p / (1 - η²p)\n## \n## Levene’s Test for Homogeneity of Variance:\n## ───────────────────────────────────────\n##            Levene’s F df1 df2     p    \n## ───────────────────────────────────────\n## DV: yield       0.160   3  20  .922    \n## ───────────────────────────────────────\n```\n\n``` r\nEMMEANS(result, effect = \"N\")\n```\n\n```\n## ------ EMMEANS (effect = \"N\") ------\n## \n## Joint Tests of \"N\":\n## ───────────────────────────────────────────────────\n##  Effect df1 df2     F     p     η²p [90% CI of η²p]\n## ───────────────────────────────────────────────────\n##   N       1  20 5.758  .026 *     .224 [.017, .460]\n##   P       1  20 0.256  .619       .013 [.000, .181]\n##   N * P   1  20 0.647  .430       .031 [.000, .230]\n## ───────────────────────────────────────────────────\n## Note. Simple effects of repeated measures with 3 or more levels\n## are different from the results obtained with SPSS MANOVA syntax.\n## \n## Univariate Tests of \"N\":\n## ────────────────────────────────────────────────────────\n##            Sum of Squares df Mean Square     F     p    \n## ────────────────────────────────────────────────────────\n## Mean: \"N\"         189.282  1     189.282 5.758  .026 *  \n## Residuals         657.400 20      32.870                \n## ────────────────────────────────────────────────────────\n## Note. Identical to the results obtained with SPSS GLM EMMEANS syntax.\n## \n## Estimated Marginal Means of \"N\":\n## ────────────────────────────────────\n##  \"N\"   Mean [95% CI of Mean]    S.E.\n## ────────────────────────────────────\n##   N0 52.067 [48.614, 55.519] (1.655)\n##   N1 57.683 [54.231, 61.136] (1.655)\n## ────────────────────────────────────\n## \n## Pairwise Comparisons of \"N\":\n## ─────────────────────────────────────────────────────────────────────\n##  Contrast Estimate    S.E. df     t     p     Cohen’s d [95% CI of d]\n## ─────────────────────────────────────────────────────────────────────\n##   N1 - N0    5.617 (2.341) 20 2.400  .026 *      0.980 [0.128, 1.831]\n## ─────────────────────────────────────────────────────────────────────\n## Pooled SD for computing Cohen’s d: 5.733\n## Results are averaged over the levels of: P\n## No need to adjust p values.\n## \n## Disclaimer:\n## By default, pooled SD is Root Mean Square Error (RMSE).\n## There is much disagreement on how to compute Cohen’s d.\n## You are completely responsible for setting `sd.pooled`.\n## You might also use `effectsize::t_to_d()` to compute d.\n```\n\n---\n\n## 回归分析\n\n### model_summary()：模型汇总\n\n\n``` r\nlm1 <- lm(Sepal.Length ~ Sepal.Width, data = iris)\nlm2 <- lm(Sepal.Length ~ Sepal.Width + Petal.Length, data = iris)\nlm3 <- lm(Sepal.Length ~ Sepal.Width + Petal.Length + Petal.Width, data = iris)\n\n# 多个模型对比\nmodel_summary(list(lm1, lm2, lm3))\n```\n\n```\n## \n## Model Summary\n## \n## ──────────────────────────────────────────────────────────────────\n##               (1) Sepal.Length  (2) Sepal.Length  (3) Sepal.Length\n## ──────────────────────────────────────────────────────────────────\n## (Intercept)     6.526 ***         2.249 ***         1.856 ***     \n##                (0.479)           (0.248)           (0.251)        \n## Sepal.Width    -0.223             0.596 ***         0.651 ***     \n##                (0.155)           (0.069)           (0.067)        \n## Petal.Length                      0.472 ***         0.709 ***     \n##                                  (0.017)           (0.057)        \n## Petal.Width                                        -0.556 ***     \n##                                                    (0.128)        \n## ──────────────────────────────────────────────────────────────────\n## R^2             0.014             0.840             0.859         \n## Adj. R^2        0.007             0.838             0.856         \n## Num. obs.     150               150               150             \n## ──────────────────────────────────────────────────────────────────\n## Note. * p < .05, ** p < .01, *** p < .001.\n```\n\n``` r\n# 输出标准化系数\nmodel_summary(lm3, std = TRUE)\n```\n\n```\n## \n## Model Summary\n## \n## ──────────────────────────────\n##               (1) Sepal.Length\n## ──────────────────────────────\n## Sepal.Width      .343 ***     \n##                 (.035)        \n## Petal.Length    1.512 ***     \n##                 (.121)        \n## Petal.Width     -.512 ***     \n##                 (.117)        \n## ──────────────────────────────\n## R^2              .859         \n## Adj. R^2         .856         \n## Num. obs.     150             \n## ──────────────────────────────\n## Note. * p < .05, ** p < .01, *** p < .001.\n## \n## # Check for Multicollinearity\n## \n## Low Correlation\n## \n##         Term  VIF     VIF 95% CI adj. VIF Tolerance Tolerance 95% CI\n##  Sepal.Width 1.27 [ 1.11,  1.65]     1.13      0.79     [0.61, 0.90]\n## \n## High Correlation\n## \n##          Term   VIF     VIF 95% CI adj. VIF Tolerance Tolerance 95% CI\n##  Petal.Length 15.10 [11.27, 20.36]     3.89      0.07     [0.05, 0.09]\n##   Petal.Width 14.23 [10.63, 19.19]     3.77      0.07     [0.05, 0.09]\n```\n\n---\n\n## 中介与调节分析\n\n### PROCESS()：中介调节分析\n\n\n``` r\nset.seed(123)\nn <- 200\nmediation_data <- data.frame(\n  X = rnorm(n),\n  M = rnorm(n),\n  Y = rnorm(n)\n)\nmediation_data$M <- 0.5 * mediation_data$X + rnorm(n, sd = 0.5)\nmediation_data$Y <- 0.4 * mediation_data$M + 0.3 * mediation_data$X + rnorm(n, sd = 0.5)\n\n# 简单中介模型\nPROCESS(mediation_data, y = \"Y\", x = \"X\", meds = \"M\", \n        ci = \"boot\", nsim = 100)\n```\n\n```\n## \n## ****************** PART 1. Regression Model Summary ******************\n## \n## PROCESS Model ID : 4\n## Model Type : Simple Mediation\n## -    Outcome (Y) : Y\n## -  Predictor (X) : X\n## -  Mediators (M) : M\n## - Moderators (W) : -\n## - Covariates (C) : -\n## -   HLM Clusters : -\n## \n## All numeric predictors have been grand-mean centered.\n## (For details, please see the help page of PROCESS.)\n## \n## Formula of Mediator:\n## -    M ~ X\n## Formula of Outcome:\n## -    Y ~ X + M\n## \n## CAUTION:\n##   Fixed effect (coef.) of a predictor involved in an interaction\n##   denotes its \"simple effect/slope\" at the other predictor = 0.\n##   Only when all predictors in an interaction are mean-centered\n##   can the fixed effect be interpreted as \"main effect\"!\n##   \n## Model Summary\n## \n## ──────────────────────────────────────────────────\n##              (1) Y        (2) M        (3) Y      \n## ──────────────────────────────────────────────────\n## (Intercept)    0.010       -0.015        0.010    \n##               (0.039)      (0.036)      (0.037)   \n## X              0.462 ***    0.475 ***    0.302 ***\n##               (0.041)      (0.039)      (0.052)   \n## M                                        0.336 ***\n##                                         (0.072)   \n## ──────────────────────────────────────────────────\n## R^2            0.391        0.434        0.452    \n## Adj. R^2       0.388        0.431        0.446    \n## Num. obs.    200          200          200        \n## ──────────────────────────────────────────────────\n## Note. * p < .05, ** p < .01, *** p < .001.\n## \n## ************ PART 2. Mediation/Moderation Effect Estimate ************\n## \n## Package Use : ‘mediation’ (v4.5.0)\n## Effect Type : Simple Mediation (Model 4)\n## Sample Size : 200\n## Random Seed : set.seed()\n## Simulations : 100 (Bootstrap)\n```\n\n```\n## \n## Running 100 simulations...\n## Indirect Path: \"X\" (X) ==> \"M\" (M) ==> \"Y\" (Y)\n## ─────────────────────────────────────────────────────────────\n##                Effect    S.E.      z     p      [Boot 95% CI]\n## ─────────────────────────────────────────────────────────────\n## Indirect (ab)   0.160 (0.039)  4.046 <.001 *** [0.098, 0.240]\n## Direct (c')     0.302 (0.053)  5.713 <.001 *** [0.192, 0.387]\n## Total (c)       0.462 (0.040) 11.623 <.001 *** [0.399, 0.545]\n## ─────────────────────────────────────────────────────────────\n## Percentile Bootstrap Confidence Interval\n## (SE and CI are estimated based on 100 Bootstrap samples.)\n## \n## Note. The results based on bootstrapping or other random processes\n## are unlikely identical to other statistical software (e.g., SPSS).\n## To make results reproducible, you need to set a seed (any number).\n## Please see the help page for details: help(PROCESS)\n## Ignore this note if you have already set a seed. :)\n```\n\n---\n\n## 其他实用功能\n\n### 运算符\n\n\n``` r\n# %notin%：不在其中\nc(1, 2, 3) %notin% c(2, 4, 6)\n```\n\n```\n## [1]  TRUE FALSE  TRUE\n```\n\n``` r\n# %allin%：全部在其中\nc(1, 2) %allin% c(1, 2, 3, 4)\n```\n\n```\n## [1] TRUE\n```\n\n### theme_bruce()：ggplot2 主题\n\n\n``` r\nlibrary(ggplot2)\n\nggplot(iris, aes(x = Sepal.Length, y = Sepal.Width, color = Species)) +\n  geom_point(size = 2, alpha = 0.7) +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  labs(title = \"鸢尾花数据可视化\") +\n  theme_bruce()\n```\n\n<div class=\"figure\">\n<img src=\"figure/unnamed-chunk-21-1.png\" alt=\"plot of chunk unnamed-chunk-21\" width=\"100%\" />\n<p class=\"caption\">plot of chunk unnamed-chunk-21</p>\n</div>\n\n---\n\n## 导出到 Word\n\nbruceR 的一大特色是可以将结果直接导出到 Word 文档：\n\n\n``` r\n# 描述统计\nDescribe(iris[, 1:4], file = \"descriptives.doc\")\n\n# 相关矩阵\nCorr(iris[, 1:4], file = \"correlation.doc\")\n\n# 回归模型\nmodel_summary(list(lm1, lm2, lm3), file = \"regression.doc\")\n\n# 中介分析\nPROCESS(data, y = \"Y\", x = \"X\", meds = \"M\", file = \"mediation.doc\")\n```\n\n---\n\n## 函数速查表\n\n| 类别 | 函数 | 功能 |\n|------|------|------|\n| **基础** | `set.wd()` | 设置工作目录到当前脚本位置 |\n| | `import()` / `export()` | 万能数据导入/导出 |\n| | `cc()` | 快速创建字符向量 |\n| | `print_table()` | 打印三线表 |\n| **计算** | `MEAN()` / `SUM()` | 横向计算（支持反向计分） |\n| | `RECODE()` | 变量重编码 |\n| | `RESCALE()` | 变量标准化 |\n| **信效度** | `Alpha()` | Cronbach's α 信度分析 |\n| | `EFA()` / `PCA()` | 探索性因子分析/主成分分析 |\n| | `CFA()` | 验证性因子分析 |\n| **描述** | `Describe()` | 描述统计 |\n| | `Freq()` | 频率分析与交叉表 |\n| | `Corr()` | 相关分析与热力图 |\n| **检验** | `TTEST()` | t检验（单样本/独立/配对） |\n| | `MANOVA()` | 多因素方差分析 |\n| | `EMMEANS()` | 边际均值与事后比较 |\n| **回归** | `model_summary()` | 回归模型整洁输出 |\n| | `GLM_summary()` | 广义线性模型汇总 |\n| | `HLM_summary()` | 多层线性模型汇总 |\n| **中介** | `PROCESS()` | 中介/调节效应分析 |\n| | `med_summary()` | 中介效应汇总 |\n\n---\n\n## 参考资源\n\n- [bruceR GitHub 主页](https://github.com/psychbruce/bruceR)\n- [CRAN 官方页面](https://cran.r-project.org/package=bruceR)\n- [中文教程：概述篇](https://zhuanlan.zhihu.com/p/281150493)\n- [中文教程：常见问题](https://zhuanlan.zhihu.com/p/432931518)\n- 引用：Bao, H. W. S. (2021). bruceR: Broadly useful convenient and efficient R functions. https://doi.org/10.32614/CRAN.package.bruceR\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"toc-depth":3,"css":["styles.css"],"highlight-style":"github","output-file":"test.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.32","knitr":{"opts_chunk":{"R.options":{"width":80}}},"theme":{"light":["cosmo","theme.scss"]},"toc-title":"目录","toc-location":"right","code-copy":true,"smooth-scroll":true,"page-layout":"full","title":"bruceR - 统计分析工具","date":"2025-01-10","categories":["R包","统计分析","数据处理"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}