{
  "hash": "0e5783fef969ccfdc9158dcf19b1838c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"R语言采样地图绘制详细教程\"\ndate: \"2024-10-20\"\ncategories: [可视化, 地图]\nimage: \"figure/map-cover.png\"\n---\n\n\n\n> 本期主要介绍如何绘制采样地图和国内区域地图，并自定义相关内容\n\n## R包介绍\n\n[ggspatial教程](https://cran.r-project.org/web/packages/ggspatial/index.html)\n\n## R包安装\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"ggspatial\")\ninstall.packages(\"sf\")\n```\n:::\n\n\n## 基础绘图代码\n\n### 导入地图json数据\n\n进入从[阿里云DataV可视化网站](http://datav.aliyun.com/portal/school/atlas/area_selector)（可选择其他平台）下载格式为.json的地图数据：\n\n![](https://pic-go-42.oss-cn-guangzhou.aliyuncs.com/img/202410270835984.webp)\n\n### 数据导入\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggspatial)\nlibrary(sf)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLinking to GEOS 3.13.1, GDAL 3.11.4, PROJ 9.7.0; sf_use_s2() is TRUE\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\n# 导入地图json数据\nmap <- st_read(\"01-attch\\\\10\\\\广州市.json\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `广州市' from data source \n  `E:\\99 其它\\05 R语言\\doc\\01-attch\\10\\广州市.json' using driver `GeoJSON'\nSimple feature collection with 11 features and 9 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 112.9585 ymin: 22.51436 xmax: 114.06 ymax: 23.93292\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n\n### 开始绘制\n\n#### 添加省份区边框\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  labs(title = \"Guangzhou\", x = NULL, y = NULL) +\n  geom_sf(data = map, fill = c(\"#f0eedf\"), size = 0.8, color = \"black\")\n```\n\n::: {.cell-output-display}\n![](2015-map_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n#### 添加指南针annotation\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- ggplot() +\n  labs(title = \"Guangzhou\", x = NULL, y = NULL) +\n  geom_sf(data = map, fill = c(\"#f0eedf\"), size = 0.8, color = \"black\") + # 设置比例尺\n  annotation_north_arrow(\n    location = \"tl\",\n    style = north_arrow_nautical(\n      fill = c(\"black\", \"white\"),\n      line_col = \"black\"\n    )\n  )\np\n```\n\n::: {.cell-output-display}\n![](2015-map_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n## 我们来自定义绘图内容\n\n### 设置白云区天河区突出显示\n\n我们新加一个图层就可以，然后fill填充亮色\n\n\n::: {.cell}\n\n```{.r .cell-code}\np + geom_sf(\n  data = map |> dplyr::filter(name %in% c(\"天河区\", \"白云区\", \"番禺区\")),\n  fill = c(\"#c98c50\"),\n  size = 0.8,\n  color = \"black\"\n)\n```\n\n::: {.cell-output-display}\n![](2015-map_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n### 设置text\n\n接下来我们要在图里标注部分区名\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(showtext)\nshowtext::showtext_auto()\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np + geom_sf(\n  data = map |> dplyr::filter(name %in% c(\"天河区\", \"白云区\", \"番禺区\")),\n  fill = c(\"#c98c50\"),\n  size = 0.8,\n  color = \"black\"\n) +\n  geom_sf_text(\n    data = map |> dplyr::filter(name %in% c(\"天河区\", \"白云区\", \"番禺区\")),\n    aes(label = name),\n    size = 3,\n    color = \"black\",\n    fontface = \"bold\"\n  )\n```\n\n::: {.cell-output-display}\n![](2015-map_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n### 设置一个合适的主题\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np2 <-\n  p + geom_sf(\n    data = map |> dplyr::filter(name %in% c(\"天河区\", \"白云区\", \"番禺区\")),\n    fill = c(\"#c98c50\"),\n    size = 0.8,\n    color = \"black\"\n  ) +\n  geom_sf_text(\n    data = map |> dplyr::filter(name %in% c(\"天河区\", \"白云区\", \"番禺区\")),\n    aes(label = name),\n    size = 3,\n    color = \"black\",\n    fontface = \"bold\"\n  ) +\n  theme_minimal()\n\np2\n```\n\n::: {.cell-output-display}\n![](2015-map_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n### 设置根据数值变量对各区的fill进行映射\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 先生成一个随机变量\nmap_neat_1 <-\n  map |>\n  dplyr::mutate(\n    value = sample(1:100, nrow(map), replace = TRUE)\n  )\n\n\nggplot() +\n  labs(title = \"map_neat_1\", x = NULL, y = NULL) +\n  geom_sf(data = map_neat_1, aes(fill = value), size = 0.8, color = \"black\") + # 设置比例尺\n  annotation_north_arrow(\n    location = \"tl\",\n    style = north_arrow_nautical(\n      fill = c(\"black\", \"white\"),\n      line_col = \"black\"\n    )\n  ) +\n  geom_sf_text(\n    data = map,\n    aes(label = name),\n    size = 3,\n    color = \"black\",\n    fontface = \"bold\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](2015-map_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n### 根据分类变量对区进行fill映射\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(MetBrewer)\n\nmap_neat_2 <-\n  map |>\n  dplyr::mutate(\n    group = sample(c(\"A\", \"B\", \"C\"), nrow(map), replace = TRUE)\n  )\n\nggplot() +\n  labs(title = \"map_neat_2\", x = NULL, y = NULL) +\n  geom_sf(data = map_neat_2, aes(fill = group), size = 0.8, color = \"black\") + # 设置比例尺\n  annotation_north_arrow(\n    location = \"tl\",\n    style = north_arrow_nautical(\n      fill = c(\"black\", \"white\"),\n      line_col = \"black\"\n    )\n  ) +\n  geom_sf_text(\n    data = map,\n    aes(label = name),\n    size = 3,\n    color = \"black\",\n    fontface = \"bold\"\n  ) +\n  theme_minimal() +\n  scale_fill_met_d(\"Cassatt1\")\n```\n\n::: {.cell-output-display}\n![](2015-map_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n### 添加采样点\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_sample <-\n  tibble::tibble(\n    lon = c(113.292333, 113.412333, 113.532333),\n    lat = c(23.191944, 23.331944, 22.931944),\n    point = c(\"A\", \"B\", \"C\"),\n  )\n\np2 +\n  geom_point(\n    data = data_sample,\n    aes(x = lon, y = lat),\n    size = 2,\n    color = \"#1647a3\"\n  ) +\n  geom_text(\n    data = data_sample,\n    aes(x = lon, y = lat, label = point),\n    size = 4,\n    color = \"#000000\",\n    fontface = \"bold\",\n    nudge_y = 0.05\n  )+\n  labs(title = \"广州市\")+\n  theme(plot.title = element_text(hjust = 0.5))\n```\n\n::: {.cell-output-display}\n![](2015-map_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n",
    "supporting": [
      "2015-map_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}