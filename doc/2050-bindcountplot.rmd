---
title: R语言计数图与分类图绘制
date: '2026-01-15'
categories:
- 数据可视化
- 其他图形
- 统计图表
- 分类图
image: images/bindcountplot_cover.svg
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
    echo = TRUE, warning = FALSE, message = FALSE,
    fig.width = 9, fig.height = 6, fig.retina = 2, out.width = "100%", dpi = 150
)
```

## 什么是计数图与分类图

计数图（Count Plot）和分类图（Categorical Plot）用于展示**分类变量的频数分布**和**分类变量间的关系**，是探索性数据分析的基础工具。

### 适用场景

| 场景 | 说明 |
|------|------|
| **频数统计** | 各类别出现次数 |
| **分组比较** | 多类别交叉统计 |
| **类别分布** | 观察数据不平衡 |

---

## R包加载

```{r}
library(ggplot2)
library(dplyr)
```

---

## 基础计数图

```{r}
# 使用内置数据
data(mpg)

ggplot(mpg, aes(x = class)) +
    geom_bar(fill = "#4f46e5", alpha = 0.8) +
    labs(
        title = "汽车类型分布计数图",
        x = "汽车类型",
        y = "数量"
    ) +
    theme_minimal(base_size = 12) +
    theme(plot.title = element_text(face = "bold"))
```

---

## 按变量着色

```{r}
ggplot(mpg, aes(x = class, fill = drv)) +
    geom_bar(position = "dodge", alpha = 0.8) +
    scale_fill_manual(values = c("#4f46e5", "#10b981", "#f59e0b")) +
    labs(
        title = "按驱动类型分组的计数图",
        x = "汽车类型",
        y = "数量",
        fill = "驱动类型"
    ) +
    theme_minimal(base_size = 12) +
    theme(
        plot.title = element_text(face = "bold"),
        legend.position = "top"
    )
```

---

## 百分比堆叠图

```{r}
ggplot(mpg, aes(x = class, fill = drv)) +
    geom_bar(position = "fill", alpha = 0.8) +
    scale_fill_manual(values = c("#4f46e5", "#10b981", "#f59e0b")) +
    scale_y_continuous(labels = scales::percent) +
    labs(
        title = "驱动类型百分比构成",
        x = "汽车类型",
        y = "比例",
        fill = "驱动类型"
    ) +
    theme_minimal(base_size = 12) +
    theme(plot.title = element_text(face = "bold"))
```

---

## 水平计数图（排序）

```{r}
mpg %>%
    count(class) %>%
    mutate(class = forcats::fct_reorder(class, n)) %>%
    ggplot(aes(x = n, y = class, fill = n)) +
    geom_col() +
    geom_text(aes(label = n), hjust = -0.2, fontface = "bold") +
    scale_fill_gradient(low = "#a5b4fc", high = "#4f46e5") +
    scale_x_continuous(expand = expansion(mult = c(0, 0.15))) +
    labs(
        title = "按数量排序的汽车类型",
        x = "数量",
        y = NULL
    ) +
    theme_minimal(base_size = 12) +
    theme(
        plot.title = element_text(face = "bold"),
        legend.position = "none"
    )
```

---

## 分面分类图

```{r fig.height=5}
ggplot(mpg, aes(x = class, fill = class)) +
    geom_bar(alpha = 0.8, show.legend = FALSE) +
    facet_wrap(~year) +
    scale_fill_viridis_d() +
    labs(
        title = "不同年份的汽车类型分布",
        x = NULL,
        y = "数量"
    ) +
    theme_minimal(base_size = 11) +
    theme(
        plot.title = element_text(face = "bold"),
        axis.text.x = element_text(angle = 45, hjust = 1)
    )
```

---

## 总结

| 图表类型 | 用途 | 关键参数 |
|----------|------|----------|
| **基础计数图** | 单变量频数 | `geom_bar()` |
| **分组计数图** | 交叉频数 | `position = "dodge"` |
| **百分比堆叠** | 比例构成 | `position = "fill"` |
| **排序计数图** | 突出排名 | `fct_reorder()` |

### 相关教程

- [柱状图与饼图](2028-bindbarchart.html)
- [棒棒糖图与排序图](2035-bindlollipop.html)
