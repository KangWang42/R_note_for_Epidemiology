---
title: "ggplot2 æ ·å¼è®¾ç½®å®Œå…¨æŒ‡å—"
date: "2026-01-14"
categories: [å¯è§†åŒ–æ•™ç¨‹, ggplot2, æ ·å¼, è¿›é˜¶]
image: "images/ggplot2-styling-cover.png"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
    echo = TRUE,
    warning = FALSE,
    message = FALSE,
    fig.width = 9,
    fig.height = 6
)
```

## å‰è¨€

æœ¬æ•™ç¨‹ä¸“æ³¨äº ggplot2 **å›¾å½¢æ ·å¼çš„ç²¾ç»†æ§åˆ¶**ï¼Œä¸è®²ç»˜åˆ¶ä»€ä¹ˆå›¾ï¼Œè€Œæ˜¯è®²å¦‚ä½•æŠŠå›¾åšå¾—æ›´ä¸“ä¸šã€æ›´ç¾è§‚ã€‚æ¶µç›–ï¼š

- ğŸ¯ **åæ ‡è½´**ï¼šåˆ»åº¦ã€æ ‡ç­¾ã€èŒƒå›´ã€å˜æ¢
- ğŸ“Š **å›¾ä¾‹**ï¼šä½ç½®ã€æ ·å¼ã€æ ‡é¢˜ã€é¡ºåº
- ğŸ“ **æ ‡é¢˜ä¸æ–‡æœ¬**ï¼šæ ‡é¢˜ã€å‰¯æ ‡é¢˜ã€è„šæ³¨ã€æ³¨é‡Š
- ğŸ¨ **ç¾å­¦æ˜ å°„**ï¼šé¢œè‰²ã€å¤§å°ã€å½¢çŠ¶çš„ç²¾ç»†æ§åˆ¶
- ğŸ“ **åˆ†é¢**ï¼šå¤šé¢æ¿å¸ƒå±€ä¸æ ·å¼
- ğŸ–¼ï¸ **ä¸»é¢˜**ï¼šå…¨é¢çš„ä¸»é¢˜å®šåˆ¶

```{r}
library(ggplot2)
library(dplyr)
library(scales)

# åˆ›å»ºç¤ºä¾‹æ•°æ®
set.seed(42)
demo_data <- data.frame(
    group = rep(c("Aç»„", "Bç»„", "Cç»„", "Dç»„"), each = 50),
    x = c(rnorm(50, 10, 2), rnorm(50, 15, 3), rnorm(50, 20, 2.5), rnorm(50, 25, 4)),
    y = c(rnorm(50, 100, 15), rnorm(50, 150, 20), rnorm(50, 200, 25), rnorm(50, 250, 30)),
    size = runif(200, 1, 10),
    category = sample(c("ç±»å‹1", "ç±»å‹2", "ç±»å‹3"), 200, replace = TRUE)
)

# åŸºç¡€å›¾å½¢ï¼ˆåç»­ä¼šä¸æ–­å®Œå–„ï¼‰
p_base <- ggplot(demo_data, aes(x = x, y = y, color = group)) +
    geom_point(size = 3, alpha = 0.7)
p_base
```

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šåæ ‡è½´è¯¦ç»†è®¾ç½®

åæ ‡è½´æ˜¯å›¾å½¢æœ€é‡è¦çš„ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ï¼ŒåŒ…æ‹¬åˆ»åº¦çº¿ã€åˆ»åº¦æ ‡ç­¾ã€è½´æ ‡ç­¾ã€è½´çº¿ç­‰ã€‚

### 1.1 åæ ‡è½´èŒƒå›´ä¸é™åˆ¶

```{r}
# æ–¹æ³•1ï¼šxlim/ylimï¼ˆä¼šåˆ é™¤èŒƒå›´å¤–çš„æ•°æ®ï¼‰
p_base +
    xlim(5, 30) +
    ylim(50, 300)
```

```{r}
# æ–¹æ³•2ï¼šcoord_cartesianï¼ˆåªæ˜¯"æ”¾å¤§"ï¼Œä¸åˆ é™¤æ•°æ®ï¼‰
# æ¨èç”¨äºæ”¾å¤§å±€éƒ¨åŒºåŸŸ
p_base +
    coord_cartesian(xlim = c(10, 25), ylim = c(100, 250))
```

```{r}
# æ–¹æ³•3ï¼šscale_*_continuous è®¾ç½®ï¼ˆæœ€ç²¾ç»†çš„æ§åˆ¶ï¼‰
p_base +
    scale_x_continuous(limits = c(5, 35), expand = c(0, 0)) +
    scale_y_continuous(limits = c(0, 350), expand = c(0, 0))
```

### 1.2 åæ ‡è½´åˆ»åº¦æ§åˆ¶

```{r}
# è®¾ç½®ä¸»åˆ»åº¦å’Œæ¬¡åˆ»åº¦
p_base +
    scale_x_continuous(
        breaks = seq(5, 35, by = 5), # ä¸»åˆ»åº¦ä½ç½®
        minor_breaks = seq(5, 35, by = 1), # æ¬¡åˆ»åº¦ä½ç½®
        limits = c(5, 35)
    ) +
    scale_y_continuous(
        breaks = seq(0, 350, by = 50),
        minor_breaks = seq(0, 350, by = 25),
        limits = c(0, 350)
    )
```

```{r}
# è‡ªå®šä¹‰åˆ»åº¦æ ‡ç­¾
p_base +
    scale_x_continuous(
        breaks = c(10, 15, 20, 25, 30),
        labels = c("ä½", "ä¸­ä½", "ä¸­", "ä¸­é«˜", "é«˜") # è‡ªå®šä¹‰æ ‡ç­¾
    ) +
    scale_y_continuous(
        breaks = seq(100, 300, by = 50),
        labels = function(x) paste0(x, " å•ä½") # ä½¿ç”¨å‡½æ•°
    )
```

```{r}
# ä½¿ç”¨ scales åŒ…æ ¼å¼åŒ–
p_base +
    scale_x_continuous(labels = scales::label_number(suffix = " L")) +
    scale_y_continuous(labels = scales::label_comma()) # åƒåˆ†ä½é€—å·
```

### 1.3 åæ ‡è½´æ ‡ç­¾æ ·å¼

```{r}
p_base +
    labs(x = "X å˜é‡ (å•ä½)", y = "Y å˜é‡ (å•ä½)") +
    theme(
        # X è½´æ ‡ç­¾
        axis.title.x = element_text(
            size = 14, # å­—å·
            face = "bold", # ç²—ä½“
            color = "#1f2937", # é¢œè‰²
            margin = margin(t = 10) # ä¸Šè¾¹è·
        ),
        # Y è½´æ ‡ç­¾
        axis.title.y = element_text(
            size = 14,
            face = "bold",
            color = "#1f2937",
            margin = margin(r = 10),
            angle = 90 # æ—‹è½¬è§’åº¦ï¼ˆé»˜è®¤90ï¼‰
        )
    )
```

### 1.4 åˆ»åº¦æ ‡ç­¾æ ·å¼

```{r}
p_base +
    theme(
        # X è½´åˆ»åº¦æ ‡ç­¾
        axis.text.x = element_text(
            size = 11,
            color = "#374151",
            angle = 45, # æ—‹è½¬è§’åº¦
            hjust = 1, # æ°´å¹³å¯¹é½
            vjust = 1 # å‚ç›´å¯¹é½
        ),
        # Y è½´åˆ»åº¦æ ‡ç­¾
        axis.text.y = element_text(
            size = 11,
            color = "#374151"
        )
    )
```

### 1.5 åæ ‡è½´çº¿ä¸åˆ»åº¦çº¿

```{r}
p_base +
    theme(
        # åæ ‡è½´çº¿
        axis.line = element_line(color = "#1f2937", linewidth = 0.8),
        # åˆ»åº¦çº¿
        axis.ticks = element_line(color = "#1f2937", linewidth = 0.5),
        # åˆ»åº¦çº¿é•¿åº¦
        axis.ticks.length = unit(0.25, "cm"),
        # å»æ‰é¢æ¿è¾¹æ¡†ï¼ˆé…åˆè½´çº¿ä½¿ç”¨ï¼‰
        panel.border = element_blank()
    )
```

### 1.6 å¯¹æ•°åæ ‡è½´

```{r}
# åˆ›å»ºé€‚åˆå¯¹æ•°å˜æ¢çš„æ•°æ®
log_data <- data.frame(
    x = c(1, 10, 100, 1000, 10000),
    y = c(2, 20, 200, 2000, 20000)
)

ggplot(log_data, aes(x, y)) +
    geom_point(size = 4, color = "#4f46e5") +
    geom_line(color = "#4f46e5") +
    scale_x_log10(
        breaks = scales::trans_breaks("log10", function(x) 10^x),
        labels = scales::trans_format("log10", scales::math_format(10^.x))
    ) +
    scale_y_log10(
        breaks = scales::trans_breaks("log10", function(x) 10^x),
        labels = scales::trans_format("log10", scales::math_format(10^.x))
    ) +
    annotation_logticks(sides = "bl") + # åœ¨å·¦ä¸‹æ·»åŠ å¯¹æ•°åˆ»åº¦
    theme_bw()
```

### 1.7 ç¿»è½¬ä¸æåæ ‡

```{r}
# ç¿»è½¬åæ ‡è½´ï¼ˆæ¨ªå‘æŸ±çŠ¶å›¾ï¼‰
ggplot(demo_data, aes(x = group, y = y)) +
    geom_boxplot(fill = "#4f46e5", alpha = 0.7) +
    coord_flip() +
    theme_minimal()
```

```{r}
# æåæ ‡ï¼ˆé¥¼å›¾/é›·è¾¾å›¾åŸºç¡€ï¼‰
pie_data <- data.frame(
    category = c("A", "B", "C", "D"),
    value = c(25, 35, 20, 20)
)

ggplot(pie_data, aes(x = "", y = value, fill = category)) +
    geom_bar(stat = "identity", width = 1) +
    coord_polar("y") +
    theme_void() +
    scale_fill_brewer(palette = "Set2")
```

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šå›¾ä¾‹è¯¦ç»†è®¾ç½®

å›¾ä¾‹æ˜¯è§£è¯»å›¾å½¢çš„å…³é”®ï¼Œéœ€è¦ç²¾å¿ƒè®¾è®¡ã€‚

### 2.1 å›¾ä¾‹ä½ç½®

```{r}
# é¢„è®¾ä½ç½®
p_base + theme(legend.position = "top")
```

```{r}
p_base + theme(legend.position = "bottom")
```

```{r}
p_base + theme(legend.position = "left")
```

```{r}
# ç²¾ç¡®ä½ç½®ï¼ˆåæ ‡ 0-1ï¼‰
p_base +
    theme(
        legend.position = c(0.85, 0.2), # å³ä¸‹è§’å†…éƒ¨
        legend.background = element_rect(fill = "white", color = "gray80")
    )
```

```{r}
# éšè—å›¾ä¾‹
p_base + theme(legend.position = "none")
```

### 2.2 å›¾ä¾‹æ ‡é¢˜ä¸æ ‡ç­¾

```{r}
p_base +
    labs(color = "å®éªŒåˆ†ç»„") + # ä¿®æ”¹å›¾ä¾‹æ ‡é¢˜
    scale_color_discrete(
        labels = c("å¯¹ç…§ç»„", "ä½å‰‚é‡", "ä¸­å‰‚é‡", "é«˜å‰‚é‡") # ä¿®æ”¹æ ‡ç­¾
    )
```

```{r}
# å»æ‰å›¾ä¾‹æ ‡é¢˜
p_base +
    theme(legend.title = element_blank())
```

### 2.3 å›¾ä¾‹æ ·å¼å®šåˆ¶

```{r}
p_base +
    labs(color = "åˆ†ç»„") +
    theme(
        # å›¾ä¾‹æ ‡é¢˜
        legend.title = element_text(
            size = 12, face = "bold", color = "#1f2937"
        ),
        # å›¾ä¾‹æ ‡ç­¾
        legend.text = element_text(
            size = 10, color = "#374151"
        ),
        # å›¾ä¾‹èƒŒæ™¯
        legend.background = element_rect(
            fill = "#f9fafb",
            color = "#e5e7eb",
            linewidth = 0.5
        ),
        # å›¾ä¾‹é”®ï¼ˆå›¾æ ‡ï¼‰èƒŒæ™¯
        legend.key = element_rect(fill = "white"),
        # å›¾ä¾‹é”®å¤§å°
        legend.key.size = unit(1, "cm"),
        # å›¾ä¾‹å†…è¾¹è·
        legend.margin = margin(5, 10, 5, 10)
    )
```

### 2.4 å›¾ä¾‹å¸ƒå±€

```{r}
# æ°´å¹³æ’åˆ—
p_base +
    theme(legend.position = "bottom") +
    guides(color = guide_legend(nrow = 1)) # å•è¡Œ
```

```{r}
# è‡ªå®šä¹‰åˆ—æ•°
p_base +
    theme(legend.position = "bottom") +
    guides(color = guide_legend(ncol = 2)) # ä¸¤åˆ—
```

### 2.5 å›¾ä¾‹é¡ºåºä¸åè½¬

```{r}
# åè½¬å›¾ä¾‹é¡ºåº
p_base +
    guides(color = guide_legend(reverse = TRUE))
```

```{r}
# è‡ªå®šä¹‰é¡ºåº
p_base +
    scale_color_discrete(limits = c("Dç»„", "Cç»„", "Bç»„", "Aç»„"))
```

### 2.6 å¤šä¸ªå›¾ä¾‹çš„æ§åˆ¶

```{r}
# åˆ›å»ºæœ‰å¤šä¸ªæ˜ å°„çš„å›¾
p_multi <- ggplot(demo_data, aes(x = x, y = y, color = group, size = size, shape = category)) +
    geom_point(alpha = 0.7)

# å•ç‹¬æ§åˆ¶æ¯ä¸ªå›¾ä¾‹
p_multi +
    guides(
        color = guide_legend(order = 1, title = "åˆ†ç»„"),
        size = guide_legend(order = 2, title = "å¤§å°"),
        shape = guide_legend(order = 3, title = "ç±»å‹")
    ) +
    theme(legend.box = "vertical") # å›¾ä¾‹å‚ç›´æ’åˆ—
```

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ ‡é¢˜ä¸æ³¨é‡Š

### 3.1 å®Œæ•´æ ‡é¢˜ç³»ç»Ÿ

```{r}
p_base +
    labs(
        title = "è¿™æ˜¯ä¸»æ ‡é¢˜",
        subtitle = "è¿™æ˜¯å‰¯æ ‡é¢˜ï¼Œæä¾›é¢å¤–è¯´æ˜",
        caption = "æ•°æ®æ¥æºï¼šæ¨¡æ‹Ÿæ•°æ® | ä½œè€…ï¼šXXX",
        tag = "A", # å›¾å½¢æ ‡ç­¾ï¼ˆå¤šå›¾æ—¶æœ‰ç”¨ï¼‰
        x = "X å˜é‡",
        y = "Y å˜é‡"
    )
```

### 3.2 æ ‡é¢˜æ ·å¼å®šåˆ¶

```{r}
p_base +
    labs(
        title = "å‘åŠ¨æœºæ€§èƒ½ä¸æ²¹è€—å…³ç³»",
        subtitle = "åŸºäº 200 ä¸ªè§‚æµ‹å€¼çš„åˆ†æ",
        caption = "æ•°æ®æ¥æºï¼šæ¨¡æ‹Ÿæ•°æ®"
    ) +
    theme(
        # ä¸»æ ‡é¢˜
        plot.title = element_text(
            size = 18,
            face = "bold",
            color = "#1f2937",
            hjust = 0.5, # å±…ä¸­
            margin = margin(b = 10)
        ),
        # å‰¯æ ‡é¢˜
        plot.subtitle = element_text(
            size = 12,
            color = "#6b7280",
            hjust = 0.5,
            margin = margin(b = 15)
        ),
        # è„šæ³¨
        plot.caption = element_text(
            size = 9,
            color = "#9ca3af",
            hjust = 1, # å³å¯¹é½
            face = "italic"
        ),
        # å›¾å½¢æ ‡ç­¾
        plot.tag = element_text(
            size = 16,
            face = "bold"
        ),
        plot.tag.position = c(0.02, 0.98) # æ ‡ç­¾ä½ç½®
    )
```

### 3.3 æ·»åŠ æ–‡æœ¬æ³¨é‡Š

```{r}
p_base +
    # annotate æ·»åŠ å•ä¸ªæ³¨é‡Š
    annotate(
        "text",
        x = 25, y = 280,
        label = "é«˜å€¼åŒºåŸŸ",
        size = 5,
        color = "#ef4444",
        fontface = "bold"
    ) +
    annotate(
        "text",
        x = 10, y = 80,
        label = "ä½å€¼åŒºåŸŸ",
        size = 5,
        color = "#10b981",
        fontface = "bold"
    )
```

### 3.4 æ·»åŠ æ•°å­¦å…¬å¼

```{r}
p_base +
    annotate(
        "text",
        x = 20, y = 300,
        label = "y == beta[0] + beta[1]*x + epsilon",
        parse = TRUE, # è§£æä¸ºè¡¨è¾¾å¼
        size = 5
    )
```

### 3.5 æ·»åŠ çŸ©å½¢/çº¿æ¡æ³¨é‡Š

```{r}
p_base +
    # çŸ©å½¢é«˜äº®åŒºåŸŸ
    annotate(
        "rect",
        xmin = 18, xmax = 28,
        ymin = 180, ymax = 320,
        alpha = 0.2,
        fill = "#4f46e5"
    ) +
    # å‚ç›´å‚è€ƒçº¿
    geom_vline(xintercept = 20, linetype = "dashed", color = "#ef4444", linewidth = 1) +
    # æ°´å¹³å‚è€ƒçº¿
    geom_hline(yintercept = 200, linetype = "dotted", color = "#10b981", linewidth = 1) +
    # ç®­å¤´æ³¨é‡Š
    annotate(
        "segment",
        x = 28, xend = 25,
        y = 100, yend = 180,
        arrow = arrow(length = unit(0.3, "cm")),
        color = "#4f46e5"
    ) +
    annotate("text", x = 28, y = 90, label = "æ³¨æ„è¿™ä¸ªåŒºåŸŸ", size = 4)
```

### 3.6 å¸¦æ ‡ç­¾çš„æ•°æ®ç‚¹

```{r}
# åªæ ‡æ³¨ç‰¹å®šç‚¹
highlight_data <- demo_data %>%
    filter(y > 280 | y < 70)

p_base +
    geom_text(
        data = highlight_data,
        aes(label = round(y, 0)),
        vjust = -1,
        size = 3
    )
```

```{r}
# ä½¿ç”¨ ggrepel é¿å…æ ‡ç­¾é‡å 
library(ggrepel)

p_base +
    geom_text_repel(
        data = highlight_data,
        aes(label = paste0("y=", round(y, 0))),
        size = 3,
        max.overlaps = 20
    )
```

---

## ç¬¬å››éƒ¨åˆ†ï¼šç¾å­¦æ˜ å°„æ·±å…¥

### 4.1 é¢œè‰²æ˜ å°„

#### ç¦»æ•£é¢œè‰²

```{r}
# ä½¿ç”¨é¢„è®¾è°ƒè‰²æ¿
p_base + scale_color_brewer(palette = "Set1")
```

```{r}
p_base + scale_color_brewer(palette = "Dark2")
```

```{r}
# æ‰‹åŠ¨æŒ‡å®šé¢œè‰²
p_base +
    scale_color_manual(
        values = c(
            "Aç»„" = "#4f46e5",
            "Bç»„" = "#10b981",
            "Cç»„" = "#f59e0b",
            "Dç»„" = "#ef4444"
        )
    )
```

#### è¿ç»­é¢œè‰²

```{r}
ggplot(demo_data, aes(x = x, y = y, color = size)) +
    geom_point(size = 4) +
    scale_color_gradient(low = "#bfdbfe", high = "#1e40af") # ä¸¤è‰²æ¸å˜
```

```{r}
ggplot(demo_data, aes(x = x, y = y, color = size)) +
    geom_point(size = 4) +
    scale_color_gradient2(low = "#ef4444", mid = "white", high = "#4f46e5", midpoint = 5) # ä¸‰è‰²æ¸å˜
```

```{r}
ggplot(demo_data, aes(x = x, y = y, color = size)) +
    geom_point(size = 4) +
    scale_color_viridis_c(option = "D") # viridis è‰²ç›²å‹å¥½
```

### 4.2 å¡«å……è‰²æ˜ å°„

```{r}
ggplot(demo_data, aes(x = group, y = y, fill = group)) +
    geom_boxplot(alpha = 0.8) +
    scale_fill_manual(
        values = c("#4f46e5", "#10b981", "#f59e0b", "#ef4444")
    ) +
    theme_minimal()
```

### 4.3 å¤§å°æ˜ å°„

```{r}
ggplot(demo_data, aes(x = x, y = y, size = size)) +
    geom_point(color = "#4f46e5", alpha = 0.6) +
    scale_size_continuous(
        range = c(1, 10), # å¤§å°èŒƒå›´
        breaks = c(2, 4, 6, 8),
        name = "æ•°å€¼å¤§å°"
    )
```

### 4.4 å½¢çŠ¶æ˜ å°„

```{r}
ggplot(demo_data, aes(x = x, y = y, shape = category, color = group)) +
    geom_point(size = 3) +
    scale_shape_manual(
        values = c("ç±»å‹1" = 16, "ç±»å‹2" = 17, "ç±»å‹3" = 15) # åœ†ã€ä¸‰è§’ã€æ–¹å—
    )
```

> **å½¢çŠ¶ç¼–å·å‚è€ƒ**ï¼š0-14 ç©ºå¿ƒï¼Œ15-20 å®å¿ƒï¼Œ21-25 å¯å¡«å……

### 4.5 é€æ˜åº¦æ˜ å°„

```{r}
ggplot(demo_data, aes(x = x, y = y, alpha = size)) +
    geom_point(size = 4, color = "#4f46e5") +
    scale_alpha_continuous(range = c(0.2, 1))
```

### 4.6 çº¿å‹æ˜ å°„

```{r}
line_data <- data.frame(
    x = rep(1:10, 3),
    y = c(cumsum(rnorm(10)), cumsum(rnorm(10)) + 10, cumsum(rnorm(10)) + 20),
    type = rep(c("A", "B", "C"), each = 10)
)

ggplot(line_data, aes(x = x, y = y, linetype = type, color = type)) +
    geom_line(linewidth = 1) +
    scale_linetype_manual(values = c("solid", "dashed", "dotted"))
```

---

## ç¬¬äº”éƒ¨åˆ†ï¼šåˆ†é¢è¯¦ç»†è®¾ç½®

### 5.1 facet_wrap å•å˜é‡åˆ†é¢

```{r}
p_base +
    facet_wrap(~group, ncol = 2) # æŒ‡å®šåˆ—æ•°
```

```{r}
p_base +
    facet_wrap(~group, nrow = 1) # å•è¡Œæ’åˆ—
```

```{r}
# è‡ªç”±åæ ‡è½´
p_base +
    facet_wrap(~group, scales = "free") # æ¯ä¸ªé¢æ¿ç‹¬ç«‹åæ ‡
```

```{r}
p_base +
    facet_wrap(~group, scales = "free_y") # åªæœ‰ Y è½´è‡ªç”±
```

### 5.2 facet_grid åŒå˜é‡åˆ†é¢

```{r}
ggplot(demo_data, aes(x = x, y = y, color = group)) +
    geom_point() +
    facet_grid(category ~ group) # è¡Œ ~ åˆ—
```

```{r}
# è¡Œæ–¹å‘åˆ†é¢
ggplot(demo_data, aes(x = x, y = y)) +
    geom_point(color = "#4f46e5") +
    facet_grid(group ~ .) # æŒ‰è¡Œåˆ†é¢
```

```{r}
# åˆ—æ–¹å‘åˆ†é¢
ggplot(demo_data, aes(x = x, y = y)) +
    geom_point(color = "#4f46e5") +
    facet_grid(. ~ group) # æŒ‰åˆ—åˆ†é¢
```

### 5.3 åˆ†é¢æ ‡ç­¾æ ·å¼

```{r}
p_base +
    facet_wrap(~group) +
    theme(
        # åˆ†é¢æ ‡ç­¾ï¼ˆstripï¼‰
        strip.text = element_text(
            size = 12,
            face = "bold",
            color = "white"
        ),
        # åˆ†é¢æ ‡ç­¾èƒŒæ™¯
        strip.background = element_rect(
            fill = "#4f46e5",
            color = "#4f46e5"
        )
    )
```

### 5.4 è‡ªå®šä¹‰åˆ†é¢æ ‡ç­¾

```{r}
# ä½¿ç”¨ labeller å‡½æ•°
custom_labels <- c(
    "Aç»„" = "å¯¹ç…§ç»„ (Control)",
    "Bç»„" = "ä½å‰‚é‡ (Low)",
    "Cç»„" = "ä¸­å‰‚é‡ (Medium)",
    "Dç»„" = "é«˜å‰‚é‡ (High)"
)

p_base +
    facet_wrap(~group, labeller = labeller(group = custom_labels))
```

### 5.5 åˆ†é¢é—´è·

```{r}
p_base +
    facet_wrap(~group) +
    theme(
        panel.spacing.x = unit(1.5, "cm"), # æ°´å¹³é—´è·
        panel.spacing.y = unit(1, "cm") # å‚ç›´é—´è·
    )
```

---

## ç¬¬å…­éƒ¨åˆ†ï¼šä¸»é¢˜ç³»ç»Ÿå…¨é¢å®šåˆ¶

### 6.1 é¢„è®¾ä¸»é¢˜ä¸€è§ˆ

```{r}
p <- ggplot(demo_data, aes(x = x, y = y, color = group)) +
    geom_point()

p + theme_gray() + labs(title = "theme_gray() - é»˜è®¤")
```

```{r}
p + theme_bw() + labs(title = "theme_bw() - é»‘ç™½")
```

```{r}
p + theme_minimal() + labs(title = "theme_minimal() - æç®€")
```

```{r}
p + theme_classic() + labs(title = "theme_classic() - ç»å…¸")
```

```{r}
p + theme_void() + labs(title = "theme_void() - ç©ºç™½")
```

### 6.2 theme() å®Œæ•´å‚æ•°

```{r}
p_base +
    labs(
        title = "å®Œå…¨è‡ªå®šä¹‰ä¸»é¢˜ç¤ºä¾‹",
        subtitle = "æ‰€æœ‰å…ƒç´ éƒ½å¯ä»¥å®šåˆ¶"
    ) +
    theme(
        # ========== å›¾å½¢æ•´ä½“ ==========
        plot.background = element_rect(fill = "#fafafa", color = NA),
        plot.margin = margin(20, 20, 20, 20),

        # ========== é¢æ¿ ==========
        panel.background = element_rect(fill = "white"),
        panel.border = element_rect(color = "#e5e7eb", fill = NA),
        panel.grid.major = element_line(color = "#f3f4f6", linewidth = 0.5),
        panel.grid.minor = element_blank(),

        # ========== åæ ‡è½´ ==========
        axis.title = element_text(size = 12, face = "bold"),
        axis.text = element_text(size = 10, color = "#374151"),
        axis.line = element_blank(),
        axis.ticks = element_line(color = "#e5e7eb"),

        # ========== å›¾ä¾‹ ==========
        legend.position = "bottom",
        legend.background = element_rect(fill = "white", color = "#e5e7eb"),
        legend.title = element_text(face = "bold"),
        legend.key = element_rect(fill = "white"),

        # ========== æ ‡é¢˜ ==========
        plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
        plot.subtitle = element_text(size = 11, color = "gray50", hjust = 0.5),

        # ========== åˆ†é¢ ==========
        strip.background = element_rect(fill = "#4f46e5"),
        strip.text = element_text(color = "white", face = "bold")
    )
```

### 6.3 åˆ›å»ºå¯å¤ç”¨ä¸»é¢˜

```{r}
# å®šä¹‰è‡ªå·±çš„ä¸»é¢˜å‡½æ•°
theme_my_style <- function(base_size = 12) {
    theme_minimal(base_size = base_size) +
        theme(
            # æ ‡é¢˜
            plot.title = element_text(face = "bold", hjust = 0.5),
            plot.subtitle = element_text(color = "gray50", hjust = 0.5),
            # é¢æ¿
            panel.grid.minor = element_blank(),
            panel.grid.major = element_line(color = "#f0f0f0"),
            # åæ ‡è½´
            axis.title = element_text(face = "bold"),
            axis.text = element_text(color = "#333333"),
            # å›¾ä¾‹
            legend.position = "bottom",
            legend.background = element_rect(fill = "white", color = "gray90"),
            # åˆ†é¢
            strip.background = element_rect(fill = "#4f46e5"),
            strip.text = element_text(color = "white", face = "bold")
        )
}

# ä½¿ç”¨è‡ªå®šä¹‰ä¸»é¢˜
p_base +
    labs(title = "ä½¿ç”¨è‡ªå®šä¹‰ä¸»é¢˜", subtitle = "å¯å¤ç”¨äºæ‰€æœ‰å›¾å½¢") +
    theme_my_style()
```

### 6.4 è®¾ç½®å…¨å±€ä¸»é¢˜

```{r}
# è®¾ç½®åç»­æ‰€æœ‰å›¾å½¢çš„é»˜è®¤ä¸»é¢˜
theme_set(theme_minimal())

# å‘é»˜è®¤ä¸»é¢˜æ·»åŠ å…ƒç´ 
theme_update(
    plot.title = element_text(face = "bold", hjust = 0.5),
    legend.position = "bottom"
)
```

---

## ç¬¬ä¸ƒéƒ¨åˆ†ï¼šå®ç”¨æŠ€å·§æ±‡æ€»

### 7.1 éšè—ç‰¹å®šå…ƒç´ 

```{r}
p_base +
    theme(
        axis.title.x = element_blank(), # éšè— X è½´æ ‡é¢˜
        axis.text.x = element_blank(), # éšè— X è½´åˆ»åº¦æ ‡ç­¾
        axis.ticks.x = element_blank(), # éšè— X è½´åˆ»åº¦çº¿
        panel.grid.major.x = element_blank() # éšè—å‚ç›´ç½‘æ ¼çº¿
    )
```

### 7.2 åæ ‡è½´æ¯”ä¾‹

```{r}
# å›ºå®š XY æ¯”ä¾‹ï¼ˆ1:1ï¼‰
ggplot(demo_data, aes(x, y)) +
    geom_point() +
    coord_fixed(ratio = 1) # X:Y = 1:1
```

### 7.3 ç™¾åˆ†æ¯”åæ ‡

```{r}
percent_data <- data.frame(
    group = c("A", "B", "C"),
    pct = c(0.35, 0.45, 0.20)
)

ggplot(percent_data, aes(x = group, y = pct, fill = group)) +
    geom_col() +
    scale_y_continuous(labels = scales::percent_format()) +
    scale_fill_brewer(palette = "Set2") +
    theme_minimal()
```

### 7.4 ç§‘å­¦è®¡æ•°æ³•

```{r}
sci_data <- data.frame(
    x = 1:5,
    y = c(1e3, 1e4, 1e5, 1e6, 1e7)
)

ggplot(sci_data, aes(x, y)) +
    geom_point(size = 4) +
    geom_line() +
    scale_y_continuous(labels = scales::scientific_format())
```

### 7.5 æ—¥æœŸåæ ‡

```{r}
date_data <- data.frame(
    date = seq(as.Date("2024-01-01"), as.Date("2024-12-31"), by = "month"),
    value = cumsum(rnorm(12, 10, 5))
)

ggplot(date_data, aes(date, value)) +
    geom_line(color = "#4f46e5", linewidth = 1) +
    geom_point(color = "#4f46e5", size = 3) +
    scale_x_date(
        date_breaks = "2 months",
        date_labels = "%Y-%m"
    ) +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

---

## é€ŸæŸ¥è¡¨

| ç±»åˆ« | å‡½æ•°/å‚æ•° | åŠŸèƒ½ |
|------|-----------|------|
| **åæ ‡è½´èŒƒå›´** | `xlim()`, `ylim()` | è®¾ç½®èŒƒå›´ï¼ˆåˆ é™¤è¶…èŒƒå›´æ•°æ®ï¼‰ |
| | `coord_cartesian(xlim, ylim)` | æ”¾å¤§è§†å›¾ï¼ˆä¸åˆ é™¤æ•°æ®ï¼‰ |
| | `scale_*_continuous(limits)` | ç²¾ç»†æ§åˆ¶ |
| **åˆ»åº¦** | `breaks` | ä¸»åˆ»åº¦ä½ç½® |
| | `labels` | åˆ»åº¦æ ‡ç­¾ |
| | `minor_breaks` | æ¬¡åˆ»åº¦ä½ç½® |
| **å›¾ä¾‹ä½ç½®** | `legend.position` | "top", "bottom", "left", "right", "none" |
| | `legend.position = c(x, y)` | ç²¾ç¡®ä½ç½® (0-1) |
| **å›¾ä¾‹æ ·å¼** | `guides()` | æ§åˆ¶å›¾ä¾‹ç»†èŠ‚ |
| | `guide_legend()` | ç¦»æ•£å›¾ä¾‹å‚æ•° |
| **æ ‡é¢˜** | `labs(title, subtitle, caption, tag)` | æ·»åŠ æ ‡é¢˜ |
| | `plot.title`, `plot.subtitle` | themeä¸­çš„æ ·å¼ |
| **æ³¨é‡Š** | `annotate()` | æ·»åŠ æ–‡å­—/å‡ ä½•æ³¨é‡Š |
| | `geom_text()`, `geom_label()` | æ•°æ®ç‚¹æ ‡ç­¾ |
| **åˆ†é¢** | `facet_wrap(~ var)` | å•å˜é‡åˆ†é¢ |
| | `facet_grid(row ~ col)` | åŒå˜é‡åˆ†é¢ |
| | `scales = "free"` | è‡ªç”±åæ ‡è½´ |
| **é¢œè‰²** | `scale_color_manual(values)` | æ‰‹åŠ¨é¢œè‰² |
| | `scale_color_brewer(palette)` | é¢„è®¾è°ƒè‰²æ¿ |
| | `scale_color_gradient()` | è¿ç»­æ¸å˜ |
| **ä¸»é¢˜** | `theme_minimal()`, `theme_bw()` | é¢„è®¾ä¸»é¢˜ |
| | `theme()` | è‡ªå®šä¹‰æ‰€æœ‰å…ƒç´  |

---

## å°ç»“

æœ¬æ•™ç¨‹æ¶µç›–äº† ggplot2 æ ·å¼è®¾ç½®çš„æ‰€æœ‰é‡è¦æ–¹é¢ï¼š

1. **åæ ‡è½´**ï¼šèŒƒå›´ã€åˆ»åº¦ã€æ ‡ç­¾ã€è½´çº¿ã€å˜æ¢
2. **å›¾ä¾‹**ï¼šä½ç½®ã€æ ‡é¢˜ã€æ ‡ç­¾ã€å¸ƒå±€ã€å¤šå›¾ä¾‹æ§åˆ¶
3. **æ ‡é¢˜æ³¨é‡Š**ï¼šæ ‡é¢˜ç³»ç»Ÿã€æ–‡æœ¬æ³¨é‡Šã€å‡ ä½•æ³¨é‡Š
4. **ç¾å­¦æ˜ å°„**ï¼šé¢œè‰²ã€å¤§å°ã€å½¢çŠ¶ã€é€æ˜åº¦ã€çº¿å‹
5. **åˆ†é¢**ï¼šwrap/gridã€æ ‡ç­¾æ ·å¼ã€é—´è·æ§åˆ¶
6. **ä¸»é¢˜ç³»ç»Ÿ**ï¼šé¢„è®¾ä¸»é¢˜ã€å®Œæ•´å®šåˆ¶ã€å¯å¤ç”¨ä¸»é¢˜

> **å»ºè®®**ï¼šä¿å­˜å¸¸ç”¨çš„ theme() è®¾ç½®ä¸ºå‡½æ•°ï¼Œåœ¨æ‰€æœ‰å›¾å½¢ä¸­å¤ç”¨ï¼Œä¿æŒé£æ ¼ç»Ÿä¸€ã€‚

## å‚è€ƒèµ„æº

- [ggplot2 å®˜æ–¹å‚è€ƒ](https://ggplot2.tidyverse.org/reference/)
- [ggplot2 ä¸»é¢˜ç³»ç»Ÿæ–‡æ¡£](https://ggplot2.tidyverse.org/reference/theme.html)
- [scales åŒ…](https://scales.r-lib.org/)
- [ggplot2 Cheatsheet](https://github.com/rstudio/cheatsheets/blob/main/data-visualization.pdf)
