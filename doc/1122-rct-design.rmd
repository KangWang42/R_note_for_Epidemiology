---
title: éšæœºå¯¹ç…§è¯•éªŒè®¾è®¡åŸç†å®Œå…¨æŒ‡å—
date: '2026-01-25'
categories:
- ç»Ÿè®¡åˆ†ææ–¹æ³•
- ç ”ç©¶è®¾è®¡
- ä¸´åºŠè¯•éªŒ
image: images/rct-design-cover.svg
description: RCTçš„è®¾è®¡åŸç†ã€éšæœºåŒ–æ–¹æ³•ã€æ ·æœ¬é‡è®¡ç®—ä¸ITTåˆ†æå®Œæ•´æ•™ç¨‹
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.width = 8,
  fig.height = 5,
  fig.retina = 2,
  out.width = "100%",
  dpi = 150
)
```

## æ–¹æ³•èƒŒæ™¯ä¸é€‚ç”¨åœºæ™¯

**éšæœºå¯¹ç…§è¯•éªŒï¼ˆRandomized Controlled Trial, RCTï¼‰** æ˜¯è¯„ä¼°å¹²é¢„æªæ–½æ•ˆæœçš„"é‡‘æ ‡å‡†"ç ”ç©¶è®¾è®¡ã€‚é€šè¿‡**éšæœºåˆ†é…**å°†ç ”ç©¶å¯¹è±¡åˆ†å…¥å¹²é¢„ç»„å’Œå¯¹ç…§ç»„ï¼Œæœ€å¤§ç¨‹åº¦æ¶ˆé™¤æ··æ‚å› ç´ çš„å½±å“ï¼Œä»è€Œè·å¾—å¹²é¢„çš„çœŸå®å› æœæ•ˆåº”ã€‚

### é€‚ç”¨åœºæ™¯

| ç ”ç©¶ç›®çš„ | å…¸å‹åº”ç”¨ |
|---------|---------|
| æ–°è¯ç–—æ•ˆè¯„ä¼° | IIIæœŸä¸´åºŠè¯•éªŒ |
| æ‰‹æœ¯æ–¹å¼æ¯”è¾ƒ | å¾®åˆ›vsä¼ ç»Ÿæ‰‹æœ¯ |
| é¢„é˜²æªæ–½è¯„ä¼° | ç–«è‹—æœ‰æ•ˆæ€§è¯•éªŒ |
| è¯Šæ–­å·¥å…·éªŒè¯ | æ–°ç­›æŸ¥æ–¹æ³•è¯„ä¼° |
| è¡Œä¸ºå¹²é¢„æ•ˆæœ | å¥åº·æ•™è‚²é¡¹ç›®è¯„ä¼° |

### RCTçš„æ ¸å¿ƒè¦ç´ 

| è¦ç´  | è¯´æ˜ | ä½œç”¨ |
|------|------|------|
| **éšæœºåŒ–** | ç”¨éšæœºæ–¹æ³•åˆ†é…å—è¯•è€… | æ¶ˆé™¤é€‰æ‹©åå€šï¼Œå¹³è¡¡æ··æ‚å› ç´  |
| **å¯¹ç…§** | è®¾ç«‹å¯¹ç…§ç»„è¿›è¡Œæ¯”è¾ƒ | æä¾›åŸºå‡†ï¼Œåˆ†ç¦»å®‰æ…°å‰‚æ•ˆåº” |
| **ç›²æ³•** | éšè—åˆ†ç»„ä¿¡æ¯ | å‡å°‘ä¿¡æ¯åå€š |
| **åˆ†é…éšè—** | éšè—åˆ†ç»„åºåˆ— | é˜²æ­¢é€‰æ‹©æ€§å…¥ç»„ |

### ä¸è§‚å¯Ÿæ€§ç ”ç©¶çš„å¯¹æ¯”

| ç‰¹å¾ | RCT | é˜Ÿåˆ—ç ”ç©¶ | ç—…ä¾‹å¯¹ç…§ |
|------|-----|---------|---------|
| éšæœºåˆ†é… | âœ“ | âœ— | âœ— |
| å› æœæ¨æ–­å¼ºåº¦ | æœ€å¼º | å¼º | ä¸­ç­‰ |
| æ··æ‚æ§åˆ¶ | éšæœºåŒ– | è°ƒæ•´ | åŒ¹é…/è°ƒæ•´ |
| ä¼¦ç†é™åˆ¶ | è¾ƒå¤§ | è¾ƒå° | è¾ƒå° |
| å¤–éƒ¨æœ‰æ•ˆæ€§ | å¯èƒ½å—é™ | è¾ƒå¥½ | è¾ƒå¥½ |
| æˆæœ¬ | é«˜ | ä¸­ | ä½ |

---

## æ ¸å¿ƒæ¦‚å¿µä¸æ¨¡å‹å…¥é—¨

### é€šä¿—ç†è§£ï¼šç”¨æ—¥å¸¸ä¾‹å­è§£é‡ŠRCT

> ğŸ’¡ **æƒ³è±¡ä½ æ˜¯ä¸€ä½è€å¸ˆï¼Œæƒ³çŸ¥é“"è¯¾åè¾…å¯¼æ˜¯å¦èƒ½æé«˜è€ƒè¯•æˆç»©"**
> 
> **æ™®é€šæ–¹æ³•**ï¼šè®©æ„¿æ„å‚åŠ è¾…å¯¼çš„å­¦ç”Ÿå‚åŠ ï¼Œç„¶åæ¯”è¾ƒæˆç»©ã€‚
> - âŒ é—®é¢˜ï¼šæ„¿æ„å‚åŠ çš„å¯èƒ½æœ¬æ¥å°±æ˜¯æ›´åŠªåŠ›çš„å­¦ç”Ÿï¼Œæ— æ³•åˆ¤æ–­æ˜¯"è¾…å¯¼æœ‰æ•ˆ"è¿˜æ˜¯"å­¦ç”Ÿæœ¬èº«ä¼˜ç§€"
>
> **RCTæ–¹æ³•**ï¼šæŠŠ100åå­¦ç”Ÿ**éšæœºæŠ½ç­¾**åˆ†æˆä¸¤ç»„â€”â€”50äººå‚åŠ è¾…å¯¼ï¼Œ50äººä¸å‚åŠ ï¼Œå­¦æœŸæœ«æ¯”è¾ƒæˆç»©ã€‚
> - âœ“ ä¼˜ç‚¹ï¼šéšæœºåˆ†ç»„ç¡®ä¿ä¸¤ç»„å­¦ç”Ÿçš„æ™ºåŠ›ã€åŠ¨æœºã€å®¶åº­èƒŒæ™¯**å¹³å‡ç›¸ä¼¼**
> - âœ“ ç»“æœï¼šå¦‚æœè¾…å¯¼ç»„æˆç»©æ›´å¥½ï¼Œå°±å¯ä»¥å½’å› äºè¾…å¯¼æœ¬èº«
>
> **å…³é”®ç‚¹**ï¼š
> - ğŸ² **éšæœº**ï¼šåƒæŠ½ç­¾ä¸€æ ·ï¼Œæ¯ä¸ªäººè¢«åˆ†åˆ°ä»»ä¸€ç»„çš„æ¦‚ç‡ç›¸ç­‰
> - âš–ï¸ **å¹³è¡¡**ï¼šéšæœºåŒ–ä½¿å¾—ä¸¤ç»„åœ¨æ‰€æœ‰ç‰¹å¾ï¼ˆåŒ…æ‹¬æœªçŸ¥çš„ï¼‰ä¸Šè¶‹äºç›¸ä¼¼
> - ğŸ”¬ **å¯¹ç…§**ï¼šæœ‰æ¯”è¾ƒæ‰èƒ½çŸ¥é“å¹²é¢„çš„çœŸæ­£æ•ˆæœ

### æ ¸å¿ƒæœ¯è¯­

| æ¦‚å¿µ | è‹±æ–‡ | å®šä¹‰ |
|------|------|------|
| éšæœºåŒ– | Randomization | ç”¨éšæœºæ–¹æ³•å°†å—è¯•è€…åˆ†é…åˆ°å„ç»„ |
| åˆ†é…éšè— | Allocation Concealment | åœ¨åˆ†é…å‰éšè—åˆ†ç»„åºåˆ— |
| ç›²æ³• | Blinding/Masking | å¯¹åˆ†ç»„ä¿¡æ¯ä¿å¯† |
| å®‰æ…°å‰‚ | Placebo | å¤–è§‚ç›¸åŒä½†æ— æ´»æ€§æˆåˆ†çš„å¯¹ç…§ |
| ITTåˆ†æ | Intention-to-Treat | æŒ‰åŸå§‹åˆ†ç»„åˆ†æï¼Œä¸è®ºå®é™…æ¥å—æƒ…å†µ |
| PPåˆ†æ | Per-Protocol | ä»…åˆ†æå®Œæˆæ–¹æ¡ˆè€… |
| éåŠ£æ•ˆæ€§ | Non-inferiority | è¯æ˜æ–°ç–—æ³•ä¸æ¯”æ ‡å‡†å·® |
| ä¼˜æ•ˆæ€§ | Superiority | è¯æ˜æ–°ç–—æ³•ä¼˜äºæ ‡å‡† |

### éšæœºåŒ–ç±»å‹

![éšæœºåŒ–æ–¹æ³•ç¤ºæ„å›¾](images/diagrams/stat-rct-randomization.svg)

| ç±»å‹ | æ–¹æ³• | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|------|
| **ç®€å•éšæœº** | æŠ›ç¡¬å¸/éšæœºæ•°è¡¨ | ç®€å•ï¼Œæ— å | å¯èƒ½å¯¼è‡´ç»„é—´ä¸å¹³è¡¡ |
| **åŒºç»„éšæœº** | æ¯ä¸ªåŒºç»„å†…å¹³è¡¡ | ä¿è¯æ ·æœ¬é‡å¹³è¡¡ | å¯èƒ½è¢«çŒœæµ‹ |
| **åˆ†å±‚éšæœº** | æŒ‰é‡è¦å› ç´ åˆ†å±‚åéšæœº | ä¿è¯å…³é”®å˜é‡å¹³è¡¡ | è®¾è®¡å¤æ‚ |
| **æœ€å°åŒ–** | åŠ¨æ€å¹³è¡¡å¤šä¸ªå› ç´  | å¤šå› ç´ å¹³è¡¡ | éçº¯éšæœº |
| **é›†ç¾¤éšæœº** | ä»¥ç¾¤ä½“ä¸ºå•ä½éšæœº | é€‚ç”¨äºç¾¤ä½“å¹²é¢„ | éœ€æ›´å¤§æ ·æœ¬ |

### ç›²æ³•å±‚æ¬¡

| å±‚æ¬¡ | è°è¢«ç›² | ç›®çš„ |
|------|-------|------|
| **å¼€æ”¾æ ‡ç­¾** | æ— äººè¢«ç›² | ä¸å¯èƒ½å®æ–½ç›²æ³•æ—¶ |
| **å•ç›²** | ä»…å—è¯•è€… | å‡å°‘å®‰æ…°å‰‚æ•ˆåº” |
| **åŒç›²** | å—è¯•è€…+ç ”ç©¶è€… | å‡å°‘æµ‹é‡åå€š |
| **ä¸‰ç›²** | å—è¯•è€…+ç ”ç©¶è€…+ç»Ÿè®¡å¸ˆ | æœ€å¤§ç¨‹åº¦å‡å°‘åå€š |

---

## æ¨¡å‹å‡è®¾ä¸å‰ææ¡ä»¶

### å‡è®¾1ï¼šéšæœºåŒ–æˆåŠŸ

**å«ä¹‰**: éšæœºåŒ–ä½¿å„ç»„åŸºçº¿ç‰¹å¾å‡è¡¡ã€‚

**æ£€éªŒæ–¹æ³•**: 
- æ¯”è¾ƒåŸºçº¿ç‰¹å¾è¡¨
- ä½¿ç”¨æ ‡å‡†åŒ–å·®å¼‚ï¼ˆSMD < 0.1ä¸ºå¹³è¡¡è‰¯å¥½ï¼‰

**è¿èƒŒåæœ**: æ··æ‚åå€šã€‚

**åº”å¯¹ç­–ç•¥**: è°ƒæ•´åˆ†æï¼ˆåæ–¹å·®åˆ†æANCOVAï¼‰ã€‚

### å‡è®¾2ï¼šæ— æ±¡æŸ“

**å«ä¹‰**: å„ç»„å—è¯•è€…åªæ¥å—åˆ†é…çš„å¹²é¢„ã€‚

**æ£€éªŒæ–¹æ³•**: 
- ç›‘æµ‹ä¾ä»æ€§
- è®°å½•äº¤å‰æƒ…å†µ

**è¿èƒŒåæœ**: æ•ˆåº”è¢«ç¨€é‡Šã€‚

**åº”å¯¹ç­–ç•¥**: ITTåˆ†æä¸ºä¸»ï¼ŒPPåˆ†æä¸ºè¾…ã€‚

### å‡è®¾3ï¼šæ— å¤±è®¿åå€š

**å«ä¹‰**: å¤±è®¿ä¸ç»“å±€å’Œåˆ†ç»„ç‹¬ç«‹ã€‚

**æ£€éªŒæ–¹æ³•**: 
- æ¯”è¾ƒå¤±è®¿è€…ç‰¹å¾
- æ•æ„Ÿæ€§åˆ†æ

**è¿èƒŒåæœ**: ä¼°è®¡åå€šã€‚

**åº”å¯¹ç­–ç•¥**: å¤šé‡æ’è¡¥ã€æœ€åæƒ…å†µåˆ†æã€‚

### å‡è®¾4ï¼šç›²æ³•æœ‰æ•ˆ

**å«ä¹‰**: å—è¯•è€…å’Œç ”ç©¶è€…ä¸çŸ¥é“åˆ†ç»„ã€‚

**æ£€éªŒæ–¹æ³•**: 
- ç ”ç©¶ç»“æŸæ—¶è¯¢é—®çŒœæµ‹åˆ†ç»„
- è®¡ç®—ç ´ç›²æŒ‡æ•°

**è¿èƒŒåæœ**: å®‰æ…°å‰‚æ•ˆåº”æˆ–æµ‹é‡åå€šã€‚

**åº”å¯¹ç­–ç•¥**: ä½¿ç”¨å®¢è§‚ç»“å±€æŒ‡æ ‡ã€‚

---

## æ•°æ®å‡†å¤‡

### å®‰è£…ä¸åŠ è½½RåŒ…

```{r}
# æ ¸å¿ƒåŒ…
library(tidyverse)     # æ•°æ®å¤„ç†
library(gtsummary)     # ä¸“ä¸šè¡¨æ ¼
library(ggplot2)       # å¯è§†åŒ–
library(pwr)           # æ ·æœ¬é‡è®¡ç®—
library(randomizr)     # éšæœºåŒ–å·¥å…·

# è¾…åŠ©åŒ…
library(broom)         # æ¨¡å‹æ•´ç†
library(gt)            # è¡¨æ ¼ç¾åŒ–
library(scales)        # æ ¼å¼åŒ–
library(DiagrammeR)    # æµç¨‹å›¾
```

### æ¨¡æ‹ŸRCTæ•°æ®

æˆ‘ä»¬æ¨¡æ‹Ÿä¸€é¡¹è¯„ä¼°é™å‹è¯çš„åŒç›²RCTï¼š

```{r}
# è®¾ç½®éšæœºç§å­
set.seed(2026)
n <- 400

# ç”ŸæˆåŸºçº¿æ•°æ®
rct_data <- tibble(
  id = sprintf("P%04d", 1:n),
  
  # åŸºçº¿åå˜é‡
  age = round(rnorm(n, 55, 10)),
  sex = factor(sample(c("ç”·", "å¥³"), n, replace = TRUE, prob = c(0.52, 0.48))),
  bmi = round(rnorm(n, 26, 4), 1),
  smoking = factor(sample(c("ä»ä¸", "æ›¾ç»", "ç°åœ¨"), n, 
                          replace = TRUE, prob = c(0.45, 0.30, 0.25))),
  diabetes = rbinom(n, 1, prob = 0.15),
  
  # åŸºçº¿è¡€å‹
  sbp_baseline = round(rnorm(n, 155, 15)),  # é«˜è¡€å‹æ‚£è€…
  dbp_baseline = round(rnorm(n, 95, 10)),
  
  # åˆ†å±‚å› ç´ 
  site = factor(sample(paste0("ä¸­å¿ƒ", 1:4), n, replace = TRUE)),
  severity = factor(sample(c("è½»åº¦", "ä¸­åº¦", "é‡åº¦"), n, 
                           replace = TRUE, prob = c(0.3, 0.5, 0.2)))
)

# ä½¿ç”¨åˆ†å±‚åŒºç»„éšæœºåŒ–åˆ†é…
rct_data$group <- block_ra(
  blocks = interaction(rct_data$site, rct_data$severity),
  conditions = c("è¯•éªŒç»„", "å¯¹ç…§ç»„")
)
rct_data$group <- factor(rct_data$group)

# ç”Ÿæˆç»“å±€æ•°æ®
rct_data <- rct_data |> 
  mutate(
    # çœŸå®æ²»ç–—æ•ˆåº”ï¼šè¯•éªŒè¯é™ä½è¡€å‹10mmHg
    treatment_effect = ifelse(group == "è¯•éªŒç»„", -10, 0),
    
    # 12å‘¨åè¡€å‹ï¼ˆè€ƒè™‘å›å½’å‡å€¼æ•ˆåº”å’Œä¸ªä½“å˜å¼‚ï¼‰
    sbp_week12 = round(
      sbp_baseline - 5 +  # å›å½’å‡å€¼æ•ˆåº”
      treatment_effect +   # æ²»ç–—æ•ˆåº”
      -0.1 * (age - 55) +  # å¹´é¾„æ•ˆåº”
      rnorm(n, 0, 8)       # ä¸ªä½“å˜å¼‚
    ),
    
    dbp_week12 = round(
      dbp_baseline - 3 + 
      ifelse(group == "è¯•éªŒç»„", -5, 0) +
      rnorm(n, 0, 5)
    ),
    
    # è¡€å‹å˜åŒ–
    sbp_change = sbp_week12 - sbp_baseline,
    dbp_change = dbp_week12 - dbp_baseline,
    
    # è¡€å‹è¾¾æ ‡ï¼ˆ< 140/90 mmHgï¼‰
    bp_controlled = as.integer(sbp_week12 < 140 & dbp_week12 < 90),
    
    # ä¾ä»æ€§ï¼ˆéƒ¨åˆ†æ‚£è€…æœªå®Œæˆæ–¹æ¡ˆï¼‰
    completed = rbinom(n, 1, prob = 0.92),
    
    # ä¸è‰¯äº‹ä»¶
    adverse_event = rbinom(n, 1, prob = ifelse(group == "è¯•éªŒç»„", 0.15, 0.08))
  )

# æŸ¥çœ‹æ•°æ®
glimpse(rct_data)

# åˆ†ç»„ç»Ÿè®¡
table(rct_data$group)
```

### åŸºçº¿ç‰¹å¾å¹³è¡¡æ€§æ£€æŸ¥

```{r}
# åŸºçº¿ç‰¹å¾è¡¨
baseline_table <- rct_data |> 
  tbl_summary(
    by = group,
    include = c(age, sex, bmi, smoking, diabetes, sbp_baseline, 
                dbp_baseline, site, severity),
    label = list(
      age ~ "å¹´é¾„ (å²)",
      sex ~ "æ€§åˆ«",
      bmi ~ "BMI (kg/mÂ²)",
      smoking ~ "å¸çƒŸçŠ¶æ€",
      diabetes ~ "ç³–å°¿ç—…",
      sbp_baseline ~ "åŸºçº¿æ”¶ç¼©å‹ (mmHg)",
      dbp_baseline ~ "åŸºçº¿èˆ’å¼ å‹ (mmHg)",
      site ~ "ç ”ç©¶ä¸­å¿ƒ",
      severity ~ "é«˜è¡€å‹ä¸¥é‡ç¨‹åº¦"
    ),
    statistic = list(
      all_continuous() ~ "{mean} Â± {sd}",
      all_categorical() ~ "{n} ({p}%)"
    )
  ) |> 
  add_p() |> 
  add_overall() |> 
  modify_header(label = "**å˜é‡**") |> 
  modify_spanning_header(c("stat_1", "stat_2") ~ "**åˆ†ç»„**") |> 
  bold_labels()

baseline_table
```

```{r}
# è®¡ç®—æ ‡å‡†åŒ–å·®å¼‚ï¼ˆSMDï¼‰
library(tableone)

vars <- c("age", "sex", "bmi", "smoking", "diabetes", 
          "sbp_baseline", "dbp_baseline")
cat_vars <- c("sex", "smoking", "diabetes")

tab_smd <- CreateTableOne(vars = vars, strata = "group", 
                           data = rct_data, factorVars = cat_vars)
smd_values <- ExtractSmd(tab_smd)

# å¯è§†åŒ–SMD
smd_df <- tibble(
  variable = names(smd_values),
  smd = as.numeric(smd_values)
) |> 
  mutate(balanced = abs(smd) < 0.1)

ggplot(smd_df, aes(x = smd, y = reorder(variable, smd))) +
  geom_vline(xintercept = c(-0.1, 0.1), linetype = "dashed", color = "gray50") +
  geom_vline(xintercept = 0, color = "black") +
  geom_point(aes(color = balanced), size = 3) +
  scale_color_manual(values = c("TRUE" = "#22c55e", "FALSE" = "#ef4444"),
                     labels = c("ä¸å¹³è¡¡", "å¹³è¡¡")) +
  labs(
    title = "åŸºçº¿ç‰¹å¾å¹³è¡¡æ€§æ£€éªŒ",
    subtitle = "|SMD| < 0.1 è¡¨ç¤ºå¹³è¡¡è‰¯å¥½",
    x = "æ ‡å‡†åŒ–å·®å¼‚ (SMD)",
    y = "",
    color = "å¹³è¡¡çŠ¶æ€"
  ) +
  theme_minimal(base_size = 12)
```

---

## å®Œæ•´åˆ†ææµç¨‹

### æ­¥éª¤1ï¼šæ ·æœ¬é‡è®¡ç®—

```{r}
# æ ·æœ¬é‡è®¡ç®—ï¼šä¸¤ç»„å‡å€¼æ¯”è¾ƒ
# H0: Î¼1 - Î¼2 = 0
# H1: Î¼1 - Î¼2 = 10 mmHg (é¢„æœŸé™å‹æ•ˆæœ)
# Î± = 0.05 (åŒä¾§), Power = 0.80
# SD = 15 mmHg

power_result <- pwr.t.test(
  d = 10 / 15,  # æ•ˆåº”é‡ = å·®å¼‚ / SD
  sig.level = 0.05,
  power = 0.80,
  type = "two.sample",
  alternative = "two.sided"
)

print(power_result)

# è€ƒè™‘20%å¤±è®¿
n_per_group <- ceiling(power_result$n / 0.80)
cat("\nè€ƒè™‘20%å¤±è®¿åï¼Œæ¯ç»„éœ€è¦:", n_per_group, "äºº\n")
cat("æ€»æ ·æœ¬é‡:", n_per_group * 2, "äºº\n")
```

```{r}
# æ ·æœ¬é‡-æ•ˆèƒ½æ›²çº¿
n_range <- seq(50, 300, by = 10)
power_curve <- sapply(n_range, function(n) {
  pwr.t.test(n = n, d = 10/15, sig.level = 0.05, 
             type = "two.sample")$power
})

power_df <- tibble(n = n_range, power = power_curve)

ggplot(power_df, aes(x = n, y = power)) +
  geom_line(color = "#2563eb", size = 1.2) +
  geom_hline(yintercept = 0.80, linetype = "dashed", color = "#ef4444") +
  geom_vline(xintercept = ceiling(power_result$n), linetype = "dashed", color = "#22c55e") +
  annotate("text", x = ceiling(power_result$n) + 20, y = 0.75, 
           label = paste("n =", ceiling(power_result$n)), color = "#22c55e") +
  scale_y_continuous(labels = percent_format(), limits = c(0, 1)) +
  labs(
    title = "æ ·æœ¬é‡-ç»Ÿè®¡æ•ˆèƒ½æ›²çº¿",
    subtitle = "æ•ˆåº”é‡d = 0.67, Î± = 0.05",
    x = "æ¯ç»„æ ·æœ¬é‡",
    y = "ç»Ÿè®¡æ•ˆèƒ½"
  ) +
  theme_minimal(base_size = 12)
```

### æ­¥éª¤2ï¼šéšæœºåŒ–å®æ–½

```{r}
# æ¼”ç¤ºä¸åŒéšæœºåŒ–æ–¹æ³•

# 1. ç®€å•éšæœºåŒ–
simple_rand <- complete_ra(N = 20, conditions = c("A", "B"))
table(simple_rand)

# 2. åŒºç»„éšæœºåŒ–ï¼ˆåŒºç»„å¤§å°ä¸º4ï¼‰
block_rand <- block_ra(
  blocks = rep(1:5, each = 4),
  conditions = c("A", "B")
)
# æ¯ä¸ªåŒºç»„å†…Aå’ŒBå„2äºº

# 3. åˆ†å±‚åŒºç»„éšæœºåŒ–
# æŒ‰æ€§åˆ«åˆ†å±‚
strat_rand <- block_ra(
  blocks = c(rep("M", 10), rep("F", 10)),
  conditions = c("A", "B")
)
table(strat_rand, c(rep("M", 10), rep("F", 10)))
```

```{r}
# å¯è§†åŒ–éšæœºåŒ–ç»“æœ
rand_visual <- tibble(
  subject = 1:20,
  method = rep(c("ç®€å•éšæœº", "åŒºç»„éšæœº"), each = 10),
  group = c(simple_rand[1:10], block_rand[1:10])
)

ggplot(rand_visual, aes(x = subject, y = method, fill = group)) +
  geom_tile(color = "white", size = 0.5) +
  scale_fill_manual(values = c("A" = "#2563eb", "B" = "#ef4444")) +
  labs(
    title = "éšæœºåŒ–åˆ†é…ç¤ºæ„å›¾",
    x = "å—è¯•è€…ç¼–å·",
    y = "éšæœºåŒ–æ–¹æ³•",
    fill = "åˆ†ç»„"
  ) +
  theme_minimal(base_size = 12)
```

### æ­¥éª¤3ï¼šCONSORTæµç¨‹å›¾

```{r}
# åˆ›å»ºCONSORTæµç¨‹å›¾æ•°æ®
consort_data <- list(
  assessed = n + 50,  # ç­›é€‰äººæ•°
  excluded = 50,      # æ’é™¤äººæ•°
  randomized = n,
  allocated_treatment = sum(rct_data$group == "è¯•éªŒç»„"),
  allocated_control = sum(rct_data$group == "å¯¹ç…§ç»„"),
  completed_treatment = sum(rct_data$group == "è¯•éªŒç»„" & rct_data$completed == 1),
  completed_control = sum(rct_data$group == "å¯¹ç…§ç»„" & rct_data$completed == 1),
  analyzed_treatment = sum(rct_data$group == "è¯•éªŒç»„"),  # ITTåˆ†æ
  analyzed_control = sum(rct_data$group == "å¯¹ç…§ç»„")
)

# ä½¿ç”¨DiagrammeRåˆ›å»ºæµç¨‹å›¾
grViz("
digraph CONSORT {
  graph [rankdir = TB]
  node [shape = box, style = filled, fillcolor = lightblue]
  
  assessed [label = 'ç­›é€‰è¯„ä¼°\\n(n = 450)']
  excluded [label = 'æ’é™¤ (n = 50)\\nâ€¢ ä¸ç¬¦åˆçº³å…¥æ ‡å‡†: 30\\nâ€¢ æ‹’ç»å‚åŠ : 15\\nâ€¢ å…¶ä»–åŸå› : 5', fillcolor = lightyellow]
  randomized [label = 'éšæœºåŒ–\\n(n = 400)', fillcolor = lightgreen]
  
  treatment [label = 'åˆ†é…è‡³è¯•éªŒç»„\\n(n = 200)']
  control [label = 'åˆ†é…è‡³å¯¹ç…§ç»„\\n(n = 200)']
  
  treatment_fu [label = 'å®Œæˆéšè®¿\\n(n = 184)\\nå¤±è®¿: 16']
  control_fu [label = 'å®Œæˆéšè®¿\\n(n = 186)\\nå¤±è®¿: 14']
  
  treatment_analyzed [label = 'ITTåˆ†æ\\n(n = 200)']
  control_analyzed [label = 'ITTåˆ†æ\\n(n = 200)']
  
  assessed -> excluded [style = dashed]
  assessed -> randomized
  randomized -> treatment
  randomized -> control
  treatment -> treatment_fu
  control -> control_fu
  treatment_fu -> treatment_analyzed
  control_fu -> control_analyzed
}
")
```

### æ­¥éª¤4ï¼šä¸»è¦ç»“å±€åˆ†æï¼ˆITTåŸåˆ™ï¼‰

```{r}
# ITTåˆ†æï¼šæ‰€æœ‰éšæœºåŒ–å—è¯•è€…
# ä¸»è¦ç»“å±€ï¼š12å‘¨è¡€å‹å˜åŒ–

# æè¿°æ€§ç»Ÿè®¡
outcome_summary <- rct_data |> 
  group_by(group) |> 
  summarise(
    n = n(),
    sbp_baseline_mean = mean(sbp_baseline),
    sbp_week12_mean = mean(sbp_week12),
    sbp_change_mean = mean(sbp_change),
    sbp_change_sd = sd(sbp_change),
    bp_controlled_pct = mean(bp_controlled) * 100,
    .groups = "drop"
  )

outcome_summary |> 
  gt() |> 
  tab_header(title = "ä¸»è¦ç»“å±€æ‘˜è¦") |> 
  fmt_number(columns = where(is.numeric), decimals = 1)
```

```{r}
# ä¸»è¦åˆ†æï¼šä¸¤ç»„è¡€å‹å˜åŒ–æ¯”è¾ƒ
# ä½¿ç”¨tæ£€éªŒ
t_test_result <- t.test(sbp_change ~ group, data = rct_data)
print(t_test_result)

# è®¡ç®—æ•ˆåº”é‡ï¼ˆCohen's dï¼‰
library(effectsize)
cohens_d <- cohens_d(sbp_change ~ group, data = rct_data)
print(cohens_d)
```

```{r}
# ANCOVAï¼šè°ƒæ•´åŸºçº¿è¡€å‹
ancova_model <- lm(sbp_week12 ~ group + sbp_baseline + age + sex, data = rct_data)

tbl_regression(ancova_model) |> 
  modify_header(label = "**å˜é‡**") |> 
  bold_p(t = 0.05)
```

### æ­¥éª¤5ï¼šPPåˆ†æï¼ˆæ•æ„Ÿæ€§åˆ†æï¼‰

```{r}
# PPåˆ†æï¼šä»…åˆ†æå®Œæˆæ–¹æ¡ˆè€…
rct_pp <- rct_data |> filter(completed == 1)

cat("PPåˆ†ææ ·æœ¬é‡:", nrow(rct_pp), "\n")

# PPåˆ†æç»“æœ
t_test_pp <- t.test(sbp_change ~ group, data = rct_pp)

# æ¯”è¾ƒITTå’ŒPPç»“æœ
comparison <- tibble(
  åˆ†æç±»å‹ = c("ITT", "PP"),
  æ ·æœ¬é‡ = c(nrow(rct_data), nrow(rct_pp)),
  è¯•éªŒç»„å‡å€¼ = c(
    mean(rct_data$sbp_change[rct_data$group == "è¯•éªŒç»„"]),
    mean(rct_pp$sbp_change[rct_pp$group == "è¯•éªŒç»„"])
  ),
  å¯¹ç…§ç»„å‡å€¼ = c(
    mean(rct_data$sbp_change[rct_data$group == "å¯¹ç…§ç»„"]),
    mean(rct_pp$sbp_change[rct_pp$group == "å¯¹ç…§ç»„"])
  ),
  ç»„é—´å·®å¼‚ = c(
    -diff(t_test_result$estimate),
    -diff(t_test_pp$estimate)
  ),
  På€¼ = c(t_test_result$p.value, t_test_pp$p.value)
)

comparison |> 
  gt() |> 
  tab_header(title = "ITT vs PP åˆ†ææ¯”è¾ƒ") |> 
  fmt_number(columns = c(è¯•éªŒç»„å‡å€¼, å¯¹ç…§ç»„å‡å€¼, ç»„é—´å·®å¼‚), decimals = 1) |> 
  fmt_number(columns = På€¼, decimals = 4)
```

### æ­¥éª¤6ï¼šç»“æœå¯è§†åŒ–

```{r}
#| fig-height: 6
# è¡€å‹å˜åŒ–åˆ†å¸ƒå›¾
ggplot(rct_data, aes(x = sbp_change, fill = group)) +
  geom_density(alpha = 0.6) +
  geom_vline(xintercept = 0, linetype = "dashed") +
  scale_fill_manual(values = c("è¯•éªŒç»„" = "#2563eb", "å¯¹ç…§ç»„" = "#ef4444")) +
  labs(
    title = "æ”¶ç¼©å‹å˜åŒ–åˆ†å¸ƒ",
    subtitle = paste("ç»„é—´å·®å¼‚:", round(-diff(t_test_result$estimate), 1), 
                     "mmHg, p =", format.pval(t_test_result$p.value, digits = 3)),
    x = "æ”¶ç¼©å‹å˜åŒ– (mmHg)",
    y = "å¯†åº¦",
    fill = "åˆ†ç»„"
  ) +
  theme_minimal(base_size = 12)
```

```{r}
# å‰åå˜åŒ–å›¾
rct_long <- rct_data |> 
  select(id, group, sbp_baseline, sbp_week12) |> 
  pivot_longer(cols = starts_with("sbp"),
               names_to = "time",
               values_to = "sbp") |> 
  mutate(time = ifelse(time == "sbp_baseline", "åŸºçº¿", "12å‘¨"))

ggplot(rct_long, aes(x = time, y = sbp, group = id, color = group)) +
  geom_line(alpha = 0.1) +
  stat_summary(aes(group = group), fun = mean, geom = "line", size = 1.5) +
  stat_summary(aes(group = group), fun = mean, geom = "point", size = 3) +
  scale_color_manual(values = c("è¯•éªŒç»„" = "#2563eb", "å¯¹ç…§ç»„" = "#ef4444")) +
  labs(
    title = "æ”¶ç¼©å‹å˜åŒ–è¶‹åŠ¿",
    subtitle = "ç»†çº¿ä¸ºä¸ªä½“è½¨è¿¹ï¼Œç²—çº¿ä¸ºç»„å‡å€¼",
    x = "æ—¶é—´ç‚¹",
    y = "æ”¶ç¼©å‹ (mmHg)",
    color = "åˆ†ç»„"
  ) +
  theme_minimal(base_size = 12)
```

```{r}
#| fig-height: 5
# è¡€å‹è¾¾æ ‡ç‡å¯¹æ¯”
bp_control_summary <- rct_data |> 
  group_by(group) |> 
  summarise(
    n = n(),
    controlled = sum(bp_controlled),
    rate = mean(bp_controlled) * 100,
    .groups = "drop"
  ) |> 
  mutate(
    ci_low = map2_dbl(controlled, n, ~binom.test(.x, .y)$conf.int[1] * 100),
    ci_high = map2_dbl(controlled, n, ~binom.test(.x, .y)$conf.int[2] * 100)
  )

ggplot(bp_control_summary, aes(x = group, y = rate, fill = group)) +
  geom_col(width = 0.6) +
  geom_errorbar(aes(ymin = ci_low, ymax = ci_high), width = 0.2) +
  geom_text(aes(label = paste0(round(rate, 1), "%")), vjust = -0.5, size = 5) +
  scale_fill_manual(values = c("è¯•éªŒç»„" = "#2563eb", "å¯¹ç…§ç»„" = "#ef4444")) +
  scale_y_continuous(limits = c(0, 100)) +
  labs(
    title = "è¡€å‹è¾¾æ ‡ç‡å¯¹æ¯”",
    subtitle = "ç›®æ ‡: <140/90 mmHg",
    x = "",
    y = "è¾¾æ ‡ç‡ (%)",
    fill = "åˆ†ç»„"
  ) +
  theme_minimal(base_size = 12) +
  theme(legend.position = "none")
```

### æ­¥éª¤7ï¼šå®‰å…¨æ€§åˆ†æ

```{r}
# ä¸è‰¯äº‹ä»¶åˆ†æ
ae_summary <- rct_data |> 
  group_by(group) |> 
  summarise(
    n = n(),
    ae_count = sum(adverse_event),
    ae_rate = mean(adverse_event) * 100,
    .groups = "drop"
  )

# Fisherç²¾ç¡®æ£€éªŒ
ae_table <- table(rct_data$group, rct_data$adverse_event)
fisher_test <- fisher.test(ae_table)

ae_summary |> 
  gt() |> 
  tab_header(
    title = "ä¸è‰¯äº‹ä»¶æ‘˜è¦",
    subtitle = paste("Fisherç²¾ç¡®æ£€éªŒ p =", round(fisher_test$p.value, 3))
  ) |> 
  cols_label(
    group = "åˆ†ç»„",
    n = "äººæ•°",
    ae_count = "ä¸è‰¯äº‹ä»¶æ•°",
    ae_rate = "å‘ç”Ÿç‡(%)"
  ) |> 
  fmt_number(columns = ae_rate, decimals = 1)
```

### æ­¥éª¤8ï¼šäºšç»„åˆ†æ

```{r}
#| fig-height: 7
# æŒ‰ä¸¥é‡ç¨‹åº¦åˆ†å±‚çš„äºšç»„åˆ†æ
subgroup_results <- rct_data |> 
  group_by(severity) |> 
  summarise(
    n = n(),
    effect = mean(sbp_change[group == "è¯•éªŒç»„"]) - mean(sbp_change[group == "å¯¹ç…§ç»„"]),
    se = sqrt(var(sbp_change[group == "è¯•éªŒç»„"])/sum(group == "è¯•éªŒç»„") +
              var(sbp_change[group == "å¯¹ç…§ç»„"])/sum(group == "å¯¹ç…§ç»„")),
    .groups = "drop"
  ) |> 
  mutate(
    ci_low = effect - 1.96 * se,
    ci_high = effect + 1.96 * se
  )

# æ·»åŠ æ€»ä½“ç»“æœ
overall <- tibble(
  severity = "æ€»ä½“",
  n = nrow(rct_data),
  effect = -diff(t_test_result$estimate),
  se = sqrt(sum((t_test_result$stderr)^2)),
  ci_low = -diff(t_test_result$estimate) - 1.96 * t_test_result$stderr,
  ci_high = -diff(t_test_result$estimate) + 1.96 * t_test_result$stderr
)

subgroup_plot_data <- bind_rows(subgroup_results, overall) |> 
  mutate(severity = factor(severity, levels = c("è½»åº¦", "ä¸­åº¦", "é‡åº¦", "æ€»ä½“")))

ggplot(subgroup_plot_data, aes(x = effect, y = severity)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray50") +
  geom_point(size = 3, color = "#2563eb") +
  geom_errorbarh(aes(xmin = ci_low, xmax = ci_high), height = 0.2, color = "#2563eb") +
  geom_text(aes(label = paste0("n=", n)), hjust = -0.5, vjust = -1, size = 3) +
  labs(
    title = "äºšç»„åˆ†æï¼šæŒ‰é«˜è¡€å‹ä¸¥é‡ç¨‹åº¦",
    subtitle = "è¯•éªŒç»„ vs å¯¹ç…§ç»„ æ”¶ç¼©å‹å˜åŒ–å·®å¼‚",
    x = "ç»„é—´å·®å¼‚ (mmHg)",
    y = "äºšç»„"
  ) +
  theme_minimal(base_size = 12)
```

---

## ç»“æœè§£è¯»ä¸æŠ¥å‘Š

### CONSORTæŠ¥å‘Šè§„èŒƒ

CONSORTï¼ˆConsolidated Standards of Reporting Trialsï¼‰æ˜¯RCTæŠ¥å‘Šçš„å›½é™…æ ‡å‡†ï¼š

| æ¡ç›® | è¦ç‚¹ |
|------|------|
| æ ‡é¢˜ | æ˜ç¡®æ ‡è¯†ä¸ºéšæœºå¯¹ç…§è¯•éªŒ |
| è¯•éªŒè®¾è®¡ | æè¿°åˆ†é…æ¯”ä¾‹ã€ä¼˜æ•ˆ/éåŠ£æ•ˆè®¾è®¡ |
| éšæœºåŒ– | æŠ¥å‘Šéšæœºåºåˆ—ç”Ÿæˆã€åˆ†é…éšè—æ–¹æ³• |
| ç›²æ³• | è¯´æ˜è°è¢«ç›²ï¼Œè¯„ä¼°ç ´ç›²æƒ…å†µ |
| æ ·æœ¬é‡ | æŠ¥å‘Šæ ·æœ¬é‡è®¡ç®—ä¾æ® |
| æµç¨‹å›¾ | æä¾›CONSORTæµç¨‹å›¾ |
| åŸºçº¿ | å±•ç¤ºåŸºçº¿ç‰¹å¾è¡¨ |
| ä¸»è¦ç»“å±€ | æŠ¥å‘ŠITTåˆ†æç»“æœï¼ŒåŒ…æ‹¬æ•ˆåº”é‡å’Œ95%CI |
| æ•æ„Ÿæ€§åˆ†æ | æŠ¥å‘ŠPPåˆ†æç­‰æ•æ„Ÿæ€§åˆ†æç»“æœ |
| å±å®³ | æŠ¥å‘Šä¸è‰¯äº‹ä»¶ |

### ç»“æœæŠ¥å‘Šæ¨¡æ¿

> æœ¬ç ”ç©¶å…±çº³å…¥ `r nrow(rct_data)` åé«˜è¡€å‹æ‚£è€…ï¼ŒæŒ‰1:1æ¯”ä¾‹éšæœºåˆ†é…è‡³è¯•éªŒç»„ï¼ˆn = `r sum(rct_data$group == "è¯•éªŒç»„")`ï¼‰å’Œå¯¹ç…§ç»„ï¼ˆn = `r sum(rct_data$group == "å¯¹ç…§ç»„")`ï¼‰ã€‚ä¸¤ç»„åŸºçº¿ç‰¹å¾å‡è¡¡ï¼ˆæ‰€æœ‰SMD < 0.1ï¼‰ã€‚
>
> **ä¸»è¦ç»“å±€**ï¼š12å‘¨åï¼Œè¯•éªŒç»„æ”¶ç¼©å‹è¾ƒåŸºçº¿å¹³å‡ä¸‹é™ `r round(abs(mean(rct_data$sbp_change[rct_data$group == "è¯•éªŒç»„"])), 1)` mmHgï¼Œå¯¹ç…§ç»„ä¸‹é™ `r round(abs(mean(rct_data$sbp_change[rct_data$group == "å¯¹ç…§ç»„"])), 1)` mmHgï¼Œç»„é—´å·®å¼‚ä¸º `r round(-diff(t_test_result$estimate), 1)` mmHgï¼ˆ95% CI: `r round(t_test_result$conf.int[1], 1)` - `r round(t_test_result$conf.int[2], 1)`, P `r ifelse(t_test_result$p.value < 0.001, "< 0.001", paste("=", round(t_test_result$p.value, 3)))`ï¼‰ã€‚
>
> **å®‰å…¨æ€§**ï¼šè¯•éªŒç»„ä¸è‰¯äº‹ä»¶å‘ç”Ÿç‡ä¸º `r round(mean(rct_data$adverse_event[rct_data$group == "è¯•éªŒç»„"]) * 100, 1)`%ï¼Œå¯¹ç…§ç»„ä¸º `r round(mean(rct_data$adverse_event[rct_data$group == "å¯¹ç…§ç»„"]) * 100, 1)`%ï¼ˆP = `r round(fisher_test$p.value, 3)`ï¼‰ã€‚

---

## å¸¸è§é”™è¯¯ä¸çº å

### é”™è¯¯1ï¼šåŸºçº¿å·®å¼‚åè°ƒæ•´På€¼

**é”™è¯¯è¡¨ç°**: åŸºçº¿æ£€éªŒP > 0.05å°±è®¤ä¸º"ç»„é—´å¹³è¡¡"ï¼ŒP < 0.05å°±"éœ€è¦è°ƒæ•´"

**æ­£ç¡®åšæ³•**: 
- åŸºçº¿På€¼å—æ ·æœ¬é‡å½±å“ï¼Œä¸åº”ä½œä¸ºè°ƒæ•´ä¾æ®
- ä½¿ç”¨SMDè¯„ä¼°å¹³è¡¡æ€§ï¼ˆ|SMD| < 0.1ï¼‰
- é¢„å…ˆè®¡åˆ’çš„åå˜é‡åº”å§‹ç»ˆè°ƒæ•´

### é”™è¯¯2ï¼šä¸æŠ¥å‘ŠITTåˆ†æ

**é”™è¯¯è¡¨ç°**: ä»…æŠ¥å‘ŠPPåˆ†æç»“æœ

**æ­£ç¡®åšæ³•**: 
- ITTåˆ†æä¸ºä¸»è¦åˆ†æï¼ˆä¿æŒéšæœºåŒ–ä¼˜åŠ¿ï¼‰
- PPåˆ†æä½œä¸ºæ•æ„Ÿæ€§åˆ†æ
- ä¸¤ç§åˆ†æç»“æœä¸€è‡´æ—¶ç»“è®ºæ›´å¯é 

### é”™è¯¯3ï¼šå¤šé‡æ¯”è¾ƒä¸æ ¡æ­£

**é”™è¯¯è¡¨ç°**: åŒæ—¶æ£€éªŒå¤šä¸ªæ¬¡è¦ç»“å±€ä¸è¿›è¡Œå¤šé‡æ¯”è¾ƒæ ¡æ­£

**æ­£ç¡®åšæ³•**: 
- é¢„å…ˆæŒ‡å®šä¸»è¦ç»“å±€ï¼ˆé€šå¸¸1ä¸ªï¼‰
- æ¬¡è¦ç»“å±€ä½¿ç”¨Bonferroniæˆ–FDRæ ¡æ­£
- æ˜ç¡®åŒºåˆ†é¢„è®¾åˆ†æå’Œæ¢ç´¢æ€§åˆ†æ

### é”™è¯¯4ï¼šé€‰æ‹©æ€§æŠ¥å‘Š

**é”™è¯¯è¡¨ç°**: åªæŠ¥å‘Šç»Ÿè®¡æ˜¾è‘—çš„ç»“æœ

**æ­£ç¡®åšæ³•**: 
- é¢„æ³¨å†Œç ”ç©¶æ–¹æ¡ˆï¼ˆå¦‚ClinicalTrials.govï¼‰
- æŠ¥å‘Šæ‰€æœ‰é¢„è®¾ç»“å±€
- æ˜ç¡®åŒºåˆ†é¢„è®¾å’Œäº‹ååˆ†æ

### é”™è¯¯5ï¼šè¿‡åº¦è§£è¯»äºšç»„åˆ†æ

**é”™è¯¯è¡¨ç°**: äºšç»„åˆ†æp < 0.05å°±è®¤ä¸ºå­˜åœ¨äº¤äº’ä½œç”¨

**æ­£ç¡®åšæ³•**: 
- äºšç»„åˆ†æåº”é¢„å…ˆè®¡åˆ’
- æ£€éªŒäº¤äº’ä½œç”¨ï¼ˆP for interactionï¼‰
- è€ƒè™‘å¤šé‡æ¯”è¾ƒé—®é¢˜
- ç»“è®ºéœ€åç»­ç ”ç©¶éªŒè¯

---

## è¿›é˜¶æ‰©å±•

### é€‚åº”æ€§è®¾è®¡

```{r eval=FALSE}
# é€‚åº”æ€§è®¾è®¡å…è®¸ä¸­æœŸåˆ†æè°ƒæ•´
library(rpact)

# è®¡åˆ’æœŸä¸­åˆ†æ
design <- getDesignGroupSequential(
  kMax = 2,                    # 2æ¬¡åˆ†æï¼ˆæœŸä¸­+æœ€ç»ˆï¼‰
  typeOfDesign = "asOF",       # O'Brien-Flemingç•Œå€¼
  informationRates = c(0.5, 1) # 50%å’Œ100%ä¿¡æ¯æ—¶
)

summary(design)
```

### éåŠ£æ•ˆæ€§è¯•éªŒè®¾è®¡

```{r}
# éåŠ£æ•ˆæ€§æ ·æœ¬é‡è®¡ç®—
# å‡è®¾æ–°è¯ä¸æ¯”æ ‡å‡†å·®5mmHgä»¥ä¸Š
margin <- 5  # éåŠ£æ•ˆç•Œå€¼
delta <- 0   # å‡è®¾çœŸå®å·®å¼‚ä¸º0
sd <- 15

n_noninf <- ((1.96 + 0.84)^2 * 2 * sd^2) / (margin - delta)^2
cat("éåŠ£æ•ˆæ€§è¯•éªŒæ¯ç»„æ ·æœ¬é‡:", ceiling(n_noninf), "\n")
```

### é›†ç¾¤éšæœºè¯•éªŒ

```{r}
# é›†ç¾¤éšæœºæ ·æœ¬é‡è®¡ç®—
# éœ€è¦è€ƒè™‘è®¾è®¡æ•ˆåº”
icc <- 0.05  # ç±»å†…ç›¸å…³ç³»æ•°
m <- 20      # æ¯ä¸ªé›†ç¾¤çš„ä¸ªä½“æ•°

# è®¾è®¡æ•ˆåº”
deff <- 1 + (m - 1) * icc
cat("è®¾è®¡æ•ˆåº”:", round(deff, 2), "\n")

# è°ƒæ•´åæ ·æœ¬é‡
n_cluster <- ceiling(power_result$n * deff)
cat("è°ƒæ•´åæ¯ç»„æ ·æœ¬é‡:", n_cluster, "\n")
cat("éœ€è¦çš„é›†ç¾¤æ•°:", ceiling(n_cluster / m), "ä¸ª/ç»„\n")
```

---

## æ€»ç»“

### RCTè¦ç‚¹å›é¡¾

1. **æ ¸å¿ƒä¼˜åŠ¿**ï¼šéšæœºåŒ–æ¶ˆé™¤æ··æ‚ï¼Œæ˜¯å› æœæ¨æ–­çš„é‡‘æ ‡å‡†
2. **å…³é”®è¦ç´ **ï¼šéšæœºåŒ–ã€å¯¹ç…§ã€ç›²æ³•ã€åˆ†é…éšè—
3. **åˆ†æåŸåˆ™**ï¼šITTä¸ºä¸»ï¼ŒPPä¸ºè¾…
4. **æŠ¥å‘Šè§„èŒƒ**ï¼šéµå¾ªCONSORTå£°æ˜
5. **æ ·æœ¬é‡**ï¼šéœ€é¢„å…ˆè®¡ç®—å¹¶è€ƒè™‘å¤±è®¿
6. **äºšç»„åˆ†æ**ï¼šè°¨æ…è§£è¯»ï¼Œéœ€é¢„å…ˆè®¡åˆ’

### è®¾è®¡æ£€æŸ¥æ¸…å•

- [ ] æ˜ç¡®ç ”ç©¶é—®é¢˜å’Œå‡è®¾
- [ ] é€‰æ‹©é€‚å½“çš„éšæœºåŒ–æ–¹æ³•
- [ ] è®¡ç®—æ‰€éœ€æ ·æœ¬é‡
- [ ] è®¾è®¡ç›²æ³•å®æ–½æ–¹æ¡ˆ
- [ ] æ˜ç¡®åˆ†é…éšè—æ–¹æ³•
- [ ] å®šä¹‰ITTå’ŒPPåˆ†æäººç¾¤
- [ ] é¢„å…ˆæŒ‡å®šäºšç»„åˆ†æ
- [ ] åˆ¶å®šæ•°æ®å®‰å…¨ç›‘æŸ¥è®¡åˆ’
- [ ] æ³¨å†Œä¸´åºŠè¯•éªŒæ–¹æ¡ˆ

---

## å‚è€ƒæ–‡çŒ®

1. Schulz KF, et al. CONSORT 2010 Statement: Updated guidelines for reporting parallel group randomised trials. BMJ. 2010;340:c332.

2. ICH E9(R1) Addendum: Estimands and Sensitivity Analysis in Clinical Trials. 2019.

3. Friedman LM, et al. Fundamentals of Clinical Trials. 5th ed. Springer; 2015.

4. Moher D, et al. CONSORT 2010 Explanation and Elaboration: Updated guidelines for reporting parallel group randomised trials. BMJ. 2010;340:c869.

5. å´é˜¶å¹³, è£˜æ³•ç¥–. é»„å®¶é©·å¤–ç§‘å­¦. äººæ°‘å«ç”Ÿå‡ºç‰ˆç¤¾; 2008.ï¼ˆä¸´åºŠè¯•éªŒè®¾è®¡ç« èŠ‚ï¼‰

6. Pocock SJ. Clinical Trials: A Practical Approach. Wiley; 2013.
