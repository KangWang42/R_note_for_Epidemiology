{
  "hash": "953da3994efde5acea774b1752175969",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"cowplot: 专业图形组合与美化\"\ndate: \"2025-01-10\"\ncategories: [可视化, ggplot2扩展]\nimage: \"figure/cowplot-cover.png\"\n---\n\n\n\n## 简介\n\n**cowplot** 是 ggplot2 的扩展包，专注于：\n\n- 专业主题：出版级简洁主题\n- 图形组合：灵活的多图排列\n- 图形嵌入：在图中添加子图\n- 标签注释：自动添加 A/B/C 面板标签\n- 对齐控制：精确对齐多图坐标轴\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(cowplot)\nlibrary(dplyr)\n```\n:::\n\n\n## 主题系统\n\n### theme_cowplot - 经典主题\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- ggplot(mtcars, aes(wt, mpg)) + \n  geom_point(aes(color = factor(cyl)), size = 3)\n\n# cowplot 经典主题：无网格线，粗坐标轴\np + theme_cowplot(font_size = 12)\n```\n\n::: {.cell-output-display}\n![](2021-cowplot_files/figure-html/unnamed-chunk-2-1.png){width=100%}\n:::\n:::\n\n\n### theme_minimal_grid - 极简网格\n\n\n::: {.cell}\n\n```{.r .cell-code}\np + theme_minimal_grid(font_size = 12)\n```\n\n::: {.cell-output-display}\n![](2021-cowplot_files/figure-html/unnamed-chunk-3-1.png){width=100%}\n:::\n:::\n\n\n### theme_minimal_hgrid / vgrid\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- p + theme_minimal_hgrid() + ggtitle(\"水平网格\")\np2 <- p + theme_minimal_vgrid() + ggtitle(\"垂直网格\")\nplot_grid(p1, p2, ncol = 2)\n```\n\n::: {.cell-output-display}\n![](2021-cowplot_files/figure-html/unnamed-chunk-4-1.png){width=100%}\n:::\n:::\n\n\n### theme_half_open - 半开放坐标轴\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 只显示左下坐标轴，适合科研图\np + theme_half_open(font_size = 12)\n```\n\n::: {.cell-output-display}\n![](2021-cowplot_files/figure-html/unnamed-chunk-5-1.png){width=100%}\n:::\n:::\n\n\n### 主题参数详解\n\n\n::: {.cell}\n\n```{.r .cell-code}\np + theme_cowplot(\n  font_size = 14,       # 基础字号\n  font_family = \"\",     # 字体\n  line_size = 0.5,      # 线条粗细\n  rel_small = 12/14,    # 小字号比例\n  rel_tiny = 10/14,     # 更小字号比例\n  rel_large = 16/14     # 大字号比例\n)\n```\n\n::: {.cell-output-display}\n![](2021-cowplot_files/figure-html/unnamed-chunk-6-1.png){width=100%}\n:::\n:::\n\n\n## 图形组合：plot_grid()\n\n### 基础组合\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- ggplot(mtcars, aes(wt, mpg)) + geom_point() + theme_cowplot()\np2 <- ggplot(mtcars, aes(disp, mpg)) + geom_point() + theme_cowplot()\np3 <- ggplot(mtcars, aes(factor(cyl))) + geom_bar(fill = \"steelblue\") + theme_cowplot()\np4 <- ggplot(mtcars, aes(hp, mpg)) + geom_point() + theme_cowplot()\n\n# 2x2 网格\nplot_grid(p1, p2, p3, p4, ncol = 2)\n```\n\n::: {.cell-output-display}\n![](2021-cowplot_files/figure-html/plot-grid-basic-1.png){width=100%}\n:::\n:::\n\n\n### 添加标签\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# A/B/C/D 标签\nplot_grid(\n  p1, p2, p3, p4,\n  ncol = 2,\n  labels = \"AUTO\",          # 自动 A/B/C/D\n  label_size = 14,          # 标签字号\n  label_fontface = \"bold\"   # 粗体\n)\n```\n\n::: {.cell-output-display}\n![](2021-cowplot_files/figure-html/unnamed-chunk-7-1.png){width=100%}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 自定义标签\nplot_grid(\n  p1, p2,\n  labels = c(\"图 1\", \"图 2\"),\n  label_size = 12,\n  label_x = 0.1,   # 标签 x 位置 (0-1)\n  label_y = 0.95   # 标签 y 位置 (0-1)\n)\n```\n\n::: {.cell-output-display}\n![](2021-cowplot_files/figure-html/unnamed-chunk-8-1.png){width=100%}\n:::\n:::\n\n\n### 控制相对大小\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# rel_widths 控制列宽比例\nplot_grid(p1, p3, ncol = 2, rel_widths = c(2, 1))  # 左:右 = 2:1\n```\n\n::: {.cell-output-display}\n![](2021-cowplot_files/figure-html/unnamed-chunk-9-1.png){width=100%}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# rel_heights 控制行高比例\nplot_grid(p1, p3, nrow = 2, rel_heights = c(2, 1))  # 上:下 = 2:1\n```\n\n::: {.cell-output-display}\n![](2021-cowplot_files/figure-html/unnamed-chunk-10-1.png){width=100%}\n:::\n:::\n\n\n### 对齐坐标轴\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 不同 y 轴范围的图\npa <- ggplot(mtcars, aes(wt, mpg)) + geom_point() + theme_cowplot()\npb <- ggplot(mtcars, aes(wt, disp)) + geom_point() + theme_cowplot()\n\n# align 参数对齐坐标轴\nplot_grid(\n  pa, pb,\n  ncol = 2,\n  align = \"h\",   # 水平对齐 (h/v/hv/none)\n  axis = \"bt\"    # 对齐哪些轴 (t/b/l/r/tb/lr/tblr)\n)\n```\n\n::: {.cell-output-display}\n![](2021-cowplot_files/figure-html/unnamed-chunk-11-1.png){width=100%}\n:::\n:::\n\n\n### 嵌套组合\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 复杂布局：左边一个大图，右边两个小图\nright_col <- plot_grid(p2, p3, ncol = 1, labels = c(\"B\", \"C\"))\nplot_grid(p1, right_col, ncol = 2, labels = c(\"A\", \"\"), rel_widths = c(1.5, 1))\n```\n\n::: {.cell-output-display}\n![](2021-cowplot_files/figure-html/unnamed-chunk-12-1.png){width=100%}\n:::\n:::\n\n\n## 图形嵌入：draw_plot()\n\n### 在图中嵌入子图\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 主图\nmain_plot <- ggplot(mtcars, aes(wt, mpg)) +\n  geom_point(size = 3) +\n  theme_cowplot()\n\n# 子图（缩略图）\ninset_plot <- ggplot(mtcars, aes(factor(cyl))) +\n  geom_bar(fill = \"steelblue\") +\n  theme_cowplot(font_size = 10) +\n  theme(plot.background = element_rect(fill = \"white\", color = \"grey50\"))\n\n# 将子图嵌入主图\nggdraw(main_plot) +\n  draw_plot(\n    inset_plot,\n    x = 0.6, y = 0.6,           # 子图左下角位置\n    width = 0.35, height = 0.35  # 子图尺寸\n  )\n```\n\n::: {.cell-output-display}\n![](2021-cowplot_files/figure-html/plot-inset-1.png){width=100%}\n:::\n:::\n\n\n### 多个嵌入图\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 可嵌入多个子图\ninset2 <- ggplot(mtcars, aes(hp)) +\n  geom_histogram(fill = \"coral\", bins = 15) +\n  theme_cowplot(font_size = 9) +\n  labs(title = \"HP分布\")\n\nggdraw(main_plot) +\n  draw_plot(inset_plot, x = 0.05, y = 0.6, width = 0.3, height = 0.35) +\n  draw_plot(inset2, x = 0.65, y = 0.1, width = 0.3, height = 0.3)\n```\n\n::: {.cell-output-display}\n![](2021-cowplot_files/figure-html/unnamed-chunk-13-1.png){width=100%}\n:::\n:::\n\n\n## 添加注释\n\n### draw_label()\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 添加文字标签\nggdraw(main_plot) +\n  draw_label(\n    \"R2 = 0.75\",\n    x = 0.8, y = 0.9,\n    size = 14,\n    fontface = \"bold\",\n    color = \"red\"\n  )\n```\n\n::: {.cell-output-display}\n![](2021-cowplot_files/figure-html/unnamed-chunk-14-1.png){width=100%}\n:::\n:::\n\n\n### draw_image() - 嵌入图片\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 嵌入外部图片（如 logo）\nggdraw() +\n  draw_image(\"path/to/logo.png\", x = 0.4, y = 0.4, width = 0.2) +\n  draw_plot(p1)\n```\n:::\n\n\n### draw_line() - 添加线条\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 添加参考线或箭头\nggdraw(main_plot) +\n  draw_line(x = c(0.2, 0.5), y = c(0.2, 0.8), color = \"red\", size = 1)\n```\n\n::: {.cell-output-display}\n![](2021-cowplot_files/figure-html/unnamed-chunk-16-1.png){width=100%}\n:::\n:::\n\n\n## 坐标轴对齐：align_plots()\n\n当图形有不同的坐标轴范围时，`plot_grid()` 的 `align` 参数可能不够用，此时使用 `align_plots()` 更精确。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 两个 y 轴范围差异大的图\nplot_a <- ggplot(mtcars, aes(wt, mpg)) + geom_point() + theme_cowplot()\nplot_b <- ggplot(mtcars, aes(wt, hp)) + geom_point() + theme_cowplot()\n\n# 精确对齐\naligned <- align_plots(plot_a, plot_b, align = \"hv\", axis = \"tblr\")\nplot_grid(aligned[[1]], aligned[[2]], ncol = 2)\n```\n\n::: {.cell-output-display}\n![](2021-cowplot_files/figure-html/unnamed-chunk-17-1.png){width=100%}\n:::\n:::\n\n\n## 保存组合图\n\n### save_plot()\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# cowplot 提供的保存函数\ncombined <- plot_grid(p1, p2, p3, p4, ncol = 2, labels = \"AUTO\")\n\n# 保存为 PNG\nsave_plot(\n  \"combined_plot.png\",\n  combined,\n  ncol = 2,          # 列数（用于计算尺寸）\n  nrow = 2,          # 行数\n  base_width = 4,    # 每个子图宽度（英寸）\n  base_height = 3    # 每个子图高度\n)\n\n# 保存为 PDF（矢量图）\nsave_plot(\"combined_plot.pdf\", combined, ncol = 2, nrow = 2)\n```\n:::\n\n\n### ggsave2() - 增强版 ggsave\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# ggsave2 自动处理组合图尺寸\nggsave2(\"output.png\", combined, width = 10, height = 8, dpi = 300)\n```\n:::\n\n\n## 与 ggplot2 facet 对比\n\n| 场景 | 推荐方法 |\n|------|----------|\n| 同一数据的分面 | ggplot + facet_wrap() |\n| 不同数据/不同图 | cowplot::plot_grid() |\n| 需要不同坐标轴 | cowplot::plot_grid(align = \"h\") |\n| 需要嵌入子图 | ggdraw() + draw_plot() |\n| 复杂嵌套布局 | cowplot 嵌套 plot_grid() |\n\n## 实战：完整科研图\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(42)\ndf <- mtcars |> mutate(group = ifelse(mpg > 20, \"High\", \"Low\"))\n\n# 图 A: 散点图 + 回归\nfig_a <- ggplot(df, aes(wt, mpg)) +\n  geom_point(aes(color = group), size = 3) +\n  geom_smooth(method = \"lm\", se = TRUE, color = \"grey40\") +\n  scale_color_manual(values = c(\"High\" = \"#E64B35\", \"Low\" = \"#4DAF4A\")) +\n  labs(x = \"Weight (1000 lbs)\", y = \"Miles per Gallon\", color = \"MPG Group\") +\n  theme_half_open() +\n  theme(legend.position = c(0.8, 0.8))\n\n# 图 B: 箱线图\nfig_b <- ggplot(df, aes(factor(cyl), mpg, fill = group)) +\n  geom_boxplot() +\n  scale_fill_manual(values = c(\"High\" = \"#E64B35\", \"Low\" = \"#4DAF4A\")) +\n  labs(x = \"Cylinders\", y = \"MPG\", fill = \"Group\") +\n  theme_half_open() +\n  theme(legend.position = \"none\")\n\n# 图 C: 密度图\nfig_c <- ggplot(df, aes(mpg, fill = group)) +\n  geom_density(alpha = 0.6) +\n  scale_fill_manual(values = c(\"High\" = \"#E64B35\", \"Low\" = \"#4DAF4A\")) +\n  labs(x = \"MPG\", y = \"Density\") +\n  theme_minimal_hgrid() +\n  theme(legend.position = \"none\")\n\n# 图 D: 柱状图\nfig_d <- df |>\n  count(cyl, group) |>\n  ggplot(aes(factor(cyl), n, fill = group)) +\n  geom_col(position = \"dodge\") +\n  scale_fill_manual(values = c(\"High\" = \"#E64B35\", \"Low\" = \"#4DAF4A\")) +\n  labs(x = \"Cylinders\", y = \"Count\") +\n  theme_half_open() +\n  theme(legend.position = \"none\")\n\n# 组合：上方大图，下方三个小图\ntop_row <- fig_a\nbottom_row <- plot_grid(fig_b, fig_c, fig_d, ncol = 3, labels = c(\"B\", \"C\", \"D\"), label_size = 14)\n\n# 最终组合\nfinal_plot <- plot_grid(\n  top_row, bottom_row,\n  nrow = 2,\n  labels = c(\"A\", \"\"),\n  label_size = 14,\n  rel_heights = c(1.2, 1)\n)\n\nfinal_plot\n```\n\n::: {.cell-output-display}\n![](2021-cowplot_files/figure-html/cowplot-cover-1.png){width=100%}\n:::\n:::\n\n\n## 与 patchwork 对比\n\n| 特性 | cowplot | patchwork |\n|------|---------|-----------|\n| 语法 | plot_grid(p1, p2) | p1 + p2 / p1 \\| p2 |\n| 图形嵌入 | draw_plot() | inset_element() |\n| 坐标轴对齐 | 需手动 align | 自动对齐 |\n| 标签添加 | labels = \"AUTO\" | plot_annotation(tag_levels) |\n| 主题系统 | 丰富的专业主题 | 无 |\n| 学习曲线 | 中等 | 简单 |\n\n**选择建议：**\n\n- 需要专业主题 → cowplot\n- 快速组合 → patchwork\n- 图形嵌入 → 两者均可\n- 复杂布局控制 → cowplot\n\n## 提取与共享图例\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 创建带图例的图\np_legend <- ggplot(mtcars, aes(wt, mpg, color = factor(cyl))) +\n  geom_point(size = 3) +\n  scale_color_brewer(palette = \"Set1\", name = \"Cylinders\") +\n  theme_cowplot()\n\n# 提取图例\nlegend <- get_legend(p_legend)\n\n# 创建无图例的图\np_no_leg1 <- p_legend + theme(legend.position = \"none\")\np_no_leg2 <- ggplot(mtcars, aes(disp, mpg, color = factor(cyl))) +\n  geom_point(size = 3) +\n  scale_color_brewer(palette = \"Set1\") +\n  theme_cowplot() +\n  theme(legend.position = \"none\")\n\n# 组合：两图共享一个图例\nplot_grid(\n  plot_grid(p_no_leg1, p_no_leg2, ncol = 2),\n  legend,\n  ncol = 2,\n  rel_widths = c(1, 0.15)\n)\n```\n\n::: {.cell-output-display}\n![](2021-cowplot_files/figure-html/unnamed-chunk-20-1.png){width=100%}\n:::\n:::\n\n\n## 常用函数速查\n\n| 函数 | 用途 |\n|------|------|\n| theme_cowplot() | 经典无网格主题 |\n| theme_half_open() | 半开放坐标轴 |\n| theme_minimal_grid() | 极简网格 |\n| plot_grid() | 组合多图 |\n| align_plots() | 精确对齐坐标轴 |\n| ggdraw() | 创建绑图画布 |\n| draw_plot() | 嵌入子图 |\n| draw_label() | 添加文字 |\n| draw_image() | 嵌入图片 |\n| save_plot() | 保存组合图 |\n| get_legend() | 提取图例 |\n| get_title() | 提取标题 |\n\n## 总结\n\ncowplot 核心优势：\n\n1. **专业主题** - theme_cowplot(), theme_half_open() 直接用于科研图\n2. **灵活组合** - plot_grid() 支持复杂嵌套布局\n3. **精确控制** - rel_widths, rel_heights, align 参数\n4. **图形嵌入** - draw_plot() 轻松添加子图\n5. **自动标签** - labels = \"AUTO\" 一键添加面板标签\n\n推荐工作流：\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 1. 创建单图，应用 cowplot 主题\np1 <- ggplot(...) + theme_half_open()\np2 <- ggplot(...) + theme_half_open()\n\n# 2. 组合并添加标签\ncombined <- plot_grid(p1, p2, labels = \"AUTO\", align = \"hv\")\n\n# 3. 保存\nsave_plot(\"output.pdf\", combined, ncol = 2)\n```\n:::\n\n",
    "supporting": [
      "2021-cowplot_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}